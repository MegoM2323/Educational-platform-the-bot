import{r as e,j as s}from"./react-core-JVqWokWt.js";import{u as t,a as l,b as n}from"./react-query-DqnBFrGE.js";import{k as a}from"./knowledgeGraphAPI-D8HHnFWf.js";import{C as r,J as c,K as i,L as d,V as o,W as m,aU as x,B as u,$ as h,Z as j,a1 as p,aV as N,ak as g}from"./main-fde3JC90.js";import{R as v,a as f}from"./radio-group-rQxajO1F.js";import{aA as b,b$ as w,aO as y,ay as _,az as k,$ as C,c3 as S,bp as E,a2 as q}from"./vendor-DC2AZkDs.js";import{b as $,u as L}from"./react-router-WAeXREDX.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";const K=({element:t,progress:l,onSubmit:n,onNext:a,isSubmitting:p,isLastElement:N})=>{var g,_,k;const[C,S]=e.useState((null==l?void 0:l.answer)||null),[E,q]=e.useState(!1),[$,L]=e.useState(null),K=async()=>{var e,s;if(C)try{const t=await n(C);L({success:!0,is_correct:null==(e=null==t?void 0:t.data)?void 0:e.is_correct,score:null==(s=null==t?void 0:t.data)?void 0:s.score,message:"–û—Ç–≤–µ—Ç –ø—Ä–∏–Ω—è—Ç!"})}catch(t){L({success:!1,message:t.message||"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞"})}},P="completed"===(null==l?void 0:l.status);if("theory"===t.element_type)return s.jsxs(r,{className:"w-full",children:[s.jsx(c,{children:s.jsxs(i,{className:"flex items-center gap-2",children:["üìñ ",t.title]})}),s.jsxs(d,{className:"space-y-4",children:[t.content.text&&s.jsx("div",{className:"prose prose-sm max-w-none",children:s.jsx("p",{className:"whitespace-pre-wrap",children:t.content.text})}),t.content.sections&&t.content.sections.length>0&&s.jsx("div",{className:"space-y-4",children:t.content.sections.map((e,t)=>s.jsxs("div",{className:"border-l-4 border-blue-500 pl-4",children:[s.jsx("h3",{className:"font-semibold text-lg mb-2",children:e.title}),s.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.content})]},t))}),P&&s.jsxs(o,{className:"bg-green-50 border-green-200",children:[s.jsx(b,{className:"h-4 w-4 text-green-600"}),s.jsx(m,{className:"text-green-800",children:"‚úì –ú–∞—Ç–µ—Ä–∏–∞–ª –∏–∑—É—á–µ–Ω"})]})]}),s.jsxs(x,{className:"flex justify-between",children:[s.jsxs("div",{className:"text-sm text-muted-foreground",children:["~",t.estimated_time_minutes," –º–∏–Ω"]}),P?s.jsx(u,{onClick:a,children:N?"–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫":"–î–∞–ª—å—à–µ ‚Üí"}):s.jsx(u,{onClick:()=>n({viewed:!0}),disabled:p,children:p?"–û—Ç–ø—Ä–∞–≤–∫–∞...":"–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ"})]})]});if("video"===t.element_type){const e=t.content.url||"",h=e.includes("youtube.com")||e.includes("youtu.be"),j=e=>{var s;const t=null==(s=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/))?void 0:s[1];return t?`https://www.youtube.com/embed/${t}`:e};return s.jsxs(r,{className:"w-full",children:[s.jsx(c,{children:s.jsxs(i,{className:"flex items-center gap-2",children:["üé¨ ",t.title]})}),s.jsxs(d,{className:"space-y-4",children:[t.content.description&&s.jsx("p",{className:"text-sm text-muted-foreground",children:t.content.description}),s.jsx("div",{className:"aspect-video w-full bg-black rounded-lg overflow-hidden",children:h?s.jsx("iframe",{width:"100%",height:"100%",src:j(e),title:t.title,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):s.jsxs("video",{controls:!0,className:"w-full h-full",children:[s.jsx("source",{src:e,type:"video/mp4"}),"–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ."]})}),P&&s.jsxs(o,{className:"bg-green-50 border-green-200",children:[s.jsx(b,{className:"h-4 w-4 text-green-600"}),s.jsxs(m,{className:"text-green-800",children:["‚úì –í–∏–¥–µ–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ (",(null==l?void 0:l.score)||0,"/",t.max_score," –±–∞–ª–ª–æ–≤)"]})]})]}),s.jsxs(x,{className:"flex justify-between",children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:t.content.duration_seconds?`${Math.floor(t.content.duration_seconds/60)} –º–∏–Ω`:`~${t.estimated_time_minutes} –º–∏–Ω`}),P?s.jsx(u,{onClick:a,children:N?"–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫":"–î–∞–ª—å—à–µ ‚Üí"}):s.jsx(u,{onClick:()=>n({watched_until:100}),disabled:p,children:p?"–û—Ç–ø—Ä–∞–≤–∫–∞...":"–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–µ"})]})]})}if("text_problem"===t.element_type)return s.jsxs(r,{className:"w-full",children:[s.jsx(c,{children:s.jsxs(i,{className:"flex items-center gap-2",children:["‚úèÔ∏è ",t.title]})}),s.jsxs(d,{className:"space-y-4",children:[s.jsx("div",{className:"prose prose-sm max-w-none",children:s.jsx("p",{className:"whitespace-pre-wrap font-medium",children:t.content.problem_text})}),P?s.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium mb-1",children:"–í–∞—à –æ—Ç–≤–µ—Ç:"}),s.jsx("p",{className:"text-sm whitespace-pre-wrap",children:null==C?void 0:C.text})]}):s.jsx(h,{placeholder:"–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç...",value:(null==C?void 0:C.text)||"",onChange:e=>S({text:e.target.value}),disabled:P,rows:6,className:"resize-none"}),t.content.hints&&t.content.hints.length>0&&!P&&s.jsxs("div",{children:[s.jsxs(u,{variant:"ghost",size:"sm",onClick:()=>q(!E),className:"text-blue-600",children:[s.jsx(w,{className:"w-4 h-4 mr-2"}),E?"–°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É":"–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É"]}),E&&s.jsx(o,{className:"mt-2 bg-blue-50 border-blue-200",children:s.jsxs(m,{className:"text-blue-800",children:["üí° ",t.content.hints[0]]})})]}),$&&s.jsxs(o,{className:$.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200",children:[$.success?s.jsx(b,{className:"h-4 w-4 text-green-600"}):s.jsx(y,{className:"h-4 w-4 text-red-600"}),s.jsx(m,{className:$.success?"text-green-800":"text-red-800",children:$.message})]}),P&&s.jsx(o,{className:"bg-yellow-50 border-yellow-200",children:s.jsx(m,{className:"text-yellow-800",children:"‚è≥ –û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º"})})]}),s.jsxs(x,{className:"flex justify-between",children:[s.jsxs("div",{className:"text-sm text-muted-foreground",children:["–ú–∞–∫—Å. –±–∞–ª–ª: ",t.max_score]}),P?s.jsx(u,{onClick:a,children:N?"–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫":"–î–∞–ª—å—à–µ ‚Üí"}):s.jsx(u,{onClick:K,disabled:p||!(null==C?void 0:C.text),children:p?"–û—Ç–ø—Ä–∞–≤–∫–∞...":"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç"})]})]});if("quick_question"===t.element_type){const e="completed"===(null==l?void 0:l.status)&&(null!=(g=null==l?void 0:l.score)?g:0)>0,n=null==$?void 0:$.is_correct;return s.jsxs(r,{className:"w-full",children:[s.jsx(c,{children:s.jsxs(i,{className:"flex items-center gap-2",children:["‚ùì ",t.title]})}),s.jsxs(d,{className:"space-y-4",children:[s.jsx("p",{className:"font-medium text-lg",children:t.content.question}),s.jsx(v,{value:(null==(_=null==C?void 0:C.choice)?void 0:_.toString())||"",onValueChange:e=>{S({choice:parseInt(e)}),L(null)},disabled:e,children:null==(k=t.content.choices)?void 0:k.map((e,t)=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(f,{value:t.toString(),id:`choice-${t}`}),s.jsx(j,{htmlFor:`choice-${t}`,className:"cursor-pointer flex-1",children:e})]},t))}),$&&s.jsxs(o,{className:n?"bg-green-50 border-green-200":"bg-red-50 border-red-200",children:[n?s.jsx(b,{className:"h-4 w-4 text-green-600"}):s.jsx(y,{className:"h-4 w-4 text-red-600"}),s.jsx(m,{className:n?"text-green-800":"text-red-800",children:n?`‚úì –í–µ—Ä–Ω–æ! –ü–æ–ª—É—á–µ–Ω–æ ${$.score}/${t.max_score} –±–∞–ª–ª–æ–≤`:"‚úó –ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."})]}),e&&!$&&s.jsxs(o,{className:"bg-green-50 border-green-200",children:[s.jsx(b,{className:"h-4 w-4 text-green-600"}),s.jsxs(m,{className:"text-green-800",children:["‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ (",(null==l?void 0:l.score)||0,"/",t.max_score," –±–∞–ª–ª–æ–≤)"]})]})]}),s.jsxs(x,{className:"flex justify-between",children:[s.jsxs("div",{className:"text-sm text-muted-foreground",children:["–ú–∞–∫—Å. –±–∞–ª–ª: ",t.max_score]}),e?s.jsx(u,{onClick:a,children:N?"–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Ä–æ–∫":"–î–∞–ª—å—à–µ ‚Üí"}):s.jsx(u,{onClick:K,disabled:p||void 0===(null==C?void 0:C.choice),children:p?"–û—Ç–ø—Ä–∞–≤–∫–∞...":"–û—Ç–≤–µ—Ç–∏—Ç—å"})]})]})}return s.jsx(r,{children:s.jsx(d,{className:"pt-6",children:s.jsxs("p",{className:"text-muted-foreground",children:["–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞: ",t.element_type]})})})},P=({lessonTitle:e,currentElement:t,currentElementIndex:l,totalElements:n,progressPercent:a,onSubmit:r,onNext:c,onPrevious:i,onBackToGraph:d,isSubmitting:o,isLastElement:m})=>{var x,h;const j=l>0,N=l<n-1;return s.jsxs("div",{className:"w-full max-w-4xl mx-auto space-y-6 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(u,{variant:"ghost",onClick:d,className:"gap-2",children:[s.jsx(_,{className:"w-4 h-4"}),"–ù–∞–∑–∞–¥ –∫ –≥—Ä–∞—Ñ—É"]}),s.jsxs("div",{className:"flex-1 text-center",children:[s.jsx("h1",{className:"text-2xl font-bold",children:e}),s.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["–≠–ª–µ–º–µ–Ω—Ç ",l+1," / ",n]})]}),s.jsx("div",{className:"w-[120px]"})," "]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[s.jsx("span",{children:"–ü—Ä–æ–≥—Ä–µ—Å—Å"}),s.jsxs("span",{children:[a,"%"]})]}),s.jsx(p,{value:a,className:"h-2"})]}),s.jsx(K,{element:t.element,progress:t.progress,onSubmit:r,onNext:c,isSubmitting:o,isLastElement:m}),s.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[s.jsxs(u,{variant:"outline",onClick:i,disabled:!j,className:"gap-2",children:[s.jsx(_,{className:"w-4 h-4"}),"–ù–∞–∑–∞–¥"]}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"completed"===(null==(x=t.progress)?void 0:x.status)?s.jsx("span",{className:"text-green-600 font-medium",children:"‚úì –ó–∞–≤–µ—Ä—à–µ–Ω–æ"}):"in_progress"===(null==(h=t.progress)?void 0:h.status)?s.jsx("span",{className:"text-blue-600 font-medium",children:"–í –ø—Ä–æ—Ü–µ—Å—Å–µ"}):s.jsx("span",{className:"text-gray-600",children:"–ù–µ –Ω–∞—á–∞—Ç–æ"})}),s.jsxs(u,{variant:"outline",onClick:c,disabled:!N,className:"gap-2",children:["–î–∞–ª—å—à–µ",s.jsx(k,{className:"w-4 h-4"})]})]})]})},F=()=>{var x,h,j,p,v;const{lessonId:f}=$(),b=L(),w=t(),[y,_]=e.useState(0),[k,K]=e.useState(!1),{data:F,isLoading:I,error:T}=l({queryKey:["student-lesson",f],queryFn:()=>a.getStudentLesson(f),enabled:!!f,refetchOnMount:!0,refetchOnWindowFocus:!1,staleTime:6e4});e.useEffect(()=>{if(null==F?void 0:F.elements){const e=F.elements.findIndex(e=>{var s;return"completed"!==(null==(s=e.progress)?void 0:s.status)});-1!==e&&_(e)}},[F]);const Q=null==(x=null==F?void 0:F.elements)?void 0:x[y],z=(null==(h=null==F?void 0:F.elements)?void 0:h.length)||0,A=y>=z-1,B=n({mutationFn:async e=>{var s;if(!Q)throw new Error("–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");"not_started"!==(null==(s=Q.progress)?void 0:s.status)&&Q.progress||await a.startStudentElement(Q.element.id);return await a.submitStudentAnswer(Q.element.id,e)},onSuccess:e=>{var s,t;void 0!==(null==(s=null==e?void 0:e.data)?void 0:s.is_correct)?e.data.is_correct?q.success("–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ú–æ–ª–æ–¥–µ—Ü!"):q.error("–ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."):q.success("–û—Ç–≤–µ—Ç –ø—Ä–∏–Ω—è—Ç!"),w.invalidateQueries({queryKey:["student-lesson",f]}),A||!1===(null==(t=null==e?void 0:e.data)?void 0:t.is_correct)||setTimeout(()=>{_(e=>e+1)},1500)},onError:e=>{q.error(e.message||"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞")}}),M=n({mutationFn:()=>a.completeStudentLesson(f),onSuccess:e=>{K(!0),q.success("üéâ –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω! –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!"),w.invalidateQueries({queryKey:["student-lesson",f]}),w.invalidateQueries({queryKey:["student-graph"]}),w.invalidateQueries({queryKey:["forum","chats"]})},onError:e=>{q.error(e.message||"–û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞")}}),G=e.useCallback(()=>{y<z-1&&_(e=>e+1)},[y,z]),O=e.useCallback(()=>{y>0&&_(e=>e-1)},[y]),V=e.useCallback(()=>{b("/dashboard/student/knowledge-graph")},[b]),W=e.useCallback(async e=>{await B.mutateAsync(e)},[B]),J=e.useCallback(()=>{M.mutate()},[M]),R=(null==(j=null==F?void 0:F.elements)?void 0:j.filter(e=>{var s;return"completed"===(null==(s=e.progress)?void 0:s.status)}).length)||0,U=z>0?Math.round(R/z*100):0,Z=R===z&&z>0;if(I)return s.jsx("div",{className:"flex items-center justify-center min-h-screen",children:s.jsx(N,{size:"lg"})});if(T)return s.jsx("div",{className:"flex items-center justify-center min-h-screen p-6",children:s.jsxs(o,{variant:"destructive",className:"max-w-md",children:[s.jsx(C,{className:"h-4 w-4"}),s.jsx(g,{children:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–∞"}),s.jsx(m,{children:T.message}),s.jsx(u,{variant:"outline",onClick:V,className:"mt-4",children:"–ù–∞–∑–∞–¥ –∫ –≥—Ä–∞—Ñ—É"})]})});if(!F||!Q)return s.jsx("div",{className:"flex items-center justify-center min-h-screen p-6",children:s.jsxs(o,{className:"max-w-md",children:[s.jsx(C,{className:"h-4 w-4"}),s.jsx(g,{children:"–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω"}),s.jsx(m,{children:"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —É—Ä–æ–∫. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –±—ã–ª —É–¥–∞–ª–µ–Ω."}),s.jsx(u,{variant:"outline",onClick:V,className:"mt-4",children:"–ù–∞–∑–∞–¥ –∫ –≥—Ä–∞—Ñ—É"})]})});if(k||Z){const e=(null==(p=F.progress)?void 0:p.total_score)||0,t=(null==(v=F.progress)?void 0:v.max_possible_score)||0,l=t>0?Math.round(e/t*100):0;return s.jsx("div",{className:"flex items-center justify-center min-h-screen p-6",children:s.jsxs(r,{className:"max-w-lg w-full",children:[s.jsxs(c,{className:"text-center",children:[s.jsx("div",{className:"flex justify-center mb-4",children:s.jsx(S,{className:"w-16 h-16 text-yellow-500"})}),s.jsx(i,{className:"text-3xl",children:"üéâ –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω!"})]}),s.jsxs(d,{className:"space-y-6",children:[s.jsxs("div",{className:"text-center space-y-2",children:[s.jsx("h2",{className:"text-xl font-semibold",children:F.graph_lesson.lesson.title}),s.jsx("p",{className:"text-muted-foreground",children:F.graph_lesson.lesson.description})]}),s.jsxs("div",{className:"space-y-4 border-t pt-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-muted-foreground",children:"–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:"}),s.jsxs("span",{className:"font-bold text-lg",children:[l,"%"]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-muted-foreground",children:"–ù–∞–±—Ä–∞–Ω–æ –±–∞–ª–ª–æ–≤:"}),s.jsxs("span",{className:"font-bold text-lg",children:[e," / ",t]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-muted-foreground",children:"–≠–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:"}),s.jsxs("span",{className:"font-bold text-lg",children:[R," / ",z]})]})]}),s.jsxs("div",{className:"flex gap-3 pt-4",children:[s.jsxs(u,{onClick:V,className:"flex-1 gap-2",children:["–ù–∞–∑–∞–¥ –∫ –≥—Ä–∞—Ñ—É",s.jsx(E,{className:"w-4 h-4"})]}),s.jsx(u,{variant:"outline",onClick:()=>{K(!1),_(0),w.invalidateQueries({queryKey:["student-lesson",f]})},className:"flex-1",children:"–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —É—Ä–æ–∫"})]})]})]})})}return s.jsx("div",{className:"min-h-screen bg-background",children:s.jsx(P,{lessonTitle:F.graph_lesson.lesson.title,currentElement:Q,currentElementIndex:y,totalElements:z,progressPercent:U,onSubmit:W,onNext:A&&Z?J:G,onPrevious:O,onBackToGraph:V,isSubmitting:B.isPending||M.isPending,isLastElement:A})})};export{F as default};
