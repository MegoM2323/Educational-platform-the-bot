import{r as e,j as s}from"./react-core-JVqWokWt.js";import{M as a,S as l,a as r,e as t,C as c,J as n,K as i,L as d,b as m,g as o,h as x,i as j,j as h,k as u,a3 as p,a4 as g,a5 as N,a6 as f,B as v}from"./main-fde3JC90.js";import{T as b}from"./TutorSidebar-DEiDMEeu.js";import{u as w}from"./useTutor-cHjriqfV.js";import{u as y}from"./useTutorStudentSchedule-WMCU5nXN.js";import{L as S}from"./LessonCard-BUGWm0lu.js";import{N as _}from"./react-router-WAeXREDX.js";import{ab as T,aa as k,aU as C}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";const L=(e,s)=>{try{return new Date(`${e}T${s}`)}catch{return new Date}},M=()=>{const{user:M}=a(),{data:V,isLoading:$}=w(),[B,D]=e.useState(""),[U,q]=e.useState("upcoming"),[z,A]=e.useState("all"),[E,F]=e.useState("all"),{lessons:J,isLoading:K,error:G}=y(B||null);if("tutor"!==(null==M?void 0:M.role))return s.jsx(_,{to:"/dashboard",replace:!0});const H=e.useMemo(()=>{const e=new Date;return J.filter(s=>{const a=L(s.date,s.start_time)>e;return!("upcoming"===U&&!a)&&(("past"!==U||!a)&&((!z||"all"===z||s.subject_name===z)&&(!E||"all"===E||s.teacher_name===E)))}).sort((e,s)=>{const a=L(e.date,e.start_time),l=L(s.date,s.start_time);return"upcoming"===U?a.getTime()-l.getTime():l.getTime()-a.getTime()})},[J,U,z,E]),I=e.useMemo(()=>[...new Set(J.map(e=>e.subject_name).filter(Boolean))].sort(),[J]),O=e.useMemo(()=>[...new Set(J.map(e=>e.teacher_name).filter(Boolean))].sort(),[J]),P=null==V?void 0:V.find(e=>String(e.id)===B);return s.jsx(l,{children:s.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[s.jsx(b,{}),s.jsxs(r,{className:"flex-1",children:[s.jsxs("header",{className:"sticky top-0 z-10 flex h-16 items-center border-b bg-background px-6",children:[s.jsx(t,{}),s.jsxs("h1",{className:"ml-4 text-xl font-semibold flex items-center gap-2",children:[s.jsx(T,{className:"w-5 h-5"}),"Расписание учеников"]})]}),s.jsx("main",{className:"p-6",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs(c,{children:[s.jsx(n,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(k,{className:"w-5 h-5"}),s.jsx(i,{className:"text-lg",children:"Выберите ученика"})]})}),s.jsxs(d,{children:[$?s.jsx(m,{className:"h-10 w-full"}):s.jsxs(o,{value:B,onValueChange:D,children:[s.jsx(x,{children:s.jsx(j,{placeholder:"Выберите ученика..."})}),s.jsx(h,{children:null==V?void 0:V.map(e=>s.jsx(u,{value:String(e.id),children:e.full_name||"Unknown"},e.id))})]}),P&&s.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium",children:P.full_name}),P.subjects&&P.subjects.length>0&&s.jsxs("div",{className:"mt-2",children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:"Предметы:"}),s.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:P.subjects.map(e=>s.jsx("span",{className:"text-xs px-2 py-1 bg-background rounded-md",children:e.name},e.enrollment_id))})]})]})]})]}),B&&s.jsxs(s.Fragment,{children:[s.jsxs(c,{children:[s.jsx(n,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(C,{className:"w-5 h-5"}),s.jsx(i,{className:"text-lg",children:"Фильтры"})]})}),s.jsx(d,{children:s.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Предмет"}),s.jsxs(o,{value:z,onValueChange:A,children:[s.jsx(x,{children:s.jsx(j,{placeholder:"Все предметы"})}),s.jsxs(h,{children:[s.jsx(u,{value:"all",children:"Все предметы"}),I.map(e=>s.jsx(u,{value:e,children:e},e))]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Преподаватель"}),s.jsxs(o,{value:E,onValueChange:F,children:[s.jsx(x,{children:s.jsx(j,{placeholder:"Все преподаватели"})}),s.jsxs(h,{children:[s.jsx(u,{value:"all",children:"Все преподаватели"}),O.map(e=>s.jsx(u,{value:e,children:e},e))]})]})]})]})})]}),s.jsxs(p,{value:U,onValueChange:e=>q(e),children:[s.jsxs(g,{className:"grid w-full sm:w-auto grid-cols-2",children:[s.jsx(N,{value:"upcoming",children:"Предстоящие"}),s.jsx(N,{value:"past",children:"Прошедшие"})]}),s.jsx(f,{value:U,className:"space-y-4 mt-6",children:K?s.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,a)=>s.jsx(c,{className:"overflow-hidden",children:s.jsx(d,{className:"p-6",children:s.jsxs("div",{className:"space-y-3",children:[s.jsx(m,{className:"h-6 w-1/2"}),s.jsx(m,{className:"h-4 w-1/3"}),s.jsx(m,{className:"h-4 w-2/3"})]})})},`lesson-skeleton-${a}`))}):G?s.jsx(c,{className:"border-destructive",children:s.jsxs(d,{className:"p-12 text-center",children:[s.jsx("div",{className:"mx-auto mb-4 w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center",children:s.jsx(T,{className:"w-6 h-6 text-destructive"})}),s.jsx("h3",{className:"text-lg font-semibold mb-2 text-destructive",children:"Ошибка загрузки расписания"}),s.jsx("p",{className:"text-muted-foreground mb-6",children:G instanceof Error?G.message:"Не удалось загрузить расписание. Попробуйте обновить страницу."}),s.jsx(v,{type:"button",onClick:()=>window.location.reload(),variant:"outline",children:"Обновить страницу"})]})}):0===H.length?s.jsx(c,{children:s.jsxs(d,{className:"p-12 text-center",children:[s.jsx(T,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"upcoming"===U?"Нет предстоящих занятий":"Нет прошедших занятий"}),s.jsx("p",{className:"text-muted-foreground",children:"upcoming"===U?"У ученика пока нет запланированных занятий":"У ученика ещё нет завершённых занятий"})]})}):s.jsx("div",{className:"space-y-4",children:H.map(e=>s.jsx(S,{lesson:e},e.id))})})]})]}),!B&&!$&&s.jsx(c,{children:s.jsxs(d,{className:"p-12 text-center",children:[s.jsx(k,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Выберите ученика"}),s.jsx("p",{className:"text-muted-foreground",children:"Выберите ученика из списка выше, чтобы просмотреть его расписание"})]})})]})})]})]})})};export{M as default};
