import{r as e,j as s}from"./react-core-JVqWokWt.js";import{C as a,J as r,K as l,L as t,b as i,B as c,M as n,u as d,l as m,S as o,a as x,e as h,N as j,c as u,A as p,v as N}from"./main-fde3JC90.js";import{T as v}from"./TeacherSidebar-Bwv8PTW2.js";import{u as f,a as g}from"./useTeacher-DJCQuFgv.js";import{u as b}from"./useTeacherLessons-FFsXHQWt.js";import{u as y}from"./react-router-WAeXREDX.js";import{ab as w,aD as _,aE as k,aF as C,bp as D,ao as T,$,ap as L,am as S,aa as E,aq as M,aG as z,aT as R,ac as U}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";import"./teacher-BhCI6v5d.js";const A=()=>{y();const{lessons:n,isLoading:d,error:m}=b(),o=e.useMemo(()=>n.filter(e=>e.is_upcoming).sort((e,s)=>new Date(`${e.date}T${e.start_time}`).getTime()-new Date(`${s.date}T${s.start_time}`).getTime()).slice(0,3),[n]);return m?s.jsxs(a,{children:[s.jsx(r,{children:s.jsxs(l,{className:"flex items-center gap-2",children:[s.jsx(w,{className:"w-5 h-5 text-primary"}),"Следующие занятия"]})}),s.jsx(t,{children:s.jsxs("div",{className:"text-center py-8 text-destructive",children:[s.jsx("p",{className:"text-sm",children:"Ошибка загрузки расписания"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Попробуйте обновить страницу"})]})})]}):d?s.jsxs(a,{children:[s.jsx(r,{children:s.jsx(i,{className:"h-6 w-48"})}),s.jsxs(t,{className:"space-y-4",children:[s.jsx(i,{className:"h-24 w-full"}),s.jsx(i,{className:"h-20 w-full"}),s.jsx(i,{className:"h-20 w-full"})]})]}):s.jsxs(a,{children:[s.jsx(r,{children:s.jsxs(l,{className:"flex items-center gap-2",children:[s.jsx(w,{className:"w-5 h-5 text-primary"}),"Следующие занятия"]})}),s.jsx(t,{className:"space-y-4",children:0===o.length?s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(w,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),s.jsx("p",{className:"text-sm",children:"Нет запланированных занятий"})]}):o.map((e,a)=>s.jsx("div",{className:"border-b pb-4 last:border-0 last:pb-0 "+(a>0?"pt-4":""),children:s.jsxs("div",{className:"flex justify-between items-start gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-semibold text-sm",children:e.student_name||"Студент"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.subject_name||"Предмет"}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-2",children:[s.jsx(w,{className:"w-3 h-3"}),s.jsx("span",{children:_(new Date(`${e.date}T${e.start_time}`),"d MMM yyyy",{locale:k})}),s.jsx("span",{children:"•"}),s.jsx(C,{className:"w-3 h-3"}),s.jsx("span",{children:e.start_time.slice(0,5)})]})]}),e.telemost_link&&s.jsx(c,{type:"button",size:"sm",variant:"outline",asChild:!0,className:"whitespace-nowrap",children:s.jsx("a",{href:e.telemost_link,target:"_blank",rel:"noopener noreferrer",children:"Присоединиться"})})]})},e.id))}),s.jsx("div",{className:"border-t px-6 py-4",children:s.jsx(c,{type:"button",variant:"outline",asChild:!0,className:"w-full",children:s.jsxs("a",{href:"/dashboard/teacher/schedule",className:"flex items-center justify-center",children:["Все занятия",s.jsx(D,{className:"w-4 h-4 ml-2"})]})})})]})},F=()=>{var r,l,t,b,w,_,k,D,F,q,J,O,B,G,K,P,W,X,Y,Z;const{user:H,signOut:I}=n(),Q=y();d();const{data:V,isLoading:ee,error:se,refetch:ae}=f(),{data:re=[],isLoading:le}=g(),te=ee||le,ie=(null==se?void 0:se.message)||null;e.useEffect(()=>{se&&(m.error("[TeacherDashboard] Dashboard fetch error:",se),m.error("[TeacherDashboard] Error message:",se.message),m.error("[TeacherDashboard] Full error:",JSON.stringify(se,null,2))),V&&(m.debug("[TeacherDashboard] Dashboard data loaded:",V),m.debug("[TeacherDashboard] Profile data:",V.profile),m.debug("[TeacherDashboard] Teacher info:",V.teacher_info))},[se,V]);const ce=()=>{Q("/dashboard/teacher/materials/create")},ne=()=>{Q("/dashboard/teacher/reports")};return s.jsx(o,{children:s.jsxs("div",{className:"flex min-h-screen w-full",children:[s.jsx(v,{}),s.jsxs(x,{children:[s.jsxs("header",{className:"sticky top-0 z-10 flex h-16 items-center gap-4 border-b bg-background px-6",children:[s.jsx(h,{}),s.jsx("div",{className:"flex-1"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(c,{type:"button",className:"gradient-primary shadow-glow",onClick:ce,children:[s.jsx(T,{className:"w-4 h-4 mr-2"}),"Создать материал"]})})]}),s.jsx("main",{className:"p-6",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Личный кабинет преподавателя"}),s.jsxs("p",{className:"text-muted-foreground",children:[(null==H?void 0:H.first_name)||"Преподаватель"," | ",null!=(l=null==(r=null==V?void 0:V.progress_overview)?void 0:r.total_students)?l:0," учеников"]})]}),ie&&s.jsx(a,{className:"p-6 border-destructive bg-destructive/10",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[s.jsx($,{className:"w-5 h-5"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:"Не удалось загрузить данные дашборда"}),s.jsx("div",{className:"text-sm mt-1",children:ie})]})]}),s.jsx(c,{type:"button",onClick:()=>ae(),variant:"outline",size:"sm",children:"Повторить попытку"})]})}),!te&&!ie&&V&&s.jsx(j,{userName:(null==(t=V.teacher_info)?void 0:t.name)||(null==H?void 0:H.first_name)||"Преподаватель",userEmail:(null==H?void 0:H.email)||"email@example.com",userRole:"teacher",avatarUrl:(null==(b=V.teacher_info)?void 0:b.avatar)||(null==(w=V.profile)?void 0:w.avatar_url),profileData:(()=>{var e,s,a,r;try{const l=null==(e=null==V?void 0:V.profile)?void 0:e.subjects;let t=[];return l&&(Array.isArray(l)?t=l.map(e=>"string"==typeof e?e:e&&"object"==typeof e&&e.name?e.name:String(e)):"string"==typeof l&&(t=[l])),{subjects:t,experience:Number(null==(s=null==V?void 0:V.profile)?void 0:s.experience)||0,studentsCount:Number(null==(a=null==V?void 0:V.progress_overview)?void 0:a.total_students)||0,materialsCount:Number(null==(r=null==V?void 0:V.progress_overview)?void 0:r.total_materials)||0}}catch(l){return m.error("[TeacherDashboard] Error extracting profile data:",l),{subjects:[],experience:0,studentsCount:0,materialsCount:0}}})(),onEdit:()=>{Q("/profile/teacher")}}),te&&s.jsx(a,{className:"p-6",children:s.jsxs("div",{className:"flex gap-4 items-start",children:[s.jsx(i,{className:"w-24 h-24 rounded-full"}),s.jsxs("div",{className:"flex-1 space-y-3",children:[s.jsx(i,{className:"h-6 w-48"}),s.jsx(i,{className:"h-4 w-64"}),s.jsx(i,{className:"h-4 w-40"})]})]})}),te&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>s.jsxs(a,{className:"p-4",children:[s.jsx(i,{className:"h-12 w-12 mb-3"}),s.jsx(i,{className:"h-6 w-16 mb-2"}),s.jsx(i,{className:"h-4 w-20"})]},`stat-skeleton-${e}`))}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.jsxs(a,{className:"p-6",children:[s.jsx(i,{className:"h-6 w-32 mb-4"}),s.jsx("div",{className:"space-y-3",children:[1,2,3].map(e=>s.jsx(i,{className:"h-16 w-full"},`lesson-skeleton-${e}`))})]}),s.jsxs(a,{className:"p-6",children:[s.jsx(i,{className:"h-6 w-32 mb-4"}),s.jsx("div",{className:"space-y-3",children:[1,2,3].map(e=>s.jsx(i,{className:"h-16 w-full"},`assignment-skeleton-${e}`))})]})]})]}),!te&&!ie&&V&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(a,{className:"p-4 hover:border-primary transition-colors cursor-pointer",onClick:()=>Q("/dashboard/teacher/materials"),children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 gradient-primary rounded-lg flex items-center justify-center",children:s.jsx(L,{className:"w-6 h-6 text-primary-foreground"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold",children:null!=(k=null==(_=V.progress_overview)?void 0:_.total_materials)?k:0}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Материалов"})]})]})}),s.jsx(a,{className:"p-4 hover:border-primary transition-colors cursor-pointer",onClick:()=>Q("/dashboard/teacher/submissions/pending"),children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 gradient-secondary rounded-lg flex items-center justify-center",children:s.jsx(S,{className:"w-6 h-6 text-secondary-foreground"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold",children:Math.max((null!=(F=null==(D=V.progress_overview)?void 0:D.total_assignments)?F:0)-(null!=(J=null==(q=V.progress_overview)?void 0:q.completed_assignments)?J:0),0)}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"На проверке"})]})]})}),s.jsx(a,{className:"p-4 hover:border-primary transition-colors cursor-pointer",onClick:()=>Q("/dashboard/teacher/materials"),children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center",children:s.jsx(E,{className:"w-6 h-6 text-accent"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold",children:null!=(B=null==(O=V.progress_overview)?void 0:O.total_students)?B:0}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Учеников"})]})]})}),s.jsx(a,{className:"p-4 hover:border-primary transition-colors cursor-pointer",onClick:()=>Q("/dashboard/teacher/reports"),children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-12 h-12 bg-success/20 rounded-lg flex items-center justify-center",children:s.jsx(M,{className:"w-6 h-6 text-success"})}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-bold",children:(null!=(G=V.reports)?G:[]).length}),s.jsx("div",{className:"text-sm text-muted-foreground",children:"Отправлено отчетов"})]})]})})]}),s.jsx(A,{}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(S,{className:"w-5 h-5 text-primary"}),s.jsx("h3",{className:"text-xl font-bold",children:"Задания на проверку"})]}),s.jsx(u,{variant:"destructive",children:re.length})]}),s.jsxs("div",{className:"space-y-3",children:[re.slice(0,3).map(e=>s.jsx("div",{className:"p-4 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer",onClick:()=>(e.id,void Q("/dashboard/teacher/submissions/pending")),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(p,{className:"w-10 h-10",children:s.jsx(N,{className:"gradient-primary text-primary-foreground",children:e.student_name.split(" ").map(e=>e[0]).join("")})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"flex items-center justify-between mb-1",children:s.jsx("div",{className:"font-medium",children:e.student_name})}),s.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:e.material_title}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[s.jsx(C,{className:"w-3 h-3"}),"Сдано ",new Date(e.submitted_at).toLocaleDateString("ru-RU")]})]})]})},e.id)),0===re.length&&s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(S,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Нет заданий на проверку"})]})]}),s.jsx(c,{type:"button",variant:"outline",className:"w-full mt-4",onClick:()=>Q("/dashboard/teacher/submissions/pending"),children:"Все задания"})]}),s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(L,{className:"w-5 h-5 text-primary"}),s.jsx("h3",{className:"text-xl font-bold",children:"Опубликованные материалы"})]}),s.jsxs(c,{type:"button",size:"sm",variant:"outline",onClick:ce,children:[s.jsx(T,{className:"w-4 h-4 mr-1"}),"Добавить"]})]}),s.jsxs("div",{className:"space-y-3",children:[(null!=(K=V.materials)?K:[]).slice(0,3).map(e=>{var a;return s.jsxs("div",{className:"p-4 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer",onClick:()=>(e.id,void Q("/dashboard/teacher/materials")),children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("div",{className:"font-medium",children:e.title}),s.jsxs("div",{className:"flex items-center gap-2",children:[e.file_url&&s.jsx(z,{className:"w-4 h-4 text-muted-foreground"}),s.jsx(u,{variant:"active"===e.status?"default":"secondary",children:"active"===e.status?"Активно":"Черновик"})]})]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("span",{children:[e.assigned_count," учеников"]}),s.jsx("span",{children:"•"}),s.jsx("span",{children:(null==(a=e.subject)?void 0:a.name)||"Без предмета"}),s.jsx("span",{children:"•"}),s.jsx("span",{children:new Date(e.created_at).toLocaleDateString("ru-RU")})]})]},e.id)}),0===(null!=(P=V.materials)?P:[]).length&&s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(L,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Нет опубликованных материалов"})]})]}),s.jsx(c,{type:"button",variant:"outline",className:"w-full mt-4",onClick:()=>Q("/dashboard/teacher/materials"),children:"Все материалы"})]})]}),s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(E,{className:"w-5 h-5 text-primary"}),s.jsx("h3",{className:"text-xl font-bold",children:"Ученики"})]}),s.jsxs(u,{variant:"outline",children:[(null!=(W=V.students)?W:[]).length," всего"]})]}),s.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:(null!=(X=V.students)?X:[]).slice(0,4).map(e=>{var a,r,l;return s.jsx("div",{className:"p-4 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer",onClick:()=>(e.id,void Q("/dashboard/teacher/materials")),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(p,{className:"w-10 h-10",children:s.jsx(N,{className:"gradient-secondary text-secondary-foreground",children:e.name.split(" ").map(e=>e[0]).join("")})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("div",{className:"font-medium",children:e.name}),(null==(a=e.profile)?void 0:a.grade)&&s.jsxs(u,{variant:"outline",className:"text-xs",children:[e.profile.grade," класс"]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[s.jsx(R,{className:"w-3 h-3"}),"Прогресс: ",null!=(l=null==(r=e.profile)?void 0:r.progress_percentage)?l:0,"%"]}),e.subjects&&e.subjects.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.subjects.map(e=>s.jsxs(u,{variant:"outline",className:"text-xs",style:{borderColor:e.color},children:[s.jsx("div",{className:"w-2 h-2 rounded-full mr-1",style:{backgroundColor:e.color}}),e.name]},e.id))})]})]})},e.id)})}),s.jsx(c,{type:"button",variant:"outline",className:"w-full mt-4",onClick:()=>Q("/dashboard/teacher/materials"),children:"Все ученики"})]}),s.jsxs(a,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(M,{className:"w-5 h-5 text-primary"}),s.jsx("h3",{className:"text-xl font-bold",children:"Отчёты"})]}),s.jsxs(c,{type:"button",size:"sm",variant:"outline",onClick:ne,children:[s.jsx(T,{className:"w-4 h-4 mr-1"}),"Создать"]})]}),s.jsxs("div",{className:"space-y-3",children:[(null!=(Y=V.reports)?Y:[]).slice(0,3).map(e=>s.jsx("div",{className:"p-4 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer",onClick:()=>(e.id,void Q("/dashboard/teacher/reports")),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium mb-1",children:e.title}),s.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.student_name," • ",e.subject]}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.created_at).toLocaleDateString("ru-RU")})]}),s.jsx(u,{variant:"sent"===e.status?"default":"secondary",children:"sent"===e.status?"Отправлено":"Черновик"})]})},e.id)),0===(null!=(Z=V.reports)?Z:[]).length&&s.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[s.jsx(M,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Нет созданных отчетов"})]})]}),s.jsx(c,{type:"button",variant:"outline",className:"w-full mt-4",onClick:()=>Q("/dashboard/teacher/reports"),children:"Все отчёты"})]}),s.jsxs(a,{className:"p-6",children:[s.jsx("h3",{className:"text-xl font-bold mb-4",children:"Быстрые действия"}),s.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(c,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:ce,children:[s.jsx(L,{className:"w-6 h-6"}),s.jsx("span",{children:"Создать материал"})]}),s.jsxs(c,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:ne,children:[s.jsx(M,{className:"w-6 h-6"}),s.jsx("span",{children:"Создать отчёт"})]}),s.jsxs(c,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>{Q("/dashboard/teacher/chat")},children:[s.jsx(U,{className:"w-6 h-6"}),s.jsx("span",{children:"Сообщения"})]}),s.jsxs(c,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>Q("/dashboard/teacher/assign-subject"),children:[s.jsx(E,{className:"w-6 h-6"}),s.jsx("span",{children:"Назначить предмет"})]})]})]})]})]})})]})]})})};export{F as default};
