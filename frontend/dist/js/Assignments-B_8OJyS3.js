import{r as e,j as s}from"./react-core-JVqWokWt.js";import{M as a,S as t,a0 as l,a as c,e as i,a3 as r,a4 as n,a5 as d,a6 as m,C as x,L as o,b as h,D as j,w as u,x as p,y as N,$ as g,_ as f,c as v,a7 as y,B as w,J as b,K as D,Y as _,l as k}from"./main-fde3JC90.js";import{u as C,a as M}from"./useAssignments-DmsJPlD2.js";import{N as S}from"./react-router-WAeXREDX.js";import{aq as T,$ as A,am as $,bA as q,aF as z,aD as E,aE as F}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";import"./migration-O34B3Isr.js";const H=()=>{const{user:H}=a(),{data:L=[],isLoading:P,error:B}=C(),[J,K]=e.useState("active"),[O,V]=e.useState(null),[Y,G]=e.useState(!1),[I,Q]=e.useState(""),[R,U]=e.useState(null),W=M((null==O?void 0:O.id)||0);if("student"!==(null==H?void 0:H.role))return s.jsx(S,{to:"/dashboard",replace:!0});const X=new Date,Z=e.useMemo(()=>L.filter(e=>"published"===e.status&&new Date(e.due_date)>X).sort((e,s)=>new Date(e.due_date).getTime()-new Date(s.due_date).getTime()),[L,X]),ee=e.useMemo(()=>L.filter(e=>"closed"===e.status||new Date(e.due_date)<=X).sort((e,s)=>new Date(s.due_date).getTime()-new Date(e.due_date).getTime()),[L,X]),se=e=>{const a=new Date(e.due_date);if("closed"===e.status)return s.jsx(v,{variant:"secondary",children:"Закрыто"});if(a<X)return s.jsx(v,{variant:"destructive",children:"Просрочено"});const t=(a.getTime()-X.getTime())/36e5;return t<24?s.jsx(v,{variant:"destructive",children:"Срочно"}):t<72?s.jsx(v,{variant:"default",children:"Скоро"}):s.jsx(v,{variant:"outline",children:"Активно"})},ae=e=>s.jsxs(x,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.jsx(b,{children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs(D,{className:"text-lg flex items-center gap-2",children:[s.jsx(T,{className:"w-5 h-5"}),e.title]}),s.jsx(_,{className:"mt-2",children:e.description})]}),se(e)]})}),s.jsxs(o,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(z,{className:"w-4 h-4"}),s.jsxs("span",{children:["Срок: ",E(new Date(e.due_date),"dd MMMM yyyy, HH:mm",{locale:F})]})]}),s.jsxs(v,{variant:"outline",children:[e.max_score," баллов"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(v,{variant:"secondary",className:"text-xs",children:["homework"===e.type&&"Домашнее задание","test"===e.type&&"Тест","project"===e.type&&"Проект","essay"===e.type&&"Эссе","practical"===e.type&&"Практическая работа"]}),s.jsxs(v,{variant:"outline",className:"text-xs",children:["Уровень ",e.difficulty_level]})]}),"published"===e.status&&new Date(e.due_date)>X&&s.jsx(w,{type:"button",onClick:()=>{V(e),G(!0)},className:"w-full",children:"Отправить ответ"})]})]},e.id);return s.jsxs(t,{children:[s.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[s.jsx(l,{}),s.jsxs(c,{className:"flex-1",children:[s.jsxs("header",{className:"sticky top-0 z-10 flex h-16 items-center border-b bg-background px-6",children:[s.jsx(i,{}),s.jsxs("h1",{className:"ml-4 text-xl font-semibold flex items-center gap-2",children:[s.jsx(T,{className:"w-5 h-5"}),"Мои задания"]})]}),s.jsx("main",{className:"p-6",children:s.jsx("div",{className:"space-y-6",children:s.jsxs(r,{value:J,onValueChange:e=>K(e),children:[s.jsxs(n,{className:"grid w-full sm:w-auto grid-cols-2",children:[s.jsxs(d,{value:"active",children:["Активные (",Z.length,")"]}),s.jsxs(d,{value:"completed",children:["Завершенные (",ee.length,")"]})]}),s.jsx(m,{value:"active",className:"space-y-4 mt-6",children:P?s.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,a)=>s.jsx(x,{children:s.jsx(o,{className:"p-6",children:s.jsxs("div",{className:"space-y-3",children:[s.jsx(h,{className:"h-6 w-1/2"}),s.jsx(h,{className:"h-4 w-full"}),s.jsx(h,{className:"h-4 w-2/3"})]})})},`assignment-skeleton-${a}`))}):B?s.jsx(x,{className:"border-destructive",children:s.jsxs(o,{className:"p-12 text-center",children:[s.jsx(A,{className:"w-12 h-12 mx-auto mb-4 text-destructive"}),s.jsx("h3",{className:"text-lg font-semibold mb-2 text-destructive",children:"Ошибка загрузки заданий"}),s.jsx("p",{className:"text-muted-foreground",children:B instanceof Error?B.message:"Не удалось загрузить задания"})]})}):0===Z.length?s.jsx(x,{children:s.jsxs(o,{className:"p-12 text-center",children:[s.jsx($,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Нет активных заданий"}),s.jsx("p",{className:"text-muted-foreground",children:"У вас пока нет активных заданий. Они появятся здесь, когда преподаватель назначит их вам."})]})}):s.jsx("div",{className:"grid gap-4",children:Z.map(ae)})}),s.jsx(m,{value:"completed",className:"space-y-4 mt-6",children:P?s.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,a)=>s.jsx(x,{children:s.jsx(o,{className:"p-6",children:s.jsxs("div",{className:"space-y-3",children:[s.jsx(h,{className:"h-6 w-1/2"}),s.jsx(h,{className:"h-4 w-full"}),s.jsx(h,{className:"h-4 w-2/3"})]})})},`assignment-skeleton-${a}`))}):0===ee.length?s.jsx(x,{children:s.jsxs(o,{className:"p-12 text-center",children:[s.jsx(T,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Нет завершенных заданий"}),s.jsx("p",{className:"text-muted-foreground",children:"Здесь будут отображаться завершенные задания"})]})}):s.jsx("div",{className:"grid gap-4",children:ee.map(ae)})})]})})})]})]}),s.jsx(j,{open:Y,onOpenChange:G,children:s.jsxs(u,{className:"max-w-2xl",children:[s.jsx(p,{children:s.jsxs(N,{children:["Отправить ответ: ",null==O?void 0:O.title]})}),s.jsxs("div",{className:"space-y-4",children:[O&&s.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium mb-2",children:"Инструкции:"}),s.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:O.instructions})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Ваш ответ"}),s.jsx(g,{value:I,onChange:e=>Q(e.target.value),placeholder:"Введите ваш ответ...",rows:8,className:"resize-none"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Файл (опционально)"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{type:"file",onChange:e=>{e.target.files&&e.target.files[0]&&U(e.target.files[0])},accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),R&&s.jsxs(v,{variant:"outline",className:"flex items-center gap-1",children:[s.jsx(q,{className:"w-3 h-3"}),R.name]})]})]})]}),s.jsxs(y,{children:[s.jsx(w,{type:"button",variant:"outline",onClick:()=>{G(!1),Q(""),U(null)},children:"Отмена"}),s.jsx(w,{type:"button",onClick:async()=>{if(O&&I.trim())try{await W.mutateAsync({content:I,file:R||void 0}),G(!1),Q(""),U(null),V(null)}catch(e){k.error("Failed to submit assignment:",e)}},disabled:!I.trim()||W.isPending,children:W.isPending?"Отправка...":"Отправить"})]})]})})]})};export{H as default};
