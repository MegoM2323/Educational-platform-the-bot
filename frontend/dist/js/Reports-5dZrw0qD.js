const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/main-fde3JC90.js","js/react-core-JVqWokWt.js","js/react-dom-DyRXjBRd.js","js/vendor-DC2AZkDs.js","js/d3-lib-BmB4v4DK.js","js/radix-ui-Ch8xfAyl.js","js/react-query-DqnBFrGE.js","js/react-router-WAeXREDX.js","js/charts-CKrVAx-o.js","css/main-BeSJoGJH.css"])))=>i.map(i=>d[i]);
import{u as e,f as s,l as t,S as a,P as r,a as n,e as i,c as l,C as c,g as d,h as o,i as h,j as m,k as x,B as u,D as j,w as p,x as g,y as v,z as f,aa as b,ab as N,ac as _,ad as y,ae as w,af as S,ag as k,ah as R,ai as D}from"./main-fde3JC90.js";import{r as C,j as E}from"./react-core-JVqWokWt.js";import{a as P}from"./reports-v_q60BAg.js";import{aq as L,ab as A,au as O,am as I,an as z}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./react-router-WAeXREDX.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";function U(){const[U,V]=C.useState(!1),[q,T]=C.useState([]),[Z,F]=C.useState([]),[$,B]=C.useState(null),[G,H]=C.useState(null),[J,K]=C.useState(null),{toast:M}=e(),Q=C.useCallback(async()=>{var e;try{V(!0);const t=await s.request("/materials/dashboard/parent/children/");(null==(e=t.data)?void 0:e.children)&&(F(t.data.children),t.data.children.length>0&&B(t.data.children[0].id))}catch(t){M({title:"Ошибка",description:t.message||"Не удалось загрузить список детей",variant:"destructive"})}finally{V(!1)}},[M]),W=C.useCallback(async()=>{try{V(!0),t.debug("[Parent Reports] Loading reports, selectedChild:",$);const e=await P.getReports();t.debug("[Parent Reports] Reports loaded:",e);const s=Array.isArray(e)?e:[];if(t.debug("[Parent Reports] Reports array length:",s.length),$){const e=s.length,a=s.filter(e=>e.student===$);t.debug("[Parent Reports] Filtered reports:",e,"->",a.length),T(a)}else t.debug("[Parent Reports] Setting all reports:",s.length),T(s)}catch(e){t.error("[Parent Reports] Error loading reports:",e),t.error("[Parent Reports] Error details:",{message:null==e?void 0:e.message,response:null==e?void 0:e.response,stack:null==e?void 0:e.stack}),M({title:"Ошибка",description:e.message||"Не удалось загрузить отчёты",variant:"destructive"}),T([])}finally{V(!1)}},[$,M]);C.useEffect(()=>{Q()},[Q]),C.useEffect(()=>{(async()=>{const{cacheService:e}=await D(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));e.delete("/reports/tutor-weekly-reports/")})().then(()=>{W()})},[W]);const X=async e=>{try{V(!0),await P.markAsRead(e),T(s=>s.map(s=>s.id===e?{...s,status:"read",read_at:(new Date).toISOString()}:s)),M({title:"Успешно",description:"Отчёт отмечен как прочитанный"});const{cacheService:s}=await D(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));s.delete("/reports/tutor-weekly-reports/")}catch(s){M({title:"Ошибка",description:s.message||"Не удалось отметить отчёт",variant:"destructive"})}finally{V(!1)}},Y=e=>{if(!e)return E.jsx(l,{variant:"outline",children:"Не указан"});return E.jsx(l,{variant:{sent:"default",read:"default",draft:"secondary",archived:"outline"}[e]||"outline",children:{sent:"Отправлен",read:"Прочитан",draft:"Черновик",archived:"Архив"}[e]||e})},ee=q.filter(e=>"sent"===e.status).length;return E.jsxs(a,{children:[E.jsxs("div",{className:"flex min-h-screen w-full",children:[E.jsx(r,{}),E.jsxs(n,{children:[E.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4",children:[E.jsx(i,{}),E.jsxs("div",{className:"flex items-center gap-2",children:[E.jsx(L,{className:"h-5 w-5"}),E.jsx("h1",{className:"text-lg font-semibold",children:"Отчёты от тьютора"}),ee>0&&E.jsxs(l,{variant:"default",className:"ml-2",children:[ee," непрочитанных"]})]})]}),E.jsx("main",{className:"flex flex-1 flex-col gap-4 p-4",children:E.jsxs("div",{className:"space-y-6",children:[Z.length>1&&E.jsxs(c,{className:"p-4",children:[E.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Выберите ребёнка"}),E.jsxs(d,{value:(null==$?void 0:$.toString())||"",onValueChange:e=>B(parseInt(e)),children:[E.jsx(o,{children:E.jsx(h,{placeholder:"Выберите ребёнка"})}),E.jsx(m,{children:Z.map(e=>E.jsxs(x,{value:e.id.toString(),children:[e.name," (",e.grade," класс)"]},e.id))})]})]}),E.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[0===q.length&&!U&&E.jsx(c,{className:"p-6 col-span-2",children:E.jsxs("div",{className:"text-center text-muted-foreground",children:[E.jsx(L,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),E.jsx("p",{children:"Отчётов пока нет"}),E.jsx("p",{className:"text-xs mt-2",children:"Отчёты от тьютора появятся здесь после их отправки"})]})}),q.filter(e=>e&&e.id).map(e=>E.jsxs(c,{className:"p-6 hover:border-primary transition-colors "+("sent"===e.status?"border-primary border-2":""),children:[E.jsxs("div",{className:"flex items-start justify-between mb-2",children:[E.jsxs("div",{className:"flex-1",children:[E.jsx("h3",{className:"font-bold mb-1",children:e.title||"Без названия"}),E.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Ученик: ",e.student_name||"Не указан"]}),E.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Тьютор: ",e.tutor_name||"Не указан"]}),E.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-2",children:[E.jsx(A,{className:"w-3 h-3"}),e.week_start&&e.week_end?E.jsxs(E.Fragment,{children:[new Date(e.week_start).toLocaleDateString("ru-RU")," - ",new Date(e.week_end).toLocaleDateString("ru-RU")]}):"Период не указан"]}),void 0!==e.progress_percentage&&e.progress_percentage>0&&E.jsxs("div",{className:"text-sm mb-2",children:["Прогресс: ",E.jsxs("strong",{children:[e.progress_percentage,"%"]})]}),void 0!==e.attendance_percentage&&e.attendance_percentage>0&&E.jsxs("div",{className:"text-sm mb-2",children:["Посещаемость: ",E.jsxs("strong",{children:[e.attendance_percentage,"%"]})]})]}),Y(e.status||"draft")]}),E.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[E.jsxs(u,{type:"button",variant:"outline",size:"sm",className:"flex-1",onClick:()=>e&&H(e),disabled:!e,children:[E.jsx(O,{className:"w-4 h-4 mr-2"}),"Просмотр"]}),e&&"sent"===e.status&&e.id&&E.jsxs(u,{type:"button",size:"sm",variant:"default",onClick:()=>X(e.id),disabled:U,children:[E.jsx(I,{className:"w-4 h-4 mr-2"}),"Прочитано"]}),E.jsxs(u,{type:"button",variant:"destructive",size:"sm",onClick:()=>K(e),disabled:U,children:[E.jsx(z,{className:"w-4 h-4 mr-2"}),"Удалить"]})]})]},e.id))]})]})})]})]}),E.jsx(j,{open:!!G,onOpenChange:()=>H(null),children:E.jsxs(p,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[E.jsxs(g,{children:[E.jsx(v,{children:null==G?void 0:G.title}),E.jsxs(f,{children:["Отчёт от ",(null==G?void 0:G.tutor_name)||"тьютора"," по ученику ",(null==G?void 0:G.student_name)||"Не указан"," ",(null==G?void 0:G.week_start)&&(null==G?void 0:G.week_end)&&`за период ${new Date(G.week_start).toLocaleDateString("ru-RU")} - ${new Date(G.week_end).toLocaleDateString("ru-RU")}`]})]}),G&&E.jsxs("div",{className:"space-y-4",children:[E.jsxs("div",{children:[E.jsx("strong",{children:"Общее резюме:"}),E.jsx("p",{className:"mt-1",children:G.summary||"Не указано"})]}),G.academic_progress&&E.jsxs("div",{children:[E.jsx("strong",{children:"Академический прогресс:"}),E.jsx("p",{className:"mt-1",children:G.academic_progress})]}),G.behavior_notes&&E.jsxs("div",{children:[E.jsx("strong",{children:"Заметки о поведении:"}),E.jsx("p",{className:"mt-1",children:G.behavior_notes})]}),G.achievements&&E.jsxs("div",{children:[E.jsx("strong",{children:"Достижения:"}),E.jsx("p",{className:"mt-1",children:G.achievements})]}),G.concerns&&E.jsxs("div",{children:[E.jsx("strong",{children:"Обеспокоенности:"}),E.jsx("p",{className:"mt-1",children:G.concerns})]}),G.recommendations&&E.jsxs("div",{children:[E.jsx("strong",{children:"Рекомендации:"}),E.jsx("p",{className:"mt-1",children:G.recommendations})]}),E.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t",children:[E.jsxs("div",{children:[E.jsx("strong",{children:"Посещаемость:"}),E.jsxs("p",{children:[G.attendance_days||0," / ",G.total_days||0," дней (",G.attendance_percentage||0,"%)"]})]}),E.jsxs("div",{children:[E.jsx("strong",{children:"Прогресс:"}),E.jsxs("p",{children:[G.progress_percentage||0,"%"]})]}),E.jsxs("div",{children:[E.jsx("strong",{children:"Статус:"}),E.jsx("div",{children:Y(G.status||"draft")})]})]}),G&&"sent"===G.status&&G.id&&E.jsx("div",{className:"flex justify-end pt-4 border-t",children:E.jsxs(u,{type:"button",onClick:()=>{X(G.id),H(null)},disabled:U,children:[E.jsx(I,{className:"w-4 h-4 mr-2"}),"Отметить как прочитанный"]})})]})]})}),E.jsx(b,{open:!!J,onOpenChange:e=>!e&&K(null),children:E.jsxs(N,{children:[E.jsxs(_,{children:[E.jsx(y,{children:"Удалить отчёт?"}),E.jsxs(w,{children:['Вы уверены, что хотите удалить отчёт "',null==J?void 0:J.title,'"? Это действие нельзя отменить.']})]}),E.jsxs(S,{children:[E.jsx(k,{disabled:U,children:"Отмена"}),E.jsx(R,{onClick:()=>J&&(async e=>{var s,a;try{V(!0),t.debug("Deleting tutor report:",e),await P.deleteReport(e),t.debug("Report deleted successfully"),T(s=>s.filter(s=>s.id!==e)),M({title:"Успешно",description:"Отчет удален"}),K(null);const{cacheService:s}=await D(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));s.delete("/reports/tutor-weekly-reports/")}catch(r){t.error("Error deleting tutor report:",r);const e=(null==(a=null==(s=null==r?void 0:r.response)?void 0:s.data)?void 0:a.detail)||(null==r?void 0:r.message)||"Не удалось удалить отчет";M({title:"Ошибка",description:e,variant:"destructive"})}finally{V(!1)}})(J.id),disabled:U,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})})]})}export{U as default};
