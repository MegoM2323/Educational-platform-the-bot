import{j as e}from"./react-core-JVqWokWt.js";import{at as s,S as t,P as a,a as i,e as n,C as r,c,d,B as l,au as m,p as o,l as x}from"./main-fde3JC90.js";import{u}from"./react-router-WAeXREDX.js";import{aa as h,b9 as j}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";const p=()=>{const m=u(),{data:o,isLoading:x}=s();return e.jsx(t,{children:e.jsxs("div",{className:"flex min-h-screen w-full",children:[e.jsx(a,{}),e.jsxs(i,{children:[e.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4",children:[e.jsx(n,{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-5 w-5"}),e.jsx("h1",{className:"text-lg font-semibold",children:"Мои дети"})]})]}),e.jsx("main",{className:"flex flex-1 flex-col gap-4 p-4",children:e.jsx(r,{className:"p-6",children:x?e.jsx("div",{children:"Загрузка..."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:null==o?void 0:o.map(s=>e.jsxs(r,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:s.full_name||s.name}),e.jsx(c,{variant:"outline",children:s.grade})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Цель: ",s.goal||"—"]}),e.jsx("div",{className:"space-y-2",children:s.subjects&&s.subjects.length>0?s.subjects.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Преподаватель: ",t.teacher_name]}),"cancelled"===t.subscription_status&&t.expires_at&&e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["Доступ до: ",new Date(t.expires_at).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{status:t.payment_status,size:"sm"}),e.jsx(g,{childId:s.id,enrollmentId:t.enrollment_id,subjectName:t.name,teacherName:t.teacher_name,hasSubscription:t.has_subscription,paymentStatus:t.payment_status,subscriptionStatus:t.subscription_status,expiresAt:t.expires_at,nextPaymentDate:t.next_payment_date})]})]},t.enrollment_id)):e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"У ребенка еще нет предметов"})}),e.jsx("div",{className:"pt-2",children:e.jsx(l,{type:"button",variant:"outline",onClick:()=>m(`/dashboard/parent/children/${s.id}`),children:"Детали"})})]},s.id))})})})]})]})})};function g({childId:s,enrollmentId:t,subjectName:a,teacherName:i,hasSubscription:n,paymentStatus:r,subscriptionStatus:d,expiresAt:u,nextPaymentDate:h}){const p=m(s,t,{description:`Оплата за предмет "${a}" (преподаватель: ${i})`,create_subscription:!0}),g=!!h&&new Date(h)>new Date;if("cancelled"===d&&u)return e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(c,{variant:"secondary",className:"text-xs bg-orange-100 text-orange-800",children:"Доступ ограничен"}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 text-right",children:["До: ",new Date(u).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})]})]});return"paid"===r&&(g||n)?e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(c,{variant:"secondary",className:"text-xs bg-green-100 text-green-800",children:"Активен"}),n&&e.jsx(l,{type:"button",size:"sm",variant:"outline",onClick:async()=>{if(window.confirm(`Отключить автосписание для предмета "${a}"?`))try{await o.cancelSubscription(s,t),window.location.reload()}catch(e){x.error("Cancel subscription error:",e)}},children:"Отключить автосписание"})]}):"overdue"===r||"paid"===r&&!g?e.jsxs(l,{type:"button",size:"sm",onClick:()=>p.mutate(),disabled:p.isPending,variant:"destructive",children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),"Оплатить предмет"]}):e.jsxs(l,{type:"button",size:"sm",onClick:()=>p.mutate(),disabled:p.isPending,variant:"default",children:[e.jsx(j,{className:"w-4 h-4 mr-1"}),"Подключить предмет"]})}export{p as default};
