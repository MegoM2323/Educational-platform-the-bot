TELEGRAM PROFILE LINKING - TEST SUMMARY
========================================

TESTS CREATED: 64 passing tests

BACKEND TESTS (44 tests):
- accounts/tests/test_telegram_linking.py (31 tests)
- accounts/tests/test_profile_serializers.py (33 tests)

TEST COVERAGE:

1. TOKEN GENERATION (7 tests)
   ✓ test_generate_link_success
   ✓ test_generate_link_token_persisted
   ✓ test_generate_link_removes_old_tokens
   ✓ test_rate_limit_max_tokens_per_window
   ✓ test_rate_limit_window_resets
   ✓ test_token_ttl_configuration
   ✓ test_bot_username_configuration

2. LINK CONFIRMATION (6 tests)
   ✓ test_confirm_link_success
   ✓ test_confirm_link_invalid_token
   ✓ test_confirm_link_expired_token
   ✓ test_confirm_link_marks_token_used
   ✓ test_confirm_link_duplicate_telegram_id
   ✓ test_confirm_link_idempotence_with_used_token

3. UNLINKING (2 tests)
   ✓ test_unlink_success
   ✓ test_unlink_not_linked

4. STATUS ENDPOINT (3 tests)
   ✓ test_status_not_linked
   ✓ test_status_linked
   ✓ test_status_requires_authentication

5. API ENDPOINTS (12 tests)
   - GenerateTelegramLinkView (3 tests)
   - ConfirmTelegramLinkView (5 tests)
   - UnlinkTelegramView (3 tests)
   - TelegramStatusView (1 test)

6. INTEGRATION TESTS (3 tests)
   ✓ test_complete_linking_flow
   ✓ test_unlinking_flow
   ✓ test_relink_flow

7. PROFILE SERIALIZERS (33 tests)
   - StudentProfileDetailSerializer (7 tests)
   - TeacherProfileDetailSerializer (5 tests)
   - TutorProfileDetailSerializer (5 tests)
   - ParentProfileDetailSerializer (5 tests)
   - UserProfileUpdateSerializer (7 tests)
   - Security edge cases (3 tests)

KEY TEST SCENARIOS:
   - Token generation with rate limiting
   - Token expiration
   - Duplicate telegram_id prevention
   - Profile update ignores telegram field
   - Telegram fields are read-only
   - Complete linking/unlinking/relinking flow
   - Bot authentication with secret key
   - Race condition prevention

BUGS FIXED:
   - Invoice model CheckConstraint 'condition' -> 'check' parameter (Django 6.0)
   - Migration file with outdated parameter names

RESULT: 64/64 TESTS PASSING
