const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/main-fde3JC90.js","js/react-core-JVqWokWt.js","js/react-dom-DyRXjBRd.js","js/vendor-DC2AZkDs.js","js/d3-lib-BmB4v4DK.js","js/radix-ui-Ch8xfAyl.js","js/react-query-DqnBFrGE.js","js/react-router-WAeXREDX.js","js/charts-CKrVAx-o.js","css/main-BeSJoGJH.css"])))=>i.map(i=>d[i]);
import{u as e,l as s,S as t,a,e as r,B as n,C as i,c as l,D as c,w as d,x as o,y as h,z as u,Z as m,g as j,h as x,i as v,j as p,k as g,_,$ as w,aa as b,ab as y,ac as f,ad as k,ae as N,af as C,ag as S,ah as R,ai as D}from"./main-fde3JC90.js";import{r as E,j as I}from"./react-core-JVqWokWt.js";import{T}from"./TeacherSidebar-Bwv8PTW2.js";import{t as A}from"./reports-v_q60BAg.js";import{f as L}from"./dateUtils-BxvfON71.js";import{aq as O,ao as V,ab as Z,au as P,aZ as U,ad as z,an as F}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./react-router-WAeXREDX.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";function $(){const[$,q]=E.useState(!1),[H,B]=E.useState(!1),[W,G]=E.useState(null),[J,K]=E.useState(null),[M,Q]=E.useState(!1),[X,Y]=E.useState([]),[ee,se]=E.useState([]),[te,ae]=E.useState(null),{toast:re}=e(),[ne,ie]=E.useState({student:0,subject:0,week_start:"",week_end:"",title:"Еженедельный отчет",summary:"",academic_progress:"",performance_notes:"",achievements:"",concerns:"",recommendations:"",assignments_completed:0,assignments_total:0,average_score:void 0,attendance_percentage:0,attachment:void 0}),le=E.useCallback(async()=>{try{Q(!0),s.debug("[Teacher Reports] Loading data...");const[e,t]=await Promise.all([A.getReports(),A.getAvailableStudents()]);s.debug("[Teacher Reports] Reports loaded:",e),s.debug("[Teacher Reports] Students loaded:",t);const a=Array.isArray(e)?e:[],r=Array.isArray(t)?t:[];s.debug("[Teacher Reports] Setting reports:",a.length),s.debug("[Teacher Reports] Setting students:",r.length),Y(a),se(r)}catch(e){s.error("[Teacher Reports] Error loading reports data:",e),s.error("[Teacher Reports] Error details:",{message:null==e?void 0:e.message,response:null==e?void 0:e.response,stack:null==e?void 0:e.stack}),re({title:"Ошибка",description:e.message||"Не удалось загрузить данные",variant:"destructive"}),Y([]),se([])}finally{Q(!1)}},[re]);E.useEffect(()=>{(async()=>{const{cacheService:e}=await D(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));e.delete("/reports/teacher-weekly-reports/"),e.delete("/reports/teacher-weekly-reports/available_students/")})().then(()=>{le()})},[le]);const ce=()=>{ie({student:0,subject:0,week_start:"",week_end:"",title:"Еженедельный отчет",summary:"",academic_progress:"",performance_notes:"",achievements:"",concerns:"",recommendations:"",assignments_completed:0,assignments_total:0,average_score:void 0,attendance_percentage:0,attachment:void 0})},de=e=>{if(!e)return I.jsx(l,{variant:"outline",children:"Не указан"});return I.jsx(l,{variant:{sent:"default",read:"default",draft:"secondary",archived:"outline"}[e]||"outline",children:{sent:"Отправлен",read:"Прочитан",draft:"Черновик",archived:"Архив"}[e]||e})},oe=()=>{if(!ne.student)return[];const e=ee.find(e=>e.id===ne.student);return(null==e?void 0:e.subjects)||[]};return E.useEffect(()=>{if($&&!ne.week_start)try{const e=(()=>{try{const e=new Date,s=e.getDay(),t=e.getDate()-s+(0===s?-6:1),a=new Date(e);a.setDate(t),a.setHours(0,0,0,0);const r=new Date(a);return r.setDate(a.getDate()+6),r.setHours(23,59,59,999),{start:L(a),end:L(r)}}catch(e){s.error("Error calculating current week:",e);const t=new Date;return{start:L(t),end:L(t)}}})();e.start&&e.end&&ie(s=>({...s,week_start:e.start,week_end:e.end}))}catch(e){s.error("Error setting week dates:",e)}},[$]),E.useEffect(()=>{ne.student&&oe().length>0&&!oe().find(e=>e.id===ne.subject)&&ie(e=>({...e,subject:0}))},[ne.student]),I.jsxs(t,{children:[I.jsxs("div",{className:"flex min-h-screen w-full",children:[I.jsx(T,{}),I.jsxs(a,{children:[I.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4",children:[I.jsx(r,{}),I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx(O,{className:"h-5 w-5"}),I.jsx("h1",{className:"text-lg font-semibold",children:"Еженедельные отчёты тьютору"})]}),I.jsx("div",{className:"ml-auto",children:I.jsxs(n,{type:"button",className:"gradient-primary shadow-glow",onClick:()=>q(!0),disabled:0===ee.length,children:[I.jsx(V,{className:"w-4 h-4 mr-2"}),"Создать отчёт"]})})]}),I.jsx("main",{className:"flex flex-1 flex-col gap-4 p-4",children:I.jsx("div",{className:"space-y-6",children:I.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[0===X.length&&!M&&I.jsx(i,{className:"p-6 col-span-2",children:I.jsxs("div",{className:"text-center text-muted-foreground",children:[I.jsx(O,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),I.jsx("p",{children:"Отчётов пока нет"}),I.jsx("p",{className:"text-xs mt-2",children:'Создайте новый отчёт, нажав кнопку "Создать отчёт"'})]})}),X.filter(e=>e&&e.id).map(e=>I.jsxs(i,{className:"p-6 hover:border-primary transition-colors",children:[I.jsxs("div",{className:"flex items-start justify-between mb-2",children:[I.jsxs("div",{className:"flex-1",children:[I.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[I.jsx("h3",{className:"font-bold",children:e.title||"Без названия"}),e.subject_name&&I.jsx(l,{style:{backgroundColor:e.subject_color||"#808080",color:"white"},children:e.subject_name})]}),I.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Ученик: ",e.student_name||"Не указан"]}),e.tutor_name&&I.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Тьютор: ",e.tutor_name]}),I.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-2",children:[I.jsx(Z,{className:"w-3 h-3"}),e.week_start&&e.week_end?I.jsxs(I.Fragment,{children:[new Date(e.week_start).toLocaleDateString("ru-RU")," - ",new Date(e.week_end).toLocaleDateString("ru-RU")]}):"Период не указан"]}),void 0!==e.average_score&&null!==e.average_score&&I.jsxs("div",{className:"text-sm mb-2",children:["Средний балл: ",I.jsx("strong",{children:e.average_score})]})]}),de(e.status||"draft")]}),I.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[I.jsxs(n,{type:"button",variant:"outline",size:"sm",onClick:()=>e&&ae(e),disabled:!e,children:[I.jsx(P,{className:"w-4 h-4 mr-2"}),"Просмотр"]}),e&&"draft"===e.status&&I.jsxs(I.Fragment,{children:[I.jsxs(n,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{G(e),ie({student:e.student,subject:e.subject,week_start:e.week_start,week_end:e.week_end,title:e.title,summary:e.summary,academic_progress:e.academic_progress||"",performance_notes:e.performance_notes||"",achievements:e.achievements||"",concerns:e.concerns||"",recommendations:e.recommendations||"",assignments_completed:e.assignments_completed||0,assignments_total:e.assignments_total||0,average_score:e.average_score,attendance_percentage:e.attendance_percentage||0,attachment:void 0}),B(!0)})(e),disabled:M,children:[I.jsx(U,{className:"w-4 h-4 mr-2"}),"Изменить"]}),I.jsxs(n,{type:"button",size:"sm",onClick:()=>(async e=>{var t,a,r,n;try{Q(!0),s.debug("Sending teacher report:",e),await A.sendReport(e),s.debug("Report sent successfully"),Y(s=>s.map(s=>s.id===e?{...s,status:"sent",sent_at:(new Date).toISOString()}:s)),re({title:"Успешно",description:"Отчет отправлен тьютору"});const{cacheService:t}=await D(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/teacher-weekly-reports/"),await le()}catch(i){s.error("Error sending teacher report:",i);const e=(null==(a=null==(t=null==i?void 0:i.response)?void 0:t.data)?void 0:a.detail)||(null==i?void 0:i.message)||(null==(n=null==(r=null==i?void 0:i.response)?void 0:r.data)?void 0:n.error)||"Не удалось отправить отчет";re({title:"Ошибка",description:e,variant:"destructive"})}finally{Q(!1)}})(e.id),disabled:M,children:[I.jsx(z,{className:"w-4 h-4 mr-2"}),"Отправить"]})]}),I.jsxs(n,{type:"button",variant:"destructive",size:"sm",onClick:()=>K(e),disabled:M,children:[I.jsx(F,{className:"w-4 h-4 mr-2"}),"Удалить"]})]})]},e.id))]})})})]})]}),I.jsx(c,{open:$,onOpenChange:q,children:I.jsxs(d,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[I.jsxs(o,{children:[I.jsx(h,{children:"Создать еженедельный отчёт тьютору"}),I.jsx(u,{children:"Заполните форму для создания отчёта о прогрессе ученика"})]}),I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx(m,{children:"Ученик *"}),I.jsxs(j,{value:ne.student&&ne.student>0?ne.student.toString():"",onValueChange:e=>ie({...ne,student:parseInt(e),subject:0}),children:[I.jsx(x,{children:I.jsx(v,{placeholder:"Выберите ученика"})}),I.jsx(p,{children:ee.map(e=>I.jsxs(g,{value:e.id.toString(),children:[e.name," (",e.grade," класс)"]},e.id))})]})]}),ne.student>0&&I.jsxs("div",{children:[I.jsx(m,{children:"Предмет *"}),I.jsxs(j,{value:ne.subject&&ne.subject>0?ne.subject.toString():"",onValueChange:e=>ie({...ne,subject:parseInt(e)}),children:[I.jsx(x,{children:I.jsx(v,{placeholder:"Выберите предмет"})}),I.jsx(p,{children:oe().map(e=>I.jsx(g,{value:e.id.toString(),children:I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),e.name]})},e.id))})]})]}),I.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[I.jsxs("div",{children:[I.jsx(m,{children:"Начало недели *"}),I.jsx(_,{type:"date",value:ne.week_start,onChange:e=>ie({...ne,week_start:e.target.value})})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Конец недели *"}),I.jsx(_,{type:"date",value:ne.week_end,onChange:e=>ie({...ne,week_end:e.target.value})})]})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Название"}),I.jsx(_,{value:ne.title,onChange:e=>ie({...ne,title:e.target.value}),placeholder:"Еженедельный отчёт"})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Общее резюме *"}),I.jsx(w,{value:ne.summary,onChange:e=>ie({...ne,summary:e.target.value}),placeholder:"Общее резюме недели...",rows:4})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Академический прогресс"}),I.jsx(w,{value:ne.academic_progress,onChange:e=>ie({...ne,academic_progress:e.target.value}),placeholder:"Опишите академический прогресс...",rows:3})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Заметки об успеваемости"}),I.jsx(w,{value:ne.performance_notes,onChange:e=>ie({...ne,performance_notes:e.target.value}),placeholder:"Заметки об успеваемости...",rows:3})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Достижения"}),I.jsx(w,{value:ne.achievements,onChange:e=>ie({...ne,achievements:e.target.value}),placeholder:"Достижения ученика...",rows:3})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Обеспокоенности"}),I.jsx(w,{value:ne.concerns,onChange:e=>ie({...ne,concerns:e.target.value}),placeholder:"Обеспокоенности...",rows:3})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Рекомендации"}),I.jsx(w,{value:ne.recommendations,onChange:e=>ie({...ne,recommendations:e.target.value}),placeholder:"Рекомендации...",rows:3})]}),I.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[I.jsxs("div",{children:[I.jsx(m,{children:"Выполнено заданий"}),I.jsx(_,{type:"number",min:"0",value:ne.assignments_completed,onChange:e=>ie({...ne,assignments_completed:parseInt(e.target.value)||0})})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Всего заданий"}),I.jsx(_,{type:"number",min:"0",value:ne.assignments_total,onChange:e=>ie({...ne,assignments_total:parseInt(e.target.value)||0})})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Средний балл"}),I.jsx(_,{type:"number",min:"0",max:"100",step:"0.01",value:ne.average_score||"",onChange:e=>ie({...ne,average_score:e.target.value?parseFloat(e.target.value):void 0})})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Посещаемость (%)"}),I.jsx(_,{type:"number",min:"0",max:"100",value:ne.attendance_percentage,onChange:e=>ie({...ne,attendance_percentage:parseInt(e.target.value)||0})})]})]}),I.jsxs("div",{className:"flex gap-2 justify-end",children:[I.jsx(n,{type:"button",variant:"outline",onClick:()=>{q(!1),ce()},children:"Отмена"}),I.jsxs(n,{type:"button",onClick:async()=>{var e,t,a,r,n,i;if(ne.student&&0!==ne.student&&ne.subject&&0!==ne.subject&&ne.week_start&&ne.week_end&&ne.summary)try{Q(!0),s.debug("Creating teacher report with data:",{student:ne.student,subject:ne.subject,week_start:ne.week_start,week_end:ne.week_end,summary:ne.summary,title:ne.title});const e=await A.createReport(ne);s.debug("Report created successfully:",e),e&&e.id&&Y(s=>s.some(s=>s.id===e.id)?s.map(s=>s.id===e.id?e:s):[e,...s]),re({title:"Успешно",description:"Отчет создан"}),q(!1),ce();const{cacheService:t}=await D(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/teacher-weekly-reports/"),le().catch(e=>s.error("Error refreshing data:",e))}catch(l){s.error("Error creating teacher report:",l);const c=(null==(t=null==(e=null==l?void 0:l.response)?void 0:e.data)?void 0:t.detail)||(null==l?void 0:l.message)||(null==(r=null==(a=null==l?void 0:l.response)?void 0:a.data)?void 0:r.error)||"Не удалось создать отчет";s.error("Error details:",{message:c,response:null==(n=null==l?void 0:l.response)?void 0:n.data,status:null==(i=null==l?void 0:l.response)?void 0:i.status}),re({title:"Ошибка",description:c,variant:"destructive"})}finally{Q(!1)}else re({title:"Ошибка",description:"Заполните все обязательные поля (ученик, предмет, период, резюме)",variant:"destructive"})},disabled:M,children:[I.jsx(z,{className:"w-4 h-4 mr-2"}),"Создать отчёт"]})]})]})]})}),I.jsx(c,{open:!!te,onOpenChange:()=>ae(null),children:I.jsxs(d,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[I.jsxs(o,{children:[I.jsx(h,{children:null==te?void 0:te.title}),I.jsxs(u,{children:["Отчёт по ученику ",(null==te?void 0:te.student_name)||"Не указан"," по предмету ",(null==te?void 0:te.subject_name)||"Не указан"," ",(null==te?void 0:te.tutor_name)&&`(Тьютор: ${te.tutor_name})`," ",(null==te?void 0:te.week_start)&&(null==te?void 0:te.week_end)&&`за период ${new Date(te.week_start).toLocaleDateString("ru-RU")} - ${new Date(te.week_end).toLocaleDateString("ru-RU")}`]})]}),te&&I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx("strong",{children:"Общее резюме:"}),I.jsx("p",{className:"mt-1",children:te.summary||"Не указано"})]}),te.academic_progress&&I.jsxs("div",{children:[I.jsx("strong",{children:"Академический прогресс:"}),I.jsx("p",{className:"mt-1",children:te.academic_progress})]}),te.performance_notes&&I.jsxs("div",{children:[I.jsx("strong",{children:"Заметки об успеваемости:"}),I.jsx("p",{className:"mt-1",children:te.performance_notes})]}),te.achievements&&I.jsxs("div",{children:[I.jsx("strong",{children:"Достижения:"}),I.jsx("p",{className:"mt-1",children:te.achievements})]}),te.concerns&&I.jsxs("div",{children:[I.jsx("strong",{children:"Обеспокоенности:"}),I.jsx("p",{className:"mt-1",children:te.concerns})]}),te.recommendations&&I.jsxs("div",{children:[I.jsx("strong",{children:"Рекомендации:"}),I.jsx("p",{className:"mt-1",children:te.recommendations})]}),I.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[I.jsxs("div",{children:[I.jsx("strong",{children:"Выполнено заданий:"}),I.jsxs("p",{children:[te.assignments_completed||0," / ",te.assignments_total||0," (",te.completion_percentage||0,"%)"]})]}),void 0!==te.average_score&&null!==te.average_score&&I.jsxs("div",{children:[I.jsx("strong",{children:"Средний балл:"}),I.jsx("p",{children:te.average_score})]}),void 0!==te.attendance_percentage&&te.attendance_percentage>0&&I.jsxs("div",{children:[I.jsx("strong",{children:"Посещаемость:"}),I.jsxs("p",{children:[te.attendance_percentage,"%"]})]}),I.jsxs("div",{children:[I.jsx("strong",{children:"Статус:"}),I.jsx("div",{children:de(te.status||"draft")})]})]})]})]})}),I.jsx(c,{open:H,onOpenChange:e=>{B(e),e||(G(null),ce())},children:I.jsxs(d,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[I.jsxs(o,{children:[I.jsx(h,{children:"Редактировать отчёт"}),I.jsx(u,{children:"Внесите изменения в отчёт"})]}),I.jsxs("div",{className:"space-y-4",children:[I.jsxs("div",{children:[I.jsx(m,{children:"Ученик *"}),I.jsxs(j,{value:ne.student&&ne.student>0?ne.student.toString():"",onValueChange:e=>ie({...ne,student:parseInt(e),subject:0}),children:[I.jsx(x,{children:I.jsx(v,{placeholder:"Выберите ученика"})}),I.jsx(p,{children:ee.map(e=>I.jsxs(g,{value:e.id.toString(),children:[e.name," (",e.grade," класс)"]},e.id))})]})]}),ne.student>0&&I.jsxs("div",{children:[I.jsx(m,{children:"Предмет *"}),I.jsxs(j,{value:ne.subject&&ne.subject>0?ne.subject.toString():"",onValueChange:e=>ie({...ne,subject:parseInt(e)}),children:[I.jsx(x,{children:I.jsx(v,{placeholder:"Выберите предмет"})}),I.jsx(p,{children:oe().map(e=>I.jsx(g,{value:e.id.toString(),children:I.jsxs("div",{className:"flex items-center gap-2",children:[I.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),e.name]})},e.id))})]})]}),I.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[I.jsxs("div",{children:[I.jsx(m,{children:"Начало недели *"}),I.jsx(_,{type:"date",value:ne.week_start,onChange:e=>ie({...ne,week_start:e.target.value})})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Конец недели *"}),I.jsx(_,{type:"date",value:ne.week_end,onChange:e=>ie({...ne,week_end:e.target.value})})]})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Название"}),I.jsx(_,{value:ne.title,onChange:e=>ie({...ne,title:e.target.value}),placeholder:"Еженедельный отчёт"})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Общее резюме *"}),I.jsx(w,{value:ne.summary,onChange:e=>ie({...ne,summary:e.target.value}),placeholder:"Общее резюме недели...",rows:4})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Академический прогресс"}),I.jsx(w,{value:ne.academic_progress,onChange:e=>ie({...ne,academic_progress:e.target.value}),placeholder:"Опишите академический прогресс...",rows:3})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Заметки об успеваемости"}),I.jsx(w,{value:ne.performance_notes,onChange:e=>ie({...ne,performance_notes:e.target.value}),placeholder:"Заметки об успеваемости...",rows:3})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Достижения"}),I.jsx(w,{value:ne.achievements,onChange:e=>ie({...ne,achievements:e.target.value}),placeholder:"Достижения ученика...",rows:3})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Обеспокоенности"}),I.jsx(w,{value:ne.concerns,onChange:e=>ie({...ne,concerns:e.target.value}),placeholder:"Обеспокоенности...",rows:3})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Рекомендации"}),I.jsx(w,{value:ne.recommendations,onChange:e=>ie({...ne,recommendations:e.target.value}),placeholder:"Рекомендации...",rows:3})]}),I.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[I.jsxs("div",{children:[I.jsx(m,{children:"Выполнено заданий"}),I.jsx(_,{type:"number",min:"0",value:ne.assignments_completed,onChange:e=>ie({...ne,assignments_completed:parseInt(e.target.value)||0})})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Всего заданий"}),I.jsx(_,{type:"number",min:"0",value:ne.assignments_total,onChange:e=>ie({...ne,assignments_total:parseInt(e.target.value)||0})})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Средний балл"}),I.jsx(_,{type:"number",min:"0",max:"100",step:"0.01",value:ne.average_score||"",onChange:e=>ie({...ne,average_score:e.target.value?parseFloat(e.target.value):void 0})})]}),I.jsxs("div",{children:[I.jsx(m,{children:"Посещаемость (%)"}),I.jsx(_,{type:"number",min:"0",max:"100",value:ne.attendance_percentage,onChange:e=>ie({...ne,attendance_percentage:parseInt(e.target.value)||0})})]})]}),I.jsxs("div",{className:"flex gap-2 justify-end",children:[I.jsx(n,{type:"button",variant:"outline",onClick:()=>{B(!1),G(null),ce()},children:"Отмена"}),I.jsxs(n,{type:"button",onClick:async()=>{var e,t;if(W)if(ne.student&&0!==ne.student&&ne.subject&&0!==ne.subject&&ne.week_start&&ne.week_end&&ne.summary)try{Q(!0),s.debug("Updating teacher report:",W.id,ne);const e=await A.updateReport(W.id,ne);s.debug("Report updated successfully:",e),Y(s=>s.map(s=>s.id===W.id?e:s)),re({title:"Успешно",description:"Отчет обновлен"}),B(!1),G(null),ce();const{cacheService:t}=await D(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/teacher-weekly-reports/")}catch(a){s.error("Error updating teacher report:",a);const r=(null==(t=null==(e=null==a?void 0:a.response)?void 0:e.data)?void 0:t.detail)||(null==a?void 0:a.message)||"Не удалось обновить отчет";re({title:"Ошибка",description:r,variant:"destructive"})}finally{Q(!1)}else re({title:"Ошибка",description:"Заполните все обязательные поля (ученик, предмет, период, резюме)",variant:"destructive"})},disabled:M,children:[I.jsx(z,{className:"w-4 h-4 mr-2"}),"Сохранить изменения"]})]})]})]})}),I.jsx(b,{open:!!J,onOpenChange:e=>!e&&K(null),children:I.jsxs(y,{children:[I.jsxs(f,{children:[I.jsx(k,{children:"Удалить отчёт?"}),I.jsxs(N,{children:['Вы уверены, что хотите удалить отчёт "',null==J?void 0:J.title,'"? Это действие нельзя отменить.']})]}),I.jsxs(C,{children:[I.jsx(S,{disabled:M,children:"Отмена"}),I.jsx(R,{onClick:()=>J&&(async e=>{var t,a;try{Q(!0),s.debug("Deleting teacher report:",e),await A.deleteReport(e),s.debug("Report deleted successfully"),Y(s=>s.filter(s=>s.id!==e)),re({title:"Успешно",description:"Отчет удален"}),K(null);const{cacheService:t}=await D(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/teacher-weekly-reports/")}catch(r){s.error("Error deleting teacher report:",r);const e=(null==(a=null==(t=null==r?void 0:r.response)?void 0:t.data)?void 0:a.detail)||(null==r?void 0:r.message)||"Не удалось удалить отчет";re({title:"Ошибка",description:e,variant:"destructive"})}finally{Q(!1)}})(J.id),disabled:M,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})})]})}export{$ as default};
