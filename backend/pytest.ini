[pytest]
DJANGO_FIND_PROJECT = false
DJANGO_SETTINGS_MODULE = config.settings
python_files = test_*.py
python_classes = Test*
python_functions = test_*
testpaths = tests
pythonpath = .
asyncio_mode = auto

# ============================================================================
# ENVIRONMENT CONFIGURATION (критично для безопасности БД)
# ============================================================================
# Принудительно устанавливаем тестовое окружение для изоляции от продакшн БД
# ПРИМЕЧАНИЕ: ENVIRONMENT должен быть установлен ДО загрузки Django settings
# Используем conftest.py для установки ENVIRONMENT (pytest-env plugin недоступен)
# env =
#     ENVIRONMENT=test

# Markers
markers =
    unit: Unit tests (быстрые, изолированные)
    integration: Integration tests (с БД, медленнее)
    dashboard: Dashboard-specific tests
    slow: Slow tests (выполняются долго)
    django_db: Tests requiring database access
    performance: Performance tests
    websocket: WebSocket consumer tests
    celery: Celery task tests
    subscription: Subscription tests
    payment: Payment tests
    cache: Cache-related tests
    error_handling: Error handling tests
    management: Management command tests
    signals: Django signal tests
    validation: Validation tests
    api: API endpoint tests
    smoke: Smoke tests

# Options
addopts =
    -v
    --strict-markers
    --tb=short
    --cov=accounts
    --cov=materials
    --cov=chat
    --cov=payments
    --cov=core
    --cov=scheduling
    --cov-report=html
    --cov-report=term-missing

# Предупреждения
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::pytest.PytestCacheWarning
    ignore

# Coverage
[coverage:run]
source = accounts,materials,chat,payments,core,scheduling
omit =
    */migrations/*
    */tests/*
    */test_*.py
    */__pycache__/*
    */venv/*
    */.venv/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
