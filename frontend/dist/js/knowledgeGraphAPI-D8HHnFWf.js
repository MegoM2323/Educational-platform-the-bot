import{f as r,aW as e}from"./main-fde3JC90.js";const t={getTeacherStudents:async()=>{try{const t=await r.get("/materials/teacher/students/");if(t.error)throw new Error(t.error);const n=t.data;if(!n)return[];if("object"==typeof n&&"students"in n){const r=n.students;return Array.isArray(r)?r:[]}return e(n)}catch(t){if(t instanceof Error)throw new Error(`Не удалось загрузить список студентов: ${t.message}`);throw new Error("Не удалось загрузить список студентов: неизвестная ошибка")}},getOrCreateGraph:async(e,t)=>{const n=await r.get(`/knowledge-graph/students/${e}/subject/${t}/`);if(n.error)throw new Error(n.error);const s=n.data;if(!s)throw new Error("Граф не найден");return"object"==typeof s&&"success"in s&&"data"in s?s.data:s},getGraphLessons:async e=>{const t=await r.get(`/knowledge-graph/${e}/lessons/`);if(t.error)throw new Error(t.error);const n=t.data;if(!n)return[];if("object"==typeof n&&"success"in n&&"data"in n){const r=n.data;return Array.isArray(r)?r:[]}if("lessons"in n){const r=n.lessons;return Array.isArray(r)?r:[]}return[]},getLessons:async t=>{const n=await r.get("/knowledge-graph/lessons/",{params:t});if(n.error)throw new Error(n.error);const s=n.data;if(!s)return[];if(Array.isArray(s))return s;if("object"==typeof s&&"success"in s&&"data"in s){const r=s.data;return Array.isArray(r)?r:[]}return e(s)},addLessonToGraph:async(e,t)=>{const n=await r.post(`/knowledge-graph/${e}/lessons/`,t);if(n.error)throw new Error(n.error);const s=n.data;if(!s)throw new Error("Ошибка при добавлении урока");return"object"==typeof s&&"success"in s&&"data"in s?s.data:s},removeLessonFromGraph:async(e,t)=>{const n=await r.delete(`/knowledge-graph/${e}/lessons/${t}/remove/`);if(n.error)throw new Error(n.error)},updateLessonPosition:async(e,t,n)=>{const s=await r.patch(`/knowledge-graph/${e}/lessons/${t}/`,n);if(s.error)throw new Error(s.error);const o=s.data;if(!o)throw new Error("Ошибка при обновлении позиции");return"object"==typeof o&&"success"in o&&"data"in o?o.data:o},batchUpdateLessons:async(e,t)=>{const n={lessons:t.lessons.map(r=>({lesson_id:r.graph_lesson_id,position_x:r.position_x,position_y:r.position_y}))},s=await r.patch(`/knowledge-graph/${e}/lessons/batch/`,n);if(s.error)throw new Error(s.error)},getLessonDependencies:async(e,t)=>{const n=await r.get(`/knowledge-graph/${e}/lessons/${t}/dependencies/`);if(n.error)throw new Error(n.error);const s=n.data;if(!s||!("data"in s))return[];const o=s.data;return[...Array.isArray(o.incoming)?o.incoming:[],...Array.isArray(o.outgoing)?o.outgoing:[]]},addDependency:async(e,t,n)=>{let s="required";n.dependency_type&&("prerequisite"===n.dependency_type?s="required":"related"===n.dependency_type?s="optional":["required","recommended","optional"].includes(n.dependency_type)&&(s=n.dependency_type));let o=0;void 0!==n.min_score_percent?o=n.min_score_percent:void 0!==n.strength&&(o=10*n.strength);const a={prerequisite_lesson_id:n.to_lesson_id,dependency_type:s,min_score_percent:o},i=await r.post(`/knowledge-graph/${e}/lessons/${t}/dependencies/`,a);if(i.error)throw new Error(i.error);const c=i.data;if(!c)throw new Error("Ошибка при создании зависимости");return"object"==typeof c&&"success"in c&&"data"in c?c.data:c},removeDependency:async(e,t,n)=>{const s=await r.delete(`/knowledge-graph/${e}/lessons/${t}/dependencies/${n}/`);if(s.error)throw new Error(s.error)},deleteLesson:async(e,t)=>{const n=await r.delete(`/knowledge-graph/${e}/lessons/${t}/delete/`);if(n.error)throw new Error(n.error)},deleteDependency:async(r,e,n)=>t.removeDependency(r,e,n),checkPrerequisites:async(e,t)=>{const n=await r.get(`/knowledge-graph/${e}/lessons/${t}/can-start/`);if(n.error)throw new Error(n.error);const s=n.data;return s?"object"==typeof s&&"success"in s&&"data"in s?s.data:s:{can_start:!1,missing_prerequisites:[]}},getStudentSubjects:async()=>{var e;const t=await r.get("/student/subjects/");if(t.error)throw new Error(t.error);return((null==(e=t.data)?void 0:e.results)||[]).map(r=>r.subject)},getStudentGraph:async(e,t)=>{const n=await r.get(`/knowledge-graph/students/${e}/subject/${t}/`);if(n.error)throw new Error(n.error);const s=n.data;if(!s)throw new Error("Граф не найден");return"object"==typeof s&&"success"in s&&"data"in s?s.data:s},getLessonProgress:async(e,t)=>{const n=await r.get(`/knowledge-graph/lessons/${e}/progress/`,{params:{student:t}});if(n.error)throw new Error(n.error);return n.data},getStudentLesson:async e=>{var t;const n=await r.get(`/knowledge-graph/student/lessons/${e}/`);if(n.error)throw new Error(n.error);if(!n.data||!("data"in n.data))throw new Error("Урок не найден");const s=n.data.data,o=(null==(t=s.graph_lesson)?void 0:t.lesson)||s.lesson;return{...s,lesson:o,graph_lesson:s.graph_lesson}},startStudentElement:async e=>{const t=await r.post(`/knowledge-graph/student/elements/${e}/start/`,{});if(t.error)throw new Error(t.error);return t.data},submitStudentAnswer:async(e,t)=>{const n=await r.post(`/knowledge-graph/student/elements/${e}/submit/`,{answer:t});if(n.error)throw new Error(n.error);return n.data},completeStudentLesson:async e=>{const t=await r.post(`/knowledge-graph/student/lessons/${e}/complete/`,{});if(t.error)throw new Error(t.error);return t.data}};export{t as k};
