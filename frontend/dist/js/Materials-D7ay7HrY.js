import{r as e,j as s}from"./react-core-JVqWokWt.js";import{u as a,C as t,J as l,K as i,Y as r,c as n,L as c,B as d,Z as o,g as x,h as m,i as h,j as u,k as j,$ as p,f as v,l as f,_ as N,D as b,a8 as g,w,x as y,y as _,S as k,a as S,e as C,a9 as D}from"./main-fde3JC90.js";import{T as L}from"./TeacherSidebar-Bwv8PTW2.js";import{ax as $,am as E,aF as q,av as z,ab as R,aq as U,a7 as F,aS as I,bw as O,ad as T,at as A,au as V,ap as M,ao as B,aa as J,aG as P,as as G,an as K}from"./vendor-DC2AZkDs.js";import{u as W}from"./react-router-WAeXREDX.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";const Y={submitted:{label:"Отправлено",icon:q,variant:"secondary",color:"text-blue-600"},reviewed:{label:"Проверено",icon:E,variant:"default",color:"text-green-600"},returned:{label:"Возвращено",icon:$,variant:"destructive",color:"text-orange-600"}};function Z({submission:N,onSuccess:b,onCancel:g}){var w,y,_,k;const{toast:S}=a(),[C,D]=e.useState(!1),[L,$]=e.useState({feedback_text:(null==(w=N.feedback)?void 0:w.feedback_text)||"",grade:(null==(y=N.feedback)?void 0:y.grade)||void 0}),E=Y[N.status],q=E.icon;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs(t,{children:[s.jsx(l,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs(i,{className:"flex items-center gap-2",children:[s.jsx(q,{className:`w-5 h-5 ${E.color}`}),"Ответ студента"]}),s.jsxs(r,{children:["Материал: ",s.jsx("strong",{children:N.material_title})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(n,{variant:E.variant,children:E.label}),N.is_late&&s.jsx(n,{variant:"outline",className:"text-orange-600",children:"С опозданием"})]})]})}),s.jsxs(c,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(z,{className:"w-4 h-4"}),s.jsx("span",{children:N.student_name})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(R,{className:"w-4 h-4"}),s.jsx("span",{children:new Date(N.submitted_at).toLocaleString("ru-RU")})]})]}),N.submission_text&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"Текстовый ответ:"}),s.jsx("div",{className:"bg-muted p-3 rounded-lg",children:s.jsx("p",{className:"whitespace-pre-wrap",children:N.submission_text})})]}),N.submission_file&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"Файл ответа:"}),s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[s.jsx(U,{className:"w-4 h-4"}),s.jsx("span",{className:"flex-1",children:N.submission_file.split("/").pop()}),s.jsxs(d,{type:"button",size:"sm",variant:"outline",onClick:()=>(async(e,s)=>{try{const a=await fetch(e,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(!a.ok)throw new Error("Ошибка скачивания файла");const t=await a.blob(),l=window.URL.createObjectURL(t),i=document.createElement("a");i.href=l,i.download=s,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(l),document.body.removeChild(i),S({title:"Успешно",description:"Файл скачан"})}catch(a){S({title:"Ошибка",description:"Ошибка при скачивании файла",variant:"destructive"})}})(N.submission_file,N.submission_file.split("/").pop()),children:[s.jsx(F,{className:"w-4 h-4 mr-1"}),"Скачать"]})]})]})]})]}),s.jsxs(t,{children:[s.jsxs(l,{children:[s.jsxs(i,{className:"flex items-center gap-2",children:[s.jsx(I,{className:"w-5 h-5"}),N.feedback?"Редактировать фидбэк":"Отправить фидбэк"]}),s.jsx(r,{children:N.feedback?"Вы можете изменить существующий фидбэк":"Напишите фидбэк для студента"})]}),s.jsx(c,{children:s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),L.feedback_text.trim())try{D(!0);const e=await v.request("/submissions/submit_feedback/",{method:"POST",data:{submission_id:N.id,feedback_text:L.feedback_text,grade:L.grade}});if(!e.data)throw new Error(e.error||"Ошибка отправки фидбэка");S({title:"Успешно",description:"Фидбэк отправлен студенту"}),b()}catch(s){f.error("Feedback error:",s),S({title:"Ошибка",description:s.message||"Произошла ошибка при отправке фидбэка",variant:"destructive"})}finally{D(!1)}else S({title:"Ошибка",description:"Необходимо написать текст фидбэка",variant:"destructive"})},className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{htmlFor:"grade",children:"Оценка (необязательно)"}),s.jsxs(x,{value:null!=(k=null==(_=L.grade)?void 0:_.toString())?k:"none",onValueChange:e=>{$(s=>({...s,grade:"none"===e?void 0:parseInt(e)}))},children:[s.jsx(m,{children:s.jsx(h,{placeholder:"Выберите оценку"})}),s.jsxs(u,{children:[s.jsx(j,{value:"none",children:"Без оценки"}),[1,2,3,4,5].map(e=>s.jsx(j,{value:e.toString(),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(O,{className:"w-4 h-4 text-yellow-500 fill-current"}),s.jsxs("span",{children:[e,"/5"]})]})},e))]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{htmlFor:"feedback-text",children:"Текст фидбэка *"}),s.jsx(p,{id:"feedback-text",placeholder:"Напишите фидбэк для студента...",value:L.feedback_text,onChange:e=>{$(s=>({...s,feedback_text:e.target.value}))},rows:6,className:"resize-none",required:!0})]}),s.jsxs("div",{className:"flex gap-3 justify-end",children:[s.jsx(d,{type:"button",variant:"outline",onClick:g,disabled:C,children:"Отмена"}),s.jsx(d,{type:"submit",disabled:C||!L.feedback_text.trim(),children:C?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Отправка..."]}):s.jsxs(s.Fragment,{children:[s.jsx(T,{className:"w-4 h-4 mr-2"}),N.feedback?"Обновить фидбэк":"Отправить фидбэк"]})})]})]})})]})]})}const H={submitted:{label:"Отправлено",icon:q,variant:"secondary",color:"text-blue-600"},reviewed:{label:"Проверено",icon:E,variant:"default",color:"text-green-600"},returned:{label:"Возвращено",icon:$,variant:"destructive",color:"text-orange-600"}};function Q({materialId:o,materialTitle:p}){a();const[k,S]=e.useState([]),[C,D]=e.useState(!0),[L,$]=e.useState(null),[E,q]=e.useState(""),[F,T]=e.useState("all"),[M,B]=e.useState(null),[J,P]=e.useState(!1),G=async()=>{try{D(!0),$(null);const e=await v.request(`/submissions/?material=${o}`);e.data?S(e.data):$("Ошибка загрузки ответов студентов")}catch(e){f.error("Fetch submissions error:",e),$("Ошибка загрузки ответов студентов")}finally{D(!1)}};e.useEffect(()=>{G()},[o]);const K=k.filter(e=>{const s=e.student_name.toLowerCase().includes(E.toLowerCase())||e.material_title.toLowerCase().includes(E.toLowerCase()),a="all"===F||e.status===F;return s&&a});return C?s.jsx(t,{children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx("div",{className:"w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"ml-2",children:"Загрузка ответов студентов..."})]})})}):L?s.jsx(t,{children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"text-center text-red-600",children:[s.jsx("p",{children:L}),s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:G,className:"mt-2",children:"Попробовать снова"})]})})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Ответы студентов"}),s.jsxs("p",{className:"text-muted-foreground",children:["Материал: ",p]})]}),s.jsx(t,{className:"p-4",children:s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(N,{placeholder:"Поиск по имени студента...",className:"pl-10",value:E,onChange:e=>q(e.target.value)})]}),s.jsxs(x,{value:F,onValueChange:T,children:[s.jsx(m,{className:"w-40",children:s.jsx(h,{placeholder:"Статус"})}),s.jsxs(u,{children:[s.jsx(j,{value:"all",children:"Все статусы"}),s.jsx(j,{value:"submitted",children:"Отправлено"}),s.jsx(j,{value:"reviewed",children:"Проверено"}),s.jsx(j,{value:"returned",children:"Возвращено"})]})]})]})}),s.jsx("div",{className:"space-y-4",children:0===K.length?s.jsx(t,{children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"text-center text-muted-foreground",children:[s.jsx(I,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),s.jsx("p",{children:"Ответы не найдены"}),s.jsx("p",{className:"text-sm",children:E||"all"!==F?"Попробуйте изменить фильтры поиска":"Студенты еще не отправили ответы на этот материал"})]})})}):K.map(e=>{var a;const o=(x=e.status,H[x]||H.submitted);var x;const m=o.icon;return s.jsx(t,{className:"hover:border-primary transition-colors",children:s.jsx(c,{className:"p-6",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(m,{className:`w-5 h-5 ${o.color}`}),s.jsx("h3",{className:"font-semibold",children:e.student_name}),s.jsx(n,{variant:o.variant,children:o.label}),e.is_late&&s.jsx(n,{variant:"outline",className:"text-orange-600",children:"С опозданием"})]}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-3",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(R,{className:"w-4 h-4"}),s.jsx("span",{children:new Date(e.submitted_at).toLocaleString("ru-RU")})]}),(null==(a=e.feedback)?void 0:a.grade)&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(O,{className:"w-4 h-4 text-yellow-500 fill-current"}),s.jsxs("span",{children:[e.feedback.grade,"/5"]})]})]}),s.jsxs("div",{className:"space-y-2",children:[e.submission_text&&s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Текстовый ответ:"}),s.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.submission_text})]}),e.submission_file&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:e.submission_file.split("/").pop()})]})]})]}),s.jsxs("div",{className:"flex gap-2 ml-4",children:[s.jsxs(b,{children:[s.jsx(g,{asChild:!0,children:s.jsxs(d,{type:"button",variant:"outline",size:"sm",children:[s.jsx(V,{className:"w-4 h-4 mr-1"}),"Просмотр"]})}),s.jsxs(w,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(y,{children:s.jsx(_,{children:"Ответ студента"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs(t,{children:[s.jsxs(l,{children:[s.jsxs(i,{className:"flex items-center gap-2",children:[s.jsx(z,{className:"w-5 h-5"}),e.student_name]}),s.jsxs(r,{children:["Отправлено: ",new Date(e.submitted_at).toLocaleString("ru-RU")]})]}),s.jsxs(c,{className:"space-y-4",children:[e.submission_text&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"Текстовый ответ:"}),s.jsx("div",{className:"bg-muted p-3 rounded-lg",children:s.jsx("p",{className:"whitespace-pre-wrap",children:e.submission_text})})]}),e.submission_file&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-2",children:"Файл ответа:"}),s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[s.jsx(U,{className:"w-4 h-4"}),s.jsx("span",{className:"flex-1",children:e.submission_file.split("/").pop()})]})]})]})]}),e.feedback&&s.jsxs(t,{children:[s.jsx(l,{children:s.jsxs(i,{className:"flex items-center gap-2",children:[s.jsx(I,{className:"w-5 h-5"}),"Фидбэк преподавателя"]})}),s.jsx(c,{children:s.jsxs("div",{className:"space-y-2",children:[e.feedback.grade&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(O,{className:"w-4 h-4 text-yellow-500 fill-current"}),s.jsxs("span",{className:"font-medium",children:[e.feedback.grade,"/5"]})]}),s.jsx("p",{className:"whitespace-pre-wrap",children:e.feedback.feedback_text}),s.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(e.feedback.created_at).toLocaleString("ru-RU")})]})})]})]})]})]}),s.jsxs(d,{type:"button",size:"sm",onClick:()=>(e=>{B(e),P(!0)})(e),children:[s.jsx(I,{className:"w-4 h-4 mr-1"}),e.feedback?"Изменить":"Фидбэк"]})]})]})})},e.id)})}),s.jsx(b,{open:J,onOpenChange:P,children:s.jsxs(w,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(y,{children:s.jsx(_,{children:"Фидбэк для студента"})}),M&&s.jsx(Z,{submission:M,onSuccess:()=>{P(!1),B(null),G()},onCancel:()=>{P(!1),B(null)}})]})})]})}const X=()=>{const l=W(),{toast:i}=a(),[r,c]=e.useState([]),[p,g]=e.useState([]),[$,E]=e.useState(!0),[q,z]=e.useState(null),[U,F]=e.useState(""),[O,T]=e.useState("all"),[Y,Z]=e.useState("all"),[H,X]=e.useState("all"),[ee,se]=e.useState(!1),[ae,te]=e.useState(null),[le,ie]=e.useState(!1),[re,ne]=e.useState(null),[ce,de]=e.useState([]),[oe,xe]=e.useState([]),[me,he]=e.useState(!1);e.useEffect(()=>{(async()=>{var e,s;try{E(!0),z(null);const a=await v.request("/materials/");if(a.data){const s=Array.isArray(a.data)?a.data:null!=(e=a.data.results)?e:[];c(s)}else z(a.error||"Ошибка загрузки материалов");const t=await v.request("/materials/subjects/");if(t.data){const e=Array.isArray(t.data)?t.data:null!=(s=t.data.results)?s:[];g(e)}}catch(a){z("Произошла ошибка при загрузке данных"),f.error("Materials fetch error:",a)}finally{E(!1)}})()},[]);const ue=r.filter(e=>{const s=e.title.toLowerCase().includes(U.toLowerCase())||e.description.toLowerCase().includes(U.toLowerCase()),a="all"===O||e.subject_name===O,t="all"===Y||e.status===Y,l="all"===H||e.type===H;return s&&a&&t&&l}),je=()=>{l("/dashboard/teacher/materials/create")},pe=e=>{te(e),se(!0)};return $?s.jsx(k,{children:s.jsxs("div",{className:"flex min-h-screen w-full",children:[s.jsx(L,{}),s.jsxs(S,{children:[s.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4",children:[s.jsx(C,{}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(M,{className:"h-5 w-5"}),s.jsx("h1",{className:"text-lg font-semibold",children:"Материалы"})]})]}),s.jsx("main",{className:"flex flex-1 flex-col gap-4 p-4",children:s.jsx(t,{className:"p-6",children:s.jsx("div",{className:"text-center",children:"Загрузка материалов..."})})})]})]})}):s.jsxs(k,{children:[s.jsxs("div",{className:"flex min-h-screen w-full",children:[s.jsx(L,{}),s.jsxs(S,{children:[s.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4",children:[s.jsx(C,{}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(M,{className:"h-5 w-5"}),s.jsx("h1",{className:"text-lg font-semibold",children:"Материалы"})]})]}),s.jsxs("main",{className:"flex flex-1 flex-col gap-4 p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Управление материалами"}),s.jsx("p",{className:"text-muted-foreground",children:"Создавайте и управляйте учебными материалами"})]}),s.jsxs(d,{type:"button",onClick:je,className:"gradient-primary shadow-glow",children:[s.jsx(B,{className:"h-4 w-4 mr-2"}),"Создать материал"]})]}),q&&s.jsx(t,{className:"p-4 border-destructive bg-destructive/10",children:s.jsx("div",{className:"flex items-center gap-2 text-destructive",children:s.jsx("span",{children:q})})}),s.jsx(t,{className:"p-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"relative",children:[s.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(N,{placeholder:"Поиск материалов...",value:U,onChange:e=>F(e.target.value),className:"pl-10"})]}),s.jsxs(x,{value:O,onValueChange:T,children:[s.jsx(m,{children:s.jsx(h,{placeholder:"Все предметы"})}),s.jsxs(u,{children:[s.jsx(j,{value:"all",children:"Все предметы"}),(p||[]).map(e=>s.jsx(j,{value:e.name,children:e.name},e.id))]})]}),s.jsxs(x,{value:Y,onValueChange:Z,children:[s.jsx(m,{children:s.jsx(h,{placeholder:"Все статусы"})}),s.jsxs(u,{children:[s.jsx(j,{value:"all",children:"Все статусы"}),s.jsx(j,{value:"draft",children:"Черновик"}),s.jsx(j,{value:"active",children:"Активно"})]})]}),s.jsxs(x,{value:H,onValueChange:X,children:[s.jsx(m,{children:s.jsx(h,{placeholder:"Все типы"})}),s.jsxs(u,{children:[s.jsx(j,{value:"all",children:"Все типы"}),s.jsx(j,{value:"lesson",children:"Урок"}),s.jsx(j,{value:"presentation",children:"Презентация"}),s.jsx(j,{value:"video",children:"Видео"}),s.jsx(j,{value:"document",children:"Документ"}),s.jsx(j,{value:"test",children:"Тест"}),s.jsx(j,{value:"homework",children:"Домашнее задание"})]})]})]})}),s.jsx("div",{className:"grid gap-4",children:0===ue.length?s.jsxs(t,{className:"p-8 text-center",children:[s.jsx(M,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Нет материалов"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:U||O||Y||H?"Не найдено материалов по заданным фильтрам":"Создайте первый материал для начала работы"}),!U&&!O&&!Y&&!H&&s.jsxs(d,{type:"button",onClick:je,className:"gradient-primary shadow-glow",children:[s.jsx(B,{className:"h-4 w-4 mr-2"}),"Создать материал"]})]}):ue.map(e=>{return s.jsx(t,{className:"p-6 hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("h3",{className:"text-lg font-semibold",children:e.title}),s.jsx(n,{variant:"active"===e.status?"default":"secondary",children:"active"===e.status?"Активно":"Черновик"}),s.jsx(n,{variant:"outline",children:(a=e.type,{lesson:"Урок",presentation:"Презентация",video:"Видео",document:"Документ",test:"Тест",homework:"Домашнее задание"}[a]||a)})]}),s.jsx("p",{className:"text-muted-foreground mb-3 line-clamp-2",children:e.description||"Описание отсутствует"}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(J,{className:"h-4 w-4"}),e.assigned_count," учеников"]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(R,{className:"h-4 w-4"}),new Date(e.created_at).toLocaleDateString("ru-RU")]}),s.jsx("span",{children:e.subject_name}),e.file&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(P,{className:"h-4 w-4"}),"Файл"]}),e.video_url&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(P,{className:"h-4 w-4"}),"Видео"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{const s=r.find(s=>s.id===e)||null;s&&pe(s)})(e.id),children:s.jsx(V,{className:"h-4 w-4"})}),s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>(async e=>{var s,a;try{ne(e),ie(!0),de([]),xe([]),f.debug("[openDistributeDialog] Material:",e);const t=await v.request("/materials/teacher/all-students/");if(f.debug("[openDistributeDialog] Students response:",t),null==(s=t.data)?void 0:s.students){const e=t.data.students.filter(e=>"student"===e.role);de(e.map(e=>({id:e.id,name:e.name||e.username||`${e.first_name} ${e.last_name}`.trim()||`ID: ${e.id}`,email:e.email||""})))}const l=await v.request(`/materials/teacher/materials/${e.id}/assignments/`);f.debug("[openDistributeDialog] Assigned response:",l),(null==(a=l.data)?void 0:a.assigned_students)&&xe(l.data.assigned_students.map(e=>e.id))}catch(t){f.error("[openDistributeDialog] Error:",t),i({title:"Ошибка",description:"Не удалось загрузить список студентов/назначений",variant:"destructive"})}})(e),children:s.jsx(J,{className:"h-4 w-4"})}),s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>pe(e),children:s.jsx(I,{className:"h-4 w-4"})}),s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>{return s=e.id,void l(`/dashboard/teacher/materials/${s}/edit`);var s},children:s.jsx(G,{className:"h-4 w-4"})}),s.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:()=>(async e=>{if(confirm("Вы уверены, что хотите удалить этот материал?"))try{const s=await v.request(`/materials/${e}/`,{method:"DELETE"});if(void 0===s.data)throw new Error(s.error||"Ошибка удаления материала");c(s=>s.filter(s=>s.id!==e)),i({title:"Материал удален",description:"Материал успешно удален"})}catch(s){f.error("Error deleting material:",s),i({title:"Ошибка удаления",description:s instanceof Error?s.message:"Произошла неизвестная ошибка",variant:"destructive"})}})(e.id),className:"text-destructive hover:text-destructive",children:s.jsx(K,{className:"h-4 w-4"})})]})]})},e.id);var a})})]})]})]}),s.jsx(b,{open:ee,onOpenChange:se,children:s.jsxs(w,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[s.jsx(y,{children:s.jsx(_,{children:"Ответы студентов"})}),ae&&s.jsx(Q,{materialId:ae.id,materialTitle:ae.title})]})}),s.jsx(b,{open:le,onOpenChange:ie,children:s.jsxs(w,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[s.jsx(y,{children:s.jsx(_,{children:"Распределение материала"})}),re&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-muted-foreground",children:"Материал"}),s.jsx("div",{className:"font-medium",children:re.title})]}),s.jsx(t,{className:"p-4",children:s.jsxs("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:[0===ce.length&&s.jsx("div",{className:"text-sm text-muted-foreground",children:"Нет доступных студентов для предмета"}),ce.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(D,{id:`dist-st-${e.id}`,checked:oe.includes(e.id),onCheckedChange:()=>{return s=e.id,void xe(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s}}),s.jsxs(o,{htmlFor:`dist-st-${e.id}`,className:"flex-1",children:[e.name," (",e.email,")"]})]},e.id))]})}),s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(d,{type:"button",variant:"outline",onClick:()=>ie(!1),children:"Отмена"}),s.jsx(d,{type:"button",onClick:async()=>{if(re)try{he(!0),f.debug("[saveDistribute] Material ID:",re.id),f.debug("[saveDistribute] Selected student IDs:",oe);const e=await v.request(`/materials/teacher/materials/${re.id}/assignments/`,{method:"PUT",body:JSON.stringify({student_ids:oe})});if(f.debug("[saveDistribute] Response:",e),!e.data)throw new Error(e.error||"Не удалось сохранить распределение");c(s=>s.map(s=>s.id===re.id?{...s,assigned_count:e.data.assigned_count}:s)),i({title:"Сохранено",description:"Материал распределён студентам"}),ie(!1),ne(null)}catch(e){i({title:"Ошибка",description:(null==e?void 0:e.message)||"Не удалось сохранить распределение",variant:"destructive"})}finally{he(!1)}},disabled:me,className:"gradient-primary shadow-glow",children:me?"Сохранение...":"Сохранить"})]})]})]})})]})};export{X as default};
