{
  "permission_boundaries": {
    "pb_developer": {
      "name": "Developer Permission Boundary",
      "description": "Restricts developers to development and staging resources, prevents privilege escalation",
      "version": "2012-10-17",
      "statements": [
        {
          "sid": "AllowDevelopmentResources",
          "effect": "Allow",
          "actions": [
            "ecs:*",
            "ec2:*",
            "s3:GetObject",
            "s3:PutObject",
            "s3:DeleteObject",
            "rds-db:connect",
            "logs:*",
            "cloudwatch:*",
            "ecr:*",
            "dynamodb:*",
            "secretsmanager:GetSecretValue",
            "kms:Decrypt"
          ],
          "resources": "*"
        },
        {
          "sid": "DenyPrivilegeEscalation",
          "effect": "Deny",
          "actions": [
            "iam:*",
            "organizations:*",
            "account:*",
            "kms:ScheduleKeyDeletion",
            "kms:DisableKey",
            "s3:DeleteBucketPolicy",
            "s3:PutBucketPolicy",
            "rds:ModifyDBInstance",
            "ec2:ModifyInstanceAttribute",
            "logs:DeleteLogGroup",
            "cloudtrail:StopLogging",
            "cloudtrail:DeleteTrail"
          ],
          "resources": "*"
        },
        {
          "sid": "DenyProductionSecrets",
          "effect": "Deny",
          "actions": [
            "secretsmanager:*"
          ],
          "resources": [
            "arn:aws:secretsmanager:*:*:secret:prod/*",
            "arn:aws:secretsmanager:*:*:secret:prod-*"
          ]
        }
      ]
    },
    "pb_devops": {
      "name": "DevOps Permission Boundary",
      "description": "Allows infrastructure management with guardrails against account-level changes",
      "version": "2012-10-17",
      "statements": [
        {
          "sid": "AllowInfrastructureManagement",
          "effect": "Allow",
          "actions": [
            "terraform:*",
            "iam:*",
            "ec2:*",
            "ecs:*",
            "rds:*",
            "s3:*",
            "cloudformation:*",
            "elasticloadbalancing:*",
            "autoscaling:*",
            "cloudwatch:*",
            "logs:*",
            "kms:*",
            "sns:*",
            "sqs:*",
            "secretsmanager:*",
            "ssm:*",
            "ecr:*",
            "dynamodb:*",
            "elasticache:*",
            "route53:*",
            "acm:*"
          ],
          "resources": "*"
        },
        {
          "sid": "DenyAccountChanges",
          "effect": "Deny",
          "actions": [
            "organizations:*",
            "account:*",
            "iam:DeleteRole",
            "iam:DeleteRolePolicy",
            "iam:DeleteUser",
            "iam:DeleteGroup",
            "iam:PutUserPolicy",
            "iam:PutGroupPolicy",
            "iam:AttachUserPolicy",
            "iam:AttachGroupPolicy",
            "iam:CreateAccessKey",
            "iam:CreateSecretAccessKey"
          ],
          "resources": "*"
        },
        {
          "sid": "DenyKeyDeletion",
          "effect": "Deny",
          "actions": [
            "kms:ScheduleKeyDeletion",
            "kms:DisableKey"
          ],
          "resources": "*"
        }
      ]
    },
    "pb_admin": {
      "name": "Admin Permission Boundary",
      "description": "Full access with MFA requirement for sensitive operations",
      "version": "2012-10-17",
      "statements": [
        {
          "sid": "AllowAllActions",
          "effect": "Allow",
          "actions": "*",
          "resources": "*"
        },
        {
          "sid": "DenyWithoutMFA",
          "effect": "Deny",
          "actions": [
            "iam:*",
            "organizations:*",
            "account:*",
            "kms:ScheduleKeyDeletion",
            "kms:DisableKey"
          ],
          "resources": "*",
          "conditions": {
            "bool": {
              "aws:MultiFactorAuthPresent": "false"
            }
          }
        }
      ]
    },
    "pb_readonly": {
      "name": "Read-Only Permission Boundary",
      "description": "View-only access, prevents all modification operations",
      "version": "2012-10-17",
      "statements": [
        {
          "sid": "AllowReadOnly",
          "effect": "Allow",
          "actions": [
            "ec2:Describe*",
            "ecs:Describe*",
            "rds:Describe*",
            "s3:GetObject",
            "s3:ListBucket",
            "logs:Describe*",
            "logs:Get*",
            "cloudwatch:Get*",
            "cloudwatch:List*",
            "cloudtrail:GetTrailStatus",
            "cloudtrail:LookupEvents",
            "kms:Describe*",
            "kms:Get*",
            "kms:List*",
            "iam:Get*",
            "iam:List*",
            "secretsmanager:GetSecretValue",
            "ssm:GetParameter",
            "ssm:GetParameters",
            "ssm:DescribeParameters",
            "route53:List*",
            "route53:Get*",
            "acm:Describe*",
            "acm:List*"
          ],
          "resources": "*"
        },
        {
          "sid": "DenyModifyingActions",
          "effect": "Deny",
          "actions": [
            "*:Create*",
            "*:Delete*",
            "*:Modify*",
            "*:Put*",
            "*:Update*",
            "*:Attach*",
            "*:Detach*",
            "iam:*"
          ],
          "resources": "*"
        }
      ]
    }
  },
  "service_restrictions": {
    "by_environment": {
      "dev": {
        "description": "Development environment - relaxed permissions",
        "allowed_services": [
          "ecs",
          "ec2",
          "rds",
          "s3",
          "dynamodb",
          "sqs",
          "sns",
          "logs",
          "cloudwatch"
        ],
        "restricted_actions": []
      },
      "staging": {
        "description": "Staging environment - moderate restrictions",
        "allowed_services": [
          "ecs",
          "ec2",
          "rds",
          "s3",
          "dynamodb",
          "sqs",
          "sns",
          "logs",
          "cloudwatch",
          "route53"
        ],
        "restricted_actions": [
          "ec2:TerminateInstances",
          "rds:DeleteDBInstance",
          "s3:DeleteBucket"
        ]
      },
      "production": {
        "description": "Production environment - strict restrictions",
        "allowed_services": [
          "ecs",
          "rds",
          "s3",
          "logs",
          "cloudwatch",
          "route53"
        ],
        "restricted_actions": [
          "ec2:TerminateInstances",
          "ec2:StopInstances",
          "rds:DeleteDBInstance",
          "rds:ModifyDBInstance",
          "s3:DeleteBucket",
          "s3:DeleteObject"
        ]
      }
    },
    "by_resource_type": {
      "compute": {
        "ec2": {
          "restricted_actions": [
            "ec2:TerminateInstances",
            "ec2:ModifyInstanceAttribute",
            "ec2:ModifySecurityGroupRules"
          ],
          "allowed_for_roles": ["devops", "admin"]
        },
        "ecs": {
          "restricted_actions": [
            "ecs:DeleteCluster",
            "ecs:DeleteService"
          ],
          "allowed_for_roles": ["devops", "admin"]
        },
        "lambda": {
          "restricted_actions": [
            "lambda:DeleteFunction",
            "lambda:DeleteEventSourceMapping"
          ],
          "allowed_for_roles": ["devops", "admin"]
        }
      },
      "database": {
        "rds": {
          "restricted_actions": [
            "rds:DeleteDBInstance",
            "rds:ModifyDBInstance",
            "rds:RebootDBInstance",
            "rds:StartDBInstance",
            "rds:StopDBInstance"
          ],
          "allowed_for_roles": ["devops", "admin"]
        },
        "dynamodb": {
          "restricted_actions": [
            "dynamodb:DeleteTable"
          ],
          "allowed_for_roles": ["developer", "devops", "admin"]
        }
      },
      "storage": {
        "s3": {
          "restricted_actions": [
            "s3:DeleteBucket",
            "s3:DeleteBucketPolicy",
            "s3:PutBucketPolicy"
          ],
          "allowed_for_roles": ["devops", "admin"]
        }
      },
      "security": {
        "iam": {
          "restricted_actions": [
            "iam:DeleteRole",
            "iam:DeleteUser",
            "iam:AttachUserPolicy",
            "iam:DetachUserPolicy",
            "iam:PutUserPolicy"
          ],
          "allowed_for_roles": ["admin"]
        },
        "kms": {
          "restricted_actions": [
            "kms:ScheduleKeyDeletion",
            "kms:DisableKey",
            "kms:PutKeyPolicy"
          ],
          "allowed_for_roles": ["devops", "admin"]
        }
      }
    }
  },
  "privilege_escalation_prevention": {
    "critical_restrictions": {
      "iam_modifications": {
        "description": "Prevent unauthorized IAM policy changes",
        "denied_actions": [
          "iam:PutUserPolicy",
          "iam:PutGroupPolicy",
          "iam:PutRolePolicy",
          "iam:AttachUserPolicy",
          "iam:AttachGroupPolicy",
          "iam:AttachRolePolicy",
          "iam:CreateAccessKey",
          "iam:CreateSecretAccessKey",
          "iam:AddUserToGroup"
        ],
        "exceptions": ["admin"]
      },
      "account_level_changes": {
        "description": "Prevent account structure changes",
        "denied_actions": [
          "organizations:*",
          "account:*",
          "iam:DeleteRole",
          "iam:DeleteUser",
          "iam:DeleteGroup"
        ],
        "exceptions": ["admin"]
      },
      "key_management": {
        "description": "Prevent KMS key deletion and disablement",
        "denied_actions": [
          "kms:ScheduleKeyDeletion",
          "kms:DisableKey",
          "kms:PutKeyPolicy"
        ],
        "exceptions": ["admin"]
      },
      "audit_trail_tampering": {
        "description": "Prevent CloudTrail and logging modification",
        "denied_actions": [
          "cloudtrail:StopLogging",
          "cloudtrail:DeleteTrail",
          "logs:DeleteLogGroup",
          "logs:DeleteLogStream",
          "cloudwatch:DeleteAlarms"
        ],
        "exceptions": ["admin"]
      }
    },
    "resource_level_restrictions": {
      "production_secrets": {
        "pattern": "arn:aws:secretsmanager:*:*:secret:prod/*",
        "allowed_actions": [
          "secretsmanager:GetSecretValue"
        ],
        "allowed_roles": ["cicd", "admin", "ecs_task_*"]
      },
      "terraform_state": {
        "pattern": "arn:aws:s3:::thebot-terraform-state*",
        "allowed_actions": [
          "s3:GetObject",
          "s3:PutObject"
        ],
        "allowed_roles": ["devops", "admin", "cicd"]
      }
    }
  },
  "mfa_enforcement": {
    "required_for_roles": ["admin"],
    "required_for_actions": [
      "iam:DeleteUser",
      "iam:DeleteRole",
      "organizations:*",
      "account:*",
      "kms:ScheduleKeyDeletion"
    ],
    "enforcement_method": "aws:MultiFactorAuthPresent",
    "session_duration_after_mfa": 900
  },
  "resource_tagging_strategy": {
    "required_tags": {
      "Project": "THE_BOT",
      "Environment": ["dev", "staging", "production"],
      "Owner": "team-email@company.com",
      "CostCenter": "CC-12345",
      "DataClassification": ["public", "internal", "confidential", "restricted"]
    },
    "tag_based_access_control": [
      {
        "resource_type": "ecs:service",
        "tag_key": "Environment",
        "tag_values": ["dev", "staging"],
        "allowed_roles": ["developer", "devops"]
      },
      {
        "resource_type": "rds:db",
        "tag_key": "Environment",
        "tag_values": ["production"],
        "allowed_roles": ["devops", "admin"]
      }
    ]
  }
}
