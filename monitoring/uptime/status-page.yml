# Status Page Configuration for THE_BOT Platform
# Defines which endpoints are shown to public, which require authentication, and SLA targets

# Global Settings
global:
  # Status page title and branding
  title: "THE_BOT Platform Status"
  description: "Real-time status and uptime monitoring for THE_BOT educational platform"
  website_url: "https://thebot.local"
  status_page_url: "https://status.thebot.local"

  # Logo and branding
  logo_url: "https://thebot.local/logo.png"
  favicon_url: "https://thebot.local/favicon.ico"

  # Theme configuration
  theme:
    primary_color: "#1976d2"  # Material Blue
    secondary_color: "#424242"  # Dark Gray
    success_color: "#4caf50"  # Green
    warning_color: "#ff9800"  # Orange
    danger_color: "#f44336"  # Red

  # Analytics
  google_analytics_id: "{{ GOOGLE_ANALYTICS_ID }}"
  sentry_dsn: "{{ SENTRY_DSN }}"

# Public Status Endpoints (shown without authentication)
public_status:
  # Overall system health
  overall_status:
    name: "System Status"
    description: "Overall health of THE_BOT platform"
    visibility: "public"
    refresh_interval: 30s
    sla_target: 99.9

  # Component groups shown to public
  components:
    - group_name: "Core Services"
      visibility: "public"
      description: "Critical platform services"
      components:
        - name: "API Server"
          service: "backend"
          component: "api_health"
          sla_target: 99.9
          incident_impact: "critical"
          show_response_time: true
          show_details: false  # Hide detailed error messages

        - name: "Authentication Service"
          service: "backend"
          component: "auth_login"
          sla_target: 99.9
          incident_impact: "critical"
          show_response_time: true
          show_details: false

        - name: "Frontend UI"
          service: "frontend"
          component: "frontend_root"
          sla_target: 99.9
          incident_impact: "critical"
          show_response_time: true
          show_details: false

        - name: "Real-time Chat"
          service: "backend"
          component: "websocket_health"
          sla_target: 99.5
          incident_impact: "high"
          show_response_time: true
          show_details: false

    - group_name: "API Endpoints"
      visibility: "public"
      description: "API functionality and features"
      components:
        - name: "Materials API"
          service: "backend"
          component: "materials_list"
          sla_target: 99.5
          incident_impact: "medium"
          show_response_time: true
          show_details: false

        - name: "Chat Rooms API"
          service: "backend"
          component: "chat_rooms"
          sla_target: 99.5
          incident_impact: "medium"
          show_response_time: true
          show_details: false

        - name: "Knowledge Graph API"
          service: "backend"
          component: "knowledge_graph"
          sla_target: 99.5
          incident_impact: "medium"
          show_response_time: true
          show_details: false

        - name: "User Profiles API"
          service: "backend"
          component: "user_profile"
          sla_target: 99.5
          incident_impact: "medium"
          show_response_time: true
          show_details: false

# Private Status Endpoints (shown with authentication)
private_status:
  # Infrastructure components
  infrastructure:
    visibility: "authenticated"
    description: "Infrastructure and system components"
    components:
      - name: "PostgreSQL Database"
        service: "backend"
        component: "database_health"
        sla_target: 99.9
        incident_impact: "critical"
        show_response_time: true
        show_details: true

      - name: "Redis Cache"
        service: "backend"
        component: "redis_health"
        sla_target: 99.5
        incident_impact: "high"
        show_response_time: true
        show_details: true

      - name: "Celery Task Queue"
        service: "backend"
        component: "celery_health"
        sla_target: 99.0
        incident_impact: "medium"
        show_response_time: true
        show_details: true

  # Advanced metrics (for ops team only)
  advanced_metrics:
    visibility: "ops_team"  # Only for ops team members
    description: "Advanced system metrics and diagnostics"
    components:
      - name: "Database Performance"
        service: "backend"
        component: "db_performance"
        metrics:
          - query_time_p95
          - connection_pool_usage
          - slow_query_count
        show_details: true

      - name: "Cache Performance"
        service: "backend"
        component: "cache_performance"
        metrics:
          - hit_rate
          - eviction_rate
          - memory_usage_percent
        show_details: true

# Incident Management
incidents:
  # Automatic incident detection
  auto_detection:
    enabled: true
    threshold_minutes: 2  # Create incident if service down for 2+ minutes
    severity_mapping:
      critical: "critical"
      warning: "major"
      info: "minor"

  # Incident templates
  templates:
    - name: "API Server Down"
      component: "api_health"
      severity: "critical"
      description: "The API server is unavailable"
      resolution_steps:
        - "Check server logs for errors"
        - "Verify database connectivity"
        - "Check Redis connection"
        - "Restart Django service if needed"

    - name: "High Response Time"
      component: "api_endpoints"
      severity: "major"
      description: "API endpoints responding slowly"
      resolution_steps:
        - "Check database query performance"
        - "Review cache hit rates"
        - "Check server resource usage (CPU, memory)"
        - "Scale horizontally if needed"

    - name: "Authentication Issues"
      component: "auth_login"
      severity: "critical"
      description: "User authentication failing"
      resolution_steps:
        - "Verify JWT secret configuration"
        - "Check database for user records"
        - "Verify password hashing service"

  # Historical incident tracking
  history:
    enabled: true
    retention_days: 365
    public_display: true
    include_resolution_time: true
    include_root_cause: true

# SLA Configuration
sla:
  # Default SLA targets
  defaults:
    critical: 99.9  # 99.9% = 43 min downtime/month
    high: 99.5      # 99.5% = 216 min downtime/month
    medium: 99.0    # 99% = 432 min downtime/month
    low: 95.0       # 95% = 21.6 hours downtime/month

  # SLA calculation periods
  calculation_periods:
    - name: "24h"
      hours: 24
      display: "Last 24 Hours"
    - name: "7d"
      hours: 168
      display: "Last 7 Days"
    - name: "30d"
      hours: 720
      display: "Last 30 Days"
    - name: "90d"
      hours: 2160
      display: "Last 90 Days"
    - name: "1y"
      hours: 8760
      display: "Last Year"

  # SLA breach notifications
  breach_notifications:
    enabled: true
    warning_threshold: 99.5  # Alert at 99.5%
    critical_threshold: 99.0  # Page oncall at 99%
    check_interval: 1h
    notify_channels:
      - slack
      - email
      - pagerduty

  # SLA credits/compensation
  credits:
    enabled: false  # Set to true to enable automatic credits
    calculation:
      - range: "99.0-99.5"
        credit_percent: 5
      - range: "98.0-99.0"
        credit_percent: 10
      - range: "95.0-98.0"
        credit_percent: 25
      - range: "<95.0"
        credit_percent: 50

  # Service credits report
  report:
    enabled: true
    generate_monthly: true
    send_to: "billing@thebot.local"

# Scheduled Maintenance
maintenance:
  # Planned maintenance notifications
  notifications:
    enabled: true
    advance_notice_hours: 24
    channels:
      - email
      - slack
      - status_page

  # Maintenance windows impact on SLA
  sla_impact:
    exclude_maintenance_downtime: true  # Don't count planned maintenance in SLA
    maintenance_window_buffer: 30m  # Grace period after maintenance

  # Maintenance templates
  templates:
    - name: "Database Maintenance"
      components: ["database_health"]
      estimated_duration_minutes: 30
      description: "Scheduled database optimization and backup"

    - name: "Redis Cache Maintenance"
      components: ["redis_health"]
      estimated_duration_minutes: 15
      description: "Cache cluster maintenance and updates"

    - name: "Frontend Deployment"
      components: ["frontend_root"]
      estimated_duration_minutes: 10
      description: "Rolling deployment of frontend updates"

# Status Page Appearance
appearance:
  # Layout configuration
  layout:
    show_graph: true  # Show uptime graph
    show_metrics: true  # Show performance metrics
    show_response_times: true  # Show response time data
    show_history: true  # Show incident history
    compact_mode: false  # Compact display for small screens

  # Component grouping
  component_grouping:
    enabled: true
    groups:
      - "Core Services"
      - "API Endpoints"
      - "Infrastructure"
      - "Advanced Metrics"

  # Incident history display
  incident_display:
    show_count: 5  # Show last 5 incidents
    show_detailed_history: true
    show_root_cause: true

  # Uptime graph configuration
  uptime_graph:
    display: "bar_chart"  # bar_chart, line_graph, percentage
    period: "30d"  # default period shown
    granularity: "daily"  # daily, hourly, weekly

# Webhook Configuration (for integrations)
webhooks:
  # Send status changes to external systems
  status_change:
    enabled: true
    retry_attempts: 3
    retry_delay_seconds: 60
    endpoints:
      - name: "Slack Webhook"
        url: "{{ SLACK_WEBHOOK_URL }}"
        events: ["service_down", "service_up", "sla_breach"]
        active: true

      - name: "Custom Integration"
        url: "{{ CUSTOM_WEBHOOK_URL }}"
        events: ["all"]
        active: "{{ ENABLE_CUSTOM_WEBHOOK }}"

  # Incident updates
  incident_updates:
    enabled: true
    notify_on:
      - "incident_created"
      - "incident_resolved"
      - "incident_updated"

# Email Configuration
email:
  # Status page email
  status_email:
    enabled: true
    send_to_list: "{{ STATUS_PAGE_EMAIL_LIST }}"
    frequency: "daily"
    time_of_day: "09:00"
    include_summary: true
    include_incidents: true

  # SLA report email
  sla_report:
    enabled: true
    recipients: "{{ SLA_REPORT_RECIPIENTS }}"
    frequency: "monthly"
    day_of_month: 1
    time_of_day: "08:00"

# Authentication & Access Control
access_control:
  # Public access (no auth required)
  public:
    enabled: true
    can_view_status: true
    can_view_history: true
    can_subscribe: true

  # Authenticated users
  authenticated:
    can_view_private_endpoints: true
    can_view_detailed_metrics: true
    can_view_incidents: true

  # Operators/DevOps team
  operators:
    can_create_incidents: true
    can_update_incidents: true
    can_acknowledge_incidents: true
    can_schedule_maintenance: true
    can_view_all_metrics: true

  # Administrators
  administrators:
    full_access: true
    can_configure_page: true
    can_manage_users: true
    can_manage_components: true

# Data Retention & Privacy
data_retention:
  # How long to keep historical data
  uptime_data_days: 90  # 3 months
  incident_history_days: 365  # 1 year
  metrics_data_days: 180  # 6 months

  # Privacy settings
  privacy:
    anonymize_ip_addresses: true
    collect_user_agents: true
    show_response_times: true
    show_error_details: false  # Don't show error messages publicly

# Rate Limiting for Status Page
rate_limiting:
  enabled: true
  # General API requests
  api_requests:
    requests_per_minute: 60
    burst_size: 10

  # Webhook delivery
  webhooks:
    requests_per_minute: 100
    burst_size: 20

  # Status page access
  public_access:
    requests_per_minute: 1000
    burst_size: 100

# Integrations
integrations:
  # Status page embeds
  embed:
    enabled: true
    # Allow status page to be embedded on other sites
    allow_embedding: true
    # Whitelist of allowed domains
    whitelist_domains:
      - "thebot.local"
      - "*.thebot.local"

  # API tokens for programmatic access
  api_tokens:
    enabled: true
    # Public token for public endpoints
    public_token: "{{ STATUS_PAGE_PUBLIC_TOKEN }}"
    # Private token for authenticated endpoints
    private_token: "{{ STATUS_PAGE_PRIVATE_TOKEN }}"
    # Token expiration
    token_expiration_days: 365

# External Status Aggregators
status_aggregators:
  # StatusPage.io integration
  statuspage_io:
    enabled: false
    api_key: "{{ STATUSPAGE_IO_API_KEY }}"
    page_id: "{{ STATUSPAGE_IO_PAGE_ID }}"
    sync_incidents: true
    sync_components: true

  # Atlassian Statuspage
  atlassian_statuspage:
    enabled: false
    api_token: "{{ ATLASSIAN_API_TOKEN }}"
    page_id: "{{ ATLASSIAN_PAGE_ID }}"

  # Better Uptime
  better_uptime:
    enabled: false
    api_token: "{{ BETTER_UPTIME_API_TOKEN }}"
    account_id: "{{ BETTER_UPTIME_ACCOUNT_ID }}"

# Localization & Timezone
localization:
  # Default timezone
  default_timezone: "UTC"
  # Supported languages
  supported_languages:
    - code: "en"
      name: "English"
    - code: "ru"
      name: "Russian"
  # Date/time format
  date_format: "YYYY-MM-DD"
  time_format: "HH:mm:ss"

# Monitoring & Diagnostics
monitoring:
  # Enable status page diagnostics
  diagnostics_enabled: true
  # Monitor status page itself
  self_monitoring:
    enabled: true
    check_interval: 60s
  # Export metrics
  metrics_export:
    enabled: true
    format: "prometheus"
    port: 9091
