# THE_BOT Platform - Docker Compose Environment Configuration
#
# Usage:
#   docker-compose --env-file .env.docker up -d
#
# This file provides all environment variables needed to run the full stack in Docker.
# For development, you can copy and customize these values.
# For production, use proper secrets management.

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# PostgreSQL Database (используется для всех окружений)
# Development использует локальную PostgreSQL через Unix socket
# Production использует cloud PostgreSQL (например Supabase PostgreSQL)
DATABASE_URL=postgresql://postgres:postgres@localhost/thebot_db
DB_HOST=localhost
DB_NAME=thebot_db
DB_USER=postgres
DB_PASSWORD=postgres
DB_PORT=5432
DB_SSLMODE=disable

# ============================================================================
# REDIS CONFIGURATION (Cache + Channels Layer)
# ============================================================================
# Redis (используется для кэша, Celery message broker и WebSockets)
# НЕ используется как основное хранилище данных
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=
REDIS_PORT=6379
USE_REDIS_CACHE=True
USE_REDIS_CHANNELS=True

# ============================================================================
# DJANGO BACKEND CONFIGURATION
# ============================================================================
BACKEND_PORT=8000
ENVIRONMENT=development
DEBUG=True

# CRITICAL: Change this in production!
# Generate with: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
SECRET_KEY=django-insecure-your-secret-key-here-change-in-production

# Allowed hosts for Django
ALLOWED_HOSTS=localhost,127.0.0.1,backend

# CORS configuration for frontend access
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000,http://localhost:8080

# ============================================================================
# TELEGRAM BOT CONFIGURATION
# ============================================================================
TELEGRAM_BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
TELEGRAM_CHAT_ID=YOUR_CHAT_ID
TELEGRAM_PUBLIC_CHAT_ID=YOUR_PUBLIC_CHAT_ID
TELEGRAM_LOG_CHAT_ID=YOUR_LOG_CHAT_ID

# ============================================================================
# YOO.KASSA PAYMENT CONFIGURATION
# ============================================================================
YOOKASSA_SHOP_ID=YOUR_SHOP_ID
YOOKASSA_SECRET_KEY=YOUR_SECRET_KEY
YOOKASSA_WEBHOOK_URL=http://backend:8000/api/payments/webhook/

# ============================================================================
# OPENROUTER API (for AI features like study plan generation)
# ============================================================================
OPENROUTER_API_KEY=

# ============================================================================
# SENTRY ERROR TRACKING
# ============================================================================
SENTRY_DSN=

# ============================================================================
# FRONTEND CONFIGURATION
# ============================================================================
FRONTEND_URL=http://localhost:3000
FRONTEND_HOST=localhost
FRONTEND_PORT=3000

# ============================================================================
# CELERY / BACKGROUND TASKS
# ============================================================================
# Celery is optional - can be disabled by setting CELERY_ENABLED=False
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2
CELERY_ENABLED=False

# ============================================================================
# LOGGING AND MONITORING
# ============================================================================
LOG_LEVEL=INFO
ENABLE_PROMETHEUS=False

# ============================================================================
# WEBSOCKET CONFIGURATION
# ============================================================================
# WebSocket Heartbeat - ping/pong to detect stale connections
# HEARTBEAT_INTERVAL: How often to send ping (seconds, 5-300, default 30)
# HEARTBEAT_TIMEOUT: How long to wait for pong before closing (seconds, 3-120, default 15)
# Must have: HEARTBEAT_TIMEOUT < HEARTBEAT_INTERVAL
# Development: longer intervals (less network traffic)
# Production: shorter intervals (detect disconnections faster)
WEBSOCKET_HEARTBEAT_INTERVAL=30
WEBSOCKET_HEARTBEAT_TIMEOUT=15

# WebSocket Authentication timeout (seconds, 5-120, default 15)
# How long client has to send auth token after connecting
WEBSOCKET_AUTH_TIMEOUT=15

# Message size limit (characters, 100-1000000, default 10000)
# Maximum length of message content
WEBSOCKET_MESSAGE_SIZE_LIMIT=10000

# Max concurrent connections per user (1-100, default 5)
# Prevents one user from hogging multiple connections
WEBSOCKET_MAX_CONNECTIONS_PER_USER=5

# Reconnect backoff multiplier (default 2.0)
# For exponential backoff: delay = initial_delay * multiplier^attempt
WEBSOCKET_RECONNECT_BACKOFF_MULTIPLIER=2.0

# Max delay between reconnect attempts (milliseconds, 1000-300000, default 32000)
# 32000 = 32 seconds max delay
WEBSOCKET_RECONNECT_MAX_DELAY=32000

# ============================================================================
# SECURITY SETTINGS
# ============================================================================
# Token TTL for telegram linking
TELEGRAM_LINK_TOKEN_TTL_MINUTES=10
