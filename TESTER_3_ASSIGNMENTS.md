# Тестирование функционала Assignment & Submission Workflow
## THE_BOT Platform - Web UI Testing Report

**Дата тестирования**: 2026-01-01
**Окружение**: Development (Docker)
**Статус**: READY FOR MANUAL TESTING

---

## Условия предварительного тестирования

### Системные требования
- Docker and Docker Compose должны быть запущены
- Backend: http://localhost:8000
- Frontend: http://localhost:3000
- База данных: PostgreSQL (port 5433)
- Кэш: Redis (port 6379)

### Учетные записи для тестирования
| Email | Пароль | Роль | Статус |
|-------|--------|------|--------|
| ivan.petrov@tutoring.com | password123 | Teacher | Готов к тестированию |
| anna.ivanova@student.com | password123 | Student | Готов к тестированию |
| dmitry.smirnov@student.com | password123 | Student | Готов к тестированию |
| admin@test.com | password123 | Admin | Готов к тестированию |

---

## ТЕСТОВЫЙ СЦЕНАРИЙ 1: Создание задания (Teacher)

### Предварительные условия
- Логин: ivan.petrov@tutoring.com
- Пароль: password123
- Роль: Teacher

### Шаги теста

| # | Шаг | Ожидаемый результат | Статус | Заметки |
|---|-----|-------------------|--------|---------|
| 1.1 | Авторизуйтесь в системе | Редирект на Dashboard учителя | PENDING | - |
| 1.2 | Найдите раздел "Assignments" или "Homework" в меню | Открывается список заданий | PENDING | - |
| 1.3 | Нажмите кнопку "Create Assignment" или "Создать задание" | Открывается форма создания | PENDING | - |
| 1.4 | Заполните поле Title: "Домашняя работа: Уравнения" | Текст введен | PENDING | - |
| 1.5 | Заполните поле Description: "Решите 5 уравнений из учебника" | Текст введен | PENDING | - |
| 1.6 | Установите Deadline: 2026-01-03 23:59 | Дата выбрана | PENDING | - |
| 1.7 | Установите Points: 100 | Значение установлено | PENDING | - |
| 1.8 | В "Assign to" выберите anna.ivanova@student.com и dmitry.smirnov@student.com | Оба студента выбраны | PENDING | - |
| 1.9 | Нажмите "Publish" или "Создать и опубликовать" | Задание создано и опубликовано | PENDING | Проверить редирект |
| 1.10 | Проверьте что задание отображается в списке | Задание видно в списке | PENDING | Содержит название и описание |

### Проверяемые поля модели Assignment
```python
# Из models.py - Assignment класс:
- title: "Домашняя работа: Уравнения"
- description: "Решите 5 уравнений из учебника"
- due_date: 2026-01-03 23:59:00
- max_score: 100
- status: "published" (из choices: draft, published, closed)
- assigned_to: [anna.ivanova@student.com, dmitry.smirnov@student.com]
- type: "homework" (по умолчанию)
```

### Критерии успеха
- [ ] Форма валидирует обязательные поля (title, description, due_date, max_score)
- [ ] Дата дедлайна корректно сохраняется в UTC
- [ ] Множественный выбор студентов работает (ManyToMany поле)
- [ ] После публикации задание имеет статус "published"
- [ ] Задание видно в списке всех заданий учителя

---

## ТЕСТОВЫЙ СЦЕНАРИЙ 2: Просмотр задания (Student)

### Предварительные условия
- Логин: anna.ivanova@student.com
- Пароль: password123
- Роль: Student
- Предварительно должно быть создано задание из сценария 1

### Шаги теста

| # | Шаг | Ожидаемый результат | Статус | Заметки |
|---|-----|-------------------|--------|---------|
| 2.1 | Авторизуйтесь в системе | Редирект на Dashboard студента | PENDING | - |
| 2.2 | Посмотрите список заданий (Assignments/Homework раздел) | Видно созданное задание из сценария 1 | PENDING | - |
| 2.3 | Нажмите на задание "Домашняя работа: Уравнения" | Открывается страница задания | PENDING | - |
| 2.4 | Проверьте видно название задания | "Домашняя работа: Уравнения" отображается | PENDING | В заголовке или основной области |
| 2.5 | Проверьте видно описание | "Решите 5 уравнений из учебника" отображается | PENDING | - |
| 2.6 | Проверьте видно дедлайн | "2026-01-03 23:59" отображается | PENDING | В правильном формате времени |
| 2.7 | Проверьте видно имя учителя | "Ivan Petrov" или "ivan.petrov@tutoring.com" отображается | PENDING | Автор задания |
| 2.8 | Проверьте видно статус задания | "Not Submitted" или "Не отправлено" отображается | PENDING | Первоначальный статус |
| 2.9 | Проверьте видны максимальные баллы | "100 points" или "100 баллов" отображается | PENDING | max_score поле |

### Проверяемые поля модели
```python
# Из models.py - видимые студенту:
- title: "Домашняя работа: Уравнения"
- description: "Решите 5 уравнений из учебника"
- due_date: 2026-01-03 23:59:00
- max_score: 100
- author: User(ivan.petrov@tutoring.com)
- Статус: определяется на основе AssignmentSubmission
```

### Критерии успеха
- [ ] Все поля задания правильно отображаются
- [ ] Дедлайн преобразован в местный часовой пояс
- [ ] Имя учителя-автора правильно отображается
- [ ] Статус submission-а корректно показывает состояние

---

## ТЕСТОВЫЙ СЦЕНАРИЙ 3: Отправка решения (Student)

### Предварительные условия
- Логин: anna.ivanova@student.com
- Пароль: password123
- Открыта страница задания из сценария 2

### Шаги теста

| # | Шаг | Ожидаемый результат | Статус | Заметки |
|---|-----|-------------------|--------|---------|
| 3.1 | На странице задания нажмите "Submit" или "Отправить решение" | Открывается форма отправки | PENDING | Кнопка должна быть активной |
| 3.2 | В поле Answer/Content введите текст решения | Текст введен | PENDING | Например: "Решение: 1) x=5, 2) x=10..." |
| 3.3 | Нажмите "Choose File" или "Выбрать файл" | Открывается диалог выбора файла | PENDING | - |
| 3.4 | Выберите текстовый файл (например, solution.txt) | Файл добавлен в форму | PENDING | Размер <10MB |
| 3.5 | Нажмите "Submit" или "Отправить" | Файл загружается и сохраняется | PENDING | Может показать прогресс-бар |
| 3.6 | После загрузки проверьте дату/время отправки | Отображается текущая дата/время | PENDING | submitted_at поле |
| 3.7 | Проверьте что статус изменился | "Submitted" или "Отправлено" | PENDING | Из моделей: Status.SUBMITTED |
| 3.8 | Проверьте возможность загрузить другой файл | Форма позволяет выбрать новый файл | PENDING | Переотправка/версионирование |
| 3.9 | Выберите другой файл (например, solution_v2.txt) | Файл добавлен | PENDING | - |
| 3.10 | Отправьте второй файл | Новый файл загружается | PENDING | Должен заменить или создать версию |

### Проверяемые поля модели AssignmentSubmission
```python
# Из models.py - AssignmentSubmission класс:
- assignment_id: из сценария 1
- student_id: anna.ivanova@student.com
- content: "Решение: 1) x=5, 2) x=10..."
- file: FileField pointing to "assignments/submissions/..."
- status: Status.SUBMITTED ("submitted")
- submitted_at: datetime.now() (auto_now_add)
- is_late: boolean (должно быть False, т.к. до дедлайна)
- score: None (до проверки)
- feedback: "" (до проверки)
```

### Критерии успеха
- [ ] Файл успешно загружается на сервер
- [ ] submitted_at устанавливается автоматически
- [ ] Статус изменяется на SUBMITTED
- [ ] Возможна повторная отправка (версионирование)
- [ ] is_late = False (дата еще до дедлайна)
- [ ] File field правильно сохраняет путь загруженного файла

---

## ТЕСТОВЫЙ СЦЕНАРИЙ 4: Проверка работ (Teacher)

### Предварительные условия
- Логин: ivan.petrov@tutoring.com
- Пароль: password123
- Роль: Teacher
- Студент anna.ivanova должна была отправить решение (сценарий 3)

### Шаги теста

| # | Шаг | Ожидаемый результат | Статус | Заметки |
|---|-----|-------------------|--------|---------|
| 4.1 | Авторизуйтесь в системе как учитель | Редирект на Dashboard учителя | PENDING | - |
| 4.2 | Перейдите в раздел "Assignments" → ваше задание | Открывается задание | PENDING | "Домашняя работа: Уравнения" |
| 4.3 | Посмотрите список всех отправленных решений | Видны 1-2 отправки (от anna и dmitry) | PENDING | Таблица/список с именами студентов |
| 4.4 | Нажмите на отправку от anna.ivanova | Открывается детальный просмотр решения | PENDING | - |
| 4.5 | Посмотрите загруженный файл | Файл доступен для скачивания/просмотра | PENDING | Иконка скачивания или preview |
| 4.6 | Нажмите на файл или "View" | Файл открывается или скачивается | PENDING | Зависит от типа файла |
| 4.7 | Вернитесь к форме оценки | Видна форма с полями score/feedback | PENDING | - |
| 4.8 | В поле Score/Баллы введите "85" | Значение установлено | PENDING | Из 100 |
| 4.9 | В поле Feedback/Комментарий напишите: "Хорошо решено, не хватает объяснений" | Текст введен | PENDING | - |
| 4.10 | Нажмите "Publish Grade" или "Опубликовать оценку" | Оценка сохраняется и публикуется | PENDING | Status → GRADED |
| 4.11 | Проверьте что оценка отображается в списке | "85/100" видно в таблице | PENDING | - |
| 4.12 | Проверьте что дата проверки установлена | graded_at отображается | PENDING | Текущая дата/время |

### Проверяемые поля модели AssignmentSubmission
```python
# Изменения после проверки:
- score: 85
- max_score: 100
- feedback: "Хорошо решено, не хватает объяснений"
- status: Status.GRADED ("graded")
- graded_at: datetime.now()
- percentage: 85.0 (вычисляемое поле)
```

### Критерии успеха
- [ ] Учитель может видеть все отправленные решения
- [ ] Файл доступен для просмотра/скачивания
- [ ] Оценка (score) сохраняется корректно
- [ ] Комментарий (feedback) сохраняется полностью
- [ ] После публикации статус меняется на GRADED
- [ ] graded_at устанавливается автоматически

---

## ТЕСТОВЫЙ СЦЕНАРИЙ 5: Просмотр оценки (Student)

### Предварительные условия
- Логин: anna.ivanova@student.com
- Пароль: password123
- Учитель поставил оценку в сценарии 4

### Шаги теста

| # | Шаг | Ожидаемый результат | Статус | Заметки |
|---|-----|-------------------|--------|---------|
| 5.1 | Авторизуйтесь в системе как студент | Редирект на Dashboard студента | PENDING | - |
| 5.2 | Перейдите в раздел "Assignments" → задание | Открывается список заданий | PENDING | - |
| 5.3 | Нажмите на задание "Домашняя работа: Уравнения" | Открывается страница задания | PENDING | - |
| 5.4 | Посмотрите полученную оценку | "85/100" или "85 из 100" отображается | PENDING | - |
| 5.5 | Посмотрите комментарий учителя | "Хорошо решено, не хватает объяснений" видно | PENDING | В разделе Feedback/Comments |
| 5.6 | Проверьте видна дата проверки | Дата и время проверки отображаются | PENDING | graded_at |
| 5.7 | Проверьте процент выполнения | "85%" или "85/100 (85%)" | PENDING | Вычисляемое поле percentage |
| 5.8 | Если доступны результаты других студентов, проверьте их видимость | Может быть скрыто по умолчанию или доступно | PENDING | Зависит от настроек приватности |

### Критерии успеха
- [ ] Оценка правильно отображается для студента
- [ ] Комментарий учителя виден полностью
- [ ] Дата проверки отображается в правильном формате
- [ ] Процент вычисляется корректно (85/100 = 85%)
- [ ] Старые отправленные файлы остаются доступны

---

## ТЕСТОВЫЙ СЦЕНАРИЙ 6: Дедлайн и опоздание

### Предварительные условия
- Логин: ivan.petrov@tutoring.com (сначала создание)
- Потом dmitry.smirnov@student.com (отправка после дедлайна)

### Шаги теста (Часть 1: Создание задания с прошлым дедлайном)

| # | Шаг | Ожидаемый результат | Статус | Заметки |
|---|-----|-------------------|--------|---------|
| 6.1 | Авторизуйтесь как ivan.petrov@tutoring.com | Dashboard учителя | PENDING | - |
| 6.2 | Создайте новое задание | Форма создания открыта | PENDING | - |
| 6.3 | Заполните Title: "Задание с пройденным дедлайном" | Текст введен | PENDING | - |
| 6.4 | Заполните Description | Любое описание | PENDING | - |
| 6.5 | Установите Deadline: 2026-01-01 23:59 (в прошлое) | Дата установлена | PENDING | Сегодняшний день 2026-01-01 |
| 6.6 | Установите Points: 100 | Значение установлено | PENDING | - |
| 6.7 | Назначьте dmitry.smirnov@student.com | Студент выбран | PENDING | - |
| 6.8 | Опубликуйте задание | Задание создано | PENDING | - |

### Шаги теста (Часть 2: Отправка после дедлайна)

| # | Шаг | Ожидаемый результат | Статус | Заметки |
|---|-----|-------------------|--------|---------|
| 6.9 | Авторизуйтесь как dmitry.smirnov@student.com | Dashboard студента | PENDING | - |
| 6.10 | Посмотрите новое задание "Задание с пройденным дедлайном" | Задание видно в списке | PENDING | - |
| 6.11 | Нажмите на задание | Открывается страница | PENDING | - |
| 6.12 | Проверьте индикацию дедлайна | "Deadline passed" или "Дедлайн истек" видно | PENDING | Warning/Red indicator |
| 6.13 | Попробуйте отправить решение | Либо позволяет, либо показывает warning | PENDING | Зависит от allow_late_submissions |
| 6.14 | Если позволяет, отправьте решение | Решение отправлено | PENDING | - |
| 6.15 | Проверьте статус в отправке | "Late" или "Опоздание" или "is_late=True" | PENDING | Флаг is_late в модели |
| 6.16 | Вернитесь как учитель и посмотрите отправку | Статус показывает как "Late" | PENDING | В списке отправок |

### Проверяемые поля модели AssignmentSubmission
```python
# Поля связанные с опозданием:
- is_late: True (если submitted_at > due_date)
- days_late: Decimal (количество дней просрочки)
- penalty_applied: Decimal или None
- Вычисление: если submitted_at > due_date → is_late=True

# Из Assignment для опоздания:
- due_date: 2026-01-01 23:59:00
- late_submission_deadline: может быть установлена
- late_penalty_type: "percentage" или "fixed_points"
- late_penalty_value: 10 (баллов или процентов)
- allow_late_submissions: может быть True/False
```

### Критерии успеха
- [ ] Система правильно определяет опоздание (is_late=True)
- [ ] Визуально показывает что дедлайн пройден
- [ ] Дни опоздания вычисляются правильно
- [ ] Учитель видит отметку "Late" в списке отправок
- [ ] If configured: штраф применяется автоматически

---

## ТЕСТОВЫЙ СЦЕНАРИЙ 7: Типы файлов

### Предварительные условия
- Логин: anna.ivanova@student.com
- Задание доступно для отправки

### Шаги теста

| # | Шаг | Ожидаемый результат | Статус | Заметки |
|---|-----|-------------------|--------|---------|
| 7.1 | Откройте задание и форму отправки | Форма видна | PENDING | - |
| 7.2 | Попробуйте загрузить PDF файл (test.pdf) | Файл загружается успешно | PENDING | Проверить upload_to="assignments/submissions/" |
| 7.3 | Посмотрите что файл сохранен | В файловой системе появился файл | PENDING | - |
| 7.4 | Отправьте решение с PDF | Отправка успешна | PENDING | - |
| 7.5 | В новом задании отправьте JPG файл (image.jpg) | Файл загружается успешно | PENDING | Изображение |
| 7.6 | Отправьте решение с JPG | Отправка успешна | PENDING | - |
| 7.7 | В новом задании отправьте PNG файл (image.png) | Файл загружается успешно | PENDING | - |
| 7.8 | Отправьте решение с PNG | Отправка успешна | PENDING | - |
| 7.9 | В новом задании отправьте TXT файл (text.txt) | Файл загружается успешно | PENDING | - |
| 7.10 | Отправьте решение с TXT | Отправка успешна | PENDING | - |
| 7.11 | В новом задании отправьте DOCX файл (document.docx) | Файл загружается успешно | PENDING | Microsoft Word |
| 7.12 | Отправьте решение с DOCX | Отправка успешна | PENDING | - |
| 7.13 | Попробуйте загрузить файл размером >50MB | Ошибка или предупреждение | PENDING | Проверить лимит размера |
| 7.14 | Попробуйте загрузить исполняемый файл (.exe) | Либо загружается, либо заблокирован | PENDING | Проверить валидацию |

### Проверяемые поля модели
```python
# Из AssignmentSubmission:
- file: FileField(upload_to="assignments/submissions/", blank=True, null=True)
# Стандартные ограничения Django FileField:
- Размер файла
- Расширения (зависит от валидаторов в serializers.py)
```

### Критерии успеха
- [ ] PDF загружается и отображается
- [ ] JPG загружается и отображается как изображение
- [ ] PNG загружается и отображается как изображение
- [ ] TXT загружается и содержимое видно
- [ ] DOCX загружается (может требовать конвертации для preview)
- [ ] Большие файлы отклоняются с понятным сообщением
- [ ] Опасные расширения либо блокируются, либо безопасны

---

## Анализ API endpoints

### Основные endpoints для тестирования

```
POST /api/assignments/                    # Создать задание
GET  /api/assignments/                    # Получить список заданий
GET  /api/assignments/{id}/                # Получить детали задания
PATCH /api/assignments/{id}/               # Обновить задание
DELETE /api/assignments/{id}/              # Удалить задание

POST /api/submissions/                    # Создать отправку (submission)
GET  /api/submissions/                    # Получить список отправок
GET  /api/submissions/{id}/                # Получить детали отправки
PATCH /api/submissions/{id}/               # Обновить отправку (оценка, feedback)
DELETE /api/submissions/{id}/              # Удалить отправку

# Комментарии к отправкам
POST /api/submissions/{id}/comments/       # Добавить комментарий
GET  /api/submissions/{id}/comments/       # Получить комментарии
POST /api/submissions/{id}/comments/{id}/publish/  # Опубликовать комментарий
```

### Пример JSON для создания задания

```json
{
  "title": "Домашняя работа: Уравнения",
  "description": "Решите 5 уравнений из учебника",
  "instructions": "Используйте методы подстановки или исключения",
  "type": "homework",
  "status": "published",
  "max_score": 100,
  "due_date": "2026-01-03T23:59:00Z",
  "start_date": "2026-01-01T00:00:00Z",
  "assigned_to": [3, 4],  # IDs студентов
  "attempts_limit": 1,
  "difficulty_level": 2,
  "tags": "equations,homework,algebra",
  "late_submission_deadline": "2026-01-05T23:59:00Z",
  "late_penalty_type": "percentage",
  "late_penalty_value": 10
}
```

### Пример JSON для отправки решения

```json
{
  "assignment": 1,
  "student": 3,
  "content": "Решение: 1) x=5, 2) x=10, ...",
  "file": "<binary file data>",
  "score": null,
  "feedback": ""
}
```

### Пример JSON для оценки (teacher)

```json
{
  "score": 85,
  "feedback": "Хорошо решено, не хватает объяснений",
  "status": "graded"
}
```

---

## Найденные проблемы и особенности

### Из анализа кода (models.py, views.py)

| ID | Проблема | Тип | Статус | Действие |
|---|----------|------|--------|----------|
| ASN_001 | HTTP 503 на login endpoint | CRITICAL | BLOCKING | Исправить /api/auth/login/ |
| ASN_002 | Версионирование отправок | FEATURE | IMPLEMENTED | Проверить SubmissionVersion |
| ASN_003 | Поддержка опозданий | FEATURE | IMPLEMENTED | Тестировать late_penalty_* |
| ASN_004 | Плагиат детекция | FEATURE | IMPLEMENTED | Проверить plagiarism endpoint |
| ASN_005 | Комментарии к отправкам | FEATURE | IMPLEMENTED | Тестировать comments API |

### Важные замечания

1. **Модель AssignmentSubmission**:
   - `unique_together = ["assignment", "student"]` - студент может отправить только один submission на задание
   - `submitted_at = auto_now_add` - дата установится автоматически при создании
   - `file` поле: `upload_to="assignments/submissions/"`

2. **Дедлайны и опоздание**:
   - `is_late` флаг определяется автоматически при сравнении `submitted_at` > `due_date`
   - `days_late` вычисляется как разница
   - `penalty_applied` может быть "percentage" или "fixed_points"

3. **Статусы отправки**:
   - SUBMITTED - просто отправлена, еще не оценена
   - GRADED - оценена учителем
   - RETURNED - возвращена на доработку

4. **Файлы**:
   - Загружаются в `/media/assignments/submissions/`
   - Максимальный размер по умолчанию ~2.5GB (Django FileField)
   - Может быть настроена валидация расширений в serializers.py

5. **Версионирование**:
   - Модель `SubmissionVersion` позволяет отслеживать историю версий
   - `SubmissionVersionDiff` сравнивает версии
   - Может быть переотправка нескольких файлов

---

## Чек-лист для ручного тестирования

### Перед тестированием
- [ ] Docker запущен: `docker ps`
- [ ] Backend работает: `curl http://localhost:8000/api/system/health/`
- [ ] Frontend доступен: `curl http://localhost:3000`
- [ ] База данных инициализирована: `python manage.py migrate`
- [ ] Тестовые пользователи созданы: смотри учетные записи выше

### После каждого сценария
- [ ] Скриншоты форм сохранены
- [ ] Результаты записаны в таблицу выше
- [ ] Ошибки задокументированы с полным текстом

### По завершении всех сценариев
- [ ] Все 7 сценариев протестированы
- [ ] Обновлена таблица результатов (PASS/FAIL/ISSUE)
- [ ] Загружены скриншоты проблемных мест
- [ ] Создан файл TESTING_ISSUES_DETAILED.md с описанием

---

## Результаты по сценариям

### СЦЕНАРИЙ 1: Создание задания
**Статус**: PENDING
**Тестов**: 10
**Passed**: -
**Failed**: -

### СЦЕНАРИЙ 2: Просмотр задания
**Статус**: PENDING
**Тестов**: 9
**Passed**: -
**Failed**: -

### СЦЕНАРИЙ 3: Отправка решения
**Статус**: PENDING
**Тестов**: 10
**Passed**: -
**Failed**: -

### СЦЕНАРИЙ 4: Проверка работ
**Статус**: PENDING
**Тестов**: 12
**Passed**: -
**Failed**: -

### СЦЕНАРИЙ 5: Просмотр оценки
**Статус**: PENDING
**Тестов**: 8
**Passed**: -
**Failed**: -

### СЦЕНАРИЙ 6: Дедлайн и опоздание
**Статус**: PENDING
**Тестов**: 16
**Passed**: -
**Failed**: -

### СЦЕНАРИЙ 7: Типы файлов
**Статус**: PENDING
**Тестов**: 14
**Passed**: -
**Failed**: -

---

## ИТОГОВАЯ СТАТИСТИКА

| Метрика | Значение |
|---------|----------|
| **Всего тестов** | 79 |
| **Успешно пройдено** | - |
| **Не пройдено** | - |
| **Ожидается** | 79 |
| **Успешность** | PENDING |

---

## Инструкции для запуска Docker и тестирования

### 1. Запуск Docker Compose
```bash
cd /home/mego/Python\ Projects/THE_BOT_platform
docker-compose up -d
```

### 2. Дождитесь загрузки всех сервисов
```bash
docker-compose ps
# Все сервисы должны быть в состоянии "Up"
```

### 3. Инициализируйте базу данных (если не была инициализирована)
```bash
docker-compose exec backend python manage.py migrate
docker-compose exec backend python manage.py create_test_users
```

### 4. Откройте браузер
- Frontend: http://localhost:3000
- Backend API: http://localhost:8000/api/

### 5. Начните с Сценария 1 (Создание задания)
- Логин: ivan.petrov@tutoring.com
- Пароль: password123

### 6. Заполняйте результаты таблиц по ходу тестирования

### 7. При обнаружении ошибок:
- Снимите скриншот
- Запишите URL страницы
- Скопируйте текст ошибки
- Запустите: `docker-compose logs backend | tail -50`
- Добавьте информацию в таблицу проблем

---

## Документ создан
- **QA Engineer**: Tester Agent
- **Дата**: 2026-01-01
- **Версия**: 1.0
- **Статус**: READY FOR EXECUTION

Ожидаем запуска Docker и ручного тестирования по приведенным сценариям.
