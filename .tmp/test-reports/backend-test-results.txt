============================= test session starts ==============================
platform linux -- Python 3.13.7, pytest-7.4.3, pluggy-1.6.0 -- /usr/bin/python
cachedir: .pytest_cache
django: version: 4.2.7, settings: config.settings (from ini)
rootdir: /home/mego/Python Projects/THE_BOT_platform/backend
configfile: pytest.ini
plugins: django-4.7.0, xdist-3.8.0, Faker-20.1.0, mock-3.12.0, anyio-3.7.1, cov-4.1.0, asyncio-0.21.1
asyncio: mode=Mode.STRICT
collecting ... collected 2444 items / 3 errors

==================================== ERRORS ====================================
_________ ERROR collecting tests/unit/chat/test_admin_chat_service.py __________
ImportError while importing test module '/home/mego/Python Projects/THE_BOT_platform/backend/tests/unit/chat/test_admin_chat_service.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
tests/unit/chat/test_admin_chat_service.py:20: in <module>
    from conftest import StudentUserFactory, ParentUserFactory
E   ImportError: cannot import name 'StudentUserFactory' from 'conftest' (/home/mego/Python Projects/THE_BOT_platform/conftest.py)
_________ ERROR collecting tests/unit/knowledge_graph/test_progress.py _________
ImportError while importing test module '/home/mego/Python Projects/THE_BOT_platform/backend/tests/unit/knowledge_graph/test_progress.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
tests/unit/knowledge_graph/test_progress.py:32: in <module>
    from conftest import StudentUserFactory, TeacherUserFactory
E   ImportError: cannot import name 'StudentUserFactory' from 'conftest' (/home/mego/Python Projects/THE_BOT_platform/conftest.py)
_____ ERROR collecting tests/unit/knowledge_graph/test_unlock_mechanism.py _____
ImportError while importing test module '/home/mego/Python Projects/THE_BOT_platform/backend/tests/unit/knowledge_graph/test_unlock_mechanism.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/usr/lib/python3.13/importlib/__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
tests/unit/knowledge_graph/test_unlock_mechanism.py:32: in <module>
    from conftest import StudentUserFactory, TeacherUserFactory
E   ImportError: cannot import name 'StudentUserFactory' from 'conftest' (/home/mego/Python Projects/THE_BOT_platform/conftest.py)

---------- coverage: platform linux, python 3.13.7-final-0 -----------
Name                                                                                                    Stmts   Miss  Cover   Missing
-------------------------------------------------------------------------------------------------------------------------------------
accounts/__init__.py                                                                                        1      0   100%
accounts/admin.py                                                                                          76     23    70%   46-51, 104-114, 119-127, 132, 137-140, 182, 186-188
accounts/apps.py                                                                                            6      0   100%
accounts/management/__init__.py                                                                             0      0   100%
accounts/management/commands/__init__.py                                                                    0      0   100%
accounts/management/commands/create_test_data.py                                                           89     89     0%   5-235
accounts/management/commands/create_test_user.py                                                           13     13     0%   1-32
accounts/management/commands/create_test_users_all.py                                                      76     76     0%   1-203
accounts/management/commands/ensure_teacher_profiles.py                                                    39     39     0%   4-76
accounts/management/commands/reset_all_test_data.py                                                       542    542     0%   16-1472
accounts/management/commands/reset_and_seed_users.py                                                       53     53     0%   1-168
accounts/management/commands/reset_database_and_create_users.py                                           154    154     0%   1-329
accounts/management/commands/sync_supabase.py                                                              55     55     0%   4-111
accounts/migrations/0001_initial.py                                                                        11     11     0%   3-20
accounts/migrations/0002_alter_user_password.py                                                             4      4     0%   3-12
accounts/migrations/0003_studentprofile_generated_password_and_more.py                                      6      6     0%   3-14
accounts/migrations/0004_normalize_parent_student_relationship.py                                           6      6     0%   4-15
accounts/migrations/0005_parentprofile_telegram_studentprofile_telegram_and_more.py                         4      4     0%   3-12
accounts/migrations/0006_alter_studentprofile_grade_and_more.py                                             4      4     0%   3-12
accounts/migrations/0007_add_telegram_id_to_profiles.py                                                     4      4     0%   4-13
accounts/migrations/__init__.py                                                                             0      0   100%
accounts/mock_supabase_service.py                                                                          27     27     0%   4-63
accounts/models.py                                                                                         73      6    92%   62, 151, 195, 239, 266, 273
accounts/permissions.py                                                                                    85     61    28%   62-77, 97-104, 125-131, 147-155, 169, 196, 201-223, 236-243, 255-276, 292-298, 320-326
accounts/profile_serializers.py                                                                           145     94    35%   18-26, 38-47, 73-83, 87-90, 94-97, 116-118, 122-127, 131-133, 137-140, 144-149, 168-174, 178-183, 187-189, 193-196, 200-201, 221-224, 240-242, 246-248, 252-260, 264-267, 271-286
accounts/profile_service.py                                                                               141    109    23%   28-37, 47-65, 70-89, 94-124, 129-145, 150-162, 167-179, 184-185, 190-194
accounts/profile_urls.py                                                                                    3      3     0%   6-12
accounts/profile_views.py                                                                                 375    375     0%   14-1077
accounts/retry_logic.py                                                                                    49     49     0%   7-198
accounts/serializers.py                                                                                   402    193    52%   25-46, 65, 100-105, 123-125, 167-169, 172-175, 197-203, 207-213, 255-262, 266-273, 277-322, 326-334, 348-351, 359-383, 416-430, 437, 469-473, 479-483, 504-508, 527-531, 609-616, 620-630, 634-644, 650-666, 712-718, 722-728, 752-757, 781-786, 855-870, 912-913, 917-922, 926-928, 932-942, 946-956, 988-989, 996-1001, 1008-1010, 1038-1063
accounts/signals.py                                                                                       182    146    20%   50-59, 86-95, 119-123, 148-153, 177-182, 202-238, 256-305, 319-338, 359-432, 450-468, 482-500, 514-525, 540-555
accounts/staff_views.py                                                                                   845    845     0%   1-2148
accounts/supabase_service.py                                                                              139    139     0%   4-344
accounts/supabase_sync.py                                                                                  83     83     0%   4-223
accounts/tutor_serializers.py                                                                             153    153     0%   1-251
accounts/tutor_service.py                                                                                 139    139     0%   1-342
accounts/tutor_views.py                                                                                   231    231     0%   1-492
accounts/urls.py                                                                                            9      9     0%   1-22
accounts/views.py                                                                                         264    264     0%   1-536
chat/__init__.py                                                                                            0      0   100%
chat/admin.py                                                                                              96     31    68%   57-74, 82-83, 90-91, 98-103, 141, 148-165, 173-177, 230-234, 238-242, 246-252
chat/admin_views.py                                                                                        62     62     0%   5-278
chat/apps.py                                                                                                9      2    78%   12-13
chat/consumers.py                                                                                         217    158    27%   24-69, 73-80, 93-121, 128-145, 149, 164, 177-179, 183-188, 192, 199, 206, 213, 221-225, 230-239, 244-251, 256-261, 265-266, 278-294, 297, 303-321, 328-336, 346, 361, 374, 381, 388, 396-415, 419-420, 428-437, 446-460, 463, 470, 474, 486-500, 503, 510, 514
chat/forum_views.py                                                                                        79     79     0%   11-325
chat/general_chat_service.py                                                                              144    144     0%   1-320
chat/management/__init__.py                                                                                 0      0   100%
chat/management/commands/__init__.py                                                                        0      0   100%
chat/middleware.py                                                                                         53     42    21%   35-76, 84-100
chat/migrations/0001_initial.py                                                                             7      7     0%   3-16
chat/migrations/0002_alter_chatroom_type_messagethread_message_thread.py                                    6      6     0%   3-15
chat/migrations/0003_chatroom_auto_delete_days.py                                                           4      4     0%   3-12
chat/migrations/0004_add_forum_chat_fields.py                                                               5      5     0%   21-31
chat/migrations/0005_add_unique_constraint_forum_enrollment.py                                              5      5     0%   3-14
chat/migrations/__init__.py                                                                                 0      0   100%
chat/models.py                                                                                            104     11    89%   83, 87, 167, 196, 230, 234, 238, 270, 274-278
chat/routing.py                                                                                             3      0   100%
chat/serializers.py                                                                                       165     71    57%   27-30, 34, 42-47, 50-62, 67-79, 97-98, 106-107, 119-125, 153, 160-165, 169-174, 178-183, 186-189, 192, 195-196, 208-209, 242-247, 268-276, 288-290
chat/services/__init__.py                                                                                   2      0   100%
chat/services/admin_chat_service.py                                                                        27     12    56%   34, 69-83, 99, 128-137
chat/services/pachca_service.py                                                                            79     63    20%   49-59, 71, 94-114, 132-138, 151-157, 171-173, 188-244
chat/signals.py                                                                                            56     43    23%   39-117, 143-178
chat/tasks.py                                                                                              57     48    16%   51-205, 224-262
chat/tests.py                                                                                               1      1     0%   1
chat/urls.py                                                                                               13     13     0%   1-15
chat/views.py                                                                                             294    294     0%   1-571
core/__init__.py                                                                                            2      0   100%
core/admin.py                                                                                              80     33    59%   64, 69-76, 85, 93, 98, 103-104, 109-113, 117-121, 125-129, 162, 167-173, 182-184, 189-190
core/backup_utils.py                                                                                      196    161    18%   30-31, 43-82, 86-101, 105-106, 110-111, 123-164, 176-209, 221-239, 251-277, 281-295, 299-300, 304, 308-321, 325-345, 354-360, 370-435
core/celery.py                                                                                              9      1    89%   23
core/celery_config.py                                                                                       2      0   100%
core/environment.py                                                                                       111     50    55%   51-55, 63, 82-87, 97-107, 119, 127-132, 141, 153, 168, 172, 187, 201, 223, 246, 257, 267-290, 302, 311-314, 318, 339-341, 347
core/file_utils.py                                                                                         42     42     0%   7-150
core/json_utils.py                                                                                         70     62    11%   27-58, 72-109, 122-128, 142-146
core/management/__init__.py                                                                                 0      0   100%
core/management/commands/__init__.py                                                                        0      0   100%
core/management/commands/audit_queries.py                                                                 108    108     0%   8-258
core/management/commands/cleanup_database.py                                                              317    317     0%   4-592
core/management/commands/create_backup.py                                                                  38     38     0%   4-86
core/management/commands/create_full_test_dataset.py                                                      402    402     0%   27-1171
core/management/commands/restore_backup.py                                                                 52     52     0%   4-111
core/management/commands/system_health.py                                                                 128    128     0%   4-204
core/media_views.py                                                                                       168    139    17%   32-55, 60-113, 118-161, 171-216, 235-290, 310-360
core/migrations/0001_initial.py                                                                             6      6     0%   3-14
core/migrations/0002_rename_core_failed_task_na_6c8b65_idx_core_failed_task_na_0a7b09_idx_and_more.py       4      4     0%   3-11
core/migrations/__init__.py                                                                                 0      0   100%
core/models.py                                                                                             75     25    67%   60, 64-68, 72-76, 80-83, 123, 127-139
core/monitoring.py                                                                                        184    153    17%   33-57, 65-78, 82-96, 100-112, 116-145, 149-169, 173-184, 188-202, 206-222, 226-241, 250-271, 286-357, 379-395, 405-420
core/monitoring_views.py                                                                                   60     60     0%   4-213
core/tasks.py                                                                                             162    140    14%   21-64, 75-135, 146-206, 217-258, 269-304, 328-428, 451-477, 486-540
core/transaction_utils.py                                                                                 121     83    31%   55-105, 126-138, 153-169, 186-204, 217-236, 250-255, 271-281, 294-302
core/urls.py                                                                                                5      5     0%   4-14
core/validators.py                                                                                         46     46     0%   4-151
core/views.py                                                                                             142    142     0%   4-312
materials/__init__.py                                                                                       0      0   100%
materials/admin.py                                                                                        206     70    66%   31, 39-40, 47, 102-123, 134-149, 157-162, 168-170, 205-206, 214-219, 248, 252-257, 274-279, 296-304, 323-330, 365-371, 399-404, 452-469, 481-490, 533-550, 562-579, 591-596
materials/apps.py                                                                                           6      0   100%
materials/cache_utils.py                                                                                  104     75    28%   14-15, 19-37, 41-54, 61, 65-71, 75-81, 85-91, 95-99, 106, 113-135, 148-167, 178-195
materials/migrations/0001_initial.py                                                                        8      8     0%   3-17
materials/migrations/0002_subjectenrollment_subjectpayment.py                                               6      6     0%   3-16
materials/migrations/0003_materialsubmission_materialfeedback.py                                            7      7     0%   3-16
materials/migrations/0004_auto_20251026_0956.py                                                             4      4     0%   5-14
materials/migrations/0005_subjectenrollment_assigned_by.py                                                  6      6     0%   3-15
materials/migrations/0006_alter_subjectpayment_due_date.py                                                  5      5     0%   3-13
materials/migrations/0007_add_teachersubject.py                                                             6      6     0%   3-15
materials/migrations/0008_alter_subjectenrollment_unique_together_and_more.py                               6      6     0%   3-15
materials/migrations/0009_studyplan.py                                                                      6      6     0%   3-15
materials/migrations/0010_merge_0004_0009.py                                                                4      4     0%   8-19
materials/migrations/0011_add_custom_subject_name.py                                                        4      4     0%   3-12
materials/migrations/0012_studyplanfile.py                                                                  6      6     0%   3-15
materials/migrations/0013_alter_subjectpayment_unique_together.py                                           4      4     0%   3-13
materials/migrations/0014_add_subscription_expires_at.py                                                    4      4     0%   3-12
materials/migrations/0015_add_study_plan_generation_models.py                                               6      6     0%   3-14
materials/migrations/0016_add_progress_message.py                                                           4      4     0%   3-11
materials/migrations/__init__.py                                                                            0      0   100%
materials/models.py                                                                                       345     79    77%   25, 58, 115-116, 120, 162, 177, 238, 242-263, 354, 357-360, 395, 428, 433-441, 498, 501-505, 543, 623, 627-649, 692, 695-699, 791, 798-806, 810-826, 897
materials/parent_dashboard_service.py                                                                     334    306     8%   31-79, 83-87, 91-99, 108-139, 154-189, 201-221, 233-290, 309-395, 412-558, 564-589, 595-620, 624-635, 653-785, 797-821
materials/parent_dashboard_views.py                                                                       286    286     0%   1-558
materials/serializers.py                                                                                  270    270     0%   1-544
materials/services/__init__.py                                                                              2      0   100%
materials/services/latex_compiler.py                                                                       68     51    25%   46-47, 56-57, 81-153, 166-200
materials/services/openrouter_service.py                                                                  112     83    26%   68-72, 100-218, 234-263, 278-314, 329-369
materials/services/study_plan_generator_service.py                                                        161    137    15%   56-57, 75-82, 94-100, 152-226, 243-320, 337-420, 436-503, 526-591, 612-646
materials/signals.py                                                                                      199    156    22%   26-39, 49-62, 72-85, 95-110, 117-127, 134-151, 158-175, 182-193, 199-210, 222-246, 252-272, 303-360, 382-402
materials/student_api_views.py                                                                             90     90     0%   1-205
materials/student_dashboard_serializers.py                                                                 96     96     0%   1-193
materials/student_dashboard_service.py                                                                     93     71    24%   28-32, 36-40, 54-131, 140-153, 164-231, 252-307, 318-339, 349-351
materials/student_dashboard_views.py                                                                      199    199     0%   1-474
materials/student_urls.py                                                                                   4      4     0%   1-7
materials/study_plan_views.py                                                                              93     93     0%   5-367
materials/subject_views.py                                                                                 22     22     0%   4-59
materials/tasks.py                                                                                         60     49    18%   44-164
materials/teacher_dashboard_serializers.py                                                                122    122     0%   1-190
materials/teacher_dashboard_service.py                                                                    198    169    15%   31-35, 39-43, 54-174, 187-226, 239-285, 301-401, 424-490, 502-538, 549-613, 622-661, 673-707, 717-749, 759
materials/teacher_dashboard_views.py                                                                      456    456     0%   1-967
materials/teacher_urls.py                                                                                   3      3     0%   1-5
materials/tests.py                                                                                          1      1     0%   1
materials/tutor_dashboard_service.py                                                                      133    111    17%   30-34, 38-42, 52-125, 138-169, 182-246, 273-324, 344-421, 434-475, 485-501
materials/tutor_dashboard_views.py                                                                        150    150     0%   1-358
materials/urls.py                                                                                          17     17     0%   1-19
materials/views.py                                                                                        282    282     0%   1-581
payments/__init__.py                                                                                        0      0   100%
payments/admin.py                                                                                           9      0   100%
payments/api_urls.py                                                                                        7      7     0%   1-9
payments/apps.py                                                                                            4      0   100%
payments/health_views.py                                                                                    8      8     0%   1-11
payments/management/__init__.py                                                                             0      0   100%
payments/management/commands/__init__.py                                                                    0      0   100%
payments/management/commands/test_telegram.py                                                              43     43     0%   1-60
payments/migrations/0001_initial.py                                                                         6      6     0%   3-14
payments/migrations/0002_payment_customer_fio_payment_service_name.py                                       4      4     0%   3-12
payments/migrations/0003_auto_20251021_1427.py                                                              5      5     0%   3-13
payments/migrations/0004_alter_payment_status.py                                                            4      4     0%   3-12
payments/migrations/0005_alter_payment_status.py                                                            4      4     0%   3-12
payments/migrations/__init__.py                                                                             0      0   100%
payments/models.py                                                                                         26      1    96%   38
payments/serializers.py                                                                                    11      0   100%
payments/services.py                                                                                      263    251     5%   45-242, 257-347, 360-381, 395-425, 447-579, 599-630
payments/telegram_service.py                                                                               87     75    14%   12-15, 19-32, 36-53, 57-101, 105-122, 126-143
payments/tests.py                                                                                           1      1     0%   1
payments/views.py                                                                                         544    500     8%   58-94, 98-106, 124-298, 306-334, 341-603, 613-754, 772-774, 778-929, 945-1019
scheduling/__init__.py                                                                                      0      0   100%
scheduling/admin.py                                                                                        74     26    65%   83, 88, 97-98, 103-104, 109, 114-121, 130-132, 137-139, 144, 185-186, 196-203, 212-214, 219
scheduling/admin_schedule_service.py                                                                       45     27    40%   44-69, 79-86, 106-107, 123-126, 136-137
scheduling/admin_urls.py                                                                                    3      3     0%   8-16
scheduling/admin_views.py                                                                                  54     54     0%   5-146
scheduling/apps.py                                                                                          4      0   100%
scheduling/migrations/0001_initial.py                                                                       8      8     0%   3-18
scheduling/migrations/0002_simplify_to_lesson_model.py                                                      7      7     0%   3-16
scheduling/migrations/__init__.py                                                                           0      0   100%
scheduling/models.py                                                                                       77     25    68%   95, 103-104, 109-110, 115, 120-123, 128-150, 162-165, 227
scheduling/permissions.py                                                                                  13     13     0%   7-59
scheduling/serializers.py                                                                                 138     74    46%   62-75, 91-95, 99-103, 107-109, 113-115, 120-165, 183-185, 189-191, 196-234, 280-282, 286-288
scheduling/services/__init__.py                                                                             2      0   100%
scheduling/services/lesson_service.py                                                                     138    109    21%   47-81, 120-185, 206-223, 245-265, 285-292, 320-377, 395-407, 427-457
scheduling/tests.py                                                                                         1      1     0%   1
scheduling/urls.py                                                                                          7      7     0%   7-22
scheduling/views.py                                                                                       146    146     0%   7-400
-------------------------------------------------------------------------------------------------------------------------------------
TOTAL                                                                                                   14447  12250    15%
Coverage HTML written to dir htmlcov

=========================== short test summary info ============================
ERROR tests/unit/chat/test_admin_chat_service.py
ERROR tests/unit/knowledge_graph/test_progress.py
ERROR tests/unit/knowledge_graph/test_unlock_mechanism.py
!!!!!!!!!!!!!!!!!!! Interrupted: 3 errors during collection !!!!!!!!!!!!!!!!!!!!
============================== 3 errors in 9.43s ===============================
