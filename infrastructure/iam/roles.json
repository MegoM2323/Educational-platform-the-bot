{
  "roles": [
    {
      "id": "developer",
      "name": "Developer",
      "description": "Role for developers with limited infrastructure access for development and staging environments",
      "access_level": "read_write_limited",
      "permission_boundary": "pb-developer",
      "mfa_required": false,
      "session_duration_seconds": 3600,
      "permissions": {
        "ecs": [
          "ecs:DescribeServices",
          "ecs:DescribeTaskDefinition",
          "ecs:DescribeTasks",
          "ecs:ListServices",
          "ecs:ListTasks",
          "ecs:UpdateService",
          "ecs:RunTask"
        ],
        "s3": [
          "s3:GetObject",
          "s3:PutObject",
          "s3:DeleteObject",
          "s3:ListBucket"
        ],
        "rds": [
          "rds-db:connect"
        ],
        "secrets": [
          "secretsmanager:GetSecretValue",
          "secretsmanager:DescribeSecret"
        ],
        "kms": [
          "kms:Decrypt",
          "kms:DescribeKey",
          "kms:GenerateDataKey"
        ],
        "logs": [
          "logs:CreateLogStream",
          "logs:PutLogEvents",
          "logs:GetLogEvents",
          "logs:FilterLogEvents"
        ],
        "cloudwatch": [
          "cloudwatch:PutMetricData",
          "cloudwatch:GetMetricStatistics",
          "cloudwatch:ListMetrics"
        ],
        "ecr": [
          "ecr:GetDownloadUrlForLayer",
          "ecr:BatchGetImage",
          "ecr:DescribeImages",
          "ecr:GetAuthorizationToken"
        ],
        "dynamodb": [
          "dynamodb:GetItem",
          "dynamodb:Query",
          "dynamodb:Scan",
          "dynamodb:PutItem",
          "dynamodb:UpdateItem",
          "dynamodb:DeleteItem"
        ]
      },
      "restrictions": {
        "environments": ["dev", "staging"],
        "denied_actions": [
          "iam:*",
          "organizations:*",
          "account:*",
          "kms:ScheduleKeyDeletion",
          "kms:DisableKey",
          "s3:DeleteBucketPolicy",
          "rds:ModifyDBInstance",
          "ec2:ModifyInstanceAttribute",
          "cloudtrail:StopLogging"
        ],
        "denied_resources": [
          "arn:aws:secretsmanager:*:*:secret:prod/*"
        ]
      },
      "audit_logging": true,
      "ip_restrictions": false,
      "review_frequency_days": 90
    },
    {
      "id": "devops",
      "name": "DevOps Engineer",
      "description": "Role for DevOps engineers with infrastructure management access across all environments",
      "access_level": "read_write_infrastructure",
      "permission_boundary": "pb-devops",
      "mfa_required": false,
      "session_duration_seconds": 3600,
      "ip_restrictions": true,
      "allowed_ips": ["0.0.0.0/0"],
      "permissions": {
        "terraform": [
          "s3:GetObject",
          "s3:PutObject",
          "s3:DeleteObject",
          "s3:ListBucket",
          "dynamodb:PutItem",
          "dynamodb:GetItem",
          "dynamodb:DeleteItem",
          "dynamodb:Query"
        ],
        "ec2": [
          "ec2:*"
        ],
        "ecs": [
          "ecs:*"
        ],
        "rds": [
          "rds:*"
        ],
        "s3": [
          "s3:*"
        ],
        "cloudformation": [
          "cloudformation:*"
        ],
        "elb": [
          "elasticloadbalancing:*"
        ],
        "autoscaling": [
          "autoscaling:*"
        ],
        "cloudwatch": [
          "cloudwatch:*",
          "logs:*"
        ],
        "kms": [
          "kms:*"
        ],
        "secrets": [
          "secretsmanager:*"
        ],
        "sns": [
          "sns:*"
        ],
        "sqs": [
          "sqs:*"
        ],
        "ssm": [
          "ssm:*"
        ],
        "ecr": [
          "ecr:*"
        ],
        "route53": [
          "route53:*"
        ],
        "acm": [
          "acm:*"
        ],
        "iam": [
          "iam:Get*",
          "iam:List*",
          "iam:Simulate*",
          "iam:PassRole"
        ]
      },
      "restrictions": {
        "denied_actions": [
          "organizations:*",
          "account:*",
          "iam:DeleteRole",
          "iam:DeleteRolePolicy",
          "iam:DeleteUser",
          "iam:DeleteGroup",
          "iam:PutUserPolicy",
          "iam:CreateAccessKey",
          "kms:ScheduleKeyDeletion",
          "kms:DisableKey"
        ]
      },
      "audit_logging": true,
      "review_frequency_days": 90
    },
    {
      "id": "admin",
      "name": "Administrator",
      "description": "Full administrator access (requires MFA, restricted IP access)",
      "access_level": "full_access",
      "permission_boundary": "pb-admin",
      "mfa_required": true,
      "session_duration_seconds": 900,
      "ip_restrictions": true,
      "allowed_ips": ["0.0.0.0/0"],
      "permissions": {
        "all": ["*"]
      },
      "restrictions": {
        "denied_actions": []
      },
      "audit_logging": true,
      "review_frequency_days": 30
    },
    {
      "id": "readonly",
      "name": "Read-Only Auditor",
      "description": "Read-only access for auditing and compliance monitoring",
      "access_level": "read_only",
      "permission_boundary": "pb-readonly",
      "mfa_required": false,
      "session_duration_seconds": 3600,
      "permissions": {
        "ec2": [
          "ec2:Describe*"
        ],
        "ecs": [
          "ecs:Describe*"
        ],
        "rds": [
          "rds:Describe*"
        ],
        "s3": [
          "s3:GetObject",
          "s3:ListBucket"
        ],
        "logs": [
          "logs:Describe*",
          "logs:Get*"
        ],
        "cloudwatch": [
          "cloudwatch:Get*",
          "cloudwatch:List*"
        ],
        "cloudtrail": [
          "cloudtrail:GetTrailStatus",
          "cloudtrail:LookupEvents"
        ],
        "kms": [
          "kms:Describe*",
          "kms:Get*",
          "kms:List*"
        ],
        "iam": [
          "iam:Get*",
          "iam:List*"
        ],
        "secrets": [
          "secretsmanager:GetSecretValue"
        ],
        "ssm": [
          "ssm:GetParameter",
          "ssm:GetParameters",
          "ssm:DescribeParameters"
        ],
        "route53": [
          "route53:List*",
          "route53:Get*"
        ],
        "acm": [
          "acm:Describe*",
          "acm:List*"
        ]
      },
      "restrictions": {
        "denied_actions": [
          "*:Create*",
          "*:Delete*",
          "*:Modify*",
          "*:Put*",
          "*:Update*",
          "iam:*"
        ]
      },
      "audit_logging": true,
      "review_frequency_days": 90
    },
    {
      "id": "cicd",
      "name": "CI/CD Service Account",
      "description": "Service account for CI/CD pipelines (GitHub Actions, GitLab CI) with minimal permissions",
      "access_level": "read_write_limited",
      "permission_boundary": "pb-devops",
      "mfa_required": false,
      "session_duration_seconds": 1800,
      "oidc_enabled": true,
      "permissions": {
        "ecr": [
          "ecr:GetDownloadUrlForLayer",
          "ecr:BatchGetImage",
          "ecr:BatchCheckLayerAvailability",
          "ecr:PutImage",
          "ecr:InitiateLayerUpload",
          "ecr:UploadLayerPart",
          "ecr:CompleteLayerUpload",
          "ecr:DescribeRepositories",
          "ecr:DescribeImages",
          "ecr:ListImages",
          "ecr:GetAuthorizationToken"
        ],
        "ecs": [
          "ecs:UpdateService",
          "ecs:DescribeServices",
          "ecs:DescribeTaskDefinition",
          "ecs:DescribeTasks",
          "ecs:ListTasks",
          "ecs:RegisterTaskDefinition"
        ],
        "secrets": [
          "secretsmanager:GetSecretValue",
          "secretsmanager:DescribeSecret"
        ],
        "kms": [
          "kms:Decrypt",
          "kms:DescribeKey"
        ],
        "iam": [
          "iam:PassRole"
        ],
        "logs": [
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents",
          "logs:GetLogEvents",
          "logs:FilterLogEvents"
        ]
      },
      "restrictions": {
        "denied_actions": [
          "iam:*",
          "organizations:*",
          "account:*",
          "kms:ScheduleKeyDeletion",
          "ec2:*",
          "rds:*",
          "s3:DeleteBucketPolicy"
        ],
        "resource_restrictions": {
          "ecr": "arn:aws:ecr:*:*:repository/thebot/*",
          "ecs": "arn:aws:ecs:*:*:service/thebot/*",
          "secrets": "arn:aws:secretsmanager:*:*:secret:thebot/*",
          "logs": "arn:aws:logs:*:*:log-group:/ecs/thebot*:*"
        }
      },
      "audit_logging": true,
      "review_frequency_days": 30
    }
  ],
  "service_accounts": [
    {
      "id": "ecs_task_execution",
      "name": "ECS Task Execution Role",
      "description": "Service account for ECS task execution (pulling images, writing logs)",
      "principal": "ecs-tasks.amazonaws.com",
      "permissions": {
        "ecr": [
          "ecr:GetAuthorizationToken",
          "ecr:BatchGetImage",
          "ecr:GetDownloadUrlForLayer",
          "ecr:BatchCheckLayerAvailability"
        ],
        "logs": [
          "logs:CreateLogStream",
          "logs:PutLogEvents"
        ],
        "secrets": [
          "secretsmanager:GetSecretValue",
          "secretsmanager:DescribeSecret"
        ],
        "kms": [
          "kms:Decrypt"
        ]
      },
      "audit_logging": true
    },
    {
      "id": "ecs_task_app",
      "name": "ECS Task Application Role",
      "description": "Service account for ECS task applications (accessing AWS resources)",
      "principal": "ecs-tasks.amazonaws.com",
      "permissions": {
        "s3": [
          "s3:GetObject",
          "s3:PutObject",
          "s3:DeleteObject"
        ],
        "rds": [
          "rds-db:connect"
        ],
        "dynamodb": [
          "dynamodb:GetItem",
          "dynamodb:Query",
          "dynamodb:Scan",
          "dynamodb:PutItem",
          "dynamodb:UpdateItem",
          "dynamodb:DeleteItem"
        ],
        "sns": [
          "sns:Publish"
        ],
        "sqs": [
          "sqs:SendMessage",
          "sqs:ReceiveMessage",
          "sqs:DeleteMessage",
          "sqs:GetQueueAttributes"
        ],
        "cloudwatch": [
          "cloudwatch:PutMetricData"
        ],
        "secrets": [
          "secretsmanager:GetSecretValue"
        ]
      },
      "audit_logging": true
    }
  ],
  "access_control_policies": {
    "mfa_requirement": {
      "roles": ["admin"],
      "description": "MFA is required for admin role assumption",
      "enforcement": "mandatory"
    },
    "ip_restrictions": {
      "admin": ["0.0.0.0/0"],
      "devops": ["0.0.0.0/0"],
      "description": "IP restrictions for privileged roles"
    },
    "session_duration": {
      "developer": 3600,
      "devops": 3600,
      "admin": 900,
      "readonly": 3600,
      "cicd": 1800,
      "description": "Maximum session duration in seconds"
    },
    "privilege_escalation_prevention": {
      "description": "Deny dangerous IAM and account management actions",
      "denied_for_all": [
        "organizations:*",
        "account:*",
        "iam:DeleteRole",
        "iam:DeleteRolePolicy",
        "iam:DeleteUser",
        "iam:DeleteGroup",
        "kms:ScheduleKeyDeletion",
        "kms:DisableKey"
      ]
    }
  },
  "access_review_procedures": {
    "frequency": {
      "developer": 90,
      "devops": 90,
      "admin": 30,
      "readonly": 90,
      "cicd": 30,
      "description": "Days between access reviews"
    },
    "quarterly_review": {
      "schedule": "First Monday of Q1, Q2, Q3, Q4",
      "scope": ["developer", "devops", "readonly"],
      "checklist": [
        "Verify role still needed for current position",
        "Review recent API calls and actions",
        "Confirm no unused permissions",
        "Check for policy violations",
        "Update documentation if needed"
      ]
    },
    "monthly_review": {
      "schedule": "First Monday of each month",
      "scope": ["admin", "cicd"],
      "checklist": [
        "Verify MFA is enabled (admin)",
        "Review admin actions and CloudTrail logs",
        "Check for failed authentication attempts",
        "Verify no credential leaks",
        "Confirm compliance with security policy"
      ]
    },
    "audit_requirements": {
      "cloudtrail_logging": true,
      "retention_days": 2555,
      "description": "CloudTrail logs retained for 7 years"
    }
  },
  "privilege_escalation_prevention": {
    "permission_boundaries": {
      "developer": "Prevents IAM changes, account changes, KMS key deletion",
      "devops": "Prevents account-level changes, KMS key deletion",
      "admin": "Enforces MFA for sensitive actions",
      "readonly": "Prevents all modification actions"
    },
    "denied_actions_matrix": {
      "create_user": ["developer", "devops", "readonly", "cicd"],
      "delete_user": ["developer", "devops", "readonly", "cicd"],
      "create_role": ["developer", "readonly", "cicd"],
      "delete_role": ["developer", "devops", "readonly", "cicd"],
      "attach_policy": ["developer", "readonly", "cicd"],
      "delete_bucket_policy": ["developer", "devops", "cicd"],
      "modify_security_group": ["developer", "readonly", "cicd"],
      "create_access_key": ["developer", "devops", "readonly", "cicd"],
      "enable_key_rotation": ["developer", "devops", "readonly", "cicd"],
      "schedule_key_deletion": ["developer", "devops", "readonly", "cicd"]
    }
  }
}
