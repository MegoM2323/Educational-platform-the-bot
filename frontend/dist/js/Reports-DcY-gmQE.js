const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/main-fde3JC90.js","js/react-core-JVqWokWt.js","js/react-dom-DyRXjBRd.js","js/vendor-DC2AZkDs.js","js/d3-lib-BmB4v4DK.js","js/radix-ui-Ch8xfAyl.js","js/react-query-DqnBFrGE.js","js/react-router-WAeXREDX.js","js/charts-CKrVAx-o.js","css/main-BeSJoGJH.css"])))=>i.map(i=>d[i]);
import{u as e,l as s,S as t,a,e as r,B as n,a3 as l,a4 as i,a5 as d,a6 as c,C as o,Z as h,g as m,h as u,i as x,j,k as p,c as v,D as g,w as _,x as y,y as w,z as b,_ as f,$ as N,aa as k,ab as S,ac as C,ad as R,ae as D,af as E,ag as T,ah as I,ai as A}from"./main-fde3JC90.js";import{r as L,j as O}from"./react-core-JVqWokWt.js";import{T as V}from"./TutorSidebar-DEiDMEeu.js";import{a as z,t as U}from"./reports-v_q60BAg.js";import{f as Z}from"./dateUtils-BxvfON71.js";import{aq as P,ao as $,ab as F,au as q,aZ as H,ad as B,an as M,am as G}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./react-router-WAeXREDX.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";function J(){const[J,K]=L.useState(!1),[Q,W]=L.useState(!1),[X,Y]=L.useState(null),[ee,se]=L.useState(null),[te,ae]=L.useState(!1),[re,ne]=L.useState([]),[le,ie]=L.useState([]),[de,ce]=L.useState([]),[oe,he]=L.useState(null),[me,ue]=L.useState(null),[xe,je]=L.useState(null),[pe,ve]=L.useState("my-reports"),{toast:ge}=e(),[_e,ye]=L.useState({student:0,week_start:"",week_end:"",title:"Еженедельный отчет",summary:"",academic_progress:"",behavior_notes:"",achievements:"",concerns:"",recommendations:"",attendance_days:0,total_days:7,progress_percentage:0,attachment:void 0}),we=L.useCallback(async()=>{try{ae(!0),s.debug("[Tutor Reports] Loading data...");const[e,t]=await Promise.all([z.getReports(),z.getAvailableStudents()]);s.debug("[Tutor Reports] Reports loaded:",e),s.debug("[Tutor Reports] Students loaded:",t);const a=Array.isArray(e)?e:[],r=Array.isArray(t)?t:[];s.debug("[Tutor Reports] Setting reports:",a.length),s.debug("[Tutor Reports] Setting students:",r.length),ne(a),ce(r)}catch(e){s.error("[Tutor Reports] Error loading reports data:",e),s.error("[Tutor Reports] Error details:",{message:null==e?void 0:e.message,response:null==e?void 0:e.response,stack:null==e?void 0:e.stack}),ge({title:"Ошибка",description:e.message||"Не удалось загрузить данные",variant:"destructive"}),ne([]),ce([])}finally{ae(!1)}},[ge]),be=L.useCallback(async(e=null)=>{try{ae(!0),s.debug("[Tutor Reports] Loading teacher reports, studentId:",e);const t=await U.getReports();s.debug("[Tutor Reports] Teacher reports loaded:",t);let a=Array.isArray(t)?t:[];if(s.debug("[Tutor Reports] Teacher reports array length:",a.length),e){const t=a.length;a=a.filter(s=>s.student===e),s.debug("[Tutor Reports] Filtered reports:",t,"->",a.length)}s.debug("[Tutor Reports] Setting teacher reports:",a.length),ie(a)}catch(t){s.error("[Tutor Reports] Error loading teacher reports:",t),s.error("[Tutor Reports] Error details:",{message:null==t?void 0:t.message,response:null==t?void 0:t.response,stack:null==t?void 0:t.stack}),ge({title:"Ошибка",description:t.message||"Не удалось загрузить отчеты преподавателей",variant:"destructive"}),ie([])}finally{ae(!1)}},[ge]);L.useEffect(()=>{(async()=>{const{cacheService:e}=await A(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));e.delete("/reports/tutor-weekly-reports/"),e.delete("/reports/tutor-weekly-reports/available_students/"),e.delete("/reports/teacher-weekly-reports/")})().then(()=>{we()})},[we]),L.useEffect(()=>{"teacher-reports"===pe&&be(oe)},[oe,pe,be]);const fe=async e=>{var t,a;try{ae(!0),s.debug("Marking teacher report as read:",e),await U.markAsRead(e),s.debug("Teacher report marked as read successfully"),ie(s=>s.map(s=>s.id===e?{...s,status:"read",read_at:(new Date).toISOString()}:s)),ge({title:"Успешно",description:"Отчет отмечен как прочитанный"});const{cacheService:t}=await A(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/teacher-weekly-reports/")}catch(r){s.error("Error marking teacher report as read:",r);const e=(null==(a=null==(t=null==r?void 0:r.response)?void 0:t.data)?void 0:a.detail)||(null==r?void 0:r.message)||"Не удалось отметить отчет";ge({title:"Ошибка",description:e,variant:"destructive"})}finally{ae(!1)}},Ne=()=>{ye({student:0,week_start:"",week_end:"",title:"Еженедельный отчет",summary:"",academic_progress:"",behavior_notes:"",achievements:"",concerns:"",recommendations:"",attendance_days:0,total_days:7,progress_percentage:0,attachment:void 0})},ke=e=>{if(!e)return O.jsx(v,{variant:"outline",children:"Не указан"});return O.jsx(v,{variant:{sent:"default",read:"default",draft:"secondary",archived:"outline"}[e]||"outline",children:{sent:"Отправлен",read:"Прочитан",draft:"Черновик",archived:"Архив"}[e]||e})};return L.useEffect(()=>{if(J&&!_e.week_start)try{const e=(()=>{const e=new Date,s=e.getDay(),t=e.getDate()-s+(0===s?-6:1),a=new Date(e.setDate(t));a.setHours(0,0,0,0);const r=new Date(a);return r.setDate(a.getDate()+6),r.setHours(23,59,59,999),{start:Z(a),end:Z(r)}})();e.start&&e.end&&ye(s=>({...s,week_start:e.start,week_end:e.end}))}catch(e){s.error("Error setting week dates:",e)}},[J]),O.jsxs(t,{children:[O.jsxs("div",{className:"flex min-h-screen w-full",children:[O.jsx(V,{}),O.jsxs(a,{children:[O.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4",children:[O.jsx(r,{}),O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx(P,{className:"h-5 w-5"}),O.jsx("h1",{className:"text-lg font-semibold",children:"Отчёты"})]}),O.jsx("div",{className:"ml-auto",children:O.jsxs(n,{type:"button",className:"gradient-primary shadow-glow",onClick:()=>K(!0),disabled:0===de.length,children:[O.jsx($,{className:"w-4 h-4 mr-2"}),"Создать отчёт родителю"]})})]}),O.jsx("main",{className:"flex flex-1 flex-col gap-4 p-4",children:O.jsxs(l,{value:pe,onValueChange:e=>ve(e),children:[O.jsxs(i,{children:[O.jsx(d,{value:"my-reports",children:"Мои отчёты родителям"}),O.jsx(d,{value:"teacher-reports",children:"Отчёты от преподавателей"})]}),O.jsx(c,{value:"my-reports",className:"space-y-4",children:te&&0===re.length?O.jsx(o,{className:"p-6",children:O.jsx("div",{className:"text-center text-muted-foreground",children:"Загрузка..."})}):O.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[0===re.length&&!te&&O.jsx(o,{className:"p-6 col-span-2",children:O.jsxs("div",{className:"text-center text-muted-foreground",children:[O.jsx(P,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),O.jsx("p",{children:"Отчётов пока нет"}),O.jsx("p",{className:"text-xs mt-2",children:'Создайте новый отчёт, нажав кнопку "Создать отчёт родителю"'})]})}),re.filter(e=>e&&e.id).map(e=>O.jsxs(o,{className:"p-6 hover:border-primary transition-colors",children:[O.jsxs("div",{className:"flex items-start justify-between mb-2",children:[O.jsxs("div",{className:"flex-1",children:[O.jsx("h3",{className:"font-bold mb-1",children:e.title||"Без названия"}),O.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Ученик: ",e.student_name||"Не указан"]}),O.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Родитель: ",e.parent_name||"Не назначен"]}),O.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-2",children:[O.jsx(F,{className:"w-3 h-3"}),e.week_start&&e.week_end?O.jsxs(O.Fragment,{children:[new Date(e.week_start).toLocaleDateString("ru-RU")," - ",new Date(e.week_end).toLocaleDateString("ru-RU")]}):"Период не указан"]})]}),ke(e.status||"draft")]}),O.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[O.jsxs(n,{type:"button",variant:"outline",size:"sm",onClick:()=>e&&ue(e),disabled:!e,children:[O.jsx(q,{className:"w-4 h-4 mr-2"}),"Просмотр"]}),e&&"draft"===e.status&&O.jsxs(O.Fragment,{children:[O.jsxs(n,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{Y(e),ye({student:e.student,week_start:e.week_start,week_end:e.week_end,title:e.title,summary:e.summary,academic_progress:e.academic_progress||"",behavior_notes:e.behavior_notes||"",achievements:e.achievements||"",concerns:e.concerns||"",recommendations:e.recommendations||"",attendance_days:e.attendance_days||0,total_days:e.total_days||7,progress_percentage:e.progress_percentage||0,attachment:void 0}),W(!0)})(e),disabled:te,children:[O.jsx(H,{className:"w-4 h-4 mr-2"}),"Изменить"]}),O.jsxs(n,{type:"button",size:"sm",onClick:()=>(async e=>{var t,a;try{ae(!0),s.debug("Sending tutor report:",e),await z.sendReport(e),s.debug("Report sent successfully"),ne(s=>s.map(s=>s.id===e?{...s,status:"sent",sent_at:(new Date).toISOString()}:s)),ge({title:"Успешно",description:"Отчет отправлен родителю"});const{cacheService:t}=await A(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/tutor-weekly-reports/"),t.delete("/reports/teacher-weekly-reports/"),await we(),"teacher-reports"===pe&&await be(oe)}catch(r){s.error("Error sending tutor report:",r);const e=(null==(a=null==(t=null==r?void 0:r.response)?void 0:t.data)?void 0:a.detail)||(null==r?void 0:r.message)||"Не удалось отправить отчет";ge({title:"Ошибка",description:e,variant:"destructive"})}finally{ae(!1)}})(e.id),disabled:te,children:[O.jsx(B,{className:"w-4 h-4 mr-2"}),"Отправить"]})]}),O.jsxs(n,{type:"button",variant:"destructive",size:"sm",onClick:()=>se(e),disabled:te,children:[O.jsx(M,{className:"w-4 h-4 mr-2"}),"Удалить"]})]})]},e.id))]})}),O.jsxs(c,{value:"teacher-reports",className:"space-y-4",children:[O.jsxs(o,{className:"p-4",children:[O.jsxs("div",{className:"flex items-center justify-between mb-2",children:[O.jsx(h,{children:"Фильтр по ученику"}),oe&&O.jsx(n,{type:"button",variant:"ghost",size:"sm",onClick:()=>he(null),children:"Показать все"})]}),O.jsxs(m,{value:(null==oe?void 0:oe.toString())||"all",onValueChange:e=>{he("all"===e?null:parseInt(e))},children:[O.jsx(u,{children:O.jsx(x,{placeholder:"Все ученики"})}),O.jsxs(j,{children:[O.jsx(p,{value:"all",children:"Все ученики"}),de.map(e=>O.jsxs(p,{value:e.id.toString(),children:[e.name," (",e.grade," класс)"]},e.id))]})]})]}),te&&0===le.length?O.jsx(o,{className:"p-6",children:O.jsx("div",{className:"text-center text-muted-foreground",children:"Загрузка..."})}):O.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[0===le.length&&!te&&O.jsx(o,{className:"p-6 col-span-2",children:O.jsxs("div",{className:"text-center text-muted-foreground",children:[O.jsx(P,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),O.jsx("p",{children:oe?"Отчётов от преподавателей по выбранному ученику пока нет":"Отчётов от преподавателей пока нет"})]})}),le.filter(e=>e&&e.id).map(e=>O.jsxs(o,{className:"p-6 hover:border-primary transition-colors",children:[O.jsxs("div",{className:"flex items-start justify-between mb-2",children:[O.jsxs("div",{className:"flex-1",children:[O.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[O.jsx("h3",{className:"font-bold",children:e.title||"Без названия"}),e.subject_name&&O.jsx(v,{style:{backgroundColor:e.subject_color||"#808080",color:"white"},children:e.subject_name})]}),O.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Преподаватель: ",e.teacher_name||"Не указан"]}),O.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Ученик: ",e.student_name||"Не указан"]}),e.tutor_name&&O.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Тьютор: ",e.tutor_name]}),O.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-2",children:[O.jsx(F,{className:"w-3 h-3"}),e.week_start&&e.week_end?O.jsxs(O.Fragment,{children:[new Date(e.week_start).toLocaleDateString("ru-RU")," - ",new Date(e.week_end).toLocaleDateString("ru-RU")]}):"Период не указан"]}),void 0!==e.average_score&&null!==e.average_score&&O.jsxs("div",{className:"text-sm mb-2",children:["Средний балл: ",O.jsx("strong",{children:e.average_score})]})]}),ke(e.status||"draft")]}),O.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[O.jsxs(n,{type:"button",variant:"outline",size:"sm",className:"flex-1",onClick:()=>e&&je(e),disabled:!e,children:[O.jsx(q,{className:"w-4 h-4 mr-2"}),"Просмотр"]}),e&&"sent"===e.status&&O.jsxs(n,{type:"button",size:"sm",onClick:()=>fe(e.id),disabled:te,children:[O.jsx(G,{className:"w-4 h-4 mr-2"}),"Прочитано"]})]})]},e.id))]})]})]})})]})]}),O.jsx(g,{open:J,onOpenChange:e=>{K(e),e||Ne()},children:O.jsxs(_,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[O.jsxs(y,{children:[O.jsx(w,{children:"Создать еженедельный отчёт"}),O.jsx(b,{children:"Заполните форму для создания отчёта родителю"})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{children:[O.jsx(h,{children:"Ученик *"}),O.jsxs(m,{value:_e.student&&_e.student>0?_e.student.toString():"",onValueChange:e=>ye({..._e,student:parseInt(e)}),children:[O.jsx(u,{children:O.jsx(x,{placeholder:"Выберите ученика"})}),O.jsx(j,{children:de.map(e=>O.jsxs(p,{value:e.id.toString(),children:[e.name," (",e.grade," класс)"]},e.id))})]})]}),O.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[O.jsxs("div",{children:[O.jsx(h,{children:"Начало недели *"}),O.jsx(f,{type:"date",value:_e.week_start,onChange:e=>ye({..._e,week_start:e.target.value})})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Конец недели *"}),O.jsx(f,{type:"date",value:_e.week_end,onChange:e=>ye({..._e,week_end:e.target.value})})]})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Название"}),O.jsx(f,{value:_e.title,onChange:e=>ye({..._e,title:e.target.value}),placeholder:"Еженедельный отчёт"})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Общее резюме *"}),O.jsx(N,{value:_e.summary,onChange:e=>ye({..._e,summary:e.target.value}),placeholder:"Общее резюме недели...",rows:4})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Академический прогресс"}),O.jsx(N,{value:_e.academic_progress,onChange:e=>ye({..._e,academic_progress:e.target.value}),placeholder:"Опишите академический прогресс...",rows:3})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Заметки о поведении"}),O.jsx(N,{value:_e.behavior_notes,onChange:e=>ye({..._e,behavior_notes:e.target.value}),placeholder:"Заметки о поведении...",rows:3})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Достижения"}),O.jsx(N,{value:_e.achievements,onChange:e=>ye({..._e,achievements:e.target.value}),placeholder:"Достижения ученика...",rows:3})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Обеспокоенности"}),O.jsx(N,{value:_e.concerns,onChange:e=>ye({..._e,concerns:e.target.value}),placeholder:"Обеспокоенности...",rows:3})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Рекомендации"}),O.jsx(N,{value:_e.recommendations,onChange:e=>ye({..._e,recommendations:e.target.value}),placeholder:"Рекомендации...",rows:3})]}),O.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[O.jsxs("div",{children:[O.jsx(h,{children:"Дней посещения"}),O.jsx(f,{type:"number",min:"0",max:"7",value:_e.attendance_days,onChange:e=>ye({..._e,attendance_days:parseInt(e.target.value)||0})})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Всего дней"}),O.jsx(f,{type:"number",min:"1",value:_e.total_days,onChange:e=>ye({..._e,total_days:parseInt(e.target.value)||7})})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Процент прогресса"}),O.jsx(f,{type:"number",min:"0",max:"100",value:_e.progress_percentage,onChange:e=>ye({..._e,progress_percentage:parseInt(e.target.value)||0})})]})]}),O.jsxs("div",{className:"flex gap-2 justify-end",children:[O.jsx(n,{type:"button",variant:"outline",onClick:()=>{K(!1),Ne()},children:"Отмена"}),O.jsxs(n,{type:"button",onClick:async()=>{var e,t;if(_e.student&&0!==_e.student&&_e.week_start&&_e.week_end&&_e.summary)try{ae(!0),s.debug("Creating tutor report with data:",{student:_e.student,week_start:_e.week_start,week_end:_e.week_end,summary:_e.summary,title:_e.title});const e=await z.createReport(_e);s.debug("Report created successfully:",e),e&&e.id&&ne(s=>s.some(s=>s.id===e.id)?s.map(s=>s.id===e.id?e:s):[e,...s]),ge({title:"Успешно",description:"Отчет создан"}),K(!1),Ne();const{cacheService:t}=await A(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/tutor-weekly-reports/"),we().catch(e=>s.error("Error refreshing data:",e))}catch(a){s.error("Error creating tutor report:",a);const r=(null==(t=null==(e=null==a?void 0:a.response)?void 0:e.data)?void 0:t.detail)||(null==a?void 0:a.message)||"Не удалось создать отчет";ge({title:"Ошибка",description:r,variant:"destructive"})}finally{ae(!1)}else ge({title:"Ошибка",description:"Заполните все обязательные поля (ученик, период, резюме)",variant:"destructive"})},disabled:te,children:[O.jsx(B,{className:"w-4 h-4 mr-2"}),"Создать отчёт"]})]})]})]})}),O.jsx(g,{open:!!me,onOpenChange:e=>{e||ue(null)},children:O.jsxs(_,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[O.jsxs(y,{children:[O.jsx(w,{children:null==me?void 0:me.title}),O.jsxs(b,{children:["Отчёт по ученику ",(null==me?void 0:me.student_name)||"Не указан"," ",(null==me?void 0:me.parent_name)&&`(Родитель: ${me.parent_name})`," ",(null==me?void 0:me.week_start)&&(null==me?void 0:me.week_end)&&`за период ${new Date(me.week_start).toLocaleDateString("ru-RU")} - ${new Date(me.week_end).toLocaleDateString("ru-RU")}`]})]}),me&&O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{children:[O.jsx("strong",{children:"Общее резюме:"}),O.jsx("p",{className:"mt-1",children:me.summary||"Не указано"})]}),me.academic_progress&&O.jsxs("div",{children:[O.jsx("strong",{children:"Академический прогресс:"}),O.jsx("p",{className:"mt-1",children:me.academic_progress})]}),me.behavior_notes&&O.jsxs("div",{children:[O.jsx("strong",{children:"Заметки о поведении:"}),O.jsx("p",{className:"mt-1",children:me.behavior_notes})]}),me.achievements&&O.jsxs("div",{children:[O.jsx("strong",{children:"Достижения:"}),O.jsx("p",{className:"mt-1",children:me.achievements})]}),me.concerns&&O.jsxs("div",{children:[O.jsx("strong",{children:"Обеспокоенности:"}),O.jsx("p",{className:"mt-1",children:me.concerns})]}),me.recommendations&&O.jsxs("div",{children:[O.jsx("strong",{children:"Рекомендации:"}),O.jsx("p",{className:"mt-1",children:me.recommendations})]}),O.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t",children:[O.jsxs("div",{children:[O.jsx("strong",{children:"Посещаемость:"}),O.jsxs("p",{children:[me.attendance_days||0," / ",me.total_days||0," дней (",me.attendance_percentage||0,"%)"]})]}),O.jsxs("div",{children:[O.jsx("strong",{children:"Прогресс:"}),O.jsxs("p",{children:[me.progress_percentage||0,"%"]})]}),O.jsxs("div",{children:[O.jsx("strong",{children:"Статус:"}),O.jsx("div",{children:ke(me.status||"draft")})]})]})]})]})}),O.jsx(g,{open:!!xe,onOpenChange:e=>{e||je(null)},children:O.jsxs(_,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[O.jsxs(y,{children:[O.jsx(w,{children:null==xe?void 0:xe.title}),O.jsxs(b,{children:["Отчёт от ",(null==xe?void 0:xe.teacher_name)||"Не указан"," по предмету ",(null==xe?void 0:xe.subject_name)||"Не указан"," по ученику ",(null==xe?void 0:xe.student_name)||"Не указан"," ",(null==xe?void 0:xe.tutor_name)&&`(Тьютор: ${xe.tutor_name})`]})]}),xe&&O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{children:[O.jsx("strong",{children:"Общее резюме:"}),O.jsx("p",{className:"mt-1",children:xe.summary||"Не указано"})]}),xe.academic_progress&&O.jsxs("div",{children:[O.jsx("strong",{children:"Академический прогресс:"}),O.jsx("p",{className:"mt-1",children:xe.academic_progress})]}),xe.performance_notes&&O.jsxs("div",{children:[O.jsx("strong",{children:"Заметки об успеваемости:"}),O.jsx("p",{className:"mt-1",children:xe.performance_notes})]}),xe.achievements&&O.jsxs("div",{children:[O.jsx("strong",{children:"Достижения:"}),O.jsx("p",{className:"mt-1",children:xe.achievements})]}),xe.concerns&&O.jsxs("div",{children:[O.jsx("strong",{children:"Обеспокоенности:"}),O.jsx("p",{className:"mt-1",children:xe.concerns})]}),xe.recommendations&&O.jsxs("div",{children:[O.jsx("strong",{children:"Рекомендации:"}),O.jsx("p",{className:"mt-1",children:xe.recommendations})]}),O.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[O.jsxs("div",{children:[O.jsx("strong",{children:"Выполнено заданий:"}),O.jsxs("p",{children:[xe.assignments_completed||0," / ",xe.assignments_total||0," (",xe.completion_percentage||0,"%)"]})]}),void 0!==xe.average_score&&null!==xe.average_score&&O.jsxs("div",{children:[O.jsx("strong",{children:"Средний балл:"}),O.jsx("p",{children:xe.average_score})]}),void 0!==xe.attendance_percentage&&xe.attendance_percentage>0&&O.jsxs("div",{children:[O.jsx("strong",{children:"Посещаемость:"}),O.jsxs("p",{children:[xe.attendance_percentage,"%"]})]}),O.jsxs("div",{children:[O.jsx("strong",{children:"Статус:"}),O.jsx("div",{children:ke(xe.status||"draft")})]})]}),xe&&"sent"===xe.status&&O.jsx("div",{className:"flex justify-end pt-4 border-t",children:O.jsxs(n,{type:"button",onClick:()=>{fe(xe.id),je(null)},disabled:te,children:[O.jsx(G,{className:"w-4 h-4 mr-2"}),"Отметить как прочитанный"]})})]})]})}),O.jsx(g,{open:Q,onOpenChange:e=>{W(e),e||(Y(null),Ne())},children:O.jsxs(_,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[O.jsxs(y,{children:[O.jsx(w,{children:"Редактировать отчёт"}),O.jsx(b,{children:"Внесите изменения в отчёт"})]}),O.jsxs("div",{className:"space-y-4",children:[O.jsxs("div",{children:[O.jsx(h,{children:"Ученик *"}),O.jsxs(m,{value:_e.student&&_e.student>0?_e.student.toString():"",onValueChange:e=>ye({..._e,student:parseInt(e)}),children:[O.jsx(u,{children:O.jsx(x,{placeholder:"Выберите ученика"})}),O.jsx(j,{children:de.map(e=>O.jsxs(p,{value:e.id.toString(),children:[e.name," (",e.grade," класс)"]},e.id))})]})]}),O.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[O.jsxs("div",{children:[O.jsx(h,{children:"Начало недели *"}),O.jsx(f,{type:"date",value:_e.week_start,onChange:e=>ye({..._e,week_start:e.target.value})})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Конец недели *"}),O.jsx(f,{type:"date",value:_e.week_end,onChange:e=>ye({..._e,week_end:e.target.value})})]})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Название"}),O.jsx(f,{value:_e.title,onChange:e=>ye({..._e,title:e.target.value}),placeholder:"Еженедельный отчёт"})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Общее резюме *"}),O.jsx(N,{value:_e.summary,onChange:e=>ye({..._e,summary:e.target.value}),placeholder:"Общее резюме недели...",rows:4})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Академический прогресс"}),O.jsx(N,{value:_e.academic_progress,onChange:e=>ye({..._e,academic_progress:e.target.value}),placeholder:"Опишите академический прогресс...",rows:3})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Заметки о поведении"}),O.jsx(N,{value:_e.behavior_notes,onChange:e=>ye({..._e,behavior_notes:e.target.value}),placeholder:"Заметки о поведении...",rows:3})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Достижения"}),O.jsx(N,{value:_e.achievements,onChange:e=>ye({..._e,achievements:e.target.value}),placeholder:"Достижения ученика...",rows:3})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Обеспокоенности"}),O.jsx(N,{value:_e.concerns,onChange:e=>ye({..._e,concerns:e.target.value}),placeholder:"Обеспокоенности...",rows:3})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Рекомендации"}),O.jsx(N,{value:_e.recommendations,onChange:e=>ye({..._e,recommendations:e.target.value}),placeholder:"Рекомендации...",rows:3})]}),O.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[O.jsxs("div",{children:[O.jsx(h,{children:"Дней посещения"}),O.jsx(f,{type:"number",min:"0",max:"7",value:_e.attendance_days,onChange:e=>ye({..._e,attendance_days:parseInt(e.target.value)||0})})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Всего дней"}),O.jsx(f,{type:"number",min:"1",value:_e.total_days,onChange:e=>ye({..._e,total_days:parseInt(e.target.value)||7})})]}),O.jsxs("div",{children:[O.jsx(h,{children:"Процент прогресса"}),O.jsx(f,{type:"number",min:"0",max:"100",value:_e.progress_percentage,onChange:e=>ye({..._e,progress_percentage:parseInt(e.target.value)||0})})]})]}),O.jsxs("div",{className:"flex gap-2 justify-end",children:[O.jsx(n,{type:"button",variant:"outline",onClick:()=>{W(!1),Y(null),Ne()},children:"Отмена"}),O.jsxs(n,{type:"button",onClick:async()=>{var e,t;if(X)if(_e.student&&0!==_e.student&&_e.week_start&&_e.week_end&&_e.summary)try{ae(!0),s.debug("Updating tutor report:",X.id,_e);const e=await z.updateReport(X.id,_e);s.debug("Report updated successfully:",e),ne(s=>s.map(s=>s.id===X.id?e:s)),ge({title:"Успешно",description:"Отчет обновлен"}),W(!1),Y(null),Ne();const{cacheService:t}=await A(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/tutor-weekly-reports/")}catch(a){s.error("Error updating tutor report:",a);const r=(null==(t=null==(e=null==a?void 0:a.response)?void 0:e.data)?void 0:t.detail)||(null==a?void 0:a.message)||"Не удалось обновить отчет";ge({title:"Ошибка",description:r,variant:"destructive"})}finally{ae(!1)}else ge({title:"Ошибка",description:"Заполните все обязательные поля (ученик, период, резюме)",variant:"destructive"})},disabled:te,children:[O.jsx(B,{className:"w-4 h-4 mr-2"}),"Сохранить изменения"]})]})]})]})}),O.jsx(k,{open:!!ee,onOpenChange:e=>!e&&se(null),children:O.jsxs(S,{children:[O.jsxs(C,{children:[O.jsx(R,{children:"Удалить отчёт?"}),O.jsxs(D,{children:['Вы уверены, что хотите удалить отчёт "',null==ee?void 0:ee.title,'"? Это действие нельзя отменить.']})]}),O.jsxs(E,{children:[O.jsx(T,{disabled:te,children:"Отмена"}),O.jsx(I,{onClick:()=>ee&&(async e=>{var t,a;try{ae(!0),s.debug("Deleting tutor report:",e),await z.deleteReport(e),s.debug("Report deleted successfully"),ne(s=>s.filter(s=>s.id!==e)),ge({title:"Успешно",description:"Отчет удален"}),se(null);const{cacheService:t}=await A(async()=>{const{cacheService:e}=await import("./main-fde3JC90.js").then(e=>e.aZ);return{cacheService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));t.delete("/reports/tutor-weekly-reports/")}catch(r){s.error("Error deleting tutor report:",r);const e=(null==(a=null==(t=null==r?void 0:r.response)?void 0:t.data)?void 0:a.detail)||(null==r?void 0:r.message)||"Не удалось удалить отчет";ge({title:"Ошибка",description:e,variant:"destructive"})}finally{ae(!1)}})(ee.id),disabled:te,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Удалить"})]})]})})]})}export{J as default};
