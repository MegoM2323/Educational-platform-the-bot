# ============================================
# THE BOT PLATFORM - ENVIRONMENT CONFIGURATION
# ============================================
# Copy this file to .env and configure for your environment
# For production, see .env.production

# ============================================
# CRITICAL: Environment Mode
# ============================================
# ENVIRONMENT determines which database to use:
#   development -> Local SQLite DB (backend/db.sqlite3)
#   production  -> Supabase PostgreSQL (production only!)
#   test        -> SQLite in-memory (automatically set for pytest)
#
ENVIRONMENT=development

# ============================================
# MAIN MODE SWITCH
# ============================================
# DEBUG=True  -> Development (localhost, small payment amounts, detailed errors)
# DEBUG=False -> Production (the-bot.ru, real amounts, secure settings)
DEBUG=True

# ============================================
# DJANGO SETTINGS
# ============================================
SECRET_KEY=your-secret-key-here-change-in-production

# ============================================
# FRONTEND URLS
# ============================================
FRONTEND_URL=http://localhost:8080
VITE_DJANGO_API_URL=http://localhost:8000/api
VITE_WEBSOCKET_URL=ws://localhost:8000/ws

# ============================================
# DATABASE CONFIGURATION
# ============================================
# IMPORTANT: In Development mode (ENVIRONMENT=development),
#            local SQLite DB (backend/db.sqlite3) is used.
#
#            DATABASE_URL below is ONLY for Production mode!
#            In Development it is IGNORED (protection from production DB)
#
# For local development NO configuration needed!
# ============================================

# Production DB (Supabase PostgreSQL) - COMMENT OUT for Development
# Uncomment ONLY on production server with ENVIRONMENT=production
#
# DATABASE_URL=postgresql://user:password@host:6543/postgres?pgbouncer=true
# DIRECT_URL=postgresql://user:password@host:5432/postgres
DB_CONNECT_TIMEOUT=10

# Optional Supabase settings (if needed for client)
# SUPABASE_URL=https://your-project.supabase.co
# SUPABASE_KEY=your-anon-key
# SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# ============================================
# PAYMENT SETTINGS (YOOKASSA)
# ============================================
# PAYMENT_DEVELOPMENT_MODE automatically = DEBUG
# In dev: 1₽ every 10 minutes | In prod: 5000₽ weekly
# Can override for testing real amounts:
# PAYMENT_DEVELOPMENT_MODE=False

YOOKASSA_SHOP_ID=your-shop-id
YOOKASSA_SECRET_KEY=your-secret-key
YOOKASSA_WEBHOOK_URL=https://your-domain.com/yookassa-webhook/

# ============================================
# TELEGRAM BOT
# ============================================
TELEGRAM_BOT_TOKEN=your-bot-token
TELEGRAM_LOG_CHAT_ID=your-log-chat-id
TELEGRAM_PUBLIC_CHAT_ID=your-public-chat-id

# ============================================
# REDIS (CACHE & CELERY)
# ============================================
# Redis automatically enabled in production (DEBUG=False)
# In development (DEBUG=True) uses InMemory cache
# Can override explicitly:
# USE_REDIS_CACHE=True
# USE_REDIS_CHANNELS=True

REDIS_URL=redis://127.0.0.1:6379

# ============================================
# PACHCA INTEGRATION (for booking notifications)
# ============================================
# Integration with Pachca messenger for lesson booking notifications
# Get token from: Pachca Admin Panel -> Automations -> API
#
# PACHCA_API_TOKEN - API access token from Pachca
# PACHCA_CHANNEL_ID - Default channel ID for notifications
# PACHCA_BASE_URL - API base URL (optional, defaults to https://api.pachca.com/api/shared/v1)
# PACHCA_WEBHOOK_URL - Public URL for webhook registration (use your domain)
# PACHCA_WEBHOOK_IPS - Comma-separated IP whitelist for webhook security (optional)

# Uncomment and configure for Pachca integration:
# PACHCA_API_TOKEN=your_pachca_api_token_here
# PACHCA_CHANNEL_ID=123456
# PACHCA_BASE_URL=https://api.pachca.com/api/shared/v1
# PACHCA_WEBHOOK_URL=https://your-domain.com/api/webhooks/pachca/
# PACHCA_WEBHOOK_IPS=1.2.3.4,5.6.7.8

# ============================================
# PACHCA INTEGRATION - FORUM NOTIFICATIONS
# ============================================
# Separate Pachca channel for forum message notifications
# Sends notifications when students/teachers exchange messages in forum chats
# This is SEPARATE from booking Pachca (different channel/token if needed)
#
# PACHCA_FORUM_API_TOKEN - API token for forum notifications (can be same as booking)
# PACHCA_FORUM_CHANNEL_ID - Channel ID for forum messages (different from booking channel)
# PACHCA_FORUM_BASE_URL - API base URL (optional, defaults to https://api.pachca.com/api/shared/v1)
#
# Uncomment and configure for forum Pachca integration:
# PACHCA_FORUM_API_TOKEN=your_forum_pachca_api_token_here
# PACHCA_FORUM_CHANNEL_ID=789012
# PACHCA_FORUM_BASE_URL=https://api.pachca.com/api/shared/v1

# ============================================
# DJANGO ADMIN
# ============================================
# Access: http://localhost:8000/admin
# Login created automatically when running ./start.sh:
#   Email: admin@example.com
#   Password: admin123

# ============================================
# OPENROUTER API (Study Plan Generator)
# ============================================
# Get API key from https://openrouter.ai/keys
OPENROUTER_API_KEY=your-api-key-here

# ============================================
# INVOICE SYSTEM
# ============================================
# Enable invoice functionality in the platform
INVOICE_ENABLED=true

# Maximum invoice amount (in rubles) to prevent accidental large amounts
INVOICE_MAX_AMOUNT=1000000.00

# Webhook timeout for invoice payment notifications (seconds)
INVOICE_WEBHOOK_TIMEOUT=30

# Celery task configuration for overdue invoice checks
# Schedule: Check for overdue invoices daily at 10:00 AM
# Executed automatically if CELERY_BEAT_SCHEDULE configured
