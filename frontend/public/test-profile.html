<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –ü—Ä–æ—Ñ–∏–ª—è –¢—å—é—Ç–æ—Ä–∞</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .log { margin: 5px 0; padding: 5px; background: #000; border-left: 3px solid #0f0; }
        .error { border-color: #f00; color: #f00; }
        .success { border-color: #0f0; color: #0f0; }
        .warning { border-color: #ff0; color: #ff0; }
        button { padding: 10px 20px; margin: 10px 5px; background: #0f0; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–§–ò–õ–Ø –¢–¨–Æ–¢–û–†–ê</h1>
    <button onclick="testLogin()">1. –¢–µ—Å—Ç –≤—Ö–æ–¥–∞</button>
    <button onclick="testProfile()">2. –¢–µ—Å—Ç –ø—Ä–æ—Ñ–∏–ª—è API</button>
    <button onclick="testFrontend()">3. –¢–µ—Å—Ç frontend /profile</button>
    <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    <div id="logs"></div>

    <script>
    const API_URL = 'http://127.0.0.1:8000/api';
    const logs = document.getElementById('logs');
    let token = localStorage.getItem('token');

    function log(message, type = 'log') {
        const div = document.createElement('div');
        div.className = `log ${type}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        logs.appendChild(div);
        console.log(message);
    }

    function clearLogs() {
        logs.innerHTML = '';
    }

    async function testLogin() {
        log('üîê –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –∫–∞–∫ tutor@test.com...', 'log');

        try {
            const response = await fetch(`${API_URL}/auth/login/`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: 'tutor@test.com',
                    password: 'TestPass123!'
                })
            });

            const data = await response.json();

            if (data.success && data.data && data.data.token) {
                token = data.data.token;
                localStorage.setItem('token', token);
                localStorage.setItem('user', JSON.stringify(data.data.user));
                log(`‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω! Token: ${token.substring(0, 30)}...`, 'success');
                log(`‚úÖ User: ${data.data.user.email} (${data.data.user.role})`, 'success');
            } else {
                log('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + JSON.stringify(data), 'error');
            }
        } catch (error) {
            log('‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –≤—Ö–æ–¥–µ: ' + error.message, 'error');
        }
    }

    async function testProfile() {
        if (!token) {
            log('‚ö†Ô∏è –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω! –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ö–æ–¥.', 'warning');
            return;
        }

        log('üìä –ó–∞–ø—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ API...', 'log');

        try {
            const response = await fetch(`${API_URL}/auth/profile/`, {
                headers: {
                    'Authorization': `Token ${token}`
                }
            });

            const data = await response.json();
            log('–û—Ç–≤–µ—Ç API: ' + JSON.stringify(data).substring(0, 200), 'log');

            if (data.data && data.data.user && data.data.profile) {
                log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—É—á–µ–Ω!', 'success');
                log(`User: ${data.data.user.email}`, 'success');
                log(`Role: ${data.data.user.role}`, 'success');
                log(`Specialization: ${data.data.profile.specialization}`, 'success');
            } else {
                log('‚ùå –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ!', 'error');
            }
        } catch (error) {
            log('‚ùå –û—à–∏–±–∫–∞ API: ' + error.message, 'error');
        }
    }

    async function testFrontend() {
        log('üåê –û—Ç–∫—Ä—ã—Ç–∏–µ /profile –Ω–∞ frontend...', 'log');
        log('‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8080/profile –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ', 'warning');
        log('‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏', 'warning');

        // Try to open
        window.open('http://localhost:8080/profile', '_blank');
    }

    // Auto-load token on page load
    window.onload = () => {
        if (token) {
            log(`‚ÑπÔ∏è –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω –≤ localStorage: ${token.substring(0, 30)}...`, 'log');
        } else {
            log('‚ÑπÔ∏è –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ö–æ–¥.', 'log');
        }
    };
    </script>
</body>
</html>
