const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/PaymentHistory-BlYakbKD.js","js/react-core-JVqWokWt.js","js/react-router-WAeXREDX.js","js/react-dom-DyRXjBRd.js","js/vendor-DC2AZkDs.js","js/d3-lib-BmB4v4DK.js","js/pagination-C0J-iX43.js","js/radix-ui-Ch8xfAyl.js","js/react-query-DqnBFrGE.js","js/charts-CKrVAx-o.js","js/PaymentSuccess-lya934BX.js","js/InvoicesPage-DPR4hTjd.js","js/useInvoiceWebSocket-CjPcUPzy.js","js/TeacherDashboard-BQRpF3j6.js","js/TeacherSidebar-Bwv8PTW2.js","js/useTeacher-DJCQuFgv.js","js/teacher-BhCI6v5d.js","js/useTeacherLessons-FFsXHQWt.js","js/TutorDashboard-CkfTILMk.js","js/TutorSidebar-DEiDMEeu.js","js/useTutor-cHjriqfV.js","js/Materials-BJzALYrl.js","js/fileDownload-DfJJnQoy.js","js/Subjects-DzuBabfw.js","js/Assignments-B_8OJyS3.js","js/useAssignments-DmsJPlD2.js","js/migration-O34B3Isr.js","js/Materials-D7ay7HrY.js","js/CreateMaterial-Co0RYYVw.js","js/Reports-Bf9XxZmE.js","js/reports-v_q60BAg.js","js/dateUtils-BxvfON71.js","js/StudyPlans-Byi1NlvE.js","js/Submissions-CGlMBFcK.js","js/AssignSubject-Cp1yglSn.js","js/Assignments-BbfLJGzg.js","js/TeacherStudyPlanGeneratorPage-DphgSch0.js","js/Reports-DcY-gmQE.js","js/Students-QBA9p8He.js","js/radio-group-rQxajO1F.js","js/useTutorStudentSchedule-WMCU5nXN.js","js/LessonCard-BUGWm0lu.js","js/InvoicesPage-Dt4qnN7c.js","js/Children-BFhUTNud.js","js/ChildDetail-D7_rlWq0.js","js/Statistics-UhcEGwif.js","js/Reports-5dZrw0qD.js","js/Chat-BM0ORLG-.js","js/StudentSchedulePage-BSS44VZ7.js","js/TeacherSchedulePage-CVkLN_K2.js","js/TutorSchedulePage-DcnzHVOA.js","js/ParentSchedulePage-0YcKatx-.js","js/Forum-BDZdA2sq.js","js/forumAPI-CXsZ6fyy.js","js/ChatPage-BcvF6_Nh.js","js/useChat-CofLPcaT.js","js/ChatPage-DXyhRqkh.js","js/ChatPage-Dq0u1oYF.js","js/ChatPage-B2jj5Zny.js","js/LessonViewer-Cdt-Ha3a.js","js/LessonViewerPage-vtmAVHqk.js","js/knowledgeGraphAPI-D8HHnFWf.js","js/KnowledgeGraphPage-DoAfbWoo.js","js/GraphVisualization-DxSFfcHP.js","js/ContentCreatorPage-CyNiP1Dy.js","js/contentCreatorService-CIIkPfml.js","js/LessonCreatorPage-CpTBl5kS.js","js/GraphEditorPage-MewfKlxG.js","js/ProgressViewerPage-D2UF32Gt.js","js/ProfilePage-D_c_VkXW.js","js/profileAPI-mpI8UVp9.js","js/StudentProfilePage-C76N9EHw.js","js/TeacherProfilePage-BSJhvSQB.js","js/TutorProfilePage-BSRYgDCn.js","js/ParentProfilePage-CxFsU2g1.js","js/NotificationSettings-DpqmDCHd.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,s=(s,t,a)=>((s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a)(s,"symbol"!=typeof t?t+"":t,a);import{r as t,j as a,a as r}from"./react-core-JVqWokWt.js";import{c as n}from"./react-dom-DyRXjBRd.js";import{V as i,R as l,A as o,C as c,T as d,D as u,P as m,a as h,b as x,c as p,d as g,S as f,O as j,e as v,f as y,g as b,h as N,i as w,j as _,k as S,l as k,m as C,n as E,o as T,p as R,q as A,r as P,s as L,t as q,u as I,v as z,w as D,x as O,I as F,y as M,z as $,B as U,E as V,F as W,L as H,G as B,H as X,J,K,M as G,N as Y,Q,U as Z,W as ee,X as se,Y as te,Z as ae,_ as re,$ as ne,a0 as ie,a1 as le,a2 as oe,a3 as ce,a4 as de,a5 as ue,a6 as me,a7 as he}from"./radix-ui-Ch8xfAyl.js";import{V as xe,c as pe,W as ge,X as fe,Y as je,Z as ve,_ as ye,$ as be,a0 as Ne,a1 as we,a2 as _e,a3 as Se,a4 as ke,a5 as Ce,a6 as Ee,a7 as Te,a8 as Re,a9 as Ae,aa as Pe,ab as Le,ac as qe,ad as Ie,ae as ze,af as De,ag as Oe,ah as Fe,ai as Me,aj as $e,ak as Ue,al as Ve,am as We,an as He,ao as Be,ap as Xe,aq as Je,ar as Ke,as as Ge,at as Ye,au as Qe,av as Ze,aw as es,ax as ss,ay as ts,az as as,aA as rs,aB as ns,aC as is,aD as ls,aE as os,aF as cs,aG as ds,aH as us,aI as ms,aJ as hs,aK as xs,aL as ps,aM as gs,aN as fs,aO as js,aP as vs,aQ as ys,aR as bs,aS as Ns,aT as ws,aU as _s,aV as Ss,aW as ks,aX as Cs,aY as Es,aZ as Ts,a_ as Rs,a$ as As,b0 as Ps,b1 as Ls,b2 as qs,b3 as Is,b4 as zs,b5 as Ds,b6 as Os,b7 as Fs,b8 as Ms,b9 as $s,ba as Us,bb as Vs,bc as Ws,bd as Hs,be as Bs,bf as Xs,bg as Js,bh as Ks,bi as Gs,bj as Ys,bk as Qs,bl as Zs,bm as et,bn as st,bo as tt,bp as at,bq as rt,br as nt,bs as it,bt as lt}from"./vendor-DC2AZkDs.js";import{u as ot,a as ct,b as dt,Q as ut}from"./react-query-DqnBFrGE.js";import{N as mt,a as ht,u as xt,O as pt,L as gt,b as ft,c as jt,B as vt,R as yt,d as bt}from"./react-router-WAeXREDX.js";import{R as Nt,L as wt,C as _t,X as St,Y as kt,T as Ct,a as Et,b as Tt,P as Rt,c as At,d as Pt,B as Lt,e as qt}from"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const It={},zt=function(e,s,t){let a=Promise.resolve();if(s&&s.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),r=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));a=e(s.map(e=>{if((e=function(e){return"/"+e}(e))in It)return;It[e]=!0;const s=e.endsWith(".css"),t=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${t}`))return;const a=document.createElement("link");return a.rel=s?"stylesheet":"modulepreload",s||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),s?new Promise((s,t)=>{a.addEventListener("load",s),a.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=e,window.dispatchEvent(s),!s.defaultPrevented)throw e}return a.then(s=>{for(const e of s||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})};let Dt=0;const Ot=new Map,Ft=e=>{if(Ot.has(e))return;const s=setTimeout(()=>{Ot.delete(e),Vt({type:"REMOVE_TOAST",toastId:e})},1e6);Ot.set(e,s)},Mt=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?Ft(t):e.toasts.forEach(e=>{Ft(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===s.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},$t=[];let Ut={toasts:[]};function Vt(e){Ut=Mt(Ut,e),$t.forEach(e=>{e(Ut)})}function Wt({...e}){const s=(Dt=(Dt+1)%Number.MAX_SAFE_INTEGER,Dt.toString()),t=()=>Vt({type:"DISMISS_TOAST",toastId:s});return Vt({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:e=>{e||t()}}}),{id:s,dismiss:t,update:e=>Vt({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function Ht(){const[e,s]=t.useState(Ut);return t.useEffect(()=>($t.push(s),()=>{const e=$t.indexOf(s);e>-1&&$t.splice(e,1)}),[e]),{...e,toast:Wt,dismiss:e=>Vt({type:"DISMISS_TOAST",toastId:e})}}function Bt(...e){return xe(pe(e))}const Xt=m,Jt=t.forwardRef(({className:e,...s},t)=>a.jsx(i,{ref:t,className:Bt("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...s}));Jt.displayName=i.displayName;const Kt=ge("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Gt=t.forwardRef(({className:e,variant:s,...t},r)=>a.jsx(l,{ref:r,className:Bt(Kt({variant:s}),e),...t}));Gt.displayName=l.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(o,{ref:t,className:Bt("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...s})).displayName=o.displayName;const Yt=t.forwardRef(({className:e,...s},t)=>a.jsx(c,{ref:t,className:Bt("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...s,children:a.jsx(fe,{className:"h-4 w-4"})}));Yt.displayName=c.displayName;const Qt=t.forwardRef(({className:e,...s},t)=>a.jsx(d,{ref:t,className:Bt("text-sm font-semibold",e),...s}));Qt.displayName=d.displayName;const Zt=t.forwardRef(({className:e,...s},t)=>a.jsx(u,{ref:t,className:Bt("text-sm opacity-90",e),...s}));function ea(){const{toasts:e}=Ht();return a.jsxs(Xt,{children:[e.map(function({id:e,title:s,description:t,action:r,...n}){return a.jsxs(Gt,{...n,children:[a.jsxs("div",{className:"grid gap-1",children:[s&&a.jsx(Qt,{children:s}),t&&a.jsx(Zt,{children:t})]}),r,a.jsx(Yt,{})]},e)}),a.jsx(Jt,{})]})}Zt.displayName=u.displayName;const sa=({...e})=>{const{theme:s="system"}=je();return a.jsx(ve,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},ta=x,aa=p,ra=g,na=t.forwardRef(({className:e,sideOffset:s=4,...t},r)=>a.jsx(h,{ref:r,sideOffset:s,className:Bt("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));na.displayName=h.displayName;const ia={debug:0,info:1,warn:2,error:3};const la=new class{constructor(e={}){s(this,"config"),this.config={enabled:!1,level:"info",prefix:e.prefix||"[App]",...e}}shouldLog(e){return!!this.config.enabled&&ia[e]>=ia[this.config.level]}formatMessage(e,s,...t){return`${(new Date).toISOString()} ${this.config.prefix} [${e.toUpperCase()}] ${s}`}debug(e,...s){this.shouldLog("debug")&&this.formatMessage("debug",e)}info(e,...s){this.shouldLog("info")&&this.formatMessage("info",e)}warn(e,...s){this.shouldLog("warn")&&console.warn(this.formatMessage("warn",e),...s)}error(e,...s){this.shouldLog("error")&&console.error(this.formatMessage("error",e),...s)}log(e,...s){this.info(e,...s)}};async function oa(e,s){try{if(!e.ok)return{success:!1,error:`HTTP ${e.status}: ${e.statusText}`,data:s};if(204===e.status||205===e.status)return{success:!0,data:s};const t=e.headers.get("content-type");!t||t.includes("application/json")||t.includes("text/json")||logger.warn(`Unexpected content type: ${t}`);const a=await e.text();if(!a.trim())return{success:!0,data:s};return{success:!0,data:JSON.parse(a)}}catch(t){return logger.error("JSON parse error:",t),{success:!1,error:t instanceof Error?t.message:"Unknown JSON parse error",data:s}}}const ca=new class{constructor(){s(this,"logs",[]),s(this,"maxLogs",1e3),s(this,"sessionId"),s(this,"userId",null),s(this,"isOnline",!0),s(this,"pendingLogs",[]),this.sessionId=this.generateSessionId(),this.setupOnlineDetection(),this.setupErrorHandlers()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}setupOnlineDetection(){this.isOnline="undefined"==typeof navigator||navigator.onLine,"undefined"!=typeof window&&(window.addEventListener("online",()=>{this.isOnline=!0,this.flushPendingLogs()}),window.addEventListener("offline",()=>{this.isOnline=!1}))}setupErrorHandlers(){"undefined"!=typeof window&&(window.addEventListener("error",e=>{var s;this.logError({level:"error",category:"client",message:e.message,stack:null==(s=e.error)?void 0:s.stack,context:{filename:e.filename,lineno:e.lineno,colno:e.colno}})}),window.addEventListener("unhandledrejection",e=>{var s;this.logError({level:"error",category:"client",message:`Unhandled Promise Rejection: ${e.reason}`,stack:null==(s=e.reason)?void 0:s.stack,context:{reason:e.reason}})}))}setUserId(e){this.userId=e}logError(e){const s={id:`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:(new Date).toISOString(),level:e.level,category:e.category,message:e.message,stack:e.stack,context:e.context,userAgent:navigator.userAgent,url:window.location.href,userId:this.userId||void 0,sessionId:this.sessionId,retryCount:e.retryCount,resolved:!1};return this.logs.push(s),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs)),this.isOnline?this.sendLogToServer(s):this.pendingLogs.push(s),s.id}async sendLogToServer(e){try{const s=this.getStoredLogs();s.push(e);const t=s.slice(-100);localStorage.setItem("error_logs",JSON.stringify(t))}catch(s){console.error("Failed to send error log to server:",s)}}getStoredLogs(){try{const e=localStorage.getItem("error_logs");return e?JSON.parse(e):[]}catch{return[]}}async flushPendingLogs(){if(0===this.pendingLogs.length)return;const e=[...this.pendingLogs];this.pendingLogs=[];for(const s of e)await this.sendLogToServer(s)}markErrorAsResolved(e){const s=this.logs.find(s=>s.id===e);s&&(s.resolved=!0)}getErrorAnalytics(){const e=new Date((new Date).getTime()-864e5),s=this.logs.filter(s=>new Date(s.timestamp)>e),t=s.reduce((e,s)=>(e[s.category]=(e[s.category]||0)+1,e),{}),a=s.reduce((e,s)=>(e[s.level]=(e[s.level]||0)+1,e),{}),r=s.filter(e=>e.resolved).length,n=s.length>0?r/s.length:0;return{totalErrors:s.length,errorsByCategory:t,errorsByLevel:a,recentErrors:s.slice(-10),errorRate:s.length/24,resolutionRate:n}}getLogsByCategory(e){return this.logs.filter(s=>s.category===e)}getLogsByLevel(e){return this.logs.filter(s=>s.level===e)}clearLogs(){this.logs=[],this.pendingLogs=[],localStorage.removeItem("error_logs")}exportLogs(){return JSON.stringify({sessionId:this.sessionId,userId:this.userId,timestamp:(new Date).toISOString(),logs:this.logs},null,2)}logNetworkError(e,s){var t;return this.logError({level:"error",category:"network",message:`Network error: ${e.message}`,stack:e.stack,context:{...s,networkType:(null==(t=navigator.connection)?void 0:t.effectiveType)||"unknown",onlineStatus:navigator.onLine}})}logAuthError(e,s){return this.logError({level:"error",category:"auth",message:`Authentication error: ${e.message}`,stack:e.stack,context:{...s,hasToken:!!localStorage.getItem("authToken"),hasRefreshToken:!!localStorage.getItem("refreshToken")}})}logValidationError(e,s){return this.logError({level:"warning",category:"validation",message:`Validation error: ${e.message}`,stack:e.stack,context:s})}logServerError(e,s,t){return this.logError({level:"error",category:"server",message:`Server error: ${e.message}`,stack:e.stack,context:{...t,statusCode:s}})}logWebSocketError(e,s){return this.logError({level:"error",category:"websocket",message:`WebSocket error: ${e.message}`,stack:e.stack,context:{...s,readyState:"WebSocket"in window?"available":"unavailable"}})}};const da=new class{constructor(){s(this,"notificationService",null),this.initializeNotificationService()}initializeNotificationService(){try{this.notificationService=null}catch(e){la.warn("Notification service not available:",e)}}setNotificationService(e){this.notificationService=e}handleError(e,s){this.logError(e,s);const t=this.createUserFriendlyError(e,s);return this.notificationService&&this.showErrorNotification(t,null==s?void 0:s.retryAction),t}logError(e,s){var t;const a=(null==e?void 0:e.message)||"Unknown error occurred",r=null==e?void 0:e.stack;let n="client",i="error";return a.includes("Network")||a.includes("fetch")?n="network":a.includes("Auth")||a.includes("token")||a.includes("401")?n="auth":a.includes("Validation")||a.includes("400")?(n="validation",i="warning"):a.includes("Server")||a.includes("500")?n="server":a.includes("WebSocket")&&(n="websocket"),ca.logError({level:i,category:n,message:a,stack:r,context:{...s,errorType:(null==(t=null==e?void 0:e.constructor)?void 0:t.name)||"Unknown"}})}createUserFriendlyError(e,s){const t=(null==e?void 0:e.message)||"Произошла неизвестная ошибка";return t.includes("Network")||t.includes("fetch")?{title:"Проблема с подключением",message:"Не удается подключиться к серверу. Проверьте подключение к интернету.",recoveryOptions:[{label:"Повторить попытку",action:(null==s?void 0:s.retryAction)||(()=>window.location.reload()),type:"retry"},{label:"Обновить страницу",action:()=>window.location.reload(),type:"refresh"}],severity:"high",category:"network",canRetry:!0,shouldReport:!1}:t.includes("Auth")||t.includes("token")||t.includes("401")?{title:"Ошибка авторизации",message:"Ваша сессия истекла или произошла ошибка авторизации. Войдите в систему заново.",recoveryOptions:[{label:"Войти в систему",action:()=>window.location.href="/auth",type:"redirect"},{label:"Обновить страницу",action:()=>window.location.reload(),type:"refresh"}],severity:"high",category:"auth",canRetry:!1,shouldReport:!1}:t.includes("Validation")||t.includes("400")?{title:"Ошибка в данных",message:"Проверьте правильность введенных данных и попробуйте снова.",recoveryOptions:[{label:"Исправить данные",action:()=>{},type:"retry"},{label:"Закрыть",action:()=>{},type:"dismiss"}],severity:"medium",category:"validation",canRetry:!0,shouldReport:!1}:t.includes("Server")||t.includes("500")?{title:"Ошибка сервера",message:"На сервере произошла ошибка. Мы уже работаем над её исправлением.",recoveryOptions:[{label:"Повторить попытку",action:(null==s?void 0:s.retryAction)||(()=>window.location.reload()),type:"retry"},{label:"Связаться с поддержкой",action:()=>this.contactSupport(),type:"contact"}],severity:"critical",category:"server",canRetry:!0,shouldReport:!0}:t.includes("WebSocket")?{title:"Проблема с чатом",message:"Не удается подключиться к чату. Проверьте подключение к интернету.",recoveryOptions:[{label:"Переподключиться",action:(null==s?void 0:s.retryAction)||(()=>window.location.reload()),type:"retry"},{label:"Обновить страницу",action:()=>window.location.reload(),type:"refresh"}],severity:"medium",category:"websocket",canRetry:!0,shouldReport:!1}:{title:"Произошла ошибка",message:(null==s?void 0:s.customMessage)||"Что-то пошло не так. Попробуйте обновить страницу.",recoveryOptions:[{label:"Обновить страницу",action:()=>window.location.reload(),type:"refresh"},{label:"На главную",action:()=>window.location.href="/",type:"redirect"}],severity:"medium",category:"client",canRetry:!0,shouldReport:!0}}showErrorNotification(e,s){if(!this.notificationService)return;const t={title:e.title,description:e.message,duration:"critical"===e.severity?1e4:5e3,action:e.canRetry&&s?{label:"Повторить",onClick:s}:void 0};switch(e.severity){case"critical":case"high":this.notificationService.showError(e.message,t);break;case"medium":this.notificationService.showWarning(e.message,t);break;case"low":this.notificationService.showInfo(e.message,t)}}contactSupport(){const e=`Описание ошибки: ${window.location.href}\n\nПожалуйста, опишите, что вы делали, когда произошла ошибка.`;window.open(`mailto:support@thebot-platform.com?subject=${encodeURIComponent("Ошибка в приложении")}&body=${encodeURIComponent(e)}`)}handleNetworkError(e,s){return this.handleError(e,{operation:"network_request",retryAction:s})}handleAuthError(e,s){return this.handleError(e,{operation:"authentication",retryAction:s})}handleValidationError(e,s){return this.handleError(e,{operation:"validation",retryAction:s})}handleServerError(e,s){return this.handleError(e,{operation:"server_request",retryAction:s})}handleWebSocketError(e,s){return this.handleError(e,{operation:"websocket_connection",retryAction:s})}isRetryableError(e){const s=(null==e?void 0:e.message)||"";return s.includes("Network")||s.includes("timeout")||s.includes("500")||s.includes("502")||s.includes("503")||s.includes("504")}shouldReportError(e){const s=(null==e?void 0:e.message)||"";return s.includes("Server")||s.includes("500")||s.includes("Internal Server Error")||!s.includes("Network")}getErrorSeverity(e){const s=(null==e?void 0:e.message)||"";return s.includes("500")||s.includes("Server")?"critical":s.includes("Network")||s.includes("Auth")?"high":s.includes("Validation")||s.includes("400")?"medium":"low"}};const ua=new class{constructor(e={},t={}){s(this,"retryConfig"),s(this,"circuitBreakerConfig"),s(this,"stats"),s(this,"failureCount",0),s(this,"lastFailureTime"),s(this,"circuitBreakerState","closed"),this.retryConfig={maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffMultiplier:2,jitter:!0,retryCondition:e=>this.shouldRetry(e),...e},this.circuitBreakerConfig={failureThreshold:5,recoveryTimeout:3e4,monitoringPeriod:6e4,...t},this.stats={totalAttempts:0,successfulAttempts:0,failedAttempts:0,averageRetryTime:0,circuitBreakerState:"closed"}}shouldRetry(e){var s,t;return"open"!==this.circuitBreakerState&&((null==e?void 0:e.status)>=400&&(null==e?void 0:e.status)<500?408===(null==e?void 0:e.status)||429===(null==e?void 0:e.status):(null==e?void 0:e.status)>=500||!(null==e?void 0:e.status)||(!("TimeoutError"!==(null==e?void 0:e.name)&&!(null==(s=null==e?void 0:e.message)?void 0:s.includes("timeout")))||!("NetworkError"!==(null==e?void 0:e.name)&&!(null==(t=null==e?void 0:e.message)?void 0:t.includes("Network")))))}calculateDelay(e){let s=this.retryConfig.baseDelay*Math.pow(this.retryConfig.backoffMultiplier,e-1);if(s=Math.min(s,this.retryConfig.maxDelay),this.retryConfig.jitter){s+=.1*Math.random()*s}return Math.floor(s)}updateCircuitBreaker(e){e?(this.failureCount=0,this.circuitBreakerState="closed"):(this.failureCount++,this.lastFailureTime=new Date,this.failureCount>=this.circuitBreakerConfig.failureThreshold&&(this.circuitBreakerState="open",la.warn("Circuit breaker opened due to repeated failures"))),this.stats.circuitBreakerState=this.circuitBreakerState}async checkCircuitBreaker(){if("closed"===this.circuitBreakerState)return!0;if("open"===this.circuitBreakerState){return(this.lastFailureTime?Date.now()-this.lastFailureTime.getTime():0)>=this.circuitBreakerConfig.recoveryTimeout&&(this.circuitBreakerState="half-open",this.stats.circuitBreakerState="half-open",la.debug("Circuit breaker moved to half-open state"),!0)}return!0}async executeWithRetry(e,s){const t=Date.now();let a;if(!(await this.checkCircuitBreaker()))throw new Error("Circuit breaker is open - service temporarily unavailable");for(let n=1;n<=this.retryConfig.maxRetries+1;n++){this.stats.totalAttempts++;try{const a=await e();this.stats.successfulAttempts++,this.updateCircuitBreaker(!0);const r=Date.now()-t;return this.stats.averageRetryTime=(this.stats.averageRetryTime*(this.stats.successfulAttempts-1)+r)/this.stats.successfulAttempts,n>1&&la.debug(`Operation succeeded on attempt ${n}${s?` (${s})`:""}`),a}catch(r){if(a=r,this.stats.failedAttempts++,!(n<=this.retryConfig.maxRetries&&this.retryConfig.retryCondition(r))){this.updateCircuitBreaker(!1);break}{const e=this.calculateDelay(n);la.warn(`Operation failed on attempt ${n}${s?` (${s})`:""}, retrying in ${e}ms:`,r),await this.sleep(e)}}}throw this.updateCircuitBreaker(!1),a}sleep(e){return new Promise(s=>setTimeout(s,e))}async retryApiCall(e,s){return this.executeWithRetry(e,s)}async retryWebSocketConnection(e,s){return this.executeWithRetry(()=>new Promise((s,t)=>{try{const a=e();a.onopen=()=>s(a),a.onerror=e=>t(new Error("WebSocket connection failed")),a.onclose=e=>{1e3!==e.code&&t(new Error(`WebSocket closed unexpectedly: ${e.code}`))}}catch(a){t(a)}}),s)}async retryFileUpload(e,s){const t={...this.retryConfig};this.retryConfig.baseDelay=2e3,this.retryConfig.maxDelay=3e4;try{return await this.executeWithRetry(e,s)}finally{this.retryConfig=t}}async healthCheck(){return{isHealthy:"open"!==this.circuitBreakerState,stats:{...this.stats},circuitBreakerState:this.circuitBreakerState}}resetCircuitBreaker(){this.circuitBreakerState="closed",this.failureCount=0,this.lastFailureTime=void 0,this.stats.circuitBreakerState="closed",la.debug("Circuit breaker manually reset")}getStats(){return{...this.stats}}updateRetryConfig(e){this.retryConfig={...this.retryConfig,...e}}updateCircuitBreakerConfig(e){this.circuitBreakerConfig={...this.circuitBreakerConfig,...e}}};const ma=new class{constructor(){s(this,"metrics",[]),s(this,"maxMetrics",1e3),s(this,"activeTimers",new Map)}startTimer(e){const s=`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.activeTimers.set(s,performance.now()),s}endTimer(e,s){const t=this.activeTimers.get(e);if(!t)return la.warn(`Timer ${e} not found`),0;const a=performance.now()-t;return this.activeTimers.delete(e),this.recordMetric({id:e,timestamp:(new Date).toISOString(),type:"api",name:e.split("_")[0],duration:a,status:"success",metadata:s}),a}recordAPICall(e,s,t,a){this.recordMetric({id:`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:(new Date).toISOString(),type:"api",name:e,duration:s,status:t,metadata:a})}recordPageLoad(e,s,t){this.recordMetric({id:`page_${e}_${Date.now()}`,timestamp:(new Date).toISOString(),type:"page",name:e,duration:s,status:"success",metadata:t})}recordComponentRender(e,s,t){this.recordMetric({id:`component_${e}_${Date.now()}`,timestamp:(new Date).toISOString(),type:"component",name:e,duration:s,status:"success",metadata:t})}recordWebSocketEvent(e,s,t,a){this.recordMetric({id:`ws_${e}_${Date.now()}`,timestamp:(new Date).toISOString(),type:"websocket",name:e,duration:s,status:t,metadata:a})}recordMetric(e){this.metrics.push(e),this.metrics.length>this.maxMetrics&&(this.metrics=this.metrics.slice(-this.maxMetrics)),e.duration>5e3&&this.sendSlowMetricToServer(e)}async sendSlowMetricToServer(e){}getMetricsByType(e){return this.metrics.filter(s=>s.type===e)}getMetricsByName(e){return this.metrics.filter(s=>s.name===e)}getRecentMetrics(e=50){return this.metrics.slice(-e)}getPerformanceSummary(e){let s=this.metrics;if(e){const t=Date.now()-e;s=this.metrics.filter(e=>new Date(e.timestamp).getTime()>t)}if(0===s.length)return{totalRequests:0,averageResponseTime:0,minResponseTime:0,maxResponseTime:0,successRate:0,errorRate:0,slowestRequests:[]};const t=s.map(e=>e.duration),a=s.filter(e=>"success"===e.status).length,r=s.filter(e=>"error"===e.status).length,n=t.reduce((e,s)=>e+s,0)/t.length,i=Math.min(...t),l=Math.max(...t),o=[...s].sort((e,s)=>s.duration-e.duration).slice(0,10).map(e=>({name:e.name,duration:e.duration,timestamp:e.timestamp}));return{totalRequests:s.length,averageResponseTime:Math.round(100*n)/100,minResponseTime:Math.round(100*i)/100,maxResponseTime:Math.round(100*l)/100,successRate:s.length>0?a/s.length*100:0,errorRate:s.length>0?r/s.length*100:0,slowestRequests:o}}getSlowRequests(e=1e3){return this.metrics.filter(s=>s.duration>e)}getFailedRequests(){return this.metrics.filter(e=>"error"===e.status||"timeout"===e.status)}clearMetrics(){this.metrics=[]}exportMetrics(){return JSON.stringify({timestamp:(new Date).toISOString(),summary:this.getPerformanceSummary(),metrics:this.metrics},null,2)}trackWebVitals(){if("undefined"!=typeof window){try{new PerformanceObserver(e=>{var s;const t=e.getEntries(),a=t[t.length-1];this.recordMetric({id:`web-vitals-lcp_${Date.now()}`,timestamp:(new Date).toISOString(),type:"page",name:"LCP",duration:a.renderTime||a.loadTime,status:a.renderTime<2500?"success":"error",metadata:{element:null==(s=a.element)?void 0:s.tagName}})}).observe({type:"largest-contentful-paint",buffered:!0})}catch(e){la.warn("Web Vitals LCP tracking not supported:",e)}try{new PerformanceObserver(e=>{e.getEntries().forEach(e=>{this.recordMetric({id:`web-vitals-fid_${Date.now()}`,timestamp:(new Date).toISOString(),type:"component",name:"FID",duration:e.processingStart-e.startTime,status:e.processingStart-e.startTime<100?"success":"error",metadata:{eventType:e.name}})})}).observe({type:"first-input",buffered:!0})}catch(e){la.warn("Web Vitals FID tracking not supported:",e)}}}};"undefined"!=typeof window&&ma.trackWebVitals();const ha={defaultTTL:3e5,maxSize:100,storageType:"localStorage",prefix:"cache_"},xa="2.0.0",pa="cache_version";class ga{constructor(e={}){s(this,"cache",new Map),s(this,"config"),s(this,"storage",null),this.config={...ha,...e},this.initializeStorage(),this.checkCacheVersion(),this.loadFromStorage()}checkCacheVersion(){if(this.storage)try{const e=this.storage.getItem(pa);if(e!==xa){la.info(`[CacheService] Cache version mismatch (${e} -> ${xa}), clearing old cache`);const s=Object.keys(this.storage);s.filter(e=>e.startsWith(this.config.prefix)).forEach(e=>this.storage.removeItem(e)),this.storage.setItem(pa,xa)}}catch(e){la.error("[CacheService] Failed to check cache version:",e)}}initializeStorage(){if("undefined"!=typeof window)switch(this.config.storageType){case"localStorage":this.storage=localStorage;break;case"sessionStorage":this.storage=sessionStorage;break;case"memory":this.storage=null}}getStorageKey(e){return`${this.config.prefix}${e}`}loadFromStorage(){if(this.storage)try{const e=Object.keys(this.storage).filter(e=>e.startsWith(this.config.prefix));for(const s of e){const e=this.storage.getItem(s);if(e){const t=JSON.parse(e);if(this.isValid(t)){const e=s.replace(this.config.prefix,"");this.cache.set(e,t)}else this.storage.removeItem(s)}}}catch(e){la.error("Failed to load cache from storage:",e)}}saveToStorage(e,s){if(this.storage)try{const t=this.getStorageKey(e);this.storage.setItem(t,JSON.stringify(s))}catch(t){la.error("Failed to save cache to storage:",t),this.cleanupOldEntries()}}removeFromStorage(e){if(this.storage)try{const s=this.getStorageKey(e);this.storage.removeItem(s)}catch(s){la.error("Failed to remove cache from storage:",s)}}isValid(e){return Date.now()-e.timestamp<e.ttl}cleanupOldEntries(){const e=[];for(const[s,t]of this.cache.entries())this.isValid(t)||e.push(s);if(e.forEach(e=>{this.cache.delete(e),this.removeFromStorage(e)}),this.cache.size>this.config.maxSize){Array.from(this.cache.entries()).sort((e,s)=>e[1].timestamp-s[1].timestamp).slice(0,this.cache.size-this.config.maxSize).forEach(([e])=>{this.cache.delete(e),this.removeFromStorage(e)})}}set(e,s,t){const a={data:s,timestamp:Date.now(),ttl:t||this.config.defaultTTL,key:e};this.cache.set(e,a),this.saveToStorage(e,a),this.cleanupOldEntries()}get(e){const s=this.cache.get(e);return s?this.isValid(s)?s.data:(this.cache.delete(e),this.removeFromStorage(e),null):null}has(e){const s=this.cache.get(e);return!!s&&this.isValid(s)}delete(e){this.cache.delete(e),this.removeFromStorage(e)}clear(){if(this.storage){Object.keys(this.storage).filter(e=>e.startsWith(this.config.prefix)).forEach(e=>this.storage.removeItem(e))}this.cache.clear()}clearExpired(){const e=[];for(const[s,t]of this.cache.entries())this.isValid(t)||e.push(s);e.forEach(e=>{this.cache.delete(e),this.removeFromStorage(e)})}getStats(){let e=0,s=0;for(const t of this.cache.values())this.isValid(t)?e++:s++;return{total:this.cache.size,valid:e,expired:s,maxSize:this.config.maxSize,usage:this.cache.size/this.config.maxSize*100}}keys(){return Array.from(this.cache.keys())}setChatMessages(e,s,t=1){const a=`chat_${e}_page_${t}`;this.set(a,s,6e5)}getChatMessages(e,s=1){const t=`chat_${e}_page_${s}`;return this.get(t)}clearChatCache(e){if(e){this.keys().filter(s=>s.startsWith(`chat_${e}_`)).forEach(e=>this.delete(e))}else{this.keys().filter(e=>e.startsWith("chat_")).forEach(e=>this.delete(e))}}setDashboardData(e,s){const t=`dashboard_${e}`;this.set(t,s,12e4)}getDashboardData(e){const s=`dashboard_${e}`;return this.get(s)}clearDashboardCache(e){if(e)this.delete(`dashboard_${e}`);else{this.keys().filter(e=>e.startsWith("dashboard_")).forEach(e=>this.delete(e))}}}const fa=new ga({defaultTTL:3e5,maxSize:100,storageType:"localStorage"}),ja=Object.freeze(Object.defineProperty({__proto__:null,CacheService:ga,cacheService:fa},Symbol.toStringTag,{value:"Module"})),va="auth_token",ya="refresh_token",ba={getTokens(){if("undefined"==typeof window)return{accessToken:null,refreshToken:null};const e=localStorage.getItem(va),s=localStorage.getItem(ya);return e&&la.debug("[tokenStorage.getTokens]",{hasAccessToken:!0,accessTokenLength:e.length,hasRefreshToken:!!s}),{accessToken:e,refreshToken:s}},saveTokens(e,s){"undefined"!=typeof window&&(localStorage.setItem(va,e),s&&localStorage.setItem(ya,s),la.debug("[tokenStorage.saveTokens]",{tokenLength:e.length,hasRefreshToken:!!s,refreshTokenLength:(null==s?void 0:s.length)||0}))},clearTokens(){"undefined"!=typeof window&&(localStorage.removeItem(va),localStorage.removeItem(ya))},getAccessToken:()=>"undefined"==typeof window?null:localStorage.getItem(va),getRefreshToken:()=>"undefined"==typeof window?null:localStorage.getItem(ya)};const Na=function(){if("undefined"!=typeof window){const e=`${"https:"===window.location.protocol?"https:":"http:"}//${window.location.host}/api`;return la.info("[Config] Using auto-detected API URL from window.location:",e),e}return la.info("[Config] Using fallback API URL (SSR/build-time)"),"http://localhost:8003/api"}(),wa=function(){if("undefined"!=typeof window){const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/ws`;return la.info("[Config] Using auto-detected WebSocket URL from window.location:",e),e}return la.info("[Config] Using fallback WebSocket URL (SSR/build-time)"),"ws://localhost:8003/ws"}(),_a={maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffMultiplier:2};const Sa=new class{constructor(e=Na,t=wa,a={}){s(this,"baseURL"),s(this,"wsURL"),s(this,"token",null),s(this,"refreshTokenValue",null),s(this,"retryConfig"),s(this,"requestQueue",new Map),s(this,"isRefreshing",!1),s(this,"refreshQueue",[]),this.baseURL=e,this.wsURL=t,this.retryConfig={..._a,...a},this.loadTokensFromStorage()}loadTokensFromStorage(){var e;const s=ba.getTokens();this.token=s.accessToken,this.refreshTokenValue=s.refreshToken,la.debug("[TokenClient] Load tokens from storage:",{hasAccessToken:!!s.accessToken,hasRefreshToken:!!s.refreshToken,accessTokenLength:(null==(e=s.accessToken)?void 0:e.length)||0})}saveTokensToStorage(e,s){this.token=e,this.refreshTokenValue=s||this.refreshTokenValue||void 0,ba.saveTokens(e,s),la.debug("[TokenClient] Tokens saved to unified storage")}clearTokens(){this.token=null,this.refreshTokenValue=null,ba.clearTokens(),la.info("[TokenClient] Tokens cleared")}getRequestKey(e,s){return`${s.method||"GET"}:${e}:${JSON.stringify(s.body||"")}`}async sleep(e){return new Promise(s=>setTimeout(s,e))}calculateDelay(e){const s=this.retryConfig.baseDelay*Math.pow(this.retryConfig.backoffMultiplier,e-1);return Math.min(s,this.retryConfig.maxDelay)}classifyError(e,s){return s?401===s.status?{type:"auth",message:"Authentication required or token expired",code:"AUTH_ERROR",details:{status:s.status}}:s.status>=400&&s.status<500?{type:"validation",message:"Invalid request data",code:"VALIDATION_ERROR",details:{status:s.status}}:s.status>=500?{type:"server",message:"Server error occurred",code:"SERVER_ERROR",details:{status:s.status}}:{type:"server",message:"Unknown error occurred",code:"UNKNOWN_ERROR",details:{error:e,response:s}}:{type:"network",message:"Network error: Unable to connect to server",code:"NETWORK_ERROR",details:e}}async request(e,s={},t=0){const a=this.getRequestKey(e,s);if(this.requestQueue.has(a))return this.requestQueue.get(a);const r=this.executeRequestWithRetry(e,s);this.requestQueue.set(a,r);try{return await r}finally{this.requestQueue.delete(a)}}async executeRequestWithRetry(e,s={}){try{return await ua.retryApiCall(()=>this.executeRequest(e,s,0),`API ${s.method||"GET"} ${e}`)}catch(t){return{success:!1,error:da.handleError(t,{operation:`API ${s.method||"GET"} ${e}`,component:"UnifiedAPIClient"}).message,timestamp:(new Date).toISOString()}}}async executeRequest(e,s={},t=0){var a,r,n,i;const l=`${this.baseURL}${e}`;this.loadTokensFromStorage();const o=!s.method||"GET"===s.method;if(o&&!t&&!e.includes("/accounts/users/")&&!e.includes("/auth/staff/")&&!e.includes("/tutor/students/")&&!e.includes("/profile/")&&!e.includes("/scheduling/lessons")){const s=fa.get(e);if(null!==s)return la.debug("[API Request] Using cached data for:",e),{success:!0,data:s,timestamp:(new Date).toISOString()}}const c={..."undefined"!=typeof FormData&&s.body instanceof FormData?{}:{"Content-Type":"application/json"},...s.headers};this.token?(c.Authorization=`Token ${this.token}`,la.debug("[API Request] Authorization header added",{endpoint:e,tokenLength:this.token.length,hasAuthHeader:!0})):la.warn("[API Request] No token available for request",{endpoint:e,method:s.method||"GET"});const d=ma.startTimer(e),u=new AbortController,m=setTimeout(()=>{la.warn("[API Request] Request timeout, aborting:",{endpoint:e,url:l}),u.abort()},3e4);try{la.debug("[API Request] Sending request:",{url:l,method:s.method||"GET",hasBody:!!s.body,hasToken:!!this.token,hasSignal:!!s.signal});const r=await fetch(l,{...s,headers:c,credentials:"include",signal:u.signal});clearTimeout(m);const n=ma.endTimer(d);la.debug("[API Request] Response received:",{url:l,status:r.status,ok:r.ok,duration:`${n}ms`});const i=await oa(r),h=e.includes("/auth/staff/");if((e.includes("/accounts/users/")||h)&&la.debug("[unifiedClient] API response:",{endpoint:e,ok:r.ok,status:r.status,statusText:r.statusText,parseSuccess:i.success,dataType:typeof i.data,isArray:Array.isArray(i.data),dataLength:Array.isArray(i.data)?i.data.length:"N/A",dataKeys:i.data&&"object"==typeof i.data&&!Array.isArray(i.data)?Object.keys(i.data):"N/A"}),!i.success)return{success:!1,error:i.error||"Ошибка парсинга ответа сервера",timestamp:(new Date).toISOString()};if(!r.ok){const a=this.classifyError(null,r);if("auth"===a.type&&0===t){if(this.isRefreshing)return new Promise(a=>{this.refreshQueue.push(()=>{this.request(e,s,t+1).then(a)})});if(this.refreshTokenValue){this.isRefreshing=!0;try{if(await this.refreshAuthToken())return this.refreshQueue.forEach(e=>e()),this.refreshQueue=[],this.request(e,s,t+1)}finally{this.isRefreshing=!1,this.refreshQueue=[]}}}if(("network"===a.type||"server"===a.type)&&t<this.retryConfig.maxRetries){const a=this.calculateDelay(t+1);return await this.sleep(a),this.request(e,s,t+1)}let n=a.message;if(i.data)if(i.data.detail)n=i.data.detail;else if(i.data.error)n=i.data.error;else if(i.data.message)n=i.data.message;else if("object"==typeof i.data){const e=Object.entries(i.data).map(([e,s])=>Array.isArray(s)?`${e}: ${s.join(", ")}`:`${e}: ${s}`).join("; ");e&&(n=e)}return{success:!1,error:n,timestamp:(new Date).toISOString()}}let x;Array.isArray(i.data)?(x=i.data,(e.includes("/accounts/users/")||h)&&la.debug("[unifiedClient] Data is array, length:",x.length)):i.data&&"object"==typeof i.data?((e.includes("/accounts/users/")||h)&&la.debug("[unifiedClient] Data is object, keys:",Object.keys(i.data)),void 0!==i.data.data?(x=i.data.data,h&&la.debug("[unifiedClient] Using result.data.data")):"count"in i.data&&"results"in i.data?(x=i.data,h&&la.debug("[unifiedClient] Using full paginated response with count:",i.data.count)):(x=i.data,h&&la.debug("[unifiedClient] Using result.data as is"))):(x=i.data,(e.includes("/accounts/users/")||h)&&la.warn("[unifiedClient] Data is not array or object:",typeof i.data));const p={success:!0,data:x,message:null==(a=i.data)?void 0:a.message,timestamp:(new Date).toISOString()};(e.includes("/accounts/users/")||h)&&la.debug("[unifiedClient] Final response:",{success:p.success,dataType:typeof p.data,isArray:Array.isArray(p.data),dataLength:Array.isArray(p.data)?p.data.length:"N/A"});return o&&p.success&&p.data&&!e.includes("/accounts/users/")&&!e.includes("/auth/staff/")&&!e.includes("/tutor/students/")&&!e.includes("/profile/")&&!e.includes("/scheduling/lessons")&&fa.set(e,p.data),ma.recordAPICall(e,n,"success"),p}catch(h){clearTimeout(m);const a=ma.endTimer(d),o=this.classifyError(h),c="AbortError"===(null==h?void 0:h.name),u="network"===o.type||(null==(r=null==h?void 0:h.message)?void 0:r.includes("Failed to fetch"))||(null==(n=null==h?void 0:h.message)?void 0:n.includes("NetworkError"))||(null==(i=null==h?void 0:h.message)?void 0:i.includes("Network request failed"));if(la.error("[API Request] Request failed:",{url:l,endpoint:e,errorType:o.type,isAbortError:c,isNetworkError:u,errorMessage:(null==h?void 0:h.message)||o.message,duration:`${a}ms`}),ma.recordAPICall(e,a,c?"timeout":(o.type,"error")),u&&!c&&t<this.retryConfig.maxRetries){const a=this.calculateDelay(t+1);return la.debug(`[API Request] Retrying after ${a}ms (attempt ${t+1}/${this.retryConfig.maxRetries})`),await this.sleep(a),this.request(e,s,t+1)}return c||u||o.message,{success:!1,error:o.message,timestamp:(new Date).toISOString()}}finally{clearTimeout(m)}}async refreshAuthToken(){var e;if(!this.refreshTokenValue)return la.warn("[TokenClient] No refresh token available"),this.clearTokens(),!1;const s=new AbortController,t=setTimeout(()=>s.abort(),1e4);try{la.info("[TokenClient] Attempting token refresh");const a=await fetch(`${this.baseURL}/auth/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:this.refreshTokenValue}),signal:s.signal});if(clearTimeout(t),!a.ok)return la.error("[TokenClient] Token refresh failed with status:",a.status),this.clearTokens(),!1;const r=await a.json();return r.success&&(null==(e=r.data)?void 0:e.token)?(la.info("[TokenClient] Token refresh successful"),this.saveTokensToStorage(r.data.token,r.data.refresh_token),!0):(la.error("[TokenClient] Invalid token refresh response:",r),this.clearTokens(),!1)}catch(a){return clearTimeout(t),a instanceof Error&&"AbortError"===a.name?la.error("[TokenClient] Token refresh timeout"):la.error("[TokenClient] Token refresh error:",a),this.clearTokens(),!1}}async login(e){var s,t,a,r;la.debug("[UnifiedClient.login] Sending login request...",{email:e.email||e.username,baseURL:this.baseURL});const n=new AbortController,i=setTimeout(()=>{la.warn("[UnifiedClient.login] Request timeout, aborting..."),n.abort()},15e3);try{const i=await this.request("/auth/login/",{method:"POST",body:JSON.stringify(e),signal:n.signal});return 429===i.statusCode||(null==(s=i.error)?void 0:s.includes("429"))?(la.warn("[UnifiedClient.login] Rate limit exceeded"),{success:!1,error:"Слишком много попыток входа. Попробуйте позже",message:"Rate limit exceeded",statusCode:429,timestamp:(new Date).toISOString()}):(i.success&&i.data?(la.debug("[UnifiedClient.login] Login successful, saving tokens:",{userId:null==(t=i.data.user)?void 0:t.id,role:null==(a=i.data.user)?void 0:a.role,hasToken:!!i.data.token,tokenLength:(null==(r=i.data.token)?void 0:r.length)||0}),this.saveTokensToStorage(i.data.token,i.data.refresh_token),localStorage.setItem("userData",JSON.stringify(i.data.user)),la.debug("[UnifiedClient.login] Tokens saved to storage")):la.error("[UnifiedClient.login] Login failed:",i.error),i)}catch(l){if("AbortError"===(null==l?void 0:l.name))return la.error("[UnifiedClient.login] Login timeout"),{success:!1,error:"Истекло время ожидания. Проверьте интернет-соединение",statusCode:408,timestamp:(new Date).toISOString()};throw l}finally{clearTimeout(i)}}async logout(){const e=await this.request("/accounts/logout/",{method:"POST"});return this.clearTokens(),e}async refreshToken(){la.info("[unifiedAPIClient.refreshToken] Refreshing token");const e=await this.request("/auth/refresh/",{method:"POST"});return e.success&&e.data?(la.info("[unifiedAPIClient.refreshToken] Token refreshed successfully"),this.saveTokensToStorage(e.data.token,e.data.refresh_token),localStorage.setItem("userData",JSON.stringify(e.data.user))):la.error("[unifiedAPIClient.refreshToken] Failed to refresh token:",e.error),e}async getProfile(){var e;this.loadTokensFromStorage(),la.debug("[UnifiedAPI.getProfile] Fetching profile with token:",{hasToken:!!this.token,tokenLength:(null==(e=this.token)?void 0:e.length)||0});let s=null;try{const e=localStorage.getItem("userData");if(e){s=JSON.parse(e).role,la.debug("[UnifiedAPI.getProfile] User role from localStorage:",s)}}catch(a){la.warn("[UnifiedAPI.getProfile] Failed to get user role from localStorage:",a)}if(!s)return la.warn("[UnifiedAPI.getProfile] No user role found in localStorage"),this.request("/profile/student/").catch(async e=>(la.warn("[UnifiedAPI.getProfile] Failed with /profile/student/, falling back to /profile/teacher/"),this.request("/profile/teacher/")));const t=this.getProfileEndpointForRole(s);return la.debug("[UnifiedAPI.getProfile] Using endpoint:",t),this.request(t)}getProfileEndpointForRole(e){switch(e){case"student":case"admin":return"/profile/student/";case"teacher":return"/profile/teacher/";case"tutor":return"/profile/tutor/";case"parent":return"/profile/parent/";default:return la.warn(`[UnifiedAPI.getProfileEndpointForRole] Unknown role: ${e}, defaulting to student`),"/profile/student/"}}async updateProfile(e){return this.request("/auth/profile/update/",{method:"PATCH",body:JSON.stringify(e)})}async changePassword(e){return this.request("/auth/change-password/",{method:"POST",body:JSON.stringify(e)})}async getStudentDashboard(){return this.request("/materials/student/")}async getTeacherDashboard(){return this.request("/materials/teacher/")}async getParentDashboard(){return this.request("/materials/parent/")}async getGeneralChat(){return this.request("/chat/general/")}async getGeneralMessages(e=1,s=50){return this.request(`/chat/general/messages/?page=${e}&page_size=${s}`)}async sendMessage(e){return this.request("/chat/general/messages/",{method:"POST",body:JSON.stringify(e)})}async createPayment(e){return this.request("/payments/",{method:"POST",body:JSON.stringify(e)})}async getPayment(e){return this.request(`/payments/${e}/`)}async getPayments(){return this.request("/payments/")}async getPaymentStatus(e){return this.request(`/payments/${e}/status/`)}async createApplication(e){return this.request("/applications/submit/",{method:"POST",body:JSON.stringify(e)})}async getApplications(){return this.request("/applications/")}async getApplication(e){return this.request(`/applications/${e}/`)}async updateApplicationStatus(e,s,t){return this.request(`/applications/${e}/status/`,{method:"PATCH",body:JSON.stringify({status:s,notes:t})})}async healthCheck(){return this.request("/health/")}setToken(e){if(this.token=e,"undefined"!=typeof window&&window.localStorage){localStorage.setItem("authToken",e);const s={data:e,timestamp:Date.now()};localStorage.setItem("bot_platform_auth_token",JSON.stringify(s)),la.debug("[Token Management] Token saved to both storage locations")}}getToken(){return this.loadTokensFromStorage(),this.token}isAuthenticated(){return!!this.token}async get(e,s){const t=null==s?void 0:s.params;let a=e;if(t){const s=new URLSearchParams;Object.entries(t).forEach(([e,t])=>{null!=t&&s.append(e,String(t))});const r=s.toString();r&&(a=`${e}${e.includes("?")?"&":"?"}${r}`)}return this.request(a,{...s,method:"GET"})}async post(e,s,t){return this.request(e,{...t,method:"POST",body:"string"==typeof s?s:JSON.stringify(s)})}async patch(e,s,t){return this.request(e,{...t,method:"PATCH",body:"string"==typeof s?s:JSON.stringify(s)})}async put(e,s,t){return this.request(e,{...t,method:"PUT",body:"string"==typeof s?s:JSON.stringify(s)})}async delete(e,s){return this.request(e,{...s,method:"DELETE"})}connectWebSocket(){if("undefined"==typeof WebSocket)return la.warn("WebSocket not supported in this environment"),null;try{return new WebSocket(`${this.wsURL}/chat/`)}catch(e){return la.error("Failed to create WebSocket connection:",e),null}}},ka={},Ca="bot_platform_",Ea=class e{constructor(){s(this,"encryptionKey"),this.encryptionKey=void 0!==import.meta&&(null==ka?void 0:ka.VITE_ENCRYPTION_KEY)||"bot_platform_secure_key_2024"}static getInstance(){return e.instance||(e.instance=new e),e.instance}encrypt(e){try{return ye.AES.encrypt(e,this.encryptionKey).toString()}catch(s){return la.error("Ошибка шифрования:",s),e}}decrypt(e){try{if(!e||""===e.trim())return null;const s=ye.AES.decrypt(e,this.encryptionKey).toString(ye.enc.Utf8);return s&&""!==s.trim()?s:(la.warn("Расшифровка вернула пустую строку - возможно, неверный ключ или поврежденные данные"),null)}catch(s){return la.error("Ошибка расшифровки:",s),null}}isExpired(e){return!!e.expires&&Date.now()>e.expires}setItem(e,s,t){try{if("undefined"==typeof window||!window.localStorage)return!1;const a={data:s,timestamp:Date.now(),expires:t?Date.now()+t:void 0},r=this.encrypt(JSON.stringify(a));return localStorage.setItem(`${Ca}${e}`,r),!0}catch(a){return la.error("Ошибка сохранения в secure storage:",a),!1}}getItem(e){try{if("undefined"==typeof window||!window.localStorage)return null;const t=localStorage.getItem(`${Ca}${e}`);if(!t)return null;let a;try{const s=JSON.parse(t);if(s&&"object"==typeof s&&"data"in s&&"timestamp"in s)return a=s,this.isExpired(a)?(this.removeItem(e),null):a.data}catch(s){}const r=this.decrypt(t);if(!r)return la.warn(`Failed to decrypt item with key: ${e}. Removing corrupted data.`),this.removeItem(e),null;try{a=JSON.parse(r)}catch(s){return la.error(`Failed to parse decrypted item with key: ${e}`,s),this.removeItem(e),null}return this.isExpired(a)?(this.removeItem(e),null):a.data}catch(t){return la.error("Ошибка получения из secure storage:",t),null}}removeItem(e){try{"undefined"!=typeof window&&window.localStorage&&localStorage.removeItem(`${Ca}${e}`)}catch(s){la.error("Ошибка удаления из secure storage:",s)}}clear(){try{if("undefined"!=typeof window&&window.localStorage){Object.keys(localStorage).forEach(e=>{e.startsWith(Ca)&&localStorage.removeItem(e)})}}catch(e){la.error("Ошибка очистки secure storage:",e)}}hasItem(e){return null!==this.getItem(e)}setAuthToken(e,s){return this.setItem("auth_token",e,s)}getAuthToken(){return this.getItem("auth_token")}setRefreshToken(e,s){return this.setItem("refresh_token",e,s)}getRefreshToken(){return this.getItem("refresh_token")}setUserData(e,s){return this.setItem("user_data",JSON.stringify(e),s)}getUserData(){const e=this.getItem("user_data");if(!e)return null;try{return JSON.parse(e)}catch(s){return la.error("Ошибка парсинга user data:",s),null}}clearAuthData(){this.removeItem("auth_token"),this.removeItem("refresh_token"),this.removeItem("user_data"),this.removeItem("token_expiry")}};s(Ea,"instance");const Ta=Ea.getInstance(),Ra=class e{constructor(){s(this,"user",null),s(this,"token",null),s(this,"refreshToken",null),s(this,"tokenExpiry",null),s(this,"authStateCallbacks",[]),s(this,"isRefreshing",!1),s(this,"initializationPromise",null),s(this,"initializationComplete",!1),this.initializationPromise=this.initializeFromStorage()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initializeFromStorage(){try{const e=Date.now();la.debug("[AuthService.init] Starting initialization from storage...");const s=this.getStoredToken(),t=this.getStoredUser(),a=this.getStoredRefreshToken(),r=this.getStoredTokenExpiry();if(la.debug("[AuthService.init] Storage check:",{hasToken:!!s,tokenLength:(null==s?void 0:s.length)||0,hasUser:!!t,userId:null==t?void 0:t.id,userRole:null==t?void 0:t.role,hasExpiry:!!r,expiry:r,now:Date.now(),isExpired:r?Date.now()>=r:"no expiry"}),s&&t){r&&Date.now()>=r?(la.debug("[AuthService.init] Token expired, clearing storage (no refresh on init)"),this.clearStorage(),this.user=null,this.token=null,this.refreshToken=null,this.tokenExpiry=null):(this.token=s,this.user=t,this.refreshToken=a,this.tokenExpiry=r||Date.now()+6048e5,Sa.setToken(s),la.debug("[AuthService.init] User authenticated from storage:",{userId:this.user.id,role:this.user.role,tokenExpiry:this.tokenExpiry}))}else la.debug("[AuthService.init] No stored credentials (missing token or user)");const n=Date.now()-e;la.debug("[AuthService.init] Initialization complete:",{isAuthenticated:this.isAuthenticated(),hasUser:!!this.user,hasToken:!!this.token,durationMs:n})}catch(e){la.error("[AuthService.init] Initialization error:",e),this.clearStorage()}finally{this.initializationComplete=!0}}getStoredToken(){const e=localStorage.getItem("auth_token");if(e)return e;try{return Ta.getAuthToken()}catch(s){const e=localStorage.getItem("authToken");if(e)return e;const t=localStorage.getItem("bot_platform_auth_token");if(t)try{const e=JSON.parse(t);return(null==e?void 0:e.data)||null}catch{}return null}}getStoredUser(){try{return Ta.getUserData()}catch(e){const s=localStorage.getItem("userData");if(s)try{return JSON.parse(s)}catch{}const t=localStorage.getItem("bot_platform_user_data");if(t)try{const e=JSON.parse(t),s=null==e?void 0:e.data;return s?JSON.parse(s):null}catch{}return null}}getStoredRefreshToken(){return Ta.getRefreshToken()}getStoredTokenExpiry(){const e=(()=>{try{return Ta.getItem("token_expiry")}catch{return null}})();if(e){const s=parseInt(e,10);if(!isNaN(s))return s}const s=localStorage.getItem("bot_platform_token_expiry");if(s)try{const e=JSON.parse(s),t=parseInt(null==e?void 0:e.data,10);return isNaN(t)?null:t}catch{}const t=localStorage.getItem("token_expiry");if(t){const e=parseInt(t,10);return isNaN(e)?null:e}return null}setStoredToken(e,s){Ta.setAuthToken(e,s)}setStoredUser(e,s){Ta.setUserData(e,s)}setStoredRefreshToken(e,s){Ta.setRefreshToken(e,s)}setStoredTokenExpiry(e){Ta.setItem("token_expiry",e.toString())}clearStorage(){Ta.clearAuthData()}async login(e){var s,t;try{la.debug("[AuthService.login] Attempting login...");const a=await Sa.login(e);if(!a.success||!a.data){const e=new Error(a.error||"Ошибка входа");throw e.statusCode=a.statusCode,e}const{token:r,user:n}=a.data;la.debug("[AuthService.login] Login successful:",{userId:null==n?void 0:n.id,username:null==n?void 0:n.username,role:null==n?void 0:n.role,tokenLength:null==r?void 0:r.length}),this.token=r,this.user=n,this.tokenExpiry=Date.now()+6048e5,Sa.setToken(r);const i=6048e5;return this.setStoredToken(r,i),this.setStoredUser(n,i),this.setStoredTokenExpiry(this.tokenExpiry),la.debug("[AuthService.login] Token and user saved to storage:",{userId:null==(s=this.user)?void 0:s.id,role:null==(t=this.user)?void 0:t.role,hasToken:!!this.token,tokenInApiClient:!!Sa.getToken(),tokenExpiry:new Date(this.tokenExpiry).toISOString()}),this.notifyAuthStateChange(n),la.debug("[AuthService.login] Auth state change notified, login complete"),{user:n,token:r,expires_at:new Date(this.tokenExpiry).toISOString()}}catch(a){throw la.error("[AuthService.login] Login failed:",a),a}}async logout(){try{await Sa.logout()}catch(e){la.error("Ошибка выхода:",e)}finally{this.token=null,this.user=null,this.refreshToken=null,this.tokenExpiry=null,this.clearStorage(),Sa.setToken(""),this.notifyAuthStateChange(null)}}async waitForInitialization(){this.initializationPromise&&await this.initializationPromise}isInitializing(){return!this.initializationComplete}getCurrentUser(){return this.user}isAuthenticated(){return!!this.token&&!!this.user}getToken(){return this.token}async refreshTokenIfNeeded(){if(!this.token||!this.tokenExpiry)return la.debug("[AuthService.refreshTokenIfNeeded] No token or expiry"),null;const e=3e5,s=this.tokenExpiry-Date.now();if(la.debug("[AuthService.refreshTokenIfNeeded]",{timeUntilExpiry:s,refreshThreshold:e,needsRefresh:s<e}),s>=e)return this.token;try{la.debug("[AuthService.refreshTokenIfNeeded] Token expiring soon, refreshing...");const e=await Sa.refreshToken();if(!e.success||!e.data)throw new Error(e.error||"Не удалось обновить токен");const{token:s,user:t}=e.data;this.token=s,this.user=t,this.tokenExpiry=Date.now()+6048e5;const a=6048e5;return this.setStoredToken(s,a),this.setStoredUser(t,a),this.setStoredTokenExpiry(this.tokenExpiry),Sa.setToken(s),la.debug("[AuthService.refreshTokenIfNeeded] Token refreshed successfully"),this.notifyAuthStateChange(t),this.token}catch(t){return la.error("[AuthService.refreshTokenIfNeeded] Error refreshing token:",t),await this.logout(),null}}onAuthStateChange(e){return this.authStateCallbacks.push(e),()=>{const s=this.authStateCallbacks.indexOf(e);s>-1&&this.authStateCallbacks.splice(s,1)}}notifyAuthStateChange(e){this.authStateCallbacks.forEach(s=>{try{s(e)}catch(t){la.error("Ошибка в callback аутентификации:",t)}})}async ensureValidToken(){if(!this.isAuthenticated())return null;const e=await this.refreshTokenIfNeeded();return e||(await this.logout(),null)}authenticateWith(e,s,t=6048e5){this.token=s,this.user=e,this.tokenExpiry=Date.now()+t,this.setStoredToken(s,t),this.setStoredUser(e,t),this.setStoredTokenExpiry(this.tokenExpiry),Sa.setToken(s),this.notifyAuthStateChange(e)}};s(Ra,"instance");const Aa=Ra.getInstance(),Pa=t.createContext(void 0),La=({children:e})=>{const[s,r]=t.useState(null),[n,i]=t.useState(!0),[l,o]=t.useState(!0);t.useEffect(()=>{(async()=>{if(!l)return void la.debug("[AuthContext] Already initialized, skipping");const e=Date.now();await new Promise(e=>setTimeout(e,0));try{la.debug("[AuthContext] Starting initialization...");const s=new Promise(s=>setTimeout(()=>{const t=Date.now()-e;la.warn(`[AuthContext] Initialization timeout after ${t}ms, continuing without auth`),s(null)},5e3));await Promise.race([Aa.waitForInitialization(),s]);const t=Aa.getCurrentUser(),a=Aa.isAuthenticated(),n=Date.now()-e;la.debug("[AuthContext] Init complete:",{hasUser:!!t,isAuth:a,userId:null==t?void 0:t.id,userRole:null==t?void 0:t.role,isInitializing:Aa.isInitializing(),durationMs:n}),a&&t?(r(t),la.debug("[AuthContext] User authenticated:",{userId:t.id,role:t.role})):(r(null),la.debug("[AuthContext] User not authenticated"))}catch(s){la.error("[AuthContext] Initialization error:",s),r(null)}finally{i(!1),o(!1),la.debug("[AuthContext] Initialization complete, isLoading=false")}})();const e=setTimeout(()=>{if(l)la.debug("[AuthContext] Delayed check skipped: still initializing");else try{const e=Aa.getCurrentUser();Aa.isAuthenticated()&&e&&(la.debug("[AuthContext] Delayed check: user found, updating state"),r(e))}catch(e){la.error("[AuthContext] Delayed check error:",e)}},150),s=()=>{if(l)la.debug("[AuthContext] Storage event ignored: still initializing");else try{const e=Aa.getCurrentUser();Aa.isAuthenticated()&&e&&(la.debug("[AuthContext] Storage event: user found, updating state"),r(e))}catch(e){la.error("[AuthContext] Storage event error:",e)}};window.addEventListener("storage",s);const t=Aa.onAuthStateChange(e=>{la.debug("[AuthContext] Auth state changed:",{hasUser:!!e,userId:null==e?void 0:e.id,role:null==e?void 0:e.role,isInitializing:l}),r(e),l||i(!1)});return()=>{t(),window.removeEventListener("storage",s),clearTimeout(e)}},[]);const c=t.useCallback(async e=>{var s,t;i(!0);try{la.debug("[AuthContext.login] Starting login...");const a=await Aa.login(e);return la.debug("[AuthContext.login] Login successful, setting user:",{userId:null==(s=a.user)?void 0:s.id,role:null==(t=a.user)?void 0:t.role}),r(a.user),la.debug("[AuthContext.login] User state updated, login complete"),a}catch(a){throw la.error("[AuthContext.login] Login failed:",a),r(null),a}finally{i(!1)}},[]),d=t.useCallback(async()=>{i(!0);try{await Aa.logout(),r(null),"undefined"!=typeof window&&(window.location.href="/auth")}catch(e){la.error("Ошибка выхода:",e),r(null),"undefined"!=typeof window&&(window.location.href="/auth")}finally{i(!1)}},[]),u=t.useCallback(async()=>{try{return await Aa.refreshTokenIfNeeded()}catch(e){return la.error("Ошибка обновления токена:",e),r(null),null}},[]),m=t.useMemo(()=>({user:s,isAuthenticated:!!s,isLoading:n,login:c,logout:d,signOut:d,refreshToken:u}),[s,n,c,d,u]);return a.jsx(Pa.Provider,{value:m,children:e})},qa=()=>{const e=t.useContext(Pa);if(void 0===e)throw new Error("useAuth должен использоваться внутри AuthProvider");return e},Ia=()=>{const e=ot(),{user:s,isLoading:t}=qa(),{data:a,isLoading:r,error:n,refetch:i,isError:l}=ct({queryKey:["profile",null==s?void 0:s.id,null==s?void 0:s.role],queryFn:async()=>{var t,a,r;la.debug("[useProfile] Fetching profile...",{userRole:null==s?void 0:s.role,userId:null==s?void 0:s.id});try{const n=await Sa.getProfile();if(!n.success){const t=n.error||"Не удалось загрузить профиль";if(t.includes("401")||t.includes("403")||t.includes("Authentication")||t.includes("Forbidden"))throw la.warn("[useProfile] Authentication/Permission error (401/403), clearing profile cache",{errorMessage:t}),e.removeQueries({queryKey:["profile",null==s?void 0:s.id,null==s?void 0:s.role]}),new Error("Сессия истекла или нет прав доступа. Пожалуйста, авторизуйтесь снова");if(t.includes("404")||t.includes("not found"))throw la.error("[useProfile] Profile not found (404)"),new Error("Профиль пользователя не найден");throw la.error("[useProfile] Error loading profile:",t),new Error(t||"Неизвестная ошибка при загрузке профиля")}if(!n.data)throw la.warn("[useProfile] Response is successful but data is empty"),new Error("Данные профиля отсутствуют");return la.debug("[useProfile] Profile loaded successfully",{userId:null==(t=n.data.user)?void 0:t.id,email:null==(a=n.data.user)?void 0:a.email,role:null==(r=n.data.user)?void 0:r.role}),n.data}catch(n){const e=n instanceof Error?n.message:"Неизвестная ошибка";throw la.error("[useProfile] Query function error:",e),n}},staleTime:3e5,gcTime:6e5,retry:(e,s)=>{const t=s instanceof Error?s.message:String(s);return t.includes("401")||t.includes("Authentication")||t.includes("403")||t.includes("Forbidden")?(la.debug("[useProfile] Auth error detected, no retries"),!1):t.includes("404")||t.includes("not found")?(la.debug("[useProfile] Not found error, no retries"),!1):e<3&&(la.debug("[useProfile] Network/server error, retry attempt:",e+1),!0)},retryDelay:e=>Math.min(1e3*Math.pow(2,e),1e4),refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0,throwOnError:!0,enabled:!t&&!!(null==s?void 0:s.id)});return{profileData:a,isLoading:r||t,error:n,refetch:i,isError:l,user:null==a?void 0:a.user}},za={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"};function Da({className:e,size:s="md"}){return a.jsx("div",{className:Bt("animate-spin",za[s],e),children:a.jsxs("svg",{className:"w-full h-full text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})}const Oa=({children:e,requiredRole:s})=>{const{isAuthenticated:r,isLoading:n,user:i,error:l}=(()=>{const{profileData:e,isLoading:s,error:t}=Ia();return{isAuthenticated:!!(null==e?void 0:e.user)&&!t,isLoading:s,user:null==e?void 0:e.user,error:t}})(),{user:o,isLoading:c}=qa(),[d,u]=t.useState(!1);t.useEffect(()=>{const e=setTimeout(()=>{(n||c)&&(la.warn("[ProtectedRoute] Initialization timeout reached (5s)",{isLoading:n,authContextLoading:c,hasUser:!!i,hasAuthContextUser:!!o,isAuthServiceInitializing:Aa.isInitializing()}),u(!0))},5e3);return()=>clearTimeout(e)},[n,c,i,o]);if((n||c||Aa.isInitializing())&&!d)return a.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Da,{}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Проверка авторизации..."})]})});const m=o||i;return m&&la.debug("[ProtectedRoute] Effective user determined:",{source:o?"AuthContext":"useProfile",userId:m.id,role:m.role,requiredRole:s}),l&&!m?(la.debug("[ProtectedRoute] Profile error without fallback user, redirecting to signin"),a.jsx(mt,{to:"/auth/signin",replace:!0})):r||m?m?(s&&la.debug("[ProtectedRoute] Role check:",{requiredRole:s,userFromProfile:null==i?void 0:i.role,userFromContext:null==o?void 0:o.role,effectiveUserRole:m.role,match:m.role===s}),s&&m.role!==s?a.jsx(mt,{to:"/unauthorized",replace:!0}):a.jsx(a.Fragment,{children:e})):(la.debug("[ProtectedRoute] No effective user after loading, redirecting to signin",{isAuthenticated:r,hasUser:!!i,hasAuthContextUser:!!o}),a.jsx(mt,{to:"/auth/signin",replace:!0})):(la.debug("[ProtectedRoute] Not authenticated, redirecting to signin",{isAuthenticated:r,hasEffectiveUser:!!m,initTimeout:d}),a.jsx(mt,{to:"/auth/signin",replace:!0}))},Fa=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Bt("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));Fa.displayName="Card";const Ma=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Bt("flex flex-col space-y-1.5 p-6",e),...s}));Ma.displayName="CardHeader";const $a=t.forwardRef(({className:e,...s},t)=>a.jsx("h3",{ref:t,className:Bt("text-2xl font-semibold leading-none tracking-tight",e),...s}));$a.displayName="CardTitle";const Ua=t.forwardRef(({className:e,...s},t)=>a.jsx("p",{ref:t,className:Bt("text-sm text-muted-foreground",e),...s}));Ua.displayName="CardDescription";const Va=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Bt("p-6 pt-0",e),...s}));Va.displayName="CardContent";const Wa=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Bt("flex items-center p-6 pt-0",e),...s}));Wa.displayName="CardFooter";const Ha=ge("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ba=t.forwardRef(({className:e,variant:s,size:t,asChild:r=!1,...n},i)=>{const l=r?f:"button";return a.jsx(l,{className:Bt(Ha({variant:s,size:t,className:e})),ref:i,...n})});Ba.displayName="Button";class Xa extends t.Component{constructor(e){super(e),s(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s}),la.error("ErrorBoundary caught an error:",e,s),this.props.onError&&this.props.onError(e,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:a.jsx(Ja,{error:this.state.error,onRetry:this.handleRetry}):this.props.children}}const Ja=({error:e,onRetry:s})=>a.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:a.jsx(Fa,{className:"w-full max-w-md p-6 text-center",children:a.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[a.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center",children:a.jsx(be,{className:"w-8 h-8 text-destructive"})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Что-то пошло не так"}),a.jsx("p",{className:"text-muted-foreground",children:"Произошла неожиданная ошибка. Мы уже работаем над её исправлением."})]}),e&&!1,a.jsxs("div",{className:"flex space-x-2 w-full",children:[a.jsxs(Ba,{type:"button",variant:"outline",onClick:()=>{window.location.href="/"},className:"flex-1",children:[a.jsx(Ne,{className:"w-4 h-4 mr-2"}),"На главную"]}),a.jsxs(Ba,{type:"button",onClick:s,className:"flex-1 gradient-primary",children:[a.jsx(we,{className:"w-4 h-4 mr-2"}),"Попробовать снова"]})]})]})})}),Ka=Xa,Ga=ge("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Ya({className:e,variant:s,...t}){return a.jsx("div",{className:Bt(Ga({variant:s}),e),...t})}const Qa=t.createContext(void 0),Za=()=>{const e=t.useContext(Qa);if(!e)throw new Error("useNotifications must be used within a NotificationProvider");return e},er=({children:e})=>{const s=t.useCallback((e,s,t={})=>{const{title:a,description:r,duration:n,action:i,onDismiss:l}=t,o={duration:n||("error"===e?5e3:3e3),action:i?{label:i.label,onClick:i.onClick}:void 0,onDismiss:l};switch(e){case"success":_e.success(s,{...o,description:a||r});break;case"error":_e.error(s,{...o,description:a||r});break;case"warning":_e.warning(s,{...o,description:a||r});break;case"info":_e.info(s,{...o,description:a||r});break;case"loading":_e.loading(s,{...o,description:a||r})}},[]),r=t.useCallback((e,t)=>{s("success",e,t)},[s]),n=t.useCallback((e,t)=>{s("error",e,t)},[s]),i=t.useCallback((e,t)=>{s("warning",e,t)},[s]),l=t.useCallback((e,t)=>{s("info",e,t)},[s]),o=t.useCallback((e,t)=>{s("loading",e,t)},[s]),c=t.useCallback(e=>{_e.dismiss(e)},[]),d=t.useCallback(()=>{_e.dismiss()},[]),u={showNotification:s,showSuccess:r,showError:n,showWarning:i,showInfo:l,showLoading:o,dismiss:c,dismissAll:d};return a.jsx(Qa.Provider,{value:u,children:e})},sr=()=>{const{showSuccess:e}=Za();return e},tr=()=>{const{showError:e}=Za();return e},ar=({children:e,showStatusIndicator:s=!0,autoRetry:r=!0,maxRetries:n=3,retryDelay:i=2e3})=>{const[l,o]=t.useState({isOnline:navigator.onLine,retryCount:0}),[c,d]=t.useState(!1),[u,m]=t.useState(!1),{showError:h,showSuccess:x,showWarning:p,showInfo:g}=Za(),f=t.useCallback(async()=>{try{return(await fetch("/api/health/",{method:"HEAD",cache:"no-cache",signal:AbortSignal.timeout(5e3)})).ok}catch(e){return!1}},[]),j=t.useCallback(async()=>{const e=navigator.onLine,s=navigator.connection;o(t=>{const a={isOnline:e,connectionType:null==s?void 0:s.type,effectiveType:null==s?void 0:s.effectiveType,downlink:null==s?void 0:s.downlink,rtt:null==s?void 0:s.rtt,lastSeen:e?new Date:t.lastSeen,retryCount:e?0:t.retryCount};return e||t.isOnline?(!e&&t.isOnline?(m(!0),p("Отсутствует подключение к интернету",{description:"Проверьте подключение к интернету",duration:0})):e&&u&&(m(!1),x("Подключение восстановлено")),a):a})},[u,p,x]),v=t.useCallback(async()=>{if(!c){d(!0);try{await f()?(o(e=>({...e,isOnline:!0,retryCount:0,lastSeen:new Date})),m(!1),x("Подключение восстановлено")):o(e=>{const s=e.retryCount+1;return s>=n?h("Не удается восстановить подключение",{description:"Попробуйте позже или обратитесь в поддержку",action:{label:"Повторить",onClick:()=>{o(e=>({...e,retryCount:0})),v()}}}):(p(`Попытка ${s} из ${n} не удалась`,{description:"Повторяем через несколько секунд..."}),r&&setTimeout(()=>{v()},i*s)),{...e,retryCount:s}})}catch(e){da.handleNetworkError(e,v)}finally{d(!1)}}},[c,f,n,r,i,x,h,p]);t.useEffect(()=>{const e=()=>{j()},s=()=>{j()};return window.addEventListener("online",e),window.addEventListener("offline",s),j(),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[j]),t.useEffect(()=>{const e=navigator.connection;if(!e)return;const s=()=>{j(),"slow-2g"!==e.effectiveType&&"2g"!==e.effectiveType||g("Медленное подключение",{description:"Соединение может работать медленно"})};return e.addEventListener("change",s),()=>{e.removeEventListener("change",s)}},[j,g]);return a.jsxs(a.Fragment,{children:[e,s?l.isOnline?"slow-2g"===l.effectiveType||"2g"===l.effectiveType?a.jsxs(Ya,{variant:"secondary",className:"flex items-center gap-1",children:[a.jsx(Ce,{className:"w-3 h-3"}),"Медленно"]}):a.jsxs(Ya,{variant:"default",className:"flex items-center gap-1",children:[a.jsx(Ce,{className:"w-3 h-3"}),"Онлайн"]}):a.jsxs(Ya,{variant:"destructive",className:"flex items-center gap-1",children:[a.jsx(Se,{className:"w-3 h-3"}),"Офлайн"]}):null,u&&a.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-destructive text-destructive-foreground",children:a.jsx(Fa,{className:"m-4 p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Se,{className:"w-5 h-5"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Отсутствует подключение к интернету"}),a.jsx("p",{className:"text-sm opacity-90",children:"Проверьте подключение к интернету. Некоторые функции могут быть недоступны."})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[l.retryCount>0&&a.jsxs("span",{className:"text-sm opacity-75",children:["Попытка ",l.retryCount," из ",n]}),a.jsxs(Ba,{type:"button",size:"sm",variant:"outline",onClick:v,disabled:c,className:"bg-background text-foreground hover:bg-muted",children:[c?a.jsx(we,{className:"w-4 h-4 animate-spin"}):a.jsx(we,{className:"w-4 h-4"}),"Повторить"]})]})]})})}),l.isOnline&&"slow-2g"===l.effectiveType&&a.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:a.jsx(Fa,{className:"p-3 border-warning",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ke,{className:"w-4 h-4 text-warning-foreground"}),a.jsx("span",{className:"text-sm text-warning-foreground",children:"Медленное подключение"})]})})})]})},rr=t.createContext(void 0),nr=({children:e,enableLogging:s=!0,enableRetry:n=!0,enableNetworkMonitoring:i=!0})=>{const[l,o]=r.useState(navigator.onLine);t.useEffect(()=>{if(s){const e=e=>{var s;ca.logError({level:"error",category:"client",message:e.message,stack:null==(s=e.error)?void 0:s.stack,context:{filename:e.filename,lineno:e.lineno,colno:e.colno}})},s=e=>{var s;ca.logError({level:"error",category:"client",message:`Unhandled Promise Rejection: ${e.reason}`,stack:null==(s=e.reason)?void 0:s.stack,context:{reason:e.reason}})};return window.addEventListener("error",e),window.addEventListener("unhandledrejection",s),()=>{window.removeEventListener("error",e),window.removeEventListener("unhandledrejection",s)}}},[s]),t.useEffect(()=>{window.__wsMessages=window.__wsMessages||[]},[]),t.useEffect(()=>{if(!i)return;const e=()=>o(!0),s=()=>o(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[i]);const c={reportError:t.useCallback((e,t)=>{s&&ca.logError({level:"error",category:"client",message:e.message,stack:e.stack,context:t}),da.handleError(e,t)},[s]),getErrorStats:t.useCallback(()=>({errorStats:s?ca.getErrorAnalytics():null,retryStats:n?ua.getStats():null,isOnline:l}),[s,n,l]),resetErrorStats:t.useCallback(()=>{s&&ca.clearLogs(),n&&ua.resetCircuitBreaker()},[s,n]),isOnline:l,retryStats:n?ua.getStats():null};return a.jsx(rr.Provider,{value:c,children:a.jsx(er,{children:a.jsx(Ka,{children:i?a.jsx(ar,{showStatusIndicator:!1,children:e}):e})})})},ir=()=>{const{reportError:e}=(()=>{const e=t.useContext(rr);if(!e)throw new Error("useErrorHandling must be used within an ErrorHandlingProvider");return e})();return{reportError:(s,t)=>{la.error("Error reported:",s,t),e(s,t)},reportNetworkError:(e,s)=>{ca.logNetworkError(e,s),da.handleNetworkError(e)},reportAuthError:(e,s)=>{ca.logAuthError(e,s),da.handleAuthError(e)},reportValidationError:(e,s)=>{ca.logValidationError(e,s),da.handleValidationError(e)},reportServerError:(e,s)=>{ca.logServerError(e,s),da.handleServerError(e)}}},lr=({size:e="md",text:s="Загрузка..."})=>a.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[a.jsx(Ee,{className:`${{sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"}[e]} animate-spin`}),s&&a.jsx("p",{className:"text-sm text-muted-foreground",children:s})]}),or=({children:e})=>{const{user:s,isLoading:t}=qa();if(t)return a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})});if(!s)return a.jsx(mt,{to:"/auth",replace:!0});if(!s.is_staff){const e={student:"/dashboard/student",teacher:"/dashboard/teacher",tutor:"/dashboard/tutor",parent:"/dashboard/parent"};return a.jsx(mt,{to:e[s.role]||"/",replace:!0})}return a.jsx(a.Fragment,{children:e})};let cr=null,dr=null;async function ur(){if(!("serviceWorker"in navigator))return console.warn("Service Workers are not supported in this browser"),!1;try{const e=await navigator.serviceWorker.register("/service-worker.js",{scope:"/"});return e.addEventListener("updatefound",()=>{!function(e){const s=e.installing;if(!s)return;s.addEventListener("statechange",()=>{if("installed"===s.state&&navigator.serviceWorker.controller&&(dr&&dr(!0),"serviceWorker"in navigator&&"SyncManager"in window))try{e.sync.register("sync-messages")}catch{console.warn("Background sync not available")}})}(e)}),setInterval(()=>{e.update().catch(e=>{console.error("Failed to check for service worker updates:",e)})},36e5),cr=e,!0}catch(e){return console.error("Service Worker registration failed:",e),!1}}async function mr(){if("serviceWorker"in navigator&&navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({type:"CLEAR_CACHE"}),"caches"in window)try{const e=await caches.keys();return await Promise.all(e.map(e=>caches.delete(e))),!0}catch(e){return console.error("Failed to clear caches:",e),!1}return!1}async function hr(){if(navigator.onLine)try{if("serviceWorker"in navigator&&"SyncManager"in window){const e=await navigator.serviceWorker.ready;await e.sync.register("sync-messages")}}catch(e){console.warn("Failed to register message sync:",e)}}async function xr(){if(!("caches"in window))return{totalCaches:0,totalSize:0,caches:[]};try{const e=await caches.keys(),s=[];let t=0;for(const a of e){const e=await caches.open(a),r=await e.keys();let n=0;for(const s of r){const t=await e.match(s);if(t){n+=(await t.blob()).size}}t+=n,s.push({name:a,entryCount:r.length})}return{totalCaches:e.length,totalSize:t,caches:s}}catch(e){return console.error("Failed to get cache stats:",e),{totalCaches:0,totalSize:0,caches:[]}}}function pr(e={}){const{autoRegister:s=!0,precacheUrls:a=[],onUpdateAvailable:r,onOnlineStatusChange:n}=e,[i,l]=t.useState({isSupported:"undefined"!=typeof navigator&&"serviceWorker"in navigator,isRegistered:!1,isOnline:"undefined"==typeof navigator||navigator.onLine,updateAvailable:!1,isUpdating:!1,cacheSize:0,error:null});t.useEffect(()=>{if(!s||!i.isSupported)return;let e=!0;return async function(){try{const s=await ur();if(e){l(e=>({...e,isRegistered:s,error:null})),s&&a.length>0&&await async function(e){if("caches"in window)try{const t=await caches.open("app-shell-v1"),a=[];for(const r of e)try{const e=await fetch(r);e.ok?await t.put(r,e):a.push(r)}catch(s){a.push(r),console.warn(`Failed to precache: ${r}`,s)}0===a.length?e.length:console.warn(`Precached ${e.length-a.length}/${e.length} assets`)}catch(s){console.error("Failed to precache assets:",s)}else console.warn("Caches API not available")}(a);const t=await xr();e&&l(e=>({...e,cacheSize:t.totalSize}))}}catch(s){e&&l(e=>({...e,error:s instanceof Error?s:new Error("Unknown error")}))}}(),()=>{e=!1}},[s,i.isSupported,a.length]),t.useEffect(()=>{if(!i.isSupported)return;const e=(dr=e=>{l(s=>({...s,updateAvailable:e})),e&&r&&r()},()=>{dr=null});return()=>{e()}},[i.isSupported,r]),t.useEffect(()=>{const e=function(e){const s=()=>e(!0),t=()=>e(!1);return window.addEventListener("online",s),window.addEventListener("offline",t),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",t)}}(e=>{l(s=>({...s,isOnline:e})),n&&n(e),e&&hr().catch(e=>{console.error("Failed to sync messages:",e)})});return()=>{e()}},[n]);const o=t.useCallback(async()=>{l(e=>({...e,isUpdating:!0}));try{!function(){if(!(null==cr?void 0:cr.installing))return void console.warn("No pending service worker update to install");cr.installing.postMessage({type:"SKIP_WAITING"});let e=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{e||(e=!0,window.location.reload())})}(),await new Promise(e=>setTimeout(e,2e3))}catch(e){l(s=>({...s,isUpdating:!1,error:e instanceof Error?e:new Error("Failed to install update")}))}},[]),c=t.useCallback(async()=>{try{return await mr(),l(e=>({...e,cacheSize:0,error:null})),!0}catch(e){return l(s=>({...s,error:e instanceof Error?e:new Error("Failed to clear cache")})),!1}},[]),d=t.useCallback(async()=>{try{return await mr(),await async function(){if(!("serviceWorker"in navigator))return!1;try{const e=await navigator.serviceWorker.getRegistrations();for(const s of e)await s.unregister();return cr=null,!0}catch(e){return console.error("Failed to unregister service worker:",e),!1}}(),l(e=>({...e,isRegistered:!1,error:null})),!0}catch(e){return l(s=>({...s,error:e instanceof Error?e:new Error("Failed to unregister")})),!1}},[]),u=t.useCallback(async()=>{try{const e=await async function(){if(!cr)return{updateAvailable:!1};try{const e=(await navigator.serviceWorker.getRegistrations())[0];return e?(await e.update(),e.installing?{updateAvailable:!0,installingWorker:e.installing}:{updateAvailable:!1}):{updateAvailable:!1}}catch(e){return console.error("Failed to check for updates:",e),{updateAvailable:!1}}}();return l(s=>({...s,updateAvailable:e.updateAvailable,error:null})),e.updateAvailable}catch(e){return l(s=>({...s,error:e instanceof Error?e:new Error("Failed to check for updates")})),!1}},[]),m=t.useCallback(async()=>{try{const e=await xr();return l(s=>({...s,cacheSize:e.totalSize,error:null})),e}catch(e){return l(s=>({...s,error:e instanceof Error?e:new Error("Failed to get cache stats")})),null}},[]);return{...i,installUpdate:o,clearCache:c,unregister:d,checkForUpdates:u,refreshCacheStats:m}}const gr=S,fr=v,jr=t.forwardRef(({className:e,...s},t)=>a.jsx(j,{className:Bt("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:t}));jr.displayName=j.displayName;const vr=t.forwardRef(({className:e,...s},t)=>a.jsxs(fr,{children:[a.jsx(jr,{}),a.jsx(y,{ref:t,className:Bt("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));vr.displayName=y.displayName;const yr=({className:e,...s})=>a.jsx("div",{className:Bt("flex flex-col space-y-2 text-center sm:text-left",e),...s});yr.displayName="AlertDialogHeader";const br=({className:e,...s})=>a.jsx("div",{className:Bt("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});br.displayName="AlertDialogFooter";const Nr=t.forwardRef(({className:e,...s},t)=>a.jsx(b,{ref:t,className:Bt("text-lg font-semibold",e),...s}));Nr.displayName=b.displayName;const wr=t.forwardRef(({className:e,...s},t)=>a.jsx(N,{ref:t,className:Bt("text-sm text-muted-foreground",e),...s}));wr.displayName=N.displayName;const _r=t.forwardRef(({className:e,...s},t)=>a.jsx(w,{ref:t,className:Bt(Ha(),e),...s}));_r.displayName=w.displayName;const Sr=t.forwardRef(({className:e,...s},t)=>a.jsx(_,{ref:t,className:Bt(Ha({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));Sr.displayName=_.displayName;const kr=({autoShow:e=!0})=>{const{showUpdatePrompt:s,handleUpdate:r,handleDismiss:n}=function(){const[e,s]=t.useState(!1),{updateAvailable:a,installUpdate:r}=pr({onUpdateAvailable:()=>{s(!0)}});return{showUpdatePrompt:e,updateAvailable:a,handleUpdate:t.useCallback(async()=>{s(!1),await r()},[r]),handleDismiss:t.useCallback(()=>{s(!1)},[])}}();return a.jsx(gr,{open:e&&s,onOpenChange:n,children:a.jsxs(vr,{className:"max-w-md",children:[a.jsxs(yr,{className:"flex flex-row items-start gap-3",children:[a.jsx(be,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx(Nr,{children:"New Version Available"}),a.jsx(wr,{className:"mt-2",children:"A new version of THE BOT is ready. Update now to get the latest features and improvements."})]})]}),a.jsxs(br,{children:[a.jsx(Sr,{onClick:n,children:"Dismiss"}),a.jsxs(_r,{onClick:r,className:"bg-blue-600 hover:bg-blue-700",children:[a.jsx(Te,{className:"mr-2 h-4 w-4"}),"Update Now"]})]})]})})};let Cr=null,Er=null;class Tr{constructor(){s(this,"pendingRequests",new Map)}getOrCreate(e,s){const t=this.pendingRequests.get(e);if(t)return la.debug("[RequestDeduplicator] Reusing pending request:",{key:e}),t;const a=s().finally(()=>{this.pendingRequests.delete(e)});return this.pendingRequests.set(e,a),a}clear(){this.pendingRequests.clear(),la.debug("[RequestDeduplicator] Cleared all pending requests")}getPendingCount(){return this.pendingRequests.size}}class Rr{constructor(){s(this,"csrfToken",null),s(this,"lastRefreshTime",0),s(this,"REFRESH_INTERVAL",36e5)}getToken(){return this.shouldRefreshToken()&&(this.csrfToken=this.extractTokenFromDOM(),this.lastRefreshTime=Date.now()),this.csrfToken||(this.csrfToken=this.extractTokenFromDOM()),this.csrfToken}setToken(e){this.csrfToken=e,this.lastRefreshTime=Date.now(),la.debug("[CsrfTokenManager] Token set manually")}extractTokenFromDOM(){if("undefined"==typeof document)return null;const e=document.querySelector('meta[name="csrf-token"]');if(e){const s=e.getAttribute("content");if(s)return la.debug("[CsrfTokenManager] Extracted token from meta tag"),s}const s=this.extractTokenFromCookie();return s?(la.debug("[CsrfTokenManager] Extracted token from cookie"),s):(la.warn("[CsrfTokenManager] No CSRF token found"),null)}extractTokenFromCookie(){if("undefined"==typeof document)return null;const e=document.cookie.split(";");for(const s of e){const[e,t]=s.trim().split("=");if("csrftoken"===e||"XSRF-TOKEN"===e)return decodeURIComponent(t)}return null}shouldRefreshToken(){return Date.now()-this.lastRefreshTime>this.REFRESH_INTERVAL}clear(){this.csrfToken=null,la.debug("[CsrfTokenManager] Token cleared")}}const Ar=(()=>{if("undefined"!=typeof window){return`${"https:"===window.location.protocol?"https:":"http:"}//${window.location.host}/api`}return"http://localhost:8003/api"})();new class{constructor(e){var t,a;s(this,"config"),s(this,"deduplicator"),s(this,"csrfTokenManager"),s(this,"requestInterceptors",[]),s(this,"responseInterceptors",[]),s(this,"activeRequests",new Map),this.config={timeout:3e4,...e},this.deduplicator=new Tr,this.csrfTokenManager=new Rr,this.registerBuiltInInterceptors(),(null==(t=e.interceptors)?void 0:t.request)&&this.requestInterceptors.push(...e.interceptors.request),(null==(a=e.interceptors)?void 0:a.response)&&this.responseInterceptors.push(...e.interceptors.response),la.info("[ApiClient] Initialized with config:",{baseURL:this.config.baseURL,timeout:this.config.timeout,debugMode:this.config.debugMode})}registerBuiltInInterceptors(){this.requestInterceptors.unshift(async e=>{const s=ba.getToken();if(s&&(e.headers={...e.headers,Authorization:`Token ${s}`},this.config.debugMode&&la.debug("[ApiClient] Added authorization token to request")),["POST","PUT","PATCH","DELETE"].includes(e.method)){const s=this.csrfTokenManager.getToken();s&&(e.headers={...e.headers,"X-CSRFToken":s},this.config.debugMode&&la.debug("[ApiClient] Added CSRF token to request"))}return e.headers={"Content-Type":"application/json",Accept:"application/json",...e.headers},e}),this.responseInterceptors.unshift(async e=>{if(401===e.status){la.warn("[ApiClient] Received 401 Unauthorized, attempting token refresh...");try{if(Cr&&Cr.refreshTokenIfNeeded){if(await Cr.refreshTokenIfNeeded())return la.debug("[ApiClient] Token refreshed successfully after 401"),e}}catch(s){la.error("[ApiClient] Token refresh failed after 401:",s)}la.warn("[ApiClient] Redirecting to login due to 401 with failed refresh"),Er&&Er("/login")}return e})}useRequestInterceptor(e){this.requestInterceptors.push(e)}useResponseInterceptor(e){this.responseInterceptors.push(e)}async executeRequestInterceptors(e){let s={...e};for(const t of this.requestInterceptors)s=await t(s);return s}async executeResponseInterceptors(e){let s={...e};for(const t of this.responseInterceptors)s=await t(s);return s}async request(e){var s,t;const a=Date.now(),r=this.generateRequestId();try{e=await this.executeRequestInterceptors(e);const n=this.buildUrl(e.url,e.params),i=this.generateDedupeKey(e.method,n);if(this.config.debugMode&&la.debug("[ApiClient] Making request:",{requestId:r,method:e.method,url:n,timeout:e.timeout||this.config.timeout,dedupeKey:i}),"GET"===e.method&&(null==(s=e.cache)?void 0:s.enabled)){const s=fa.get(e.cache.key||i);if(s)return this.config.debugMode&&la.debug("[ApiClient] Cache hit for request:",{requestId:r,dedupeKey:i}),{status:200,statusText:"OK (from cache)",headers:{"X-Cache":"HIT"},data:s,timestamp:a,duration:Date.now()-a}}const l=await this.deduplicator.getOrCreate(i,async()=>this.performRequest(e,r));"GET"===e.method&&(null==(t=e.cache)?void 0:t.enabled)&&l.status<400&&(fa.set(e.cache.key||i,l.data,e.cache.ttl),this.config.debugMode&&la.debug("[ApiClient] Cached response:",{requestId:r,dedupeKey:i,ttl:e.cache.ttl}));const o=await this.executeResponseInterceptors(l);return this.config.debugMode&&la.debug("[ApiClient] Request completed:",{requestId:r,status:o.status,duration:o.duration}),o}catch(n){const e=Date.now()-a,s=this.normalizeError(n,{requestId:r,duration:e});throw this.config.debugMode&&la.error("[ApiClient] Request failed:",{requestId:r,error:s.message,status:s.status,duration:e}),s}}async performRequest(e,s){return e.skipRetry?this.executeRequest(e,s):ua.retryApiCall(()=>this.executeRequest(e,s),`API Request ${s}`)}async executeRequest(e,s){const t=Date.now(),a=new AbortController,r=e.timeout||this.config.timeout,n=setTimeout(()=>{a.abort(),this.config.debugMode&&la.warn("[ApiClient] Request timeout:",{requestId:s,timeout:r})},r);this.activeRequests.set(s,a);try{const r=this.buildUrl(e.url,e.params),i=e.signal||a.signal,l=await fetch(r,{method:e.method,headers:e.headers,body:e.data?JSON.stringify(e.data):void 0,signal:i,credentials:"include"});clearTimeout(n);const o=await this.parseResponse(l),c=Date.now()-t;if(!l.ok){const e=new Error((null==o?void 0:o.message)||(null==o?void 0:o.error)||l.statusText);throw e.status=l.status,e.statusText=l.statusText,e.data=o,this.config.debugMode&&la.warn("[ApiClient] Error response received:",{requestId:s,status:l.status,statusText:l.statusText}),e}return this.config.debugMode&&la.debug("[ApiClient] Response received:",{requestId:s,status:l.status,size:JSON.stringify(o).length}),{status:l.status,statusText:l.statusText,headers:this.extractHeaders(l),data:o,timestamp:t,duration:c}}catch(i){if(clearTimeout(n),this.activeRequests.delete(s),i instanceof DOMException&&"AbortError"===i.name){const e=new Error(`Request timeout after ${r}ms`);throw e.name="TimeoutError",e}throw i}finally{clearTimeout(n),this.activeRequests.delete(s)}}async parseResponse(e){const s=e.headers.get("content-type");if(!s||!s.includes("application/json"))return e.text();try{return await e.json()}catch(t){throw la.error("[ApiClient] Failed to parse JSON response:",t),new Error("Invalid JSON response from server")}}extractHeaders(e){const s={};return e.headers.forEach((e,t)=>{s[t]=e}),s}buildUrl(e,s){const t=new URL(e.startsWith("http")?e:this.config.baseURL+e);return s&&Object.entries(s).forEach(([e,s])=>{null!=s&&(Array.isArray(s)?s.forEach(s=>t.searchParams.append(e,String(s))):t.searchParams.append(e,String(s)))}),t.toString()}generateRequestId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateDedupeKey(e,s){return`${e}:${s}`}normalizeError(e,s){const t=new Error((null==e?void 0:e.message)||"An unknown error occurred");t.status=null==e?void 0:e.status,t.statusText=null==e?void 0:e.statusText,t.data=null==e?void 0:e.data,t.originalError=e,(null==s?void 0:s.requestId)&&la.error("[ApiClient] Error in request:",{requestId:s.requestId,message:t.message,status:t.status,duration:s.duration});try{da.handleError(t,{operation:"api_request",component:"ApiClient"})}catch(a){la.warn("[ApiClient] Failed to report error:",a)}return t}cancelRequest(e){const s=this.activeRequests.get(e);s&&(s.abort(),this.activeRequests.delete(e),la.debug("[ApiClient] Request cancelled:",{requestId:e}))}cancelAllRequests(){this.activeRequests.forEach(e=>e.abort()),this.activeRequests.clear(),la.debug("[ApiClient] All requests cancelled")}invalidateCache(e){var s;e?la.debug("[ApiClient] Cache invalidated with pattern:",{pattern:e}):(null==(s=fa.clear)||s.call(fa),la.debug("[ApiClient] All cache cleared"))}setCsrfToken(e){this.csrfTokenManager.setToken(e)}getCsrfToken(){return this.csrfTokenManager.getToken()}getStats(){return{pendingRequests:this.deduplicator.getPendingCount(),activeAbortControllers:this.activeRequests.size}}get(e,s){return this.request({method:"GET",url:e,cache:{enabled:!0,ttl:3e5},...s})}post(e,s,t){return this.request({method:"POST",url:e,data:s,...t})}put(e,s,t){return this.request({method:"PUT",url:e,data:s,...t})}patch(e,s,t){return this.request({method:"PATCH",url:e,data:s,...t})}delete(e,s){return this.request({method:"DELETE",url:e,...s})}head(e,s){return this.request({method:"HEAD",url:e,...s})}}({baseURL:Ar,timeout:3e4,debugMode:!1,retryConfig:{maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffMultiplier:2}});const Pr=t.forwardRef(({className:e,type:s,...t},r)=>a.jsx("input",{type:s,className:Bt("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...t}));Pr.displayName="Input";const Lr=t.forwardRef(({className:e,orientation:s="horizontal",decorative:t=!0,...r},n)=>a.jsx(k,{ref:n,decorative:t,orientation:s,className:Bt("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...r}));Lr.displayName=k.displayName;const qr=L,Ir=E,zr=t.forwardRef(({className:e,...s},t)=>a.jsx(C,{className:Bt("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:t}));zr.displayName=C.displayName;const Dr=ge("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Or=t.forwardRef(({side:e="right",className:s,children:t,...r},n)=>a.jsxs(Ir,{children:[a.jsx(zr,{}),a.jsxs(T,{ref:n,className:Bt(Dr({side:e}),s),...r,children:[t,a.jsxs(R,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[a.jsx(fe,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Or.displayName=T.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(A,{ref:t,className:Bt("text-lg font-semibold text-foreground",e),...s})).displayName=A.displayName;function Fr({className:e,...s}){return a.jsx("div",{className:Bt("animate-pulse rounded-md bg-muted",e),...s})}t.forwardRef(({className:e,...s},t)=>a.jsx(P,{ref:t,className:Bt("text-sm text-muted-foreground",e),...s})).displayName=P.displayName;const Mr=t.createContext(null);function $r(){const e=t.useContext(Mr);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const Ur=t.forwardRef(({defaultOpen:e=!0,open:s,onOpenChange:r,className:n,style:i,children:l,...o},c)=>{const d=function(){const[e,s]=t.useState(void 0);return t.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),t=()=>{s(window.innerWidth<768)};return e.addEventListener("change",t),s(window.innerWidth<768),()=>e.removeEventListener("change",t)},[]),!!e}(),[u,m]=t.useState(!1),[h,x]=t.useState(e),p=null!=s?s:h,g=t.useCallback(e=>{const s="function"==typeof e?e(p):e;r?r(s):x(s),document.cookie=`sidebar:state=${s}; path=/; max-age=604800`},[r,p]),f=t.useCallback(()=>d?m(e=>!e):g(e=>!e),[d,g,m]);t.useEffect(()=>{const e=e=>{"b"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),f())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f]);const j=p?"expanded":"collapsed",v=t.useMemo(()=>({state:j,open:p,setOpen:g,isMobile:d,openMobile:u,setOpenMobile:m,toggleSidebar:f}),[j,p,g,d,u,m,f]);return a.jsx(Mr.Provider,{value:v,children:a.jsx(ta,{delayDuration:0,children:a.jsx("div",{style:{"--sidebar-width":"16rem","--sidebar-width-icon":"3rem",...i},className:Bt("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:c,...o,children:l})})})});Ur.displayName="SidebarProvider";const Vr=t.forwardRef(({side:e="left",variant:s="sidebar",collapsible:t="offcanvas",className:r,children:n,...i},l)=>{const{isMobile:o,state:c,openMobile:d,setOpenMobile:u}=$r();return"none"===t?a.jsx("div",{className:Bt("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",r),ref:l,...i,children:n}):o?a.jsx(qr,{open:d,onOpenChange:u,...i,children:a.jsx(Or,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":"18rem"},side:e,children:a.jsx("div",{className:"flex h-full w-full flex-col",children:n})})}):a.jsxs("div",{ref:l,className:"group peer hidden text-sidebar-foreground md:block","data-state":c,"data-collapsible":"collapsed"===c?t:"","data-variant":s,"data-side":e,children:[a.jsx("div",{className:Bt("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180","floating"===s||"inset"===s?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),a.jsx("div",{className:Bt("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex","left"===e?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]","floating"===s||"inset"===s?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",r),...i,children:a.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:n})})]})});Vr.displayName="Sidebar";const Wr=t.forwardRef(({className:e,onClick:s,...t},r)=>{const{toggleSidebar:n}=$r();return a.jsxs(Ba,{type:"button",ref:r,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:Bt("h-7 w-7",e),onClick:e=>{null==s||s(e),n()},...t,children:[a.jsx(Re,{}),a.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});Wr.displayName="SidebarTrigger";t.forwardRef(({className:e,...s},t)=>{const{toggleSidebar:r}=$r();return a.jsx("button",{ref:t,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:r,title:"Toggle Sidebar",className:Bt("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...s})}).displayName="SidebarRail";const Hr=t.forwardRef(({className:e,...s},t)=>a.jsx("main",{ref:t,className:Bt("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...s}));Hr.displayName="SidebarInset";t.forwardRef(({className:e,...s},t)=>a.jsx(Pr,{ref:t,"data-sidebar":"input",className:Bt("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...s})).displayName="SidebarInput";t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,"data-sidebar":"header",className:Bt("flex flex-col gap-2 p-2",e),...s})).displayName="SidebarHeader";const Br=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,"data-sidebar":"footer",className:Bt("flex flex-col gap-2 p-2",e),...s}));Br.displayName="SidebarFooter";t.forwardRef(({className:e,...s},t)=>a.jsx(Lr,{ref:t,"data-sidebar":"separator",className:Bt("mx-2 w-auto bg-sidebar-border",e),...s})).displayName="SidebarSeparator";const Xr=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,"data-sidebar":"content",className:Bt("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...s}));Xr.displayName="SidebarContent";const Jr=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,"data-sidebar":"group",className:Bt("relative flex w-full min-w-0 flex-col p-2",e),...s}));Jr.displayName="SidebarGroup";const Kr=t.forwardRef(({className:e,asChild:s=!1,...t},r)=>{const n=s?f:"div";return a.jsx(n,{ref:r,"data-sidebar":"group-label",className:Bt("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...t})});Kr.displayName="SidebarGroupLabel";t.forwardRef(({className:e,asChild:s=!1,...t},r)=>{const n=s?f:"button";return a.jsx(n,{ref:r,"data-sidebar":"group-action",className:Bt("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...t})}).displayName="SidebarGroupAction";const Gr=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,"data-sidebar":"group-content",className:Bt("w-full text-sm",e),...s}));Gr.displayName="SidebarGroupContent";const Yr=t.forwardRef(({className:e,...s},t)=>a.jsx("ul",{ref:t,"data-sidebar":"menu",className:Bt("flex w-full min-w-0 flex-col gap-1",e),...s}));Yr.displayName="SidebarMenu";const Qr=t.forwardRef(({className:e,...s},t)=>a.jsx("li",{ref:t,"data-sidebar":"menu-item",className:Bt("group/menu-item relative",e),...s}));Qr.displayName="SidebarMenuItem";const Zr=ge("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),en=t.forwardRef(({asChild:e=!1,isActive:s=!1,variant:t="default",size:r="default",tooltip:n,className:i,...l},o)=>{const c=e?f:"button",{isMobile:d,state:u}=$r(),m=a.jsx(c,{ref:o,"data-sidebar":"menu-button","data-size":r,"data-active":s,className:Bt(Zr({variant:t,size:r}),i),...l});return n?("string"==typeof n&&(n={children:n}),a.jsxs(aa,{children:[a.jsx(ra,{asChild:!0,children:m}),a.jsx(na,{side:"right",align:"center",hidden:"collapsed"!==u||d,...n})]})):m});en.displayName="SidebarMenuButton";t.forwardRef(({className:e,asChild:s=!1,showOnHover:t=!1,...r},n)=>{const i=s?f:"button";return a.jsx(i,{ref:n,"data-sidebar":"menu-action",className:Bt("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",t&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...r})}).displayName="SidebarMenuAction";t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,"data-sidebar":"menu-badge",className:Bt("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...s})).displayName="SidebarMenuBadge";t.forwardRef(({className:e,showIcon:s=!1,...r},n)=>{const i=t.useMemo(()=>`${Math.floor(40*Math.random())+50}%`,[]);return a.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:Bt("flex h-8 items-center gap-2 rounded-md px-2",e),...r,children:[s&&a.jsx(Fr,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),a.jsx(Fr,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":i}})]})}).displayName="SidebarMenuSkeleton";t.forwardRef(({className:e,...s},t)=>a.jsx("ul",{ref:t,"data-sidebar":"menu-sub",className:Bt("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...s})).displayName="SidebarMenuSub";t.forwardRef(({...e},s)=>a.jsx("li",{ref:s,...e})).displayName="SidebarMenuSubItem";t.forwardRef(({asChild:e=!1,size:s="md",isActive:t,className:r,...n},i)=>{const l=e?f:"a";return a.jsx(l,{ref:i,"data-sidebar":"menu-sub-button","data-size":s,"data-active":t,className:Bt("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground","sm"===s&&"text-xs","md"===s&&"text-sm","group-data-[collapsible=icon]:hidden",r),...n})}).displayName="SidebarMenuSubButton";const sn=["Мониторинг системы","Рассылки","Шаблоны уведомлений","Аналитика уведомлений","Параметры системы"],tn=[{title:"Мониторинг системы",url:"/admin/monitoring",icon:Ae,description:"Состояние системы и метрики"},{title:"Управление аккаунтами",url:"/admin/accounts",icon:Pe,description:"Управление пользователями системы"},{title:"Расписание",url:"/admin/schedule",icon:Le,description:"Календарь всех занятий"},{title:"Все чаты",url:"/admin/chats",icon:qe,description:"Все чаты в системе"},{title:"Рассылки",url:"/admin/broadcasts",icon:Ie,description:"Управление рассылками"},{title:"Шаблоны уведомлений",url:"/admin/notification-templates",icon:ze,description:"Управление шаблонами уведомлений"},{title:"Аналитика уведомлений",url:"/admin/notifications",icon:De,description:"Аналитика доставки и метрики уведомлений"},{title:"Параметры системы",url:"/admin/settings",icon:Oe,description:"Управление параметрами платформы"}];function an(){const{state:e}=$r(),{logout:s}=qa();return a.jsxs(Vr,{collapsible:"icon",children:[a.jsx(Xr,{children:a.jsxs(Jr,{children:[a.jsx(Kr,{children:"Администратор"}),a.jsx(Gr,{children:a.jsx(Yr,{children:tn.filter(e=>!sn.includes(e.title)).map(s=>a.jsx(Qr,{children:a.jsx(en,{asChild:!0,tooltip:s.description,children:a.jsxs(ht,{to:s.url,className:({isActive:e})=>e?"bg-sidebar-accent text-sidebar-accent-foreground":"",children:[a.jsx(s.icon,{className:"h-4 w-4"}),"expanded"===e&&a.jsx("span",{children:s.title})]})})},s.title))})})]})}),a.jsx(Br,{children:a.jsx(Yr,{children:a.jsx(Qr,{children:a.jsxs(Ba,{type:"button",variant:"ghost",className:"w-full justify-start text-red-600 hover:text-red-700 hover:bg-red-50",onClick:async()=>{try{await s(),_e.success("Вы вышли из системы")}catch(e){la.error("AdminSidebar logout error:",e),_e.error("Ошибка при выходе")}},children:[a.jsx(Fe,{className:"h-4 w-4 mr-2"}),"expanded"===e&&a.jsx("span",{children:"Выход"})]})})})})]})}const rn=()=>{const e=qa(),s=xt();return{user:e.user,loading:e.isLoading,signOut:async()=>{await e.logout(),s("/auth")}}};function nn(){const e=xt(),{user:s,isLoading:r}=rn();return t.useEffect(()=>{r||!s||s.is_staff||e("/403")},[s,r,e]),r?a.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):s&&s.is_staff?a.jsx(Ur,{children:a.jsxs("div",{className:"flex h-screen w-full",children:[a.jsx(an,{}),a.jsxs(Hr,{className:"flex-1",children:[a.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4 sticky top-0 bg-background z-10",children:[a.jsx(Wr,{className:"-ml-1"}),a.jsx("div",{className:"flex-1",children:a.jsx("h1",{className:"text-xl font-semibold",children:"Панель администратора"})})]}),a.jsx("main",{className:"flex-1 overflow-auto",children:a.jsx(pt,{})})]})]})}):null}const ln={updateUser:async(e,s)=>Sa.request(`/auth/users/${e}/`,{method:"PATCH",body:JSON.stringify(s)}),updateStudentProfile:async(e,s)=>Sa.request(`/auth/students/${e}/profile/`,{method:"PATCH",body:JSON.stringify(s)}),updateTeacherProfile:async(e,s)=>Sa.request(`/auth/teachers/${e}/profile/`,{method:"PATCH",body:JSON.stringify(s)}),updateTutorProfile:async(e,s)=>Sa.request(`/auth/tutors/${e}/profile/`,{method:"PATCH",body:JSON.stringify(s)}),updateParentProfile:async(e,s)=>Sa.request(`/auth/parents/${e}/profile/`,{method:"PATCH",body:JSON.stringify(s)}),resetPassword:async e=>Sa.request(`/auth/users/${e}/reset-password/`,{method:"POST"}),deleteUser:async(e,s=!1)=>Sa.request(`/auth/users/${e}/delete/`,{method:"DELETE",body:JSON.stringify({permanent:s})}),createUser:async e=>Sa.request("/auth/users/create/",{method:"POST",body:JSON.stringify(e)}),async getTutors(){var e;const s=await Sa.request("/auth/staff/?role=tutor");return(null==(e=s.data)?void 0:e.results)?{...s,data:s.data.results}:Array.isArray(s.data)?s:{...s,data:[]}},async getParents(){const e=await Sa.request("/auth/parents/");return e.data&&!Array.isArray(e.data)&&"results"in e.data?{...e,data:e.data.results}:Array.isArray(e.data)?e:{...e,data:[]}},async getStudents(e){const s=new URLSearchParams;e&&(e.grade&&s.append("grade",e.grade),e.tutor_id&&s.append("tutor_id",e.tutor_id.toString()),e.search&&s.append("search",e.search),null!==e.is_active&&void 0!==e.is_active&&s.append("is_active",e.is_active.toString()),e.ordering&&s.append("ordering",e.ordering),e.page&&s.append("page",e.page.toString()),e.page_size&&s.append("page_size",e.page_size.toString()));const t=s.toString(),a="/auth/students/"+(t?"?"+t:"");return Sa.request(a)},createStudent:async e=>Sa.request("/auth/students/create/",{method:"POST",body:JSON.stringify(e)}),editTeacher:async(e,s)=>Sa.request(`/auth/teachers/${e}/`,{method:"PATCH",body:JSON.stringify(s)}),assignStudentsToTeacher:async(e,s)=>Sa.request(`/auth/teachers/${e}/assign-students/`,{method:"POST",body:JSON.stringify(s)}),editTutor:async(e,s)=>Sa.request(`/auth/tutors/${e}/`,{method:"PATCH",body:JSON.stringify(s)}),reactivateUser:async e=>Sa.request(`/auth/users/${e}/reactivate/`,{method:"POST"}),createParent:async e=>Sa.request("/auth/parents/create/",{method:"POST",body:JSON.stringify(e)}),listParents:async()=>Sa.request("/auth/parents/"),assignParentToStudents:async(e,s)=>Sa.request("/auth/assign-parent/",{method:"POST",body:JSON.stringify({parent_id:e,student_ids:s})}),async getSchedule(e){var s,t,a;const r=new URLSearchParams;e&&Object.entries(e).forEach(([e,s])=>{void 0!==s&&r.append(e,s)});const n="/admin/schedule/lessons/"+(r.toString()?"?"+r.toString():""),i=await Sa.request(n);return i.data?{...i,data:{success:null!=(s=i.data.success)&&s,count:null!=(t=i.data.count)?t:0,lessons:null!=(a=i.data.results)?a:[]}}:{...i,data:{success:!1,count:0,lessons:[]}}},getScheduleStats:async()=>Sa.request("/admin/schedule/stats/"),getScheduleFilters:async()=>Sa.request("/admin/schedule/filters/"),getChatRooms:async()=>Sa.request("/chat/admin/rooms/"),getChatRoomDetail:async e=>Sa.request(`/chat/admin/rooms/${e}/`),async getChatMessages(e,s){const t=new URLSearchParams;void 0!==(null==s?void 0:s.limit)&&t.append("limit",s.limit.toString()),void 0!==(null==s?void 0:s.offset)&&t.append("offset",s.offset.toString());const a=`/chat/admin/rooms/${e}/messages/${t.toString()?"?"+t.toString():""}`;return Sa.request(a)},getChatStats:async()=>Sa.request("/chat/admin/stats/"),getUserStats:async()=>Sa.request("/admin/stats/users/"),async getBroadcasts(e){const s=new URLSearchParams;e&&(e.status&&s.append("status",e.status),e.date_from&&s.append("date_from",e.date_from),e.date_to&&s.append("date_to",e.date_to),e.page&&s.append("page",e.page.toString()),e.page_size&&s.append("page_size",e.page_size.toString()));const t="/admin/broadcasts/"+(s.toString()?"?"+s.toString():"");return Sa.request(t)},getBroadcast:async e=>Sa.request(`/admin/broadcasts/${e}/`),getBroadcastRecipients:async e=>Sa.request(`/admin/broadcasts/${e}/recipients/`),createBroadcast:async e=>Sa.request("/admin/broadcasts/create/",{method:"POST",body:JSON.stringify(e)}),previewBroadcast:async e=>Sa.request("/admin/broadcasts/preview/",{method:"POST",body:JSON.stringify(e)}),getAuditLogs:async e=>Promise.reject(new Error("Audit logs endpoint not implemented in backend")),getAuditLogDetail:async e=>Promise.reject(new Error(`Audit logs endpoint not implemented in backend (logId: ${e})`)),getAuditLogStats:async()=>Promise.reject(new Error("Audit logs endpoint not implemented in backend")),async getUsers(e){const s=new URLSearchParams;e&&(e.search&&s.append("search",e.search),e.role&&s.append("role",e.role),e.status&&s.append("status",e.status),e.joined_date_from&&s.append("joined_date_from",e.joined_date_from),e.joined_date_to&&s.append("joined_date_to",e.joined_date_to),e.ordering&&s.append("ordering",e.ordering),e.page&&s.append("page",e.page.toString()),e.page_size&&s.append("page_size",e.page_size.toString()));const t=s.toString(),a="/admin/users/"+(t?"?"+t:"");return Sa.request(a)},getUserDetail:async e=>Sa.request(`/admin/users/${e}/`),bulkActivateUsers:async e=>Sa.request("/admin/bulk-operations/bulk_activate/",{method:"POST",body:JSON.stringify({user_ids:e})}),bulkDeactivateUsers:async e=>Sa.request("/admin/bulk-operations/bulk_deactivate/",{method:"POST",body:JSON.stringify({user_ids:e})}),bulkSuspendUsers:async e=>Sa.request("/admin/bulk-operations/bulk_suspend/",{method:"POST",body:JSON.stringify({user_ids:e})}),bulkResetPasswordUsers:async e=>Sa.request("/admin/bulk-operations/bulk_reset_password/",{method:"POST",body:JSON.stringify({user_ids:e})}),bulkDeleteUsers:async e=>Sa.request("/admin/bulk-operations/bulk_delete/",{method:"POST",body:JSON.stringify({user_ids:e})}),bulkAssignRoleUsers:async(e,s)=>Sa.request("/admin/bulk-operations/bulk_assign_role/",{method:"POST",body:JSON.stringify({user_ids:e,new_role:s})}),createLesson:async e=>Sa.request("/admin/schedule/lessons/create/",{method:"POST",body:JSON.stringify({student:e.student_id,subject:e.subject_id,teacher:e.teacher_id,date:e.date,start_time:e.start_time,end_time:e.end_time,description:e.description||"",telemost_link:e.telemost_link||""})})},on=ge("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),cn=t.forwardRef(({className:e,...s},t)=>a.jsx(q,{ref:t,className:Bt(on(),e),...s}));cn.displayName=q.displayName;const dn=L,un=I,mn=E,hn=t.forwardRef(({className:e,...s},t)=>a.jsx(C,{ref:t,className:Bt("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));hn.displayName=C.displayName;const xn=t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(mn,{children:[a.jsx(hn,{}),a.jsxs(T,{ref:r,className:Bt("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[s,a.jsxs(R,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[a.jsx(fe,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));xn.displayName=T.displayName;const pn=({className:e,...s})=>a.jsx("div",{className:Bt("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});pn.displayName="DialogHeader";const gn=({className:e,...s})=>a.jsx("div",{className:Bt("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});gn.displayName="DialogFooter";const fn=t.forwardRef(({className:e,...s},t)=>a.jsx(A,{ref:t,className:Bt("text-lg font-semibold leading-none tracking-tight",e),...s}));fn.displayName=A.displayName;const jn=t.forwardRef(({className:e,...s},t)=>a.jsx(P,{ref:t,className:Bt("text-sm text-muted-foreground",e),...s}));function vn(e){if(Array.isArray(e))return e;if(e&&"object"==typeof e){const s=e;if("results"in s&&Array.isArray(s.results))return s.results;if("data"in s&&s.data&&"object"==typeof s.data){const e=s.data;if("results"in e&&Array.isArray(e.results))return e.results}}return console.warn("[extractResults] Unknown response format:",e),[]}jn.displayName=P.displayName;const yn=t.forwardRef(({className:e,...s},t)=>a.jsx("textarea",{className:Bt("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:t,...s}));yn.displayName="Textarea";const bn=t.forwardRef(({className:e,...s},t)=>a.jsx(z,{className:Bt("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...s,ref:t,children:a.jsx(D,{className:Bt("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));bn.displayName=z.displayName;const Nn=G,wn=Y,_n=t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(O,{ref:r,className:Bt("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[s,a.jsx(F,{asChild:!0,children:a.jsx(Me,{className:"h-4 w-4 opacity-50"})})]}));_n.displayName=O.displayName;const Sn=t.forwardRef(({className:e,...s},t)=>a.jsx(M,{ref:t,className:Bt("flex cursor-default items-center justify-center py-1",e),...s,children:a.jsx($e,{className:"h-4 w-4"})}));Sn.displayName=M.displayName;const kn=t.forwardRef(({className:e,...s},t)=>a.jsx($,{ref:t,className:Bt("flex cursor-default items-center justify-center py-1",e),...s,children:a.jsx(Me,{className:"h-4 w-4"})}));kn.displayName=$.displayName;const Cn=t.forwardRef(({className:e,children:s,position:t="popper",...r},n)=>a.jsx(U,{children:a.jsxs(V,{ref:n,className:Bt("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...r,children:[a.jsx(Sn,{}),a.jsx(W,{className:Bt("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),a.jsx(kn,{})]})}));Cn.displayName=V.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(H,{ref:t,className:Bt("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s})).displayName=H.displayName;const En=t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(B,{ref:r,className:Bt("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...t,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(X,{children:a.jsx(Ue,{className:"h-4 w-4"})})}),a.jsx(J,{children:s})]}));En.displayName=B.displayName;t.forwardRef(({className:e,...s},t)=>a.jsx(K,{ref:t,className:Bt("-mx-1 my-1 h-px bg-muted",e),...s})).displayName=K.displayName;const Tn=ge("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Rn=t.forwardRef(({className:e,variant:s,...t},r)=>a.jsx("div",{ref:r,role:"alert",className:Bt(Tn({variant:s}),e),...t}));Rn.displayName="Alert";const An=t.forwardRef(({className:e,...s},t)=>a.jsx("h5",{ref:t,className:Bt("mb-1 font-medium leading-none tracking-tight",e),...s}));An.displayName="AlertTitle";const Pn=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{ref:t,className:Bt("text-sm [&_p]:leading-relaxed",e),...s}));Pn.displayName="AlertDescription";const Ln=({user:e,profile:s,open:r,onOpenChange:n,onSuccess:i})=>{var l,o;const[c,d]=t.useState(!1),[u,m]=t.useState(null),[h,x]=t.useState([]),[p,g]=t.useState([]),[f,j]=t.useState({email:e.email,first_name:e.first_name,last_name:e.last_name,phone:e.phone||"",is_active:!1!==e.is_active}),[v,y]=t.useState({grade:(null==s?void 0:s.grade)||"",goal:(null==s?void 0:s.goal)||"",tutor_id:(null==s?void 0:s.tutor_id)||(null==(l=null==s?void 0:s.tutor)?void 0:l.id)||null,parent_id:(null==s?void 0:s.parent_id)||(null==(o=null==s?void 0:s.parent)?void 0:o.id)||null}),[b,N]=t.useState({experience_years:(null==s?void 0:s.experience_years)||0,bio:(null==s?void 0:s.bio)||""}),[w,_]=t.useState({specialization:(null==s?void 0:s.specialization)||"",experience_years:(null==s?void 0:s.experience_years)||0,bio:(null==s?void 0:s.bio)||""});t.useEffect(()=>{"student"===e.role&&r&&S()},[e.role,r]),t.useEffect(()=>{var t,a;j({email:e.email,first_name:e.first_name,last_name:e.last_name,phone:e.phone||"",is_active:!1!==e.is_active}),"student"===e.role?y({grade:(null==s?void 0:s.grade)||"",goal:(null==s?void 0:s.goal)||"",tutor_id:(null==s?void 0:s.tutor_id)||(null==(t=null==s?void 0:s.tutor)?void 0:t.id)||null,parent_id:(null==s?void 0:s.parent_id)||(null==(a=null==s?void 0:s.parent)?void 0:a.id)||null}):"teacher"===e.role?N({experience_years:(null==s?void 0:s.experience_years)||0,bio:(null==s?void 0:s.bio)||""}):"tutor"===e.role&&_({specialization:(null==s?void 0:s.specialization)||"",experience_years:(null==s?void 0:s.experience_years)||0,bio:(null==s?void 0:s.bio)||""})},[e,s,r]);const S=async()=>{try{const[e,s]=await Promise.all([ln.getTutors(),ln.getParents()]);e.success&&e.data&&x(vn(e.data)),s.success&&s.data&&g(vn(s.data))}catch(e){la.error("Error loading selection data:",e)}},k=e=>{const s=e.replace(/\D/g,"");return s.startsWith("8")?"+7"+s.slice(1):s.startsWith("7")?"+"+s:10===s.length?"+7"+s:e};return a.jsx(dn,{open:r,onOpenChange:n,children:a.jsxs(xn,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Редактировать пользователя"})}),a.jsxs("form",{onSubmit:async s=>{var t;if(s.preventDefault(),m(null),f.email&&f.first_name&&f.last_name)if(t=f.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))if("student"!==e.role||v.grade)if("tutor"!==e.role||w.specialization){d(!0);try{const s={...f,phone:f.phone?k(f.phone):void 0};"student"===e.role?s.profile_data=v:"teacher"===e.role?s.profile_data=b:"tutor"===e.role&&(s.profile_data=w);const t=await ln.updateUser(e.id,s);t.success?(_e.success("Пользователь успешно обновлен"),i(),n(!1)):m(t.error||"Ошибка обновления пользователя")}catch(a){m((null==a?void 0:a.message)||"Произошла ошибка при обновлении пользователя")}finally{d(!1)}}else m("Специализация обязательна для тьютора");else m("Класс обязателен для студента");else m("Некорректный формат email");else m("Email, имя и фамилия обязательны")},children:[a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsx("h3",{className:"text-sm font-medium",children:"Базовая информация"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"email",children:"Email *"}),a.jsx(Pr,{id:"email",type:"email",value:f.email,onChange:e=>j({...f,email:e.target.value}),required:!0,disabled:c})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"first_name",children:"Имя *"}),a.jsx(Pr,{id:"first_name",value:f.first_name,onChange:e=>j({...f,first_name:e.target.value}),required:!0,disabled:c})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"last_name",children:"Фамилия *"}),a.jsx(Pr,{id:"last_name",value:f.last_name,onChange:e=>j({...f,last_name:e.target.value}),required:!0,disabled:c})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"phone",children:"Телефон"}),a.jsx(Pr,{id:"phone",type:"tel",value:f.phone,onChange:e=>j({...f,phone:e.target.value}),placeholder:"+7XXXXXXXXXX",disabled:c}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Формат: +7XXXXXXXXXX"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(bn,{id:"is_active",checked:f.is_active,onCheckedChange:e=>j({...f,is_active:e}),disabled:c}),a.jsx(cn,{htmlFor:"is_active",className:"cursor-pointer",children:"Активен"})]}),"student"===e.role&&a.jsxs(a.Fragment,{children:[a.jsx(Lr,{className:"my-4"}),a.jsx("h3",{className:"text-sm font-medium mb-3",children:"Профиль студента"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"grade",children:"Класс *"}),a.jsx(Pr,{id:"grade",value:v.grade,onChange:e=>y({...v,grade:e.target.value}),required:!0,disabled:c,placeholder:"Например: 10"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"goal",children:"Цель обучения"}),a.jsx(yn,{id:"goal",value:v.goal,onChange:e=>y({...v,goal:e.target.value}),disabled:c,placeholder:"Цель обучения студента",rows:3})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"tutor",children:"Тьютор"}),a.jsxs(Nn,{value:(null==(C=v.tutor_id)?void 0:C.toString())||"none",onValueChange:e=>y({...v,tutor_id:"none"===e?null:parseInt(e)}),disabled:c,children:[a.jsx(_n,{id:"tutor",children:a.jsx(wn,{placeholder:"Выберите тьютора"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"none",children:"Не назначен"}),h.map(e=>a.jsx(En,{value:e.id.toString(),children:e.user.full_name},e.id))]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"parent",children:"Родитель"}),a.jsxs(Nn,{value:(null==(E=v.parent_id)?void 0:E.toString())||"none",onValueChange:e=>y({...v,parent_id:"none"===e?null:parseInt(e)}),disabled:c,children:[a.jsx(_n,{id:"parent",children:a.jsx(wn,{placeholder:"Выберите родителя"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"none",children:"Не назначен"}),p.map(e=>a.jsx(En,{value:e.id.toString(),children:e.user.full_name},e.id))]})]})]})]}),"teacher"===e.role&&a.jsxs(a.Fragment,{children:[a.jsx(Lr,{className:"my-4"}),a.jsx("h3",{className:"text-sm font-medium mb-3",children:"Профиль преподавателя"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"experience_years",children:"Опыт работы (лет)"}),a.jsx(Pr,{id:"experience_years",type:"number",value:b.experience_years,onChange:e=>N({...b,experience_years:parseInt(e.target.value)||0}),disabled:c,min:"0"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"bio",children:"Биография"}),a.jsx(yn,{id:"bio",value:b.bio,onChange:e=>N({...b,bio:e.target.value}),disabled:c,placeholder:"Расскажите о преподавателе",rows:4})]})]}),"tutor"===e.role&&a.jsxs(a.Fragment,{children:[a.jsx(Lr,{className:"my-4"}),a.jsx("h3",{className:"text-sm font-medium mb-3",children:"Профиль тьютора"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"specialization",children:"Специализация *"}),a.jsx(Pr,{id:"specialization",value:w.specialization,onChange:e=>_({...w,specialization:e.target.value}),required:!0,disabled:c,placeholder:"Например: Математика"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"experience_years",children:"Опыт работы (лет)"}),a.jsx(Pr,{id:"experience_years",type:"number",value:w.experience_years,onChange:e=>_({...w,experience_years:parseInt(e.target.value)||0}),disabled:c,min:"0"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"bio",children:"Биография"}),a.jsx(yn,{id:"bio",value:w.bio,onChange:e=>_({...w,bio:e.target.value}),disabled:c,placeholder:"Расскажите о тьюторе",rows:4})]})]})]}),u&&a.jsxs(Rn,{variant:"destructive",className:"mb-4",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:u})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:c,children:"Отмена"}),a.jsx(Ba,{type:"submit",disabled:c,children:c?"Сохранение...":"Сохранить"})]})]})]})});var C,E},qn=({user:e,open:s,onOpenChange:r})=>{const[n,i]=t.useState(null),[l,o]=t.useState(!1),[c,d]=t.useState(null),u=()=>{i(null),d(null),r(!1)};return a.jsx(dn,{open:s,onOpenChange:u,children:a.jsxs(xn,{className:"sm:max-w-[500px]",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Сбросить пароль"})}),n?a.jsxs(a.Fragment,{children:[a.jsxs(Rn,{className:"bg-yellow-50 border-yellow-200",children:[a.jsx(be,{className:"h-4 w-4 text-yellow-600"}),a.jsxs(Pn,{className:"text-yellow-800",children:["Новый пароль сгенерирован. ",a.jsx("strong",{children:"Сохраните его"}),", он показывается только один раз!"]})]}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium mb-2",children:"Новый пароль:"}),a.jsxs("div",{className:"bg-muted p-4 rounded-md flex items-center justify-between",children:[a.jsx("code",{className:"text-lg font-mono font-bold",children:n}),a.jsxs(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>{n&&(navigator.clipboard.writeText(n),_e.success("Пароль скопирован в буфер обмена"))},children:[a.jsx(Ve,{className:"h-4 w-4 mr-1"}),"Копировать"]})]})]}),a.jsxs("div",{className:"bg-green-50 border border-green-200 p-3 rounded-md flex items-start gap-2",children:[a.jsx(We,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-sm text-green-800",children:[a.jsx("p",{className:"font-medium",children:"Пароль успешно сброшен"}),a.jsxs("p",{className:"mt-1",children:["Отправьте этот пароль пользователю ",e.full_name,". После закрытия этого окна пароль больше не будет отображаться."]})]})]})]}),a.jsx(gn,{children:a.jsx(Ba,{type:"button",onClick:u,children:"Закрыть"})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"py-4 space-y-4",children:[a.jsxs("p",{children:["Вы уверены, что хотите сбросить пароль для пользователя"," ",a.jsx("strong",{children:e.full_name})," (",e.email,")?"]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Будет сгенерирован новый случайный пароль. Текущий пароль пользователя перестанет работать."})]}),c&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:c})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:u,disabled:l,children:"Отмена"}),a.jsx(Ba,{type:"button",onClick:async()=>{o(!0),d(null);try{const s=await ln.resetPassword(e.id);s.success&&s.data?(i(s.data.new_password),_e.success("Пароль успешно сброшен")):d(s.error||"Не удалось сбросить пароль")}catch(s){d((null==s?void 0:s.message)||"Произошла ошибка при сбросе пароля")}finally{o(!1)}},disabled:l,children:l?"Генерация...":"Сбросить пароль"})]})]})]})})},In=t.forwardRef(({className:e,...s},t)=>a.jsx(Q,{ref:t,className:Bt("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...s,children:a.jsx(Z,{className:Bt("flex items-center justify-center text-current"),children:a.jsx(Ue,{className:"h-4 w-4"})})}));In.displayName=Q.displayName;const zn=({user:e,open:s,onOpenChange:r,onSuccess:n})=>{const[i,l]=t.useState(""),[o,c]=t.useState(!1),[d,u]=t.useState(!1),[m,h]=t.useState(null),x=()=>{l(""),c(!1),h(null),r(!1)};return a.jsx(dn,{open:s,onOpenChange:x,children:a.jsxs(xn,{className:"sm:max-w-[500px]",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Удалить пользователя"})}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:o?a.jsxs(a.Fragment,{children:[a.jsx("strong",{children:"ВНИМАНИЕ: Это действие необратимо!"}),a.jsx("br",{}),"Все данные пользователя ",a.jsx("strong",{children:e.full_name})," будут удалены навсегда из базы данных. Это включает профиль, связанные записи, материалы и историю активности."]}):a.jsxs(a.Fragment,{children:["Пользователь ",a.jsx("strong",{children:e.full_name})," будет деактивирован (is_active = False).",a.jsx("br",{}),"Вход в систему станет невозможен, но все данные сохранятся и пользователя можно будет восстановить позже."]})})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(In,{id:"permanent",checked:o,onCheckedChange:e=>c(!!e),disabled:d}),a.jsx(cn,{htmlFor:"permanent",className:"cursor-pointer text-sm font-medium",children:"Удалить полностью (hard delete) - НЕОБРАТИМО"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"confirmEmail",children:"Введите email пользователя для подтверждения:"}),a.jsx(Pr,{id:"confirmEmail",value:i,onChange:e=>l(e.target.value),placeholder:e.email,disabled:d,autoComplete:"off"}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Для подтверждения введите: ",a.jsx("code",{className:"text-xs bg-muted px-1 py-0.5 rounded",children:e.email})]})]}),m&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:m})]})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:x,disabled:d,children:"Отмена"}),a.jsx(Ba,{type:"button",variant:"destructive",onClick:async()=>{if(h(null),i.toLowerCase().trim()===e.email.toLowerCase().trim()){u(!0);try{const s=await ln.deleteUser(e.id,o);s.success?(_e.success(o?"Пользователь удален навсегда":"Пользователь деактивирован"),n(),r(!1),l(""),c(!1)):h(s.error||"Не удалось удалить пользователя")}catch(s){h((null==s?void 0:s.message)||"Произошла ошибка при удалении пользователя")}finally{u(!1)}}else h("Email не совпадает. Пожалуйста, введите точный email пользователя.")},disabled:d||i.toLowerCase().trim()!==e.email.toLowerCase().trim(),children:d?"Удаление...":o?"Удалить навсегда":"Деактивировать"})]})]})})},Dn=({open:e,onOpenChange:s,onSuccess:r})=>{var n,i;const[l,o]=t.useState("form"),[c,d]=t.useState(!1),[u,m]=t.useState(null),[h,x]=t.useState([]),[p,g]=t.useState([]),[f,j]=t.useState(null),[v,y]=t.useState({email:"",first_name:"",last_name:"",grade:"",phone:"",goal:"",tutor_id:null,parent_id:null,password:""});t.useEffect(()=>{e&&b()},[e]);const b=async()=>{try{const[e,s]=await Promise.all([ln.getTutors(),ln.getParents()]);if(e.success&&e.data){const s=Array.isArray(e.data)?e.data:e.data.results||[];x(s)}if(s.success&&s.data){const e=Array.isArray(s.data)?s.data:s.data.results||[];g(e)}}catch(e){la.error("Error loading selection data:",e)}},N=e=>{const s=e.replace(/\D/g,"");return s.startsWith("8")?"+7"+s.slice(1):s.startsWith("7")?"+"+s:10===s.length?"+7"+s:e},w=()=>{o("form"),y({email:"",first_name:"",last_name:"",grade:"",phone:"",goal:"",tutor_id:null,parent_id:null,password:""}),j(null),m(null),s(!1)};return a.jsx(dn,{open:e,onOpenChange:w,children:a.jsx(xn,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:"form"===l?a.jsxs(a.Fragment,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Создать студента"})}),a.jsxs("form",{onSubmit:async e=>{var s;if(e.preventDefault(),m(null),v.email&&v.first_name&&v.last_name)if(s=v.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))if(v.grade){d(!0);try{const e={email:v.email.trim().toLowerCase(),first_name:v.first_name.trim(),last_name:v.last_name.trim(),grade:v.grade.trim(),phone:v.phone?N(v.phone):void 0,goal:v.goal||void 0,tutor_id:v.tutor_id||void 0,parent_id:v.parent_id||void 0,password:v.password||void 0},s=await ln.createStudent(e);s.success&&s.data?(j(s.data.credentials),o("success"),_e.success("Студент успешно создан")):m(s.error||"Не удалось создать студента")}catch(t){m((null==t?void 0:t.message)||"Произошла ошибка при создании студента")}finally{d(!1)}}else m("Класс обязателен для студента");else m("Некорректный формат email");else m("Email, имя и фамилия обязательны")},children:[a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"email",children:"Email *"}),a.jsx(Pr,{id:"email",type:"email",value:v.email,onChange:e=>y({...v,email:e.target.value}),required:!0,disabled:c,placeholder:"student@example.com",autoComplete:"username"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"first_name",children:"Имя *"}),a.jsx(Pr,{id:"first_name",value:v.first_name,onChange:e=>y({...v,first_name:e.target.value}),required:!0,disabled:c,placeholder:"Иван"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"last_name",children:"Фамилия *"}),a.jsx(Pr,{id:"last_name",value:v.last_name,onChange:e=>y({...v,last_name:e.target.value}),required:!0,disabled:c,placeholder:"Иванов"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"grade",children:"Класс *"}),a.jsx(Pr,{id:"grade",value:v.grade,onChange:e=>y({...v,grade:e.target.value}),required:!0,disabled:c,placeholder:"10"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"phone",children:"Телефон"}),a.jsx(Pr,{id:"phone",type:"tel",value:v.phone,onChange:e=>y({...v,phone:e.target.value}),placeholder:"+7XXXXXXXXXX",disabled:c})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"goal",children:"Цель обучения"}),a.jsx(yn,{id:"goal",value:v.goal,onChange:e=>y({...v,goal:e.target.value}),disabled:c,placeholder:"Цель обучения студента",rows:3})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"tutor",children:"Тьютор"}),a.jsxs(Nn,{value:(null==(n=v.tutor_id)?void 0:n.toString())||"none",onValueChange:e=>y({...v,tutor_id:"none"===e?null:parseInt(e)}),disabled:c,children:[a.jsx(_n,{id:"tutor",children:a.jsx(wn,{placeholder:"Выберите тьютора"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"none",children:"Не назначен"}),h.map(e=>a.jsx(En,{value:e.id.toString(),children:e.user.full_name},e.id))]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"parent",children:"Родитель"}),a.jsxs(Nn,{value:(null==(i=v.parent_id)?void 0:i.toString())||"none",onValueChange:e=>y({...v,parent_id:"none"===e?null:parseInt(e)}),disabled:c,children:[a.jsx(_n,{id:"parent",children:a.jsx(wn,{placeholder:"Выберите родителя"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"none",children:"Не назначен"}),p.map(e=>a.jsx(En,{value:e.id.toString(),children:e.user.full_name},e.id))]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"password",children:"Пароль (оставьте пустым для автогенерации)"}),a.jsx(Pr,{id:"password",type:"password",autoComplete:"new-password",value:v.password,onChange:e=>y({...v,password:e.target.value}),disabled:c,placeholder:"Автоматический пароль"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Если не указан, будет сгенерирован случайный пароль"})]})]}),u&&a.jsxs(Rn,{variant:"destructive",className:"mb-4",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:u})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:w,disabled:c,children:"Отмена"}),a.jsx(Ba,{type:"submit",disabled:c,children:c?"Создание...":"Создать"})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Студент создан!"})}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs(Rn,{className:"bg-green-50 border-green-200",children:[a.jsx(We,{className:"h-4 w-4 text-green-600"}),a.jsx(Pn,{className:"text-green-800",children:"Студент успешно создан. Сохраните данные для входа:"})]}),f&&a.jsxs("div",{className:"bg-muted p-4 rounded-md space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-medium",children:"Логин (email):"}),a.jsx("code",{className:"text-sm",children:f.login})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-medium",children:"Пароль:"}),a.jsx("code",{className:"text-sm font-bold",children:f.password})]})]}),a.jsxs(Ba,{type:"button",onClick:()=>{if(f){const e=`Логин: ${f.login}\nПароль: ${f.password}`;navigator.clipboard.writeText(e),_e.success("Данные для входа скопированы")}},variant:"outline",className:"w-full",children:[a.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Копировать данные для входа"]}),a.jsxs(Rn,{className:"bg-yellow-50 border-yellow-200",children:[a.jsx(be,{className:"h-4 w-4 text-yellow-600"}),a.jsx(Pn,{className:"text-yellow-800 text-sm",children:"Сохраните эти данные! После закрытия окна пароль больше не будет отображаться."})]})]}),a.jsx(gn,{children:a.jsx(Ba,{type:"button",onClick:()=>{r(),w()},children:"Закрыть"})})]})})})},On=({open:e,onOpenChange:s,studentId:r,studentName:n,onSuccess:i})=>{const[l,o]=t.useState(!1),[c,d]=t.useState(null),[u,m]=t.useState([]),[h,x]=t.useState([]),[p,g]=t.useState([{subject_id:0,teacher_id:0}]);t.useEffect(()=>{e&&f()},[e]);const f=async()=>{var e,s;try{const[t,a]=await Promise.all([Sa.request("/materials/subjects/all/"),Sa.request("/auth/staff/?role=teacher")]);if(t.success&&t.data){const s=t.data;let a=[];Array.isArray(s)?a=s:(null==s?void 0:s.results)&&Array.isArray(s.results)?a=s.results:(null==s?void 0:s.data)&&Array.isArray(s.data)?a=s.data:(null==(e=null==s?void 0:s.data)?void 0:e.results)&&Array.isArray(s.data.results)&&(a=s.data.results),m(a)}if(a.success&&a.data){const e=a.data;let t=[];Array.isArray(e)?t=e:(null==e?void 0:e.results)&&Array.isArray(e.results)?t=e.results:(null==e?void 0:e.data)&&Array.isArray(e.data)?t=e.data:(null==(s=null==e?void 0:e.data)?void 0:s.results)&&Array.isArray(e.data.results)&&(t=e.data.results),x(t)}}catch(t){la.error("Error loading data:",t),_e.error("Ошибка загрузки данных")}},j=(e,s,t)=>{const a=[...p];a[e][s]=t,g(a)};return a.jsx(dn,{open:e,onOpenChange:s,children:a.jsxs(xn,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsxs(fn,{children:["Назначить предметы студенту: ",n]})}),a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),d(null);for(let s=0;s<p.length;s++){const e=p[s];if(!e.subject_id||!e.teacher_id)return void d(`Назначение ${s+1}: выберите предмет и преподавателя`)}const t=p.map(e=>e.subject_id),a=new Set(t);if(t.length===a.size){o(!0);try{const e=p.map(e=>Sa.request("/materials/tutor/students/assign-subject/",{method:"POST",body:JSON.stringify({student_id:r,subject_id:e.subject_id,teacher_id:e.teacher_id})})),t=await Promise.allSettled(e),a=t.filter(e=>"rejected"===e.status);a.length>0?(d(`Не удалось назначить ${a.length} предмет(ов)`),_e.error(`Назначено ${t.length-a.length} из ${t.length} предметов`)):(_e.success(`Назначено ${p.length} предмет(ов) для ${n}`),i(),s(!1))}catch(l){d((null==l?void 0:l.message)||"Произошла ошибка при назначении предметов")}finally{o(!1)}}else d("Нельзя назначать один предмет несколько раз")},children:[a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Выберите предметы и преподавателей для назначения студенту"}),p.map((e,s)=>a.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("h4",{className:"text-sm font-medium",children:["Назначение ",s+1]}),p.length>1&&a.jsx(Ba,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{1!==p.length?g(p.filter((s,t)=>t!==e)):_e.error("Должно быть хотя бы одно назначение")})(s),disabled:l,children:a.jsx(He,{className:"h-4 w-4 text-red-500"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:`subject-${s}`,children:"Предмет *"}),a.jsxs(Nn,{value:e.subject_id.toString(),onValueChange:e=>j(s,"subject_id",parseInt(e)),disabled:l,children:[a.jsx(_n,{id:`subject-${s}`,children:a.jsx(wn,{placeholder:"Выберите предмет"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"0",disabled:!0,children:"Выберите предмет"}),u.map(e=>a.jsx(En,{value:e.id.toString(),children:e.name},e.id))]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:`teacher-${s}`,children:"Преподаватель *"}),a.jsxs(Nn,{value:e.teacher_id.toString(),onValueChange:e=>j(s,"teacher_id",parseInt(e)),disabled:l||!e.subject_id,children:[a.jsx(_n,{id:`teacher-${s}`,children:a.jsx(wn,{placeholder:"Выберите преподавателя"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"0",disabled:!0,children:"Выберите преподавателя"}),(e.subject_id,h).map(e=>a.jsx(En,{value:e.user.id.toString(),children:e.user.full_name},e.id))]})]})]})]})]},s)),a.jsxs(Ba,{type:"button",variant:"outline",size:"sm",onClick:()=>{g([...p,{subject_id:0,teacher_id:0}])},disabled:l,className:"w-full",children:[a.jsx(Be,{className:"h-4 w-4 mr-2"}),"Добавить предмет"]})]}),c&&a.jsxs(Rn,{variant:"destructive",className:"mb-4",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:c})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:l,children:"Отмена"}),a.jsx(Ba,{type:"submit",disabled:l,children:l?"Назначение...":"Назначить предметы"})]})]})]})})},Fn=t.forwardRef(({className:e,...s},t)=>a.jsx(ee,{ref:t,className:Bt("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));Fn.displayName=ee.displayName;const Mn=t.forwardRef(({className:e,...s},t)=>a.jsx(se,{ref:t,className:Bt("aspect-square h-full w-full",e),...s}));Mn.displayName=se.displayName;const $n=t.forwardRef(({className:e,...s},t)=>a.jsx(te,{ref:t,className:Bt("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));$n.displayName=te.displayName;const Un=ie,Vn=t.forwardRef(({className:e,...s},t)=>a.jsx(ae,{ref:t,className:Bt("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));Vn.displayName=ae.displayName;const Wn=t.forwardRef(({className:e,...s},t)=>a.jsx(re,{ref:t,className:Bt("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...s}));Wn.displayName=re.displayName;const Hn=t.forwardRef(({className:e,...s},t)=>a.jsx(ne,{ref:t,className:Bt("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));function Bn({open:e,onOpenChange:s,userId:r,role:n,onUpdate:i}){var l,o,c,d,u,m;const[h,x]=t.useState(!1),[p,g]=t.useState(null),[f,j]=t.useState(null),[v,y]=t.useState("profile"),[b,N]=t.useState(!1),[w,_]=t.useState(!1),S=async()=>{x(!0);try{const e=await Sa.request(`/accounts/admin/users/${r}/profile/`);if(e.success&&e.data)g(e.data);else{la.error("[UserDetailModal] Failed to load profile:",{userId:r,status:null==e?void 0:e.status,error:null==e?void 0:e.error,endpoint:"/accounts/admin/users/{userId}/profile/"});let s="Ошибка загрузки профиля";403===(null==e?void 0:e.status)?s="Недостаточно прав для просмотра этого профиля":404===(null==e?void 0:e.status)?s="Пользователь не найден":(null==e?void 0:e.error)&&(s=e.error),_e.error(s)}}catch(e){la.error("[UserDetailModal] Exception loading profile:",{userId:r,error:e,endpoint:"/accounts/admin/users/{userId}/profile/"}),_e.error("Не удалось загрузить профиль")}finally{x(!1)}},k=async()=>{try{const e=await Sa.request(`/accounts/admin/users/${r}/full-info/`);e.success&&e.data&&j(e.data)}catch(e){la.error("[UserDetailModal] Error loading full info:",e)}};t.useEffect(()=>{e&&r&&(S(),k())},[e,r]);const C=null==p?void 0:p.user,E=null==p?void 0:p.profile;return a.jsxs(a.Fragment,{children:[a.jsx(dn,{open:e,onOpenChange:s,children:a.jsxs(xn,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsxs(fn,{className:"flex items-center justify-between",children:[a.jsx("span",{children:"Профиль пользователя"}),a.jsx(Ba,{type:"button",variant:"ghost",size:"icon",onClick:()=>s(!1),children:a.jsx(fe,{className:"h-4 w-4"})})]})}),h?a.jsx("div",{className:"py-12 text-center text-muted-foreground",children:"Загрузка..."}):C?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-start gap-6",children:[a.jsxs(Fn,{className:"h-24 w-24",children:[a.jsx(Mn,{src:C.avatar,alt:C.full_name}),a.jsx($n,{className:"text-2xl",children:(()=>{if(!C)return"U";const e=C.first_name||"",s=C.last_name||"";return`${e.charAt(0)}${s.charAt(0)}`.toUpperCase()||"U"})()})]}),a.jsxs("div",{className:"flex-1 space-y-2",children:[a.jsx("h3",{className:"text-2xl font-semibold",children:C.full_name}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx(Ya,{variant:C.is_active?"default":"secondary",children:C.is_active?"Активен":"Неактивен"}),a.jsx(Ya,{variant:"outline",children:C.role_display})]}),a.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[a.jsxs("p",{children:["Email: ",C.email]}),C.phone&&a.jsxs("p",{children:["Телефон: ",C.phone]}),C.created_at&&a.jsxs("p",{children:["Зарегистрирован:"," ",new Date(C.created_at).toLocaleDateString("ru-RU")]})]})]})]}),a.jsx(Lr,{}),a.jsxs(Un,{value:v,onValueChange:y,children:[a.jsxs(Vn,{className:"grid w-full grid-cols-4",children:[a.jsx(Wn,{value:"profile",children:"Профиль"}),a.jsxs(Wn,{value:"enrollments",children:[a.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Предметы"]}),a.jsxs(Wn,{value:"schedule",children:[a.jsx(Le,{className:"h-4 w-4 mr-2"}),"Расписание"]}),a.jsxs(Wn,{value:"other",children:[a.jsx(Je,{className:"h-4 w-4 mr-2"}),"Другое"]})]}),a.jsxs(Hn,{value:"profile",className:"space-y-4",children:["student"===n&&E&&"grade"in E&&a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Класс"}),a.jsx("p",{className:"text-base",children:E.grade||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Цель"}),a.jsx("p",{className:"text-base",children:E.goal||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Тьютор"}),a.jsx("p",{className:"text-base",children:E.tutor?E.tutor.name:"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Родитель"}),a.jsx("p",{className:"text-base",children:E.parent?E.parent.name:"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Прогресс"}),a.jsxs("p",{className:"text-base",children:[null!=(l=E.progress_percentage)?l:0,"%"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Дни подряд"}),a.jsx("p",{className:"text-base",children:null!=(o=E.streak_days)?o:0})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Баллы"}),a.jsx("p",{className:"text-base",children:null!=(c=E.total_points)?c:0})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Точность"}),a.jsxs("p",{className:"text-base",children:[null!=(d=E.accuracy_percentage)?d:0,"%"]})]})]}),"teacher"===n&&E&&"subject"in E&&a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Предмет"}),a.jsx("p",{className:"text-base",children:E.subject||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Опыт (лет)"}),a.jsx("p",{className:"text-base",children:null!=(u=E.experience_years)?u:0})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Био"}),a.jsx("p",{className:"text-base",children:E.bio||"-"})]}),E.subjects&&E.subjects.length>0&&a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Предметы"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:E.subjects.map(e=>a.jsx(Ya,{variant:"secondary",children:e.name},e.id))})]})]}),"tutor"===n&&E&&"specialization"in E&&a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Специализация"}),a.jsx("p",{className:"text-base",children:E.specialization||"-"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Опыт (лет)"}),a.jsx("p",{className:"text-base",children:null!=(m=E.experience_years)?m:0})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Био"}),a.jsx("p",{className:"text-base",children:E.bio||"-"})]})]}),"parent"===n&&a.jsx("div",{className:"text-sm text-muted-foreground",children:a.jsx("p",{children:"Профиль родителя (базовые поля отображены выше)"})}),E&&"telegram"in E&&E.telegram&&a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Telegram"}),a.jsx("p",{className:"text-base",children:E.telegram})]})]}),a.jsx(Hn,{value:"enrollments",className:"space-y-4",children:(null==f?void 0:f.enrollments)&&f.enrollments.length>0?a.jsx("div",{className:"space-y-2",children:f.enrollments.map(e=>a.jsxs("div",{className:"p-3 border rounded-md space-y-1",children:[a.jsx("p",{className:"font-medium",children:e.subject||"-"}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Преподаватель: ",e.teacher||"-"]}),e.tutor&&a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Тьютор: ",e.tutor]}),e.enrolled_at&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Зачислен:"," ",new Date(e.enrolled_at).toLocaleDateString("ru-RU")]})]},e.id))}):a.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Нет назначенных предметов"})}),a.jsx(Hn,{value:"schedule",className:"space-y-4",children:(null==f?void 0:f.schedule)&&f.schedule.length>0?a.jsx("div",{className:"space-y-2",children:f.schedule.map(e=>a.jsxs("div",{className:"p-3 border rounded-md space-y-1",children:[a.jsx("p",{className:"font-medium",children:e.title||"Урок"}),a.jsxs("p",{className:"text-sm",children:["Предмет: ",e.subject||"-"]}),e.date&&a.jsxs("p",{className:"text-sm",children:["Дата: ",new Date(e.date).toLocaleDateString("ru-RU")]}),e.start_time&&e.end_time&&a.jsxs("p",{className:"text-sm",children:["Время: ",e.start_time," - ",e.end_time]}),e.student&&a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Студент: ",e.student]}),e.teacher&&a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Преподаватель: ",e.teacher]})]},e.id))}):a.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Нет запланированных уроков"})}),a.jsxs(Hn,{value:"other",className:"space-y-4",children:["parent"===n&&(null==f?void 0:f.invoices)&&f.invoices.length>0&&a.jsxs("div",{children:[a.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[a.jsx(Ke,{className:"h-4 w-4"}),"Счета"]}),a.jsx("div",{className:"space-y-2",children:f.invoices.map(e=>a.jsxs("div",{className:"p-3 border rounded-md space-y-1",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("p",{className:"font-medium",children:[e.amount," ₽"]}),a.jsx(Ya,{variant:"paid"===e.status?"default":"sent"===e.status?"secondary":"outline",children:e.status})]}),e.student&&a.jsxs("p",{className:"text-sm",children:["Студент: ",e.student]}),e.tutor&&a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Тьютор: ",e.tutor]}),e.due_date&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Срок: ",new Date(e.due_date).toLocaleDateString("ru-RU")]})]},e.id))})]}),(null==f?void 0:f.reports)&&f.reports.length>0&&a.jsxs("div",{children:[a.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[a.jsx(Je,{className:"h-4 w-4"}),"Отчёты"]}),a.jsx("div",{className:"space-y-2",children:f.reports.map(e=>a.jsxs("div",{className:"p-3 border rounded-md space-y-1",children:[a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsx("p",{className:"font-medium",children:"tutor_weekly"===e.type?"Еженедельный отчёт тьютора":"Отчёт преподавателя"}),e.status&&a.jsx(Ya,{variant:"outline",children:e.status})]}),e.created_at&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Создан:"," ",new Date(e.created_at).toLocaleDateString("ru-RU")]})]},e.id))})]}),(!(null==f?void 0:f.invoices)||0===f.invoices.length)&&(!(null==f?void 0:f.reports)||0===f.reports.length)&&a.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Нет дополнительных данных"})]})]})]}):a.jsx("div",{className:"py-12 text-center text-muted-foreground",children:"Пользователь не найден"}),a.jsxs(gn,{className:"flex gap-2 sm:gap-0",children:[a.jsxs(Ba,{type:"button",variant:"outline",onClick:()=>N(!0),disabled:!C,children:[a.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Редактировать"]}),a.jsxs(Ba,{type:"button",variant:"destructive",onClick:()=>_(!0),disabled:!C,children:[a.jsx(He,{className:"h-4 w-4 mr-2"}),"Удалить"]}),a.jsx(Ba,{type:"button",variant:"secondary",onClick:()=>s(!1),children:"Закрыть"})]})]})}),C&&E&&a.jsx(Ln,{user:C,profile:{id:E.id,user:C,...E},open:b,onOpenChange:N,onSuccess:()=>{S(),k(),null==i||i()}}),C&&a.jsx(zn,{user:C,open:w,onOpenChange:_,onSuccess:()=>{s(!1),null==i||i()}})]})}function Xn({onUpdate:e}){var s;const[r,n]=t.useState([]),[i,l]=t.useState(!1),[o,c]=t.useState(!1),[d,u]=t.useState(0),[m,h]=t.useState(1),[x,p]=t.useState(20),[g,f]=t.useState(""),[j,v]=t.useState("asc"),[y,b]=t.useState([]),[N,w]=t.useState({search:"",grade:"",tutor_id:"",is_active:"all"}),[_,S]=t.useState({open:!1,item:null}),[k,C]=t.useState({open:!1,item:null}),[E,T]=t.useState({open:!1,item:null}),[R,A]=t.useState({open:!1,item:null,isLoading:!1}),[P,L]=t.useState({open:!1,item:null}),[q,I]=t.useState({open:!1,item:null}),z=t.useCallback(async(e=1)=>{l(!0);try{const s={};if(N.search&&(s.search=N.search),N.grade&&(s.grade=N.grade),N.tutor_id&&(s.tutor_id=parseInt(N.tutor_id)),"all"!==N.is_active&&(s.is_active="true"===N.is_active),g){const e="desc"===j?"-":"";s.ordering=`${e}${g}`}s.page=e,s.page_size=x;const t=await ln.getStudents(s);if(t.success&&t.data){const s=t.data;n(s.results||[]),u(s.count||0),h(e)}else _e.error(t.error||"Ошибка загрузки списка студентов"),n([]),u(0)}catch(s){const e=s;_e.error((null==e?void 0:e.message)||"Ошибка загрузки списка"),n([]),u(0)}finally{l(!1)}},[N,x,g,j]),D=t.useCallback(async()=>{try{const e=await ln.getTutors();if(e.success&&e.data){const s=Array.isArray(e.data)?e.data:e.data.results||[];b(s)}}catch(e){la.error("Error loading filter data:",e)}},[]);t.useEffect(()=>{z(1)},[N,x,g,j]),t.useEffect(()=>{D()},[]);const O=e=>{g===e?v("asc"===j?"desc":"asc"):(f(e),v("asc"))},F=e=>g!==e?null:"asc"===j?" ↑":" ↓",M=Math.ceil(d/x);return a.jsxs(a.Fragment,{children:[a.jsxs(Fa,{children:[a.jsxs(Ma,{className:"flex flex-row items-center justify-between",children:[a.jsx($a,{children:"Студенты"}),a.jsxs(Ba,{type:"button",onClick:()=>c(!0),children:[a.jsx(Be,{className:"h-4 w-4 mr-2"}),"Создать студента"]})]}),a.jsxs(Va,{children:[a.jsxs("div",{className:"space-y-4 mb-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx(cn,{className:"text-sm",children:"Поиск"}),a.jsxs("div",{className:"flex gap-2 mt-2",children:[a.jsx(Pr,{placeholder:"ФИО, email...",value:N.search,onChange:e=>w({...N,search:e.target.value}),className:"flex-1"}),a.jsx(Ba,{type:"button",variant:"outline",size:"icon",children:a.jsx(Ye,{className:"h-4 w-4"})})]})]}),a.jsxs("div",{children:[a.jsx(cn,{className:"text-sm",children:"Класс"}),a.jsx(Pr,{placeholder:"Класс...",value:N.grade,onChange:e=>w({...N,grade:e.target.value}),className:"mt-2"})]}),a.jsxs("div",{children:[a.jsx(cn,{className:"text-sm",children:"Тьютор"}),a.jsxs("select",{value:N.tutor_id,onChange:e=>w({...N,tutor_id:e.target.value}),className:"w-full mt-2 h-10 px-3 border border-input bg-background rounded-md text-sm",children:[a.jsx("option",{value:"",children:"Все"}),y.map(e=>a.jsx("option",{value:e.id,children:e.user.full_name},e.id))]})]}),a.jsxs("div",{children:[a.jsx(cn,{className:"text-sm",children:"Статус"}),a.jsxs("select",{value:N.is_active,onChange:e=>w({...N,is_active:e.target.value}),className:"w-full mt-2 h-10 px-3 border border-input bg-background rounded-md text-sm",children:[a.jsx("option",{value:"all",children:"Все"}),a.jsx("option",{value:"true",children:"Активные"}),a.jsx("option",{value:"false",children:"Неактивные"})]})]})]}),a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsxs("div",{children:[a.jsx(cn,{className:"text-sm",children:"Показывать по"}),a.jsxs("select",{value:x,onChange:e=>{p(parseInt(e.target.value)),h(1)},className:"w-[120px] mt-2 h-10 px-3 border border-input bg-background rounded-md text-sm",children:[a.jsx("option",{value:"20",children:"20"}),a.jsx("option",{value:"50",children:"50"})]})]}),a.jsx("div",{className:"flex-1"}),a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>{w({search:"",grade:"",tutor_id:"",is_active:"all"}),f(""),v("asc")},className:"mt-6",children:"Сбросить фильтры"})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left border-b",children:[a.jsxs("th",{className:"py-2 pr-4 cursor-pointer hover:bg-muted/50",onClick:()=>O("user__last_name"),children:["ФИО",F("user__last_name")]}),a.jsxs("th",{className:"py-2 pr-4 cursor-pointer hover:bg-muted/50",onClick:()=>O("user__email"),children:["Email",F("user__email")]}),a.jsxs("th",{className:"py-2 pr-4 cursor-pointer hover:bg-muted/50",onClick:()=>O("grade"),children:["Класс",F("grade")]}),a.jsx("th",{className:"py-2 pr-4",children:"Статус"}),a.jsx("th",{className:"py-2 pr-4",children:"Действия"})]})}),a.jsx("tbody",{children:i?a.jsx("tr",{children:a.jsx("td",{className:"py-4",colSpan:5,children:"Загрузка..."})}):r&&0!==r.length?r.map(e=>a.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[a.jsx("td",{className:"py-2 pr-4",children:e.user.full_name}),a.jsx("td",{className:"py-2 pr-4",children:e.user.email}),a.jsx("td",{className:"py-2 pr-4",children:e.grade||"-"}),a.jsx("td",{className:"py-2 pr-4",children:a.jsx(Ya,{variant:e.user.is_active?"default":"secondary",children:e.user.is_active?"Активен":"Неактивен"})}),a.jsx("td",{className:"py-2 pr-4",children:a.jsxs("div",{className:"flex gap-1",children:[a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>I({open:!0,item:e}),title:"Просмотреть профиль",children:a.jsx(Qe,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>S({open:!0,item:e}),title:"Редактировать пользователя",children:a.jsx(Ze,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>L({open:!0,item:e}),title:"Назначить предметы",children:a.jsx(Xe,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>C({open:!0,item:e}),title:"Сбросить пароль",children:a.jsx(es,{className:"h-4 w-4"})}),!e.user.is_active&&a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>A({open:!0,item:e,isLoading:!1}),title:"Активировать студента",children:a.jsx(ss,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"destructive",onClick:()=>T({open:!0,item:e}),title:"Удалить пользователя",children:a.jsx(He,{className:"h-4 w-4"})})]})})]},e.id)):a.jsx("tr",{children:a.jsx("td",{className:"py-4",colSpan:5,children:"Студенты не найдены"})})})]})}),a.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[a.jsxs("div",{className:"text-sm text-muted-foreground",children:["Показано ",(null==r?void 0:r.length)||0," из ",d," студентов"]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Ba,{type:"button",variant:"outline",size:"sm",onClick:()=>z(m-1),disabled:1===m||i,children:a.jsx(ts,{className:"h-4 w-4"})}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:"text-sm",children:["Страница ",m," из ",M||1]})}),a.jsx(Ba,{type:"button",variant:"outline",size:"sm",onClick:()=>z(m+1),disabled:m>=M||i,children:a.jsx(as,{className:"h-4 w-4"})})]})]})]})]}),a.jsx(Dn,{open:o,onOpenChange:c,onSuccess:()=>{z(1),null==e||e()}}),_.item&&a.jsx(Ln,{user:_.item.user,profile:_.item,open:_.open,onOpenChange:e=>{e?S(s=>({...s,open:e})):(S(e=>({...e,open:!1})),setTimeout(()=>S({open:!1,item:null}),300))},onSuccess:()=>{z(m),null==e||e()}}),k.item&&a.jsx(qn,{user:k.item.user,open:k.open,onOpenChange:e=>{e?C(s=>({...s,open:e})):(C(e=>({...e,open:!1})),setTimeout(()=>C({open:!1,item:null}),300))}}),E.item&&a.jsx(zn,{user:E.item.user,open:E.open,onOpenChange:e=>{e?T(s=>({...s,open:e})):(T(e=>({...e,open:!1})),setTimeout(()=>T({open:!1,item:null}),300))},onSuccess:()=>{z(m),null==e||e()}}),a.jsx(dn,{open:R.open,onOpenChange:e=>{e?A(s=>({...s,open:e})):(A(e=>({...e,open:!1})),setTimeout(()=>A({open:!1,item:null,isLoading:!1}),300))},children:a.jsxs(xn,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Активировать студента"})}),a.jsx("div",{className:"py-4",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Вы уверены, что хотите активировать студента ",a.jsx("strong",{children:null==(s=R.item)?void 0:s.user.full_name}),"?"]})}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>A({open:!1,item:null,isLoading:!1}),disabled:R.isLoading,children:"Отменить"}),a.jsx(Ba,{type:"button",onClick:async()=>{if(R.item){A(e=>({...e,isLoading:!0}));try{const s=await ln.reactivateUser(R.item.user.id);s.success?(_e.success("Студент успешно активирован"),A({open:!1,item:null,isLoading:!1}),await z(m),null==e||e()):_e.error(s.error||"Ошибка при активации")}catch(s){const e=s instanceof Error?s.message:"Неизвестная ошибка";_e.error(e)}finally{A(e=>({...e,isLoading:!1}))}}},disabled:R.isLoading,children:R.isLoading?"Активация...":"Активировать"})]})]})}),P.item&&a.jsx(On,{open:P.open,onOpenChange:e=>{e?L(s=>({...s,open:e})):(L(e=>({...e,open:!1})),setTimeout(()=>L({open:!1,item:null}),300))},studentId:P.item.id,studentName:P.item.user.full_name,onSuccess:()=>{z(m)}}),q.item&&a.jsx(Bn,{open:q.open,onOpenChange:e=>{e?I(s=>({...s,open:e})):(I(e=>({...e,open:!1})),setTimeout(()=>I({open:!1,item:null}),300))},userId:q.item.user.id,role:"student",onUpdate:()=>{z(m),null==e||e()}})]})}Hn.displayName=ne.displayName;const Jn={async list(e){const s=Date.now(),t=await Sa.request(`/auth/staff/?role=${e}&_=${s}`,{method:"GET"});if(!t.success)throw la.error("Error loading staff list:",t.error),new Error(t.error||"Не удалось получить список");let a=[];return Array.isArray(t.data)?a=t.data:t.data&&"object"==typeof t.data&&"results"in t.data&&(a=t.data.results||[]),la.debug(`[staffService] Loaded ${a.length} ${e}s`,{dataType:typeof t.data,isArray:Array.isArray(t.data)}),a},async create(e){const s=await Sa.request("/auth/staff/create/",{method:"POST",body:JSON.stringify(e)});if(!s.success)throw new Error(s.error||"Не удалось создать пользователя");return s.data},async getAllSubjects(){const e=await Sa.request("/materials/subjects/all/",{method:"GET"});if(!e.success)throw new Error(e.error||"Не удалось загрузить предметы");const s=e.data;return Array.isArray(s)?s:s.results||[]},async updateTeacherSubjects(e,s){const t=await Sa.request(`/auth/staff/teachers/${e}/subjects/`,{method:"PATCH",body:JSON.stringify({subject_ids:s})});if(!t.success)throw new Error(t.error||"Не удалось обновить предметы")}},Kn=({value:e,onChange:s,disabled:r})=>{const[n,i]=t.useState([]),[l,o]=t.useState(!0),[c,d]=t.useState(null);t.useEffect(()=>{(async()=>{try{o(!0),d(null);const e=await Sa.request("/materials/subjects/all/",{method:"GET"});if(!e.success)throw new Error(e.error||"Ошибка загрузки предметов");const s=e.data,t=Array.isArray(s)?s:s.results||[];i(t)}catch(e){la.error("Error loading subjects:",e),d(e.message||"Не удалось загрузить список предметов")}finally{o(!1)}})()},[]);return l?a.jsxs("div",{className:"flex items-center justify-center p-4",children:[a.jsx(Ee,{className:"h-6 w-6 animate-spin text-muted-foreground"}),a.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Загрузка предметов..."})]}):c?a.jsx("div",{className:"p-4 text-sm text-destructive border border-destructive rounded-md",children:c}):0===n.length?a.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Предметы не найдены"}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(cn,{className:"text-sm font-medium",children:"Выберите предметы"}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["Выбрано: ",e.length," из ",n.length]})]}),e.length>0&&a.jsx("div",{className:"flex flex-wrap gap-1 p-2 bg-muted rounded-md",children:e.map(e=>{const s=n.find(s=>s.id===e);return s?a.jsx(Ya,{variant:"secondary",children:s.name},e):null})}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-[400px] overflow-y-auto p-2 border rounded-md",children:n.map(t=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(In,{id:`subject-${t.id}`,checked:e.includes(t.id),onCheckedChange:a=>((t,a)=>{s(a?[...e,t]:e.filter(e=>e!==t))})(t.id,!0===a),disabled:r}),a.jsxs(cn,{htmlFor:`subject-${t.id}`,className:"text-sm cursor-pointer "+(r?"opacity-50":""),children:[t.name,t.description&&a.jsx("span",{className:"block text-xs text-muted-foreground mt-0.5",children:t.description})]})]},t.id))})]})},Gn=({value:e,onChange:s,placeholder:r="Выберите студентов...",maxHeight:n=400,disabled:i})=>{const[l,o]=t.useState([]),[c,d]=t.useState(!0),[u,m]=t.useState(null);t.useEffect(()=>{(async()=>{try{d(!0),m(null);const e=await ln.getStudents({is_active:!0,page_size:1e3});if(!e.success)throw new Error(e.error||"Ошибка загрузки студентов");const s=e.data,t=(null==s?void 0:s.results)||[];o(t)}catch(e){la.error("Error loading students:",e),m(e.message||"Не удалось загрузить список студентов")}finally{d(!1)}})()},[]);return c?a.jsxs("div",{className:"flex items-center justify-center p-4",children:[a.jsx(Ee,{className:"h-6 w-6 animate-spin text-muted-foreground"}),a.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Загрузка студентов..."})]}):u?a.jsx("div",{className:"p-4 text-sm text-destructive border border-destructive rounded-md",children:u}):0===l.length?a.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Студенты не найдены"}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-xs text-muted-foreground",children:r}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["Выбрано: ",e.length," из ",l.length]})]}),e.length>0&&a.jsx("div",{className:"flex flex-wrap gap-1 p-2 bg-muted rounded-md",children:e.map(e=>{const s=l.find(s=>s.id===e);return s?a.jsxs(Ya,{variant:"secondary",children:[s.user.first_name," ",s.user.last_name]},e):null})}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 overflow-y-auto p-2 border rounded-md",style:{maxHeight:`${n}px`},children:l.map(t=>a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(In,{id:`student-${t.id}`,checked:e.includes(t.id),onCheckedChange:a=>((t,a)=>{s(a?[...e,t]:e.filter(e=>e!==t))})(t.id,!0===a),disabled:i}),a.jsxs(cn,{htmlFor:`student-${t.id}`,className:"text-sm cursor-pointer "+(i?"opacity-50":""),children:[t.user.first_name," ",t.user.last_name,t.grade&&a.jsxs("span",{className:"block text-xs text-muted-foreground mt-0.5",children:["Класс: ",t.grade]})]})]},t.id))})]})},Yn=({teacher:e,open:s,onOpenChange:r,onSuccess:n})=>{const[i,l]=t.useState(!1),[o,c]=t.useState(null),[d,u]=t.useState({first_name:e.user.first_name||"",last_name:e.user.last_name||"",email:e.user.email||"",phone:e.user.phone||"",is_active:!1!==e.user.is_active,experience_years:e.experience_years||0,bio:e.bio||""}),[m,h]=t.useState([]),[x,p]=t.useState([]);t.useEffect(()=>{var t;s&&e&&(u({first_name:e.user.first_name||"",last_name:e.user.last_name||"",email:e.user.email||"",phone:e.user.phone||"",is_active:!1!==e.user.is_active,experience_years:e.experience_years||0,bio:e.bio||""}),h((null==(t=e.subjects)?void 0:t.map(e=>e.id))||[]),p([]),c(null))},[s,e]);const g=e=>{const s=e.replace(/\D/g,"");return s.startsWith("8")?"+7"+s.slice(1):s.startsWith("7")?"+"+s:10===s.length?"+7"+s:e};return a.jsx(dn,{open:s,onOpenChange:r,children:a.jsxs(xn,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Редактировать преподавателя"})}),a.jsxs("form",{onSubmit:async s=>{if(s.preventDefault(),c(null),d.email&&d.first_name&&d.last_name)if(t=d.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){var t;l(!0);try{const s={email:d.email.trim().toLowerCase(),first_name:d.first_name.trim(),last_name:d.last_name.trim(),phone:d.phone?g(d.phone):void 0,is_active:d.is_active,experience_years:d.experience_years,bio:d.bio||void 0,subject_ids:m.length>0?m:void 0},t=await ln.editTeacher(e.id,s);if(t.success){if(x.length>0&&m.length>0)try{for(const s of m)await ln.assignStudentsToTeacher(e.id,{student_ids:x,subject_id:s});_e.success("Преподаватель обновлен и студенты успешно назначены")}catch(a){la.error("Error assigning students to teacher:",a),_e.warning("Преподаватель обновлен, но произошла ошибка при назначении студентов")}else _e.success("Преподаватель успешно обновлен");p([]),n(),r(!1)}else c(t.error||"Ошибка обновления преподавателя")}catch(i){c((null==i?void 0:i.message)||"Произошла ошибка при обновлении преподавателя")}finally{l(!1)}}else c("Некорректный формат email");else c("Email, имя и фамилия обязательны")},children:[a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsx("h3",{className:"text-sm font-medium",children:"Базовая информация"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"email",children:"Email *"}),a.jsx(Pr,{id:"email",type:"email",value:d.email,onChange:e=>u({...d,email:e.target.value}),required:!0,disabled:i})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"first_name",children:"Имя *"}),a.jsx(Pr,{id:"first_name",value:d.first_name,onChange:e=>u({...d,first_name:e.target.value}),required:!0,disabled:i})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"last_name",children:"Фамилия *"}),a.jsx(Pr,{id:"last_name",value:d.last_name,onChange:e=>u({...d,last_name:e.target.value}),required:!0,disabled:i})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"phone",children:"Телефон"}),a.jsx(Pr,{id:"phone",type:"tel",value:d.phone,onChange:e=>u({...d,phone:e.target.value}),placeholder:"+7XXXXXXXXXX",disabled:i}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Формат: +7XXXXXXXXXX"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(bn,{id:"is_active",checked:d.is_active,onCheckedChange:e=>u({...d,is_active:e}),disabled:i}),a.jsx(cn,{htmlFor:"is_active",className:"cursor-pointer",children:"Активен"})]}),a.jsxs("div",{className:"border-t pt-4 mt-4",children:[a.jsx("h3",{className:"text-sm font-medium mb-3",children:"Профиль преподавателя"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"experience_years",children:"Опыт работы (лет)"}),a.jsx(Pr,{id:"experience_years",type:"number",value:d.experience_years,onChange:e=>u({...d,experience_years:parseInt(e.target.value)||0}),disabled:i,min:"0"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"bio",children:"Биография"}),a.jsx(yn,{id:"bio",value:d.bio,onChange:e=>u({...d,bio:e.target.value}),disabled:i,placeholder:"Расскажите о преподавателе",rows:4})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{children:"Предметы"}),a.jsx(Kn,{value:m,onChange:h,disabled:i})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"assigned_students",children:"Назначенные студенты"}),a.jsx(Gn,{value:x,onChange:p,placeholder:"Выберите студентов для назначения...",maxHeight:300,disabled:i}),a.jsx("p",{className:"text-sm text-gray-500",children:"Выбранные студенты будут назначены на выбранные предметы учителя"})]})]})]})]}),o&&a.jsxs(Rn,{variant:"destructive",className:"mb-4",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:o})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:i,children:"Отмена"}),a.jsx(Ba,{type:"submit",disabled:i,children:i?"Сохранение...":"Сохранить"})]})]})]})})},Qn=({teacher:e,open:s,onOpenChange:r,onSuccess:n})=>{const[i,l]=t.useState([]),[o,c]=t.useState(!1),[d,u]=t.useState(null);t.useEffect(()=>{s&&e.subjects&&(l(e.subjects.map(e=>e.id)),u(null))},[s,e]);return a.jsx(dn,{open:s,onOpenChange:r,children:a.jsxs(xn,{className:"max-w-2xl",children:[a.jsxs(pn,{children:[a.jsx(fn,{children:"Редактировать предметы преподавателя"}),a.jsxs(jn,{children:[e.user.first_name," ",e.user.last_name," (",e.user.email,")"]})]}),a.jsx("div",{className:"py-4",children:a.jsx(Kn,{value:i,onChange:l,disabled:o})}),d&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:d})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>{u(null),r(!1)},disabled:o,children:"Отмена"}),a.jsx(Ba,{type:"button",onClick:async()=>{try{if(c(!0),u(null),0===i.length)return void u("Выберите хотя бы один предмет");await Jn.updateTeacherSubjects(e.id,i),n(),r(!1)}catch(s){la.error("Error updating teacher subjects:",s),u(s.message||"Ошибка сохранения предметов")}finally{c(!1)}},disabled:o||0===i.length,children:o?a.jsxs(a.Fragment,{children:[a.jsx(Ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Сохранение..."]}):"Сохранить"})]})]})})};function Zn({onUpdate:e}){var s;const[r,n]=t.useState([]),[i,l]=t.useState([]),[o,c]=t.useState(!1),[d,u]=t.useState(!1),[m,h]=t.useState(""),[x,p]=t.useState(null),[g,f]=t.useState({open:!1,teacher:null}),[j,v]=t.useState({open:!1,teacher:null}),[y,b]=t.useState({open:!1,item:null}),[N,w]=t.useState({open:!1,item:null}),[_,S]=t.useState({open:!1,item:null,isLoading:!1}),[k,C]=t.useState({open:!1,item:null}),[E,T]=t.useState({email:"",first_name:"",last_name:"",subject:"",experience_years:0,bio:""}),R=t.useCallback(async()=>{c(!0);try{const e=await Jn.list("teacher");n(e),l(e)}catch(e){_e.error((null==e?void 0:e.message)||"Ошибка загрузки списка")}finally{c(!1)}},[]);t.useEffect(()=>{R()},[R]),t.useEffect(()=>{if(!m)return void l(r);const e=m.toLowerCase(),s=r.filter(s=>{var t,a,r;const n=(null==(t=s.user.full_name)?void 0:t.toLowerCase())||"",i=(null==(a=s.user.email)?void 0:a.toLowerCase())||"",l=(null==(r=s.subjects)?void 0:r.map(e=>e.name.toLowerCase()).join(" "))||"";return n.includes(e)||i.includes(e)||l.includes(e)});l(s)},[m,r]);return a.jsxs(a.Fragment,{children:[a.jsxs(Fa,{children:[a.jsxs(Ma,{className:"flex flex-row items-center justify-between",children:[a.jsx($a,{children:"Преподаватели"}),a.jsxs(Ba,{type:"button",onClick:()=>{T({email:"",first_name:"",last_name:"",subject:"",experience_years:0,bio:""}),p(null),u(!0)},children:[a.jsx(Be,{className:"h-4 w-4 mr-2"}),"Создать преподавателя"]})]}),a.jsxs(Va,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx(cn,{className:"text-sm",children:"Поиск"}),a.jsxs("div",{className:"flex gap-2 mt-2",children:[a.jsx(Pr,{placeholder:"ФИО, email, предметы...",value:m,onChange:e=>h(e.target.value),className:"flex-1"}),a.jsx(Ba,{type:"button",variant:"outline",size:"icon",children:a.jsx(Ye,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left border-b",children:[a.jsx("th",{className:"py-2 pr-4",children:"ФИО"}),a.jsx("th",{className:"py-2 pr-4",children:"Email"}),a.jsx("th",{className:"py-2 pr-4",children:"Предметы"}),a.jsx("th",{className:"py-2 pr-4",children:"Опыт"}),a.jsx("th",{className:"py-2 pr-4",children:"Действия"})]})}),a.jsx("tbody",{children:o?a.jsx("tr",{children:a.jsx("td",{className:"py-4",colSpan:5,children:"Загрузка..."})}):i&&0!==i.length?i.map(e=>{var s;return a.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[a.jsx("td",{className:"py-2 pr-4",children:e.user.full_name}),a.jsx("td",{className:"py-2 pr-4",children:e.user.email}),a.jsx("td",{className:"py-2 pr-4",children:e.subjects&&e.subjects.length>0?a.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.subjects.slice(0,3).map(e=>a.jsx(Ya,{variant:"secondary",children:e.name},e.id)),e.subjects.length>3&&a.jsxs(Ya,{variant:"outline",children:["+",e.subjects.length-3," ещё"]})]}):a.jsx("span",{className:"text-muted-foreground text-xs",children:"Не назначены"})}),a.jsx("td",{className:"py-2 pr-4",children:null!=(s=e.experience_years)?s:0}),a.jsx("td",{className:"py-2 pr-4",children:a.jsxs("div",{className:"flex gap-1",children:[a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>C({open:!0,item:e}),title:"Просмотреть профиль",children:a.jsx(Qe,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>v({open:!0,teacher:e}),title:"Редактировать предметы",children:a.jsx(Xe,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>f({open:!0,teacher:e}),title:"Редактировать преподавателя",children:a.jsx(Ge,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>b({open:!0,item:e}),title:"Сбросить пароль",children:a.jsx(es,{className:"h-4 w-4"})}),!e.user.is_active&&a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>S({open:!0,item:e,isLoading:!1}),title:"Активировать преподавателя",children:a.jsx(ss,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"destructive",onClick:()=>w({open:!0,item:e}),title:"Удалить пользователя",children:a.jsx(He,{className:"h-4 w-4"})})]})})]},e.id)}):a.jsx("tr",{children:a.jsx("td",{className:"py-4",colSpan:5,children:m?"Преподаватели не найдены по запросу":"Преподаватели не найдены"})})})]})})]})]}),a.jsx(dn,{open:d,onOpenChange:u,children:a.jsxs(xn,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Создание преподавателя"})}),a.jsxs("div",{className:"grid gap-3 py-2",children:[a.jsxs("div",{children:[a.jsx(cn,{children:"Email"}),a.jsx(Pr,{type:"email",autoComplete:"username",value:E.email,onChange:e=>T({...E,email:e.target.value})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx(cn,{children:"Имя"}),a.jsx(Pr,{value:E.first_name,onChange:e=>T({...E,first_name:e.target.value})})]}),a.jsxs("div",{children:[a.jsx(cn,{children:"Фамилия"}),a.jsx(Pr,{value:E.last_name,onChange:e=>T({...E,last_name:e.target.value})})]})]}),a.jsxs("div",{children:[a.jsx(cn,{children:"Предмет"}),a.jsx(Pr,{value:E.subject,onChange:e=>T({...E,subject:e.target.value})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx(cn,{children:"Опыт (лет)"}),a.jsx(Pr,{type:"number",value:E.experience_years,onChange:e=>T({...E,experience_years:Number(e.target.value)})})]}),a.jsxs("div",{children:[a.jsx(cn,{children:"Био"}),a.jsx(Pr,{value:E.bio,onChange:e=>T({...E,bio:e.target.value})})]})]})]}),a.jsx(gn,{children:a.jsx(Ba,{type:"button",onClick:async()=>{try{if(!E.email||!E.first_name||!E.last_name)return void _e.error("Заполните email, имя и фамилию");if(!E.subject)return void _e.error("Укажите предмет");const s={role:"teacher",email:E.email.trim().toLowerCase(),first_name:E.first_name.trim(),last_name:E.last_name.trim(),experience_years:E.experience_years||void 0,bio:E.bio||void 0,subject:E.subject},t=await Jn.create(s);la.debug("[TeacherSection] Teacher created:",t),p(t.credentials),u(!1),_e.success("Преподаватель создан"),await R(),null==e||e()}catch(s){_e.error((null==s?void 0:s.message)||"Не удалось создать преподавателя"),la.error("Error creating teacher:",s)}},children:"Создать"})})]})}),a.jsx(dn,{open:!!x,onOpenChange:e=>!e&&p(null),children:a.jsxs(xn,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Учетные данные (показаны один раз)"})}),x&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"font-medium",children:"Логин (email):"})," ",a.jsx("span",{children:x.login})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"font-medium",children:"Пароль:"})," ",a.jsx("span",{children:x.password})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Скопируйте эти данные и отправьте преподавателю. После закрытия окна они больше не будут показаны."}),a.jsx("div",{className:"flex gap-2",children:a.jsx(Ba,{type:"button",onClick:()=>navigator.clipboard.writeText(`${x.login} ${x.password}`),children:"Скопировать"})})]})]})}),g.teacher&&a.jsx(Yn,{teacher:g.teacher,open:g.open,onOpenChange:e=>{e?f(s=>({...s,open:e})):(f(e=>({...e,open:!1})),setTimeout(()=>f({open:!1,teacher:null}),300))},onSuccess:()=>{_e.success("Преподаватель успешно обновлен"),R(),null==e||e()}}),j.teacher&&a.jsx(Qn,{teacher:j.teacher,open:j.open,onOpenChange:e=>{e?v(s=>({...s,open:e})):(v(e=>({...e,open:!1})),setTimeout(()=>v({open:!1,teacher:null}),300))},onSuccess:()=>{_e.success("Предметы обновлены"),R()}}),y.item&&a.jsx(qn,{user:y.item.user,open:y.open,onOpenChange:e=>{e?b(s=>({...s,open:e})):(b(e=>({...e,open:!1})),setTimeout(()=>b({open:!1,item:null}),300))}}),N.item&&a.jsx(zn,{user:N.item.user,open:N.open,onOpenChange:e=>{e?w(s=>({...s,open:e})):(w(e=>({...e,open:!1})),setTimeout(()=>w({open:!1,item:null}),300))},onSuccess:()=>{R(),null==e||e()}}),a.jsx(dn,{open:_.open,onOpenChange:e=>{e?S(s=>({...s,open:e})):(S(e=>({...e,open:!1})),setTimeout(()=>S({open:!1,item:null,isLoading:!1}),300))},children:a.jsxs(xn,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Активировать преподавателя"})}),a.jsx("div",{className:"py-4",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Вы уверены, что хотите активировать преподавателя ",a.jsx("strong",{children:null==(s=_.item)?void 0:s.user.full_name}),"?"]})}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>S({open:!1,item:null,isLoading:!1}),disabled:_.isLoading,children:"Отменить"}),a.jsx(Ba,{type:"button",onClick:async()=>{if(_.item){S(e=>({...e,isLoading:!0}));try{const s=await ln.reactivateUser(_.item.user.id);s.success?(_e.success("Преподаватель успешно активирован"),S({open:!1,item:null,isLoading:!1}),await R(),null==e||e()):_e.error(s.error||"Ошибка при активации")}catch(s){const e=s instanceof Error?s.message:"Неизвестная ошибка";_e.error(e)}finally{S(e=>({...e,isLoading:!1}))}}},disabled:_.isLoading,children:_.isLoading?"Активация...":"Активировать"})]})]})}),k.item&&a.jsx(Bn,{open:k.open,onOpenChange:e=>{e?C(s=>({...s,open:e})):(C(e=>({...e,open:!1})),setTimeout(()=>C({open:!1,item:null}),300))},userId:k.item.user.id,role:"teacher",onUpdate:()=>{R(),null==e||e()}})]})}const ei=({tutor:e,open:s,onOpenChange:r,onSuccess:n})=>{const[i,l]=t.useState(!1),[o,c]=t.useState(null),[d,u]=t.useState({first_name:e.user.first_name||"",last_name:e.user.last_name||"",email:e.user.email||"",phone:e.user.phone||"",is_active:!1!==e.user.is_active,specialization:e.specialization||"",experience_years:e.experience_years||0,bio:e.bio||""});t.useEffect(()=>{s&&e&&(u({first_name:e.user.first_name||"",last_name:e.user.last_name||"",email:e.user.email||"",phone:e.user.phone||"",is_active:!1!==e.user.is_active,specialization:e.specialization||"",experience_years:e.experience_years||0,bio:e.bio||""}),c(null))},[s,e]);const m=e=>{const s=e.replace(/\D/g,"");return s.startsWith("8")?"+7"+s.slice(1):s.startsWith("7")?"+"+s:10===s.length?"+7"+s:e};return a.jsx(dn,{open:s,onOpenChange:r,children:a.jsxs(xn,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Редактировать тьютора"})}),a.jsxs("form",{onSubmit:async s=>{var t;if(s.preventDefault(),c(null),d.email&&d.first_name&&d.last_name)if(t=d.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))if(d.specialization){l(!0);try{const s={email:d.email.trim().toLowerCase(),first_name:d.first_name.trim(),last_name:d.last_name.trim(),phone:d.phone?m(d.phone):void 0,is_active:d.is_active,specialization:d.specialization.trim(),experience_years:d.experience_years,bio:d.bio||void 0},t=await ln.editTutor(e.id,s);t.success?(_e.success("Тьютор успешно обновлен"),n(),r(!1)):c(t.error||"Ошибка обновления тьютора")}catch(a){c((null==a?void 0:a.message)||"Произошла ошибка при обновлении тьютора")}finally{l(!1)}}else c("Специализация обязательна для тьютора");else c("Некорректный формат email");else c("Email, имя и фамилия обязательны")},children:[a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsx("h3",{className:"text-sm font-medium",children:"Базовая информация"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"email",children:"Email *"}),a.jsx(Pr,{id:"email",type:"email",value:d.email,onChange:e=>u({...d,email:e.target.value}),required:!0,disabled:i})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"first_name",children:"Имя *"}),a.jsx(Pr,{id:"first_name",value:d.first_name,onChange:e=>u({...d,first_name:e.target.value}),required:!0,disabled:i})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"last_name",children:"Фамилия *"}),a.jsx(Pr,{id:"last_name",value:d.last_name,onChange:e=>u({...d,last_name:e.target.value}),required:!0,disabled:i})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"phone",children:"Телефон"}),a.jsx(Pr,{id:"phone",type:"tel",value:d.phone,onChange:e=>u({...d,phone:e.target.value}),placeholder:"+7XXXXXXXXXX",disabled:i}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Формат: +7XXXXXXXXXX"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(bn,{id:"is_active",checked:d.is_active,onCheckedChange:e=>u({...d,is_active:e}),disabled:i}),a.jsx(cn,{htmlFor:"is_active",className:"cursor-pointer",children:"Активен"})]}),a.jsxs("div",{className:"border-t pt-4 mt-4",children:[a.jsx("h3",{className:"text-sm font-medium mb-3",children:"Профиль тьютора"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"specialization",children:"Специализация *"}),a.jsx(Pr,{id:"specialization",value:d.specialization,onChange:e=>u({...d,specialization:e.target.value}),required:!0,disabled:i,placeholder:"Например: Математика"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"experience_years",children:"Опыт работы (лет)"}),a.jsx(Pr,{id:"experience_years",type:"number",value:d.experience_years,onChange:e=>u({...d,experience_years:parseInt(e.target.value)||0}),disabled:i,min:"0"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"bio",children:"Биография"}),a.jsx(yn,{id:"bio",value:d.bio,onChange:e=>u({...d,bio:e.target.value}),disabled:i,placeholder:"Расскажите о тьюторе",rows:4})]})]})]})]}),o&&a.jsxs(Rn,{variant:"destructive",className:"mb-4",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:o})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:i,children:"Отмена"}),a.jsx(Ba,{type:"submit",disabled:i,children:i?"Сохранение...":"Сохранить"})]})]})]})})};function si({onUpdate:e}){var s;const[r,n]=t.useState([]),[i,l]=t.useState([]),[o,c]=t.useState(!1),[d,u]=t.useState(!1),[m,h]=t.useState(""),[x,p]=t.useState(null),[g,f]=t.useState({open:!1,tutor:null}),[j,v]=t.useState({open:!1,item:null}),[y,b]=t.useState({open:!1,item:null}),[N,w]=t.useState({open:!1,item:null,isLoading:!1}),[_,S]=t.useState({open:!1,item:null}),[k,C]=t.useState({email:"",first_name:"",last_name:"",specialization:"",experience_years:0,bio:""}),E=t.useCallback(async()=>{c(!0);try{const e=await Jn.list("tutor");n(e),l(e)}catch(e){_e.error((null==e?void 0:e.message)||"Ошибка загрузки списка")}finally{c(!1)}},[]);t.useEffect(()=>{E()},[E]),t.useEffect(()=>{if(!m)return void l(r);const e=m.toLowerCase(),s=r.filter(s=>{var t,a,r;const n=(null==(t=s.user.full_name)?void 0:t.toLowerCase())||"",i=(null==(a=s.user.email)?void 0:a.toLowerCase())||"",l=(null==(r=s.specialization)?void 0:r.toLowerCase())||"";return n.includes(e)||i.includes(e)||l.includes(e)});l(s)},[m,r]);return a.jsxs(a.Fragment,{children:[a.jsxs(Fa,{children:[a.jsxs(Ma,{className:"flex flex-row items-center justify-between",children:[a.jsx($a,{children:"Тьютеры"}),a.jsxs(Ba,{type:"button",onClick:()=>{C({email:"",first_name:"",last_name:"",specialization:"",experience_years:0,bio:""}),p(null),u(!0)},children:[a.jsx(Be,{className:"h-4 w-4 mr-2"}),"Создать тьютера"]})]}),a.jsxs(Va,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx(cn,{className:"text-sm",children:"Поиск"}),a.jsxs("div",{className:"flex gap-2 mt-2",children:[a.jsx(Pr,{placeholder:"ФИО, email, специализация...",value:m,onChange:e=>h(e.target.value),className:"flex-1"}),a.jsx(Ba,{type:"button",variant:"outline",size:"icon",children:a.jsx(Ye,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left border-b",children:[a.jsx("th",{className:"py-2 pr-4",children:"ФИО"}),a.jsx("th",{className:"py-2 pr-4",children:"Email"}),a.jsx("th",{className:"py-2 pr-4",children:"Специализация"}),a.jsx("th",{className:"py-2 pr-4",children:"Опыт"}),a.jsx("th",{className:"py-2 pr-4",children:"Действия"})]})}),a.jsx("tbody",{children:o?a.jsx("tr",{children:a.jsx("td",{className:"py-4",colSpan:5,children:"Загрузка..."})}):i&&0!==i.length?i.map(e=>{var s;return a.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[a.jsx("td",{className:"py-2 pr-4",children:e.user.full_name}),a.jsx("td",{className:"py-2 pr-4",children:e.user.email}),a.jsx("td",{className:"py-2 pr-4",children:e.specialization||"-"}),a.jsx("td",{className:"py-2 pr-4",children:null!=(s=e.experience_years)?s:0}),a.jsx("td",{className:"py-2 pr-4",children:a.jsxs("div",{className:"flex gap-1",children:[a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>S({open:!0,item:e}),title:"Просмотреть профиль",children:a.jsx(Qe,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>f({open:!0,tutor:e}),title:"Редактировать тьютора",children:a.jsx(Ge,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>v({open:!0,item:e}),title:"Сбросить пароль",children:a.jsx(es,{className:"h-4 w-4"})}),!e.user.is_active&&a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>w({open:!0,item:e,isLoading:!1}),title:"Активировать тьютора",children:a.jsx(ss,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"destructive",onClick:()=>b({open:!0,item:e}),title:"Удалить пользователя",children:a.jsx(He,{className:"h-4 w-4"})})]})})]},e.id)}):a.jsx("tr",{children:a.jsx("td",{className:"py-4",colSpan:5,children:m?"Тьютеры не найдены по запросу":"Тьютеры не найдены"})})})]})})]})]}),a.jsx(dn,{open:d,onOpenChange:u,children:a.jsxs(xn,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Создание тьютора"})}),a.jsxs("div",{className:"grid gap-3 py-2",children:[a.jsxs("div",{children:[a.jsx(cn,{children:"Email"}),a.jsx(Pr,{type:"email",autoComplete:"username",value:k.email,onChange:e=>C({...k,email:e.target.value})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx(cn,{children:"Имя"}),a.jsx(Pr,{value:k.first_name,onChange:e=>C({...k,first_name:e.target.value})})]}),a.jsxs("div",{children:[a.jsx(cn,{children:"Фамилия"}),a.jsx(Pr,{value:k.last_name,onChange:e=>C({...k,last_name:e.target.value})})]})]}),a.jsxs("div",{children:[a.jsx(cn,{children:"Специализация"}),a.jsx(Pr,{value:k.specialization,onChange:e=>C({...k,specialization:e.target.value})})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx(cn,{children:"Опыт (лет)"}),a.jsx(Pr,{type:"number",value:k.experience_years,onChange:e=>C({...k,experience_years:Number(e.target.value)})})]}),a.jsxs("div",{children:[a.jsx(cn,{children:"Био"}),a.jsx(Pr,{value:k.bio,onChange:e=>C({...k,bio:e.target.value})})]})]})]}),a.jsx(gn,{children:a.jsx(Ba,{type:"button",onClick:async()=>{try{if(!k.email||!k.first_name||!k.last_name)return void _e.error("Заполните email, имя и фамилию");if(!k.specialization)return void _e.error("Укажите специализацию");const s={role:"tutor",email:k.email.trim().toLowerCase(),first_name:k.first_name.trim(),last_name:k.last_name.trim(),experience_years:k.experience_years||void 0,bio:k.bio||void 0,specialization:k.specialization},t=await Jn.create(s);la.debug("[TutorSection] Tutor created:",t),p(t.credentials),u(!1),_e.success("Тьютор создан"),await E(),null==e||e()}catch(s){_e.error((null==s?void 0:s.message)||"Не удалось создать тьютора"),la.error("Error creating tutor:",s)}},children:"Создать"})})]})}),a.jsx(dn,{open:!!x,onOpenChange:e=>!e&&p(null),children:a.jsxs(xn,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Учетные данные (показаны один раз)"})}),x&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"font-medium",children:"Логин (email):"})," ",a.jsx("span",{children:x.login})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"font-medium",children:"Пароль:"})," ",a.jsx("span",{children:x.password})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Скопируйте эти данные и отправьте тьютору. После закрытия окна они больше не будут показаны."}),a.jsx("div",{className:"flex gap-2",children:a.jsx(Ba,{type:"button",onClick:()=>navigator.clipboard.writeText(`${x.login} ${x.password}`),children:"Скопировать"})})]})]})}),g.tutor&&a.jsx(ei,{tutor:g.tutor,open:g.open,onOpenChange:e=>{e?f(s=>({...s,open:e})):(f(e=>({...e,open:!1})),setTimeout(()=>f({open:!1,tutor:null}),300))},onSuccess:()=>{_e.success("Тьютор успешно обновлен"),E(),null==e||e()}}),j.item&&a.jsx(qn,{user:j.item.user,open:j.open,onOpenChange:e=>{e?v(s=>({...s,open:e})):(v(e=>({...e,open:!1})),setTimeout(()=>v({open:!1,item:null}),300))}}),y.item&&a.jsx(zn,{user:y.item.user,open:y.open,onOpenChange:e=>{e?b(s=>({...s,open:e})):(b(e=>({...e,open:!1})),setTimeout(()=>b({open:!1,item:null}),300))},onSuccess:()=>{E(),null==e||e()}}),_.item&&a.jsx(Bn,{open:_.open,onOpenChange:e=>{e?S(s=>({...s,open:e})):(S(e=>({...e,open:!1})),setTimeout(()=>S({open:!1,item:null}),300))},userId:_.item.user.id,role:"tutor",onUpdate:()=>{E(),null==e||e()}}),a.jsx(dn,{open:N.open,onOpenChange:e=>{e?w(s=>({...s,open:e})):(w(e=>({...e,open:!1})),setTimeout(()=>w({open:!1,item:null,isLoading:!1}),300))},children:a.jsxs(xn,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Активировать тьютора"})}),a.jsx("div",{className:"py-4",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Вы уверены, что хотите активировать тьютора ",a.jsx("strong",{children:null==(s=N.item)?void 0:s.user.full_name}),"?"]})}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>w({open:!1,item:null,isLoading:!1}),disabled:N.isLoading,children:"Отменить"}),a.jsx(Ba,{type:"button",onClick:async()=>{if(N.item){w(e=>({...e,isLoading:!0}));try{const s=await ln.reactivateUser(N.item.user.id);s.success?(_e.success("Тьютор успешно активирован"),w({open:!1,item:null,isLoading:!1}),await E(),null==e||e()):_e.error(s.error||"Ошибка при активации")}catch(s){const e=s instanceof Error?s.message:"Неизвестная ошибка";_e.error(e)}finally{w(e=>({...e,isLoading:!1}))}}},disabled:N.isLoading,children:N.isLoading?"Активация...":"Активировать"})]})]})})]})}const ti=({open:e,onOpenChange:s,onSuccess:r})=>{const[n,i]=t.useState("form"),[l,o]=t.useState(!1),[c,d]=t.useState(null),[u,m]=t.useState(null),[h,x]=t.useState({email:"",first_name:"",last_name:"",phone:"",password:""}),p=e=>{const s=e.replace(/\D/g,"");return s.startsWith("8")?"+7"+s.slice(1):s.startsWith("7")?"+"+s:10===s.length?"+7"+s:e},g=()=>{i("form"),x({email:"",first_name:"",last_name:"",phone:"",password:""}),m(null),d(null),s(!1)};return a.jsx(dn,{open:e,onOpenChange:g,children:a.jsx(xn,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:"form"===n?a.jsxs(a.Fragment,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Создать родителя"})}),a.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d(null),h.email&&h.first_name&&h.last_name)if(s=h.email,/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)){var s;o(!0);try{const e={email:h.email.trim().toLowerCase(),first_name:h.first_name.trim(),last_name:h.last_name.trim(),phone:h.phone?p(h.phone):void 0,password:h.password||void 0},s=await ln.createParent(e);s.success&&s.data?(m(s.data.credentials),i("success"),_e.success("Родитель успешно создан")):d(s.error||"Не удалось создать родителя")}catch(t){d((null==t?void 0:t.message)||"Произошла ошибка при создании родителя")}finally{o(!1)}}else d("Некорректный формат email");else d("Email, имя и фамилия обязательны")},children:[a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"email",children:"Email *"}),a.jsx(Pr,{id:"email",type:"email",value:h.email,onChange:e=>x({...h,email:e.target.value}),required:!0,disabled:l,placeholder:"parent@example.com",autoComplete:"username"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"first_name",children:"Имя *"}),a.jsx(Pr,{id:"first_name",value:h.first_name,onChange:e=>x({...h,first_name:e.target.value}),required:!0,disabled:l,placeholder:"Иван"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"last_name",children:"Фамилия *"}),a.jsx(Pr,{id:"last_name",value:h.last_name,onChange:e=>x({...h,last_name:e.target.value}),required:!0,disabled:l,placeholder:"Иванов"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"phone",children:"Телефон"}),a.jsx(Pr,{id:"phone",type:"tel",value:h.phone,onChange:e=>x({...h,phone:e.target.value}),placeholder:"+7XXXXXXXXXX",disabled:l})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"password",children:"Пароль (оставьте пустым для автогенерации)"}),a.jsx(Pr,{id:"password",type:"password",autoComplete:"new-password",value:h.password,onChange:e=>x({...h,password:e.target.value}),disabled:l,placeholder:"Автоматический пароль"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Если не указан, будет сгенерирован случайный пароль"})]})]}),c&&a.jsxs(Rn,{variant:"destructive",className:"mb-4",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:c})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:g,disabled:l,children:"Отмена"}),a.jsx(Ba,{type:"submit",disabled:l,children:l?"Создание...":"Создать"})]})]})]}):a.jsxs(a.Fragment,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Родитель создан!"})}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs(Rn,{className:"bg-green-50 border-green-200",children:[a.jsx(We,{className:"h-4 w-4 text-green-600"}),a.jsx(Pn,{className:"text-green-800",children:"Родитель успешно создан. Сохраните данные для входа:"})]}),u&&a.jsxs("div",{className:"bg-muted p-4 rounded-md space-y-2",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-medium",children:"Логин (email):"}),a.jsx("code",{className:"text-sm",children:u.login})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-medium",children:"Пароль:"}),a.jsx("code",{className:"text-sm font-bold",children:u.password})]})]}),a.jsxs(Ba,{type:"button",onClick:()=>{if(u){const e=`Логин: ${u.login}\nПароль: ${u.password}`;navigator.clipboard.writeText(e),_e.success("Данные для входа скопированы")}},variant:"outline",className:"w-full",children:[a.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Копировать данные для входа"]}),a.jsxs(Rn,{className:"bg-yellow-50 border-yellow-200",children:[a.jsx(be,{className:"h-4 w-4 text-yellow-600"}),a.jsx(Pn,{className:"text-yellow-800 text-sm",children:"Сохраните эти данные! После закрытия окна пароль больше не будет отображаться."})]})]}),a.jsx(gn,{children:a.jsx(Ba,{type:"button",onClick:()=>{r(),g()},children:"Закрыть"})})]})})})},ai=({open:e,onOpenChange:s,onSuccess:r})=>{const[n,i]=t.useState(!1),[l,o]=t.useState(null),[c,d]=t.useState(!1),[u,m]=t.useState([]),[h,x]=t.useState([]),[p,g]=t.useState(""),[f,j]=t.useState(new Set);t.useEffect(()=>{e&&v()},[e]);const v=async()=>{var e,s;try{i(!0);const[t,a]=await Promise.all([ln.listParents(),ln.getStudents()]);if(t.success&&t.data&&m(t.data.results||[]),a.success&&a.data){const t=(null==(s=null==(e=a.data)?void 0:e.results)?void 0:s.map(e=>{var s;return{id:e.id,name:(null==(s=e.user)?void 0:s.full_name)||"Unknown",grade:e.grade,currentParent:e.parent_id?`ID: ${e.parent_id}`:"Не назначен"}}))||[];x(t)}}catch(t){la.error("Error loading data:",t),o("Не удалось загрузить данные")}finally{i(!1)}},y=()=>{g(""),j(new Set),o(null),d(!1),s(!1)},b=u.find(e=>e.id===parseInt(p));return a.jsx(dn,{open:e,onOpenChange:y,children:a.jsxs(xn,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Назначить студентов родителю"})}),c?a.jsx("div",{className:"space-y-4 py-4",children:a.jsxs(Rn,{className:"bg-green-50 border-green-200",children:[a.jsx(rs,{className:"h-4 w-4 text-green-600"}),a.jsx(Pn,{className:"text-green-800",children:"Студенты успешно назначены родителю!"})]})}):a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"parent",children:"Выберите родителя *"}),a.jsxs(Nn,{value:p,onValueChange:e=>{g(e),j(new Set),o(null),d(!1)},disabled:n,children:[a.jsx(_n,{id:"parent",children:a.jsx(wn,{placeholder:"Выберите родителя"})}),a.jsx(Cn,{children:u.map(e=>a.jsxs(En,{value:e.id.toString(),children:[e.user.full_name,e.children_count?` (${e.children_count} детей)`:" (нет детей)"]},e.id))})]})]}),b&&a.jsx("div",{className:"bg-muted p-3 rounded-md",children:a.jsxs("p",{className:"text-sm",children:[a.jsx("strong",{children:b.user.full_name})," – Email: ",b.user.email]})}),p&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx(cn,{children:"Студенты для назначения:"}),a.jsx(Ba,{type:"button",variant:"ghost",size:"sm",onClick:()=>{f.size===h.length?j(new Set):j(new Set(h.map(e=>e.id)))},disabled:n||0===h.length,children:f.size===h.length?"Убрать все":"Выбрать все"})]}),a.jsx("div",{className:"border rounded-md p-3 max-h-[400px] overflow-y-auto space-y-2",children:0===h.length?a.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Студентов не найдено"}):h.map(e=>a.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-muted rounded",children:[a.jsx(In,{id:`student-${e.id}`,checked:f.has(e.id),onCheckedChange:()=>(e=>{const s=new Set(f);s.has(e)?s.delete(e):s.add(e),j(s)})(e.id),disabled:n}),a.jsxs("label",{htmlFor:`student-${e.id}`,className:"flex-1 cursor-pointer text-sm flex items-center space-x-2",children:[a.jsx("span",{className:"font-medium",children:e.name}),e.grade&&a.jsxs("span",{className:"text-muted-foreground",children:["(",e.grade," класс)"]})]}),a.jsx("span",{className:"text-xs text-muted-foreground",children:e.currentParent})]},e.id))}),a.jsxs("div",{className:"text-sm text-muted-foreground",children:["Выбрано: ",f.size," из ",h.length]})]}),l&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:l})]})]}),!c&&a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:y,disabled:n,children:"Отмена"}),a.jsx(Ba,{type:"button",onClick:async()=>{var e;if(p)if(0!==f.size){i(!0),o(null);try{const s=parseInt(p),t=Array.from(f),a=await ln.assignParentToStudents(s,t);a.success?(d(!0),_e.success((null==(e=a.data)?void 0:e.message)||"Студенты успешно назначены родителю"),setTimeout(()=>{r(),y()},1500)):o(a.error||"Не удалось назначить студентов")}catch(s){const e=s instanceof Error?s.message:"Произошла ошибка";o(e)}finally{i(!1)}}else o("Выберите хотя бы одного студента");else o("Выберите родителя")},disabled:n||!p||0===f.size,children:n?"Назначение...":"Назначить"})]}),c&&a.jsx(gn,{children:a.jsx(Ba,{type:"button",onClick:y,children:"Закрыть"})})]})})};function ri({onUpdate:e}){var s;const[r,n]=t.useState([]),[i,l]=t.useState([]),[o,c]=t.useState(!1),[d,u]=t.useState(!1),[m,h]=t.useState(""),[x,p]=t.useState(!1),[g,f]=t.useState({open:!1,item:null}),[j,v]=t.useState({open:!1,item:null}),[y,b]=t.useState({open:!1,item:null}),[N,w]=t.useState({open:!1,item:null,isLoading:!1}),[_,S]=t.useState({open:!1,item:null}),k=async()=>{c(!0);try{const e=await ln.listParents();if(e.success&&e.data){const s=e.data.results||[];n(s),l(s)}else _e.error(e.error||"Ошибка загрузки списка родителей")}catch(e){_e.error((null==e?void 0:e.message)||"Ошибка загрузки списка")}finally{c(!1)}};t.useEffect(()=>{k()},[]),t.useEffect(()=>{if(!m)return void l(r);const e=m.toLowerCase(),s=r.filter(s=>{var t,a;const r=(null==(t=s.user.full_name)?void 0:t.toLowerCase())||"",n=(null==(a=s.user.email)?void 0:a.toLowerCase())||"";return r.includes(e)||n.includes(e)});l(s)},[m,r]);return a.jsxs(a.Fragment,{children:[a.jsxs(Fa,{children:[a.jsxs(Ma,{className:"flex flex-row items-center justify-between",children:[a.jsx($a,{children:"Родители"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Ba,{type:"button",onClick:()=>u(!0),children:[a.jsx(Be,{className:"h-4 w-4 mr-2"}),"Создать родителя"]}),a.jsxs(Ba,{type:"button",variant:"outline",onClick:()=>p(!0),children:[a.jsx(ns,{className:"h-4 w-4 mr-2"}),"Назначить студентов"]})]})]}),a.jsxs(Va,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx(cn,{className:"text-sm",children:"Поиск"}),a.jsxs("div",{className:"flex gap-2 mt-2",children:[a.jsx(Pr,{placeholder:"ФИО или email...",value:m,onChange:e=>h(e.target.value),className:"flex-1"}),a.jsx(Ba,{type:"button",variant:"outline",size:"icon",children:a.jsx(Ye,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"text-left border-b",children:[a.jsx("th",{className:"py-2 pr-4",children:"ФИО"}),a.jsx("th",{className:"py-2 pr-4",children:"Email"}),a.jsx("th",{className:"py-2 pr-4",children:"Телефон"}),a.jsx("th",{className:"py-2 pr-4",children:"Детей"}),a.jsx("th",{className:"py-2 pr-4",children:"Действия"})]})}),a.jsx("tbody",{children:o?a.jsx("tr",{children:a.jsx("td",{className:"py-4",colSpan:5,children:"Загрузка..."})}):0===i.length?a.jsx("tr",{children:a.jsx("td",{className:"py-4",colSpan:5,children:m?"Родители не найдены по запросу":"Родители не найдены"})}):i.map(e=>a.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[a.jsx("td",{className:"py-2 pr-4",children:e.user.full_name}),a.jsx("td",{className:"py-2 pr-4",children:e.user.email}),a.jsx("td",{className:"py-2 pr-4",children:e.user.phone||"-"}),a.jsx("td",{className:"py-2 pr-4",children:e.children_count||0}),a.jsx("td",{className:"py-2 pr-4",children:a.jsxs("div",{className:"flex gap-1",children:[a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>S({open:!0,item:e}),title:"Просмотреть профиль",children:a.jsx(Qe,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>f({open:!0,item:e}),title:"Редактировать пользователя",children:a.jsx(Ze,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>v({open:!0,item:e}),title:"Сбросить пароль",children:a.jsx(es,{className:"h-4 w-4"})}),!e.user.is_active&&a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:()=>w({open:!0,item:e,isLoading:!1}),title:"Активировать родителя",children:a.jsx(ss,{className:"h-4 w-4"})}),a.jsx(Ba,{type:"button",size:"sm",variant:"destructive",onClick:()=>b({open:!0,item:e}),title:"Удалить пользователя",children:a.jsx(He,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]}),a.jsx(ti,{open:d,onOpenChange:u,onSuccess:()=>{k(),null==e||e()}}),a.jsx(ai,{open:x,onOpenChange:p,onSuccess:()=>{k()}}),g.item&&a.jsx(Ln,{user:g.item.user,open:g.open,onOpenChange:e=>{e?f(s=>({...s,open:e})):(f(e=>({...e,open:!1})),setTimeout(()=>f({open:!1,item:null}),300))},onSuccess:()=>{k(),null==e||e()}}),j.item&&a.jsx(qn,{user:j.item.user,open:j.open,onOpenChange:e=>{e?v(s=>({...s,open:e})):(v(e=>({...e,open:!1})),setTimeout(()=>v({open:!1,item:null}),300))}}),y.item&&a.jsx(zn,{user:y.item.user,open:y.open,onOpenChange:e=>{e?b(s=>({...s,open:e})):(b(e=>({...e,open:!1})),setTimeout(()=>b({open:!1,item:null}),300))},onSuccess:()=>{k(),null==e||e()}}),_.item&&a.jsx(Bn,{open:_.open,onOpenChange:e=>{e?S(s=>({...s,open:e})):(S(e=>({...e,open:!1})),setTimeout(()=>S({open:!1,item:null}),300))},userId:_.item.user.id,role:"parent",onUpdate:()=>{k(),null==e||e()}}),a.jsx(dn,{open:N.open,onOpenChange:e=>{e?w(s=>({...s,open:e})):(w(e=>({...e,open:!1})),setTimeout(()=>w({open:!1,item:null,isLoading:!1}),300))},children:a.jsxs(xn,{children:[a.jsx(pn,{children:a.jsx(fn,{children:"Активировать родителя"})}),a.jsx("div",{className:"py-4",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Вы уверены, что хотите активировать родителя ",a.jsx("strong",{children:null==(s=N.item)?void 0:s.user.full_name}),"?"]})}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>w({open:!1,item:null,isLoading:!1}),disabled:N.isLoading,children:"Отменить"}),a.jsx(Ba,{type:"button",onClick:async()=>{if(N.item){w(e=>({...e,isLoading:!0}));try{const s=await ln.reactivateUser(N.item.user.id);s.success?(_e.success("Родитель успешно активирован"),w({open:!1,item:null,isLoading:!1}),await k(),null==e||e()):(_e.error(s.error||"Ошибка при активации"),w(e=>({...e,isLoading:!1})))}catch(s){const e=s instanceof Error?s.message:"Неизвестная ошибка";_e.error(e),w(e=>({...e,isLoading:!1}))}}},disabled:N.isLoading,children:N.isLoading?"Активация...":"Активировать"})]})]})})]})}function ni(){const[e,s]=t.useState({total_users:0,total_students:0,total_teachers:0,total_tutors:0,total_parents:0,active_today:0});t.useEffect(()=>{r()},[]);const r=async()=>{var e,t,a,r,n,i;try{const l=await ln.getUserStats();if((null==l?void 0:l.success)&&(null==l?void 0:l.data)){const o=l.data||{};s({total_users:null!=(e=o.total_users)?e:0,total_students:null!=(t=o.total_students)?t:0,total_teachers:null!=(a=o.total_teachers)?a:0,total_tutors:null!=(r=o.total_tutors)?r:0,total_parents:null!=(n=o.total_parents)?n:0,active_today:null!=(i=o.active_today)?i:0})}}catch(l){console.error("Failed to load stats:",l)}},n=[{title:"Всего пользователей",value:e.total_users,icon:a.jsx(Pe,{className:"h-6 w-6 text-blue-500"})},{title:"Студентов",value:e.total_students,icon:a.jsx(is,{className:"h-6 w-6 text-green-500"})},{title:"Преподавателей",value:e.total_teachers,icon:a.jsx(Xe,{className:"h-6 w-6 text-purple-500"})},{title:"Активных сегодня",value:e.active_today,icon:a.jsx(Ae,{className:"h-6 w-6 text-red-500"})}];return a.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:n.map((e,s)=>a.jsxs(Fa,{children:[a.jsx(Ma,{className:"pb-3",children:a.jsx($a,{className:"text-sm font-medium text-muted-foreground",children:e.title})}),a.jsx(Va,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"text-2xl font-bold",children:e.value}),a.jsx("div",{children:e.icon})]})})]},s))}),a.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[a.jsx(Xn,{onUpdate:r}),a.jsx(Zn,{onUpdate:r}),a.jsx(si,{onUpdate:r}),a.jsx(ri,{onUpdate:r})]})]})}const ii={pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"},li={pending:"Ожидание подтверждения",confirmed:"Подтверждено",completed:"Завершено",cancelled:"Отменено"},oi=({lesson:e,open:s,onOpenChange:t})=>e?a.jsx(dn,{open:s,onOpenChange:t,children:a.jsxs(xn,{className:"max-w-2xl",children:[a.jsx(pn,{children:a.jsxs("div",{className:"flex items-start justify-between gap-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(fn,{className:"text-2xl",children:e.subject_name}),a.jsx(jn,{className:"mt-1",children:"Детали занятия"})]}),a.jsx(Ya,{className:ii[e.status]||ii.pending,children:li[e.status]||"Неизвестно"})]})}),a.jsxs("div",{className:"space-y-4 mt-4",children:[a.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[a.jsx(Le,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Дата"}),a.jsx("p",{className:"text-base font-semibold",children:ls(new Date(e.date),"d MMMM yyyy",{locale:os})})]})]}),a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[a.jsx(cs,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Время"}),a.jsxs("p",{className:"text-base font-semibold",children:[e.start_time.slice(0,5)," - ",e.end_time.slice(0,5)]})]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[a.jsx(Ze,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Преподаватель"}),a.jsx("p",{className:"text-base font-semibold",children:e.teacher_name})]})]}),a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[a.jsx(Ze,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Студент"}),a.jsx("p",{className:"text-base font-semibold",children:e.student_name})]})]}),a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[a.jsx(Xe,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Предмет"}),a.jsx("p",{className:"text-base font-semibold",children:e.subject_name})]})]})]}),e.description&&a.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[a.jsx(Je,{className:"w-5 h-5 text-muted-foreground mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Описание"}),a.jsx("p",{className:"text-sm",children:e.description})]})]}),e.telemost_link&&a.jsx("div",{className:"pt-2",children:a.jsx(Ba,{type:"button",asChild:!0,className:"w-full",children:a.jsxs("a",{href:e.telemost_link,target:"_blank",rel:"noopener noreferrer",children:[a.jsx(ds,{className:"w-4 h-4 mr-2"}),"Присоединиться к уроку"]})})}),(e.created_at||e.updated_at)&&a.jsxs("div",{className:"pt-4 border-t text-xs text-muted-foreground space-y-1",children:[e.created_at&&a.jsxs("p",{children:["Создано: ",ls(new Date(e.created_at),"d MMMM yyyy, HH:mm",{locale:os})]}),e.updated_at&&e.updated_at!==e.created_at&&a.jsxs("p",{children:["Обновлено: ",ls(new Date(e.updated_at),"d MMMM yyyy, HH:mm",{locale:os})]})]})]})]})}):null,ci={teacher_id:"",student_id:"",subject_id:"",date:ls(new Date,"yyyy-MM-dd"),start_time:"10:00",end_time:"11:00",description:"",telemost_link:""};function di(){var e;const{toast:s}=Ht(),[r,n]=t.useState(new Date),[i,l]=t.useState("all"),[o,c]=t.useState("all"),[d,u]=t.useState("all"),[m,h]=t.useState("month"),[x,p]=t.useState(null),[g,f]=t.useState(new Set),[j,v]=t.useState(!1),[y,b]=t.useState(!1),[N,w]=t.useState(ci),_=t.useMemo(()=>{if("month"===m)return{from:ls(ms(r),"yyyy-MM-dd"),to:ls(us(r),"yyyy-MM-dd")};if("week"===m){const e=hs(r,{weekStartsOn:1}),s=xs(r,{weekStartsOn:1});return{from:ls(e,"yyyy-MM-dd"),to:ls(s,"yyyy-MM-dd")}}return{from:ls(r,"yyyy-MM-dd"),to:ls(r,"yyyy-MM-dd")}},[r,m]),{lessons:S,teachers:k,subjects:C,students:E,isLoading:T,error:R,filtersError:A,refetch:P}=((e={})=>{var s,t,a,r;const{data:n,isLoading:i,error:l,refetch:o}=ct({queryKey:["admin","schedule",null==e?void 0:e.teacher_id,null==e?void 0:e.subject_id,null==e?void 0:e.student_id,null==e?void 0:e.date_from,null==e?void 0:e.date_to,null==e?void 0:e.status],queryFn:()=>ln.getSchedule(e),enabled:!0,staleTime:6e4}),{data:c,isLoading:d,error:u}=ct({queryKey:["admin","schedule","filters"],queryFn:()=>ln.getScheduleFilters(),staleTime:3e5});return{lessons:null!=(s=null==n?void 0:n.lessons)?s:[],teachers:null!=(t=null==c?void 0:c.teachers)?t:[],subjects:null!=(a=null==c?void 0:c.subjects)?a:[],students:null!=(r=null==c?void 0:c.students)?r:[],isLoading:i||d,error:null==l?void 0:l.message,filtersError:null==u?void 0:u.message,refetch:o}})({teacher_id:"all"!==i?i:void 0,subject_id:"all"!==o?o:void 0,student_id:"all"!==d?d:void 0,date_from:_.from,date_to:_.to});t.useEffect(()=>{A&&s({variant:"destructive",title:"Ошибка загрузки фильтров",description:A})},[A,s]),t.useEffect(()=>{f(new Set)},[m]);const L=t.useMemo(()=>{if("month"===m){const e=hs(ms(r),{weekStartsOn:1}),s=xs(us(r),{weekStartsOn:1});return ps({start:e,end:s})}if("week"===m){const e=hs(r,{weekStartsOn:1}),s=xs(r,{weekStartsOn:1});return ps({start:e,end:s})}return[r]},[r,m]),q=S.reduce((e,s)=>{const t=s.date;return e[t]||(e[t]=[]),e[t].push(s),e},{}),I=e=>{switch(e){case"confirmed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"completed":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};if(R)return a.jsx("div",{className:"container mx-auto p-4",children:a.jsx(Fa,{children:a.jsxs(Va,{className:"pt-6",children:[a.jsxs("div",{className:"flex items-center gap-2 text-red-500 mb-4",children:[a.jsx(be,{className:"h-5 w-5"}),a.jsxs("p",{children:["Ошибка загрузки расписания: ",R]})]}),a.jsx(Ba,{type:"button",onClick:()=>P(),children:"Повторить"})]})})});const z=ls(new Date,"yyyy-MM-dd"),D=z>=_.from&&z<=_.to&&q[z]||[],O=S.length,F=S.filter(e=>"pending"===e.status).length;S.filter(e=>"completed"===e.status).length;const M=S.filter(e=>"cancelled"===e.status).length,$=S.filter(e=>"confirmed"===e.status).length;return a.jsxs("div",{className:"container mx-auto p-4",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 mb-6",children:[a.jsx(Fa,{className:"bg-blue-50 border-blue-200",children:a.jsx(Va,{className:"pt-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-blue-600",children:O}),a.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"Всего занятий"})]})})}),a.jsx(Fa,{className:"bg-green-50 border-green-200",children:a.jsx(Va,{className:"pt-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-green-600",children:D.length}),a.jsx("div",{className:"text-sm text-green-700 mt-1",children:"Занятий сегодня"})]})})}),a.jsx(Fa,{className:"bg-yellow-50 border-yellow-200",children:a.jsx(Va,{className:"pt-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:F}),a.jsx("div",{className:"text-sm text-yellow-700 mt-1",children:"Ожидают подтверждения"})]})})}),a.jsx(Fa,{className:"bg-purple-50 border-purple-200",children:a.jsx(Va,{className:"pt-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-purple-600",children:$}),a.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"Подтверждено"})]})})}),a.jsx(Fa,{className:"bg-red-50 border-red-200",children:a.jsx(Va,{className:"pt-6",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-red-600",children:M}),a.jsx("div",{className:"text-sm text-red-700 mt-1",children:"Отменено"})]})})})]}),a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs($a,{className:"flex items-center gap-2",children:[a.jsx(Le,{className:"h-5 w-5"}),"Расписание всех занятий"]}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs(Ba,{type:"button",onClick:()=>{w(ci),v(!0)},className:"gap-2",children:[a.jsx(Be,{className:"h-4 w-4"}),"Создать занятие"]}),a.jsxs(Nn,{value:i,onValueChange:l,children:[a.jsx(_n,{className:"w-[180px]",children:a.jsx(wn,{placeholder:"Все преподаватели"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"all",children:"Все преподаватели"}),k.map(e=>a.jsx(En,{value:e.id.toString(),children:e.name},e.id))]})]}),a.jsxs(Nn,{value:o,onValueChange:c,children:[a.jsx(_n,{className:"w-[180px]",children:a.jsx(wn,{placeholder:"Все предметы"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"all",children:"Все предметы"}),C.map(e=>a.jsx(En,{value:e.id.toString(),children:e.name},e.id))]})]}),a.jsxs(Nn,{value:d,onValueChange:u,children:[a.jsx(_n,{className:"w-[180px]",children:a.jsx(wn,{placeholder:"Все студенты"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"all",children:"Все студенты"}),E.map(e=>a.jsx(En,{value:e.id.toString(),children:e.name},e.id))]})]})]})]})}),a.jsxs(Va,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ba,{type:"button",variant:"outline",size:"icon",onClick:()=>{const e=new Date(r);"month"===m?e.setMonth(e.getMonth()-1):"week"===m?e.setDate(e.getDate()-7):e.setDate(e.getDate()-1),n(e)},children:a.jsx(ts,{className:"h-4 w-4"})}),a.jsx("h2",{className:"text-xl font-semibold min-w-[250px] text-center",children:(()=>{if("month"===m)return ls(r,"LLLL yyyy",{locale:os});if("week"===m){const e=hs(r,{weekStartsOn:1}),s=xs(r,{weekStartsOn:1});return`${ls(e,"d MMM",{locale:os})} - ${ls(s,"d MMM yyyy",{locale:os})}`}return ls(r,"d MMMM yyyy",{locale:os})})()}),a.jsx(Ba,{type:"button",variant:"outline",size:"icon",onClick:()=>{const e=new Date(r);"month"===m?e.setMonth(e.getMonth()+1):"week"===m?e.setDate(e.getDate()+7):e.setDate(e.getDate()+1),n(e)},children:a.jsx(as,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(Ba,{type:"button",variant:"month"===m?"default":"outline",size:"sm",onClick:()=>h("month"),children:"Месяц"}),a.jsx(Ba,{type:"button",variant:"week"===m?"default":"outline",size:"sm",onClick:()=>h("week"),children:"Неделя"}),a.jsx(Ba,{type:"button",variant:"day"===m?"default":"outline",size:"sm",onClick:()=>h("day"),children:"День"})]})]}),T?a.jsx("div",{className:"grid grid-cols-7 gap-2",children:[...Array(35)].map((e,s)=>a.jsx(Fr,{className:"h-24"},s))}):a.jsx(a.Fragment,{children:"day"===m?a.jsx("div",{className:"space-y-2",children:(null==(e=q[ls(r,"yyyy-MM-dd")])?void 0:e.length)?q[ls(r,"yyyy-MM-dd")].map(e=>a.jsx(Fa,{className:"p-3 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>p(e),children:a.jsx("div",{className:"flex items-start justify-between gap-3",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(cs,{className:"h-4 w-4 text-muted-foreground"}),a.jsxs("span",{className:"font-medium",children:[e.start_time.slice(0,5)," - ",e.end_time.slice(0,5)]}),a.jsx("span",{className:Bt("text-xs px-2 py-0.5 rounded",I(e.status)),children:e.status})]}),a.jsx("p",{className:"font-semibold",children:e.subject_name}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.teacher_name," → ",e.student_name]})]})})},e.id)):a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(Le,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"Нет занятий на выбранный день"})]})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:Bt("grid gap-2 mb-2","grid-cols-7"),children:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"].map(e=>a.jsx("div",{className:"text-center font-semibold text-sm",children:e},e))}),a.jsx("div",{className:Bt("grid gap-2","grid-cols-7"),children:L.map(e=>{const s=ls(e,"yyyy-MM-dd"),t=q[s]||[],n=gs(e,r),i=fs(e,new Date),l=g.has(s),o=l?t:t.slice(0,3);return a.jsxs("div",{className:Bt("min-h-[100px] p-2 border rounded-lg",!n&&"bg-gray-50 opacity-50",i&&"bg-blue-50 border-blue-300"),children:[a.jsx("div",{className:"font-semibold text-sm mb-1",children:ls(e,"d")}),a.jsxs("div",{className:"space-y-1 text-xs",children:[o.map(e=>a.jsxs("div",{className:Bt("p-1 rounded cursor-pointer hover:opacity-80",I(e.status)),onClick:()=>p(e),children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(cs,{className:"h-3 w-3"}),a.jsx("span",{children:e.start_time.slice(0,5)})]}),a.jsx("div",{className:"truncate font-medium",children:e.subject_name}),a.jsxs("div",{className:"truncate text-[10px] opacity-75",children:[e.teacher_name," → ",e.student_name]})]},e.id)),t.length>3&&a.jsx("button",{type:"button",className:"w-full text-center text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded py-1",onClick:e=>{e.stopPropagation(),(e=>{const s=new Set(g);s.has(e)?s.delete(e):s.add(e),f(s)})(s)},children:l?"Свернуть":`+${t.length-3} еще`})]})]},e.toString())})}),0===S.length&&!T&&a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(Le,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"Нет занятий на выбранный период"})]})]})})]})]}),a.jsx(oi,{lesson:x,open:!!x,onOpenChange:e=>!e&&p(null)}),a.jsx(dn,{open:j,onOpenChange:v,children:a.jsxs(xn,{className:"max-w-lg",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Создание нового занятия"})}),a.jsxs("div",{className:"space-y-4 mt-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"teacher",children:"Преподаватель *"}),a.jsxs(Nn,{value:N.teacher_id,onValueChange:e=>w(s=>({...s,teacher_id:e})),children:[a.jsx(_n,{id:"teacher",children:a.jsx(wn,{placeholder:"Выберите преподавателя"})}),a.jsx(Cn,{children:k.map(e=>a.jsx(En,{value:e.id.toString(),children:e.name},e.id))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"student",children:"Студент *"}),a.jsxs(Nn,{value:N.student_id,onValueChange:e=>w(s=>({...s,student_id:e})),children:[a.jsx(_n,{id:"student",children:a.jsx(wn,{placeholder:"Выберите студента"})}),a.jsx(Cn,{children:E.map(e=>a.jsx(En,{value:e.id.toString(),children:e.name},e.id))})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"subject",children:"Предмет *"}),a.jsxs(Nn,{value:N.subject_id,onValueChange:e=>w(s=>({...s,subject_id:e})),children:[a.jsx(_n,{id:"subject",children:a.jsx(wn,{placeholder:"Выберите предмет"})}),a.jsx(Cn,{children:C.map(e=>a.jsx(En,{value:e.id.toString(),children:e.name},e.id))})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"date",children:"Дата *"}),a.jsx(Pr,{id:"date",type:"date",value:N.date,onChange:e=>w(s=>({...s,date:e.target.value}))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"start_time",children:"Начало *"}),a.jsx(Pr,{id:"start_time",type:"time",value:N.start_time,onChange:e=>w(s=>({...s,start_time:e.target.value}))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"end_time",children:"Конец *"}),a.jsx(Pr,{id:"end_time",type:"time",value:N.end_time,onChange:e=>w(s=>({...s,end_time:e.target.value}))})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"description",children:"Описание"}),a.jsx(yn,{id:"description",placeholder:"Описание занятия...",value:N.description,onChange:e=>w(s=>({...s,description:e.target.value}))})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"telemost_link",children:"Ссылка на видеоконференцию"}),a.jsx(Pr,{id:"telemost_link",type:"url",placeholder:"https://telemost.yandex.ru/...",value:N.telemost_link,onChange:e=>w(s=>({...s,telemost_link:e.target.value}))})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>v(!1),disabled:y,children:"Отмена"}),a.jsx(Ba,{type:"button",onClick:async()=>{if(N.teacher_id&&N.student_id&&N.subject_id){b(!0);try{const e=await ln.createLesson({teacher_id:parseInt(N.teacher_id),student_id:parseInt(N.student_id),subject_id:parseInt(N.subject_id),date:N.date,start_time:N.start_time+":00",end_time:N.end_time+":00",description:N.description,telemost_link:N.telemost_link});if(e.error)throw new Error(e.error);s({title:"Занятие создано",description:"Новое занятие успешно добавлено в расписание"}),v(!1),w(ci),P()}catch(e){s({variant:"destructive",title:"Ошибка создания",description:e instanceof Error?e.message:"Не удалось создать занятие"})}finally{b(!1)}}else s({variant:"destructive",title:"Ошибка",description:"Выберите преподавателя, студента и предмет"})},disabled:y,children:y?"Создание...":"Создать занятие"})]})]})]})})]})}const ui=t.forwardRef(({className:e,children:s,...t},r)=>a.jsxs(le,{ref:r,className:Bt("relative overflow-hidden",e),...t,children:[a.jsx(oe,{className:"h-full w-full rounded-[inherit]",children:s}),a.jsx(mi,{}),a.jsx(ce,{})]}));ui.displayName=le.displayName;const mi=t.forwardRef(({className:e,orientation:s="vertical",...t},r)=>a.jsx(de,{ref:r,orientation:s,className:Bt("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:a.jsx(ue,{className:"relative flex-1 rounded-full bg-border"})}));mi.displayName=de.displayName;const hi=({room:e,selected:s,onClick:t})=>{var r,n;const i=e.participants.map(e=>e.full_name.charAt(0)).join("").toUpperCase().slice(0,3)||"C",l=e.participants.map(e=>e.full_name).join(", "),o=e.name||l||"Чат",c=(null==(r=e.last_message)?void 0:r.content)||"Нет сообщений",d=(null==(n=e.last_message)?void 0:n.created_at)?new Date(e.last_message.created_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}):"";return a.jsx("div",{onClick:t,className:Bt("p-3 rounded-lg cursor-pointer transition-colors border",s?"bg-primary/10 border-primary":"border-transparent hover:bg-muted"),children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Fn,{className:"w-10 h-10",children:a.jsx($n,{className:"gradient-primary text-primary-foreground text-xs",children:i})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("div",{className:"font-medium truncate text-sm",children:o}),a.jsxs(Ya,{variant:"outline",className:"ml-2 text-xs",children:[e.participants_count," ",a.jsx(Pe,{className:"w-3 h-3 ml-1"})]})]}),e.subject&&a.jsxs("p",{className:"text-xs text-muted-foreground mb-1 truncate",children:["Предмет: ",e.subject.name]}),a.jsxs("p",{className:"text-xs text-blue-600 mb-1",children:["Тип: ","forum_subject"===e.type?"Форум (предмет)":e.type]}),a.jsx("p",{className:"text-xs text-muted-foreground truncate",children:c}),d&&a.jsxs("div",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[a.jsx(Le,{className:"w-3 h-3"}),d]})]})]})})},xi=({rooms:e,selectedRoom:s,onSelectRoom:r,searchQuery:n,onSearchChange:i,isLoading:l})=>{const o=t.useMemo(()=>{if(!n)return e;const s=n.toLowerCase();return e.filter(e=>{var t,a;return e.name.toLowerCase().includes(s)||(null==(a=null==(t=e.subject)?void 0:t.name)?void 0:a.toLowerCase().includes(s))||e.participants.some(e=>e.full_name.toLowerCase().includes(s))})},[e,n]);return a.jsxs(Fa,{className:"flex flex-col h-full",children:[a.jsx(Ma,{children:a.jsxs($a,{className:"flex items-center gap-2 text-lg",children:[a.jsx(qe,{className:"h-5 w-5"}),"Чаты (",e.length,")"]})}),a.jsxs(Va,{className:"flex-1 flex flex-col overflow-hidden",children:[a.jsxs("div",{className:"relative mb-4",children:[a.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),a.jsx(Pr,{placeholder:"Поиск чатов...",className:"pl-10 text-sm",value:n,onChange:e=>i(e.target.value)})]}),a.jsx(ui,{className:"flex-1",children:a.jsx("div",{className:"space-y-2 pr-4",children:l?a.jsxs(a.Fragment,{children:[a.jsx(Fr,{className:"h-24 rounded-lg"}),a.jsx(Fr,{className:"h-24 rounded-lg"}),a.jsx(Fr,{className:"h-24 rounded-lg"})]}):0===o.length?a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[a.jsx(qe,{className:"w-8 h-8 text-muted-foreground mb-2"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:n?"Чатов не найдено":"Нет активных чатов"})]}):o.map(e=>a.jsx(hi,{room:e,selected:(null==s?void 0:s.id)===e.id,onClick:()=>r(e)},e.id))})})]})]})},pi=({room:e,messages:s,isLoadingMessages:t})=>{if(!e)return a.jsxs(Fa,{className:"flex flex-col items-center justify-center h-full p-6",children:[a.jsx(qe,{className:"w-12 h-12 text-muted-foreground mb-4"}),a.jsx("p",{className:"text-muted-foreground",children:"Выберите чат для просмотра истории сообщений"})]});const r=e.participants.map(e=>e.full_name).join(", "),n=e.name||r||"Чат";return a.jsxs(Fa,{className:"flex flex-col h-full",children:[a.jsx(Ma,{className:"border-b",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Fn,{className:"w-10 h-10",children:a.jsx($n,{className:"gradient-primary text-primary-foreground text-xs",children:e.participants.map(e=>e.full_name.charAt(0)).join("").toUpperCase().slice(0,3)||"C"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-bold text-sm",children:n}),e.subject&&a.jsxs("div",{className:"text-xs text-muted-foreground",children:["Предмет: ",e.subject.name]}),e.participants.length>0&&a.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1 mt-1",children:[a.jsx(Pe,{className:"w-3 h-3"}),e.participants_count," участник(ов)"]})]}),a.jsx(Ya,{variant:e.is_active?"default":"secondary",children:e.is_active?"Активен":"Неактивен"})]})}),a.jsx(Va,{className:"flex-1 overflow-hidden p-0",children:a.jsx(ui,{className:"h-full py-4 px-6",children:a.jsx("div",{className:"space-y-4",children:t?a.jsxs(a.Fragment,{children:[a.jsx(Fr,{className:"h-16 rounded w-[70%]"}),a.jsx(Fr,{className:"h-16 rounded w-[70%] ml-auto"}),a.jsx(Fr,{className:"h-16 rounded w-[70%]"})]}):0===s.length?a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx(qe,{className:"w-10 h-10 text-muted-foreground mb-3"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Нет сообщений в этом чате"})]}):a.jsx(a.Fragment,{children:s.map(e=>{const s=e.sender.full_name.split(" ").map(e=>e.charAt(0)).join("").toUpperCase();return a.jsxs("div",{className:"flex gap-3",children:[a.jsx(Fn,{className:"w-8 h-8 flex-shrink-0",children:a.jsx($n,{className:"text-xs",children:s})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[a.jsx("span",{className:"font-medium text-sm",children:e.sender.full_name}),a.jsx(Ya,{variant:"outline",className:"text-xs",children:"student"===e.sender.role?"Студент":"teacher"===e.sender.role?"Преподаватель":"tutor"===e.sender.role?"Тьютор":"parent"===e.sender.role?"Родитель":e.sender.role}),a.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),a.jsx("div",{className:"bg-muted p-3 rounded-lg",children:a.jsx("p",{className:"text-sm break-words whitespace-pre-wrap",children:e.content})})]})]},e.id)})})})})}),a.jsx("div",{className:"px-6 py-3 border-t bg-muted/30",children:a.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Просмотр истории сообщений (только для чтения)"})})]})};function gi(){const[e,s]=t.useState(null),[r,n]=t.useState(""),{rooms:i,isLoading:l,roomsError:o}=(()=>{var e,s,a;const[r,n]=t.useState(null),{data:i,isLoading:l,error:o,refetch:c}=ct({queryKey:["admin","chats","rooms"],queryFn:()=>ln.getChatRooms(),staleTime:6e4,refetchOnMount:!0,refetchOnWindowFocus:!1}),{data:d,isLoading:u,error:m}=ct({queryKey:["admin","chats","stats"],queryFn:()=>ln.getChatStats(),staleTime:3e5,refetchOnWindowFocus:!1}),{data:h,isLoading:x,error:p}=ct({queryKey:["admin","chats","room-detail",r],queryFn:()=>{if(!r)throw new Error("No room selected");return ln.getChatRoomDetail(r)},enabled:null!==r,staleTime:6e4,refetchOnWindowFocus:!1});return{rooms:(null==(e=null==i?void 0:i.data)?void 0:e.rooms)||[],roomsCount:(null==(s=null==i?void 0:i.data)?void 0:s.count)||0,roomsLoading:l,roomsError:null==o?void 0:o.message,stats:(null==d?void 0:d.data)||null,statsLoading:u,statsError:null==m?void 0:m.message,roomDetail:(null==(a=null==h?void 0:h.data)?void 0:a.room)||null,roomDetailLoading:x,roomDetailError:null==p?void 0:p.message,selectedRoomId:r,setSelectedRoomId:n,refetchRooms:c,isLoading:l||u}})(),{messages:c,isLoading:d}=((e,s)=>{var t,a,r,n;const{data:i,isLoading:l,error:o,refetch:c}=ct({queryKey:["admin","chats","messages",e,s],queryFn:()=>{if(!e)throw new Error("Room ID is required");return ln.getChatMessages(e,s)},enabled:null!==e,staleTime:3e4,refetchOnMount:!0,refetchOnWindowFocus:!1});return{messages:(null==(t=null==i?void 0:i.data)?void 0:t.messages)||[],messagesCount:(null==(a=null==i?void 0:i.data)?void 0:a.count)||0,limit:(null==(r=null==i?void 0:i.data)?void 0:r.limit)||(null==s?void 0:s.limit)||100,offset:(null==(n=null==i?void 0:i.data)?void 0:n.offset)||(null==s?void 0:s.offset)||0,isLoading:l,error:null==o?void 0:o.message,refetch:c}})((null==e?void 0:e.id)||null),u=o?new Error(o):null;return u?a.jsx("div",{className:"container mx-auto p-4",children:a.jsx(Fa,{children:a.jsx(Va,{className:"pt-6",children:a.jsxs("p",{className:"text-red-500",children:["Ошибка загрузки чатов: ",u.message]})})})}):a.jsxs("div",{className:"container mx-auto p-4",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Управление чатами"}),a.jsx("p",{className:"text-muted-foreground",children:"Просмотр всех чатов и истории сообщений (только для чтения)"})]}),a.jsxs("div",{className:"grid md:grid-cols-3 gap-6 h-[calc(100vh-200px)]",children:[a.jsx("div",{className:"md:col-span-1",children:a.jsx(xi,{rooms:i,selectedRoom:e,onSelectRoom:e=>{s(e),n("")},searchQuery:r,onSearchChange:n,isLoading:l})}),a.jsx("div",{className:"md:col-span-2",children:a.jsx(pi,{room:e,messages:c,isLoadingMessages:d})})]})]})}const fi=({open:e,onOpenChange:s,onSuccess:r})=>{const[n,i]=t.useState("all_students"),[l,o]=t.useState(""),[c,d]=t.useState(""),[u,m]=t.useState(""),[h,x]=t.useState(""),[p,g]=t.useState(!1),[f,j]=t.useState(!1),[v,y]=t.useState(null),[b,N]=t.useState(null),[w,_]=t.useState([]),[S,k]=t.useState([]);t.useEffect(()=>{e?C():E()},[e]);const C=async()=>{var e;try{const[s,t]=await Promise.all([ln.getScheduleFilters(),ln.getTutors()]);if(s.success&&(null==(e=s.data)?void 0:e.subjects)&&_(s.data.subjects),t.success&&t.data){const e=Array.isArray(t.data)?t.data:t.data.results||[];k(e)}}catch(s){console.error("Error loading filter data:",s)}},E=()=>{i("all_students"),o(""),d(""),m(""),x(""),y(null),N(null)};return a.jsx(dn,{open:e,onOpenChange:s,children:a.jsxs(xn,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Создать рассылку"})}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"target-group",children:"Целевая группа"}),a.jsxs(Nn,{value:n,onValueChange:e=>i(e),children:[a.jsx(_n,{id:"target-group",children:a.jsx(wn,{placeholder:"Выберите группу"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"all_students",children:"Все студенты"}),a.jsx(En,{value:"all_teachers",children:"Все учителя"}),a.jsx(En,{value:"all_tutors",children:"Все тьютеры"}),a.jsx(En,{value:"all_parents",children:"Все родители"}),a.jsx(En,{value:"by_subject",children:"По предмету"}),a.jsx(En,{value:"by_tutor",children:"По тьютору"}),a.jsx(En,{value:"custom",children:"Кастомная группа (ID)"})]})]})]}),"by_subject"===n&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"subject",children:"Предмет"}),a.jsxs(Nn,{value:c,onValueChange:d,children:[a.jsx(_n,{id:"subject",children:a.jsx(wn,{placeholder:"Выберите предмет"})}),a.jsx(Cn,{children:w.map(e=>a.jsx(En,{value:e.id.toString(),children:e.name},e.id))})]})]}),"by_tutor"===n&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"tutor",children:"Тьютор"}),a.jsxs(Nn,{value:u,onValueChange:m,children:[a.jsx(_n,{id:"tutor",children:a.jsx(wn,{placeholder:"Выберите тьютора"})}),a.jsx(Cn,{children:S.map(e=>a.jsx(En,{value:e.id.toString(),children:e.user.full_name},e.id))})]})]}),"custom"===n&&a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"custom-ids",children:"ID пользователей (через запятую)"}),a.jsx(Pr,{id:"custom-ids",placeholder:"1, 5, 10, 15",value:h,onChange:e=>x(e.target.value)})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(cn,{htmlFor:"message",children:"Текст сообщения"}),a.jsxs("span",{className:"text-sm "+(l.length>500?"text-red-500":"text-muted-foreground"),children:[l.length,"/500"]})]}),a.jsx(yn,{id:"message",placeholder:"Введите текст сообщения для рассылки...",value:l,onChange:e=>o(e.target.value),rows:6,maxLength:500})]}),v&&a.jsxs(Rn,{children:[a.jsx(We,{className:"h-4 w-4"}),a.jsx(Pn,{children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"font-medium",children:["Получателей: ",v.count]}),v.recipients.length>0&&a.jsxs("div",{className:"text-sm",children:[a.jsx("p",{className:"text-muted-foreground mb-1",children:"Первые получатели:"}),a.jsxs("ul",{className:"space-y-1",children:[v.recipients.slice(0,5).map(e=>a.jsxs("li",{className:"text-xs",children:[e.full_name," (",e.email,") - ",e.role]},e.id)),v.recipients.length>5&&a.jsxs("li",{className:"text-xs text-muted-foreground",children:["...и еще ",v.recipients.length-5]})]})]})]})})]}),b&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:b})]})]}),a.jsxs(gn,{children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:p,children:"Отмена"}),a.jsxs(Ba,{type:"button",variant:"secondary",onClick:async()=>{N(null),j(!0);try{const e={target_group:n};if("by_subject"===n&&c)e.subject_id=parseInt(c);else if("by_tutor"===n&&u)e.tutor_id=parseInt(u);else if("custom"===n&&h){const s=h.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e));if(0===s.length)return void N("Введите корректные ID пользователей через запятую");e.user_ids=s}const s=await ln.previewBroadcast(e);s.success&&s.data?y({count:s.data.recipients_count,recipients:s.data.recipients_preview||[]}):N(s.error||"Не удалось получить предпросмотр")}catch(e){N((null==e?void 0:e.message)||"Ошибка предпросмотра")}finally{j(!1)}},disabled:p||f,children:[f&&a.jsx(Ee,{className:"mr-2 h-4 w-4 animate-spin"}),"Предпросмотр"]}),a.jsxs(Ba,{type:"button",onClick:async()=>{if(N(null),l.trim())if(l.length>500)N("Текст сообщения не должен превышать 500 символов");else if("by_subject"!==n||c)if("by_tutor"!==n||u)if("custom"!==n||h){g(!0);try{const e={target_group:n,message:l.trim()};if("by_subject"===n&&c)e.subject_id=parseInt(c);else if("by_tutor"===n&&u)e.tutor_id=parseInt(u);else if("custom"===n&&h){const s=h.split(",").map(e=>parseInt(e.trim())).filter(e=>!isNaN(e));e.user_ids=s}const t=await ln.createBroadcast(e);t.success?(_e.success("Рассылка успешно отправлена"),r(),s(!1)):N(t.error||"Не удалось отправить рассылку")}catch(e){N((null==e?void 0:e.message)||"Ошибка отправки рассылки")}finally{g(!1)}}else N("Введите ID пользователей");else N("Выберите тьютора");else N("Выберите предмет");else N("Введите текст сообщения")},disabled:p||!l.trim(),children:[p&&a.jsx(Ee,{className:"mr-2 h-4 w-4 animate-spin"}),"Отправить"]})]})]})})},ji=({broadcastId:e,open:s,onOpenChange:r})=>{const[n,i]=t.useState(null),[l,o]=t.useState([]),[c,d]=t.useState(!1),[u,m]=t.useState(null);t.useEffect(()=>{s&&e?h():(i(null),o([]),m(null))},[s,e]);const h=async()=>{var s,t;if(e){d(!0),m(null);try{const[a,r]=await Promise.all([ln.getBroadcast(e),ln.getBroadcastRecipients(e)]);a.success&&(null==(s=a.data)?void 0:s.data)?i(a.data.data):m(a.error||"Не удалось загрузить детали рассылки"),r.success&&(null==(t=r.data)?void 0:t.recipients)&&o(r.data.recipients)}catch(a){m((null==a?void 0:a.message)||"Ошибка загрузки данных")}finally{d(!1)}}},x=e=>{switch(e){case"sent":return a.jsx(We,{className:"h-4 w-4 text-green-600"});case"failed":return a.jsx(js,{className:"h-4 w-4 text-red-600"});case"pending":return a.jsx(cs,{className:"h-4 w-4 text-yellow-600"});default:return null}};return a.jsx(dn,{open:s,onOpenChange:r,children:a.jsxs(xn,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsxs(fn,{children:["Детали рассылки #",e]})}),c&&a.jsxs("div",{className:"space-y-4",children:[a.jsx(Fr,{className:"h-20 w-full"}),a.jsx(Fr,{className:"h-40 w-full"}),a.jsx(Fr,{className:"h-60 w-full"})]}),u&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:u})]}),!c&&!u&&n&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"font-semibold",children:"Информация"}),(e=>{switch(e){case"draft":return a.jsx(Ya,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:"Черновик"});case"sent":return a.jsx(Ya,{variant:"default",className:"bg-green-100 text-green-800",children:"Отправлено"});case"failed":return a.jsx(Ya,{variant:"destructive",children:"Ошибка"});default:return null}})(n.status)]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-muted-foreground",children:"Дата создания:"}),a.jsx("p",{className:"font-medium",children:ls(new Date(n.created_at),"dd.MM.yyyy HH:mm",{locale:os})})]}),n.sent_at&&a.jsxs("div",{children:[a.jsx("p",{className:"text-muted-foreground",children:"Дата отправки:"}),a.jsx("p",{className:"font-medium",children:ls(new Date(n.sent_at),"dd.MM.yyyy HH:mm",{locale:os})})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-muted-foreground",children:"Кто создал:"}),a.jsx("p",{className:"font-medium",children:n.created_by.full_name})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-muted-foreground",children:"Целевая группа:"}),a.jsx("p",{className:"font-medium",children:(e=>{var s,t;switch(e){case"all_students":return"Все студенты";case"all_teachers":return"Все учителя";case"all_tutors":return"Все тьютеры";case"all_parents":return"Все родители";case"by_subject":return`По предмету: ${(null==(s=null==n?void 0:n.metadata)?void 0:s.subject_name)||"N/A"}`;case"by_tutor":return`По тьютору: ${(null==(t=null==n?void 0:n.metadata)?void 0:t.tutor_name)||"N/A"}`;case"custom":return"Кастомная группа";default:return e}})(n.target_group)})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold",children:"Текст сообщения"}),a.jsx("div",{className:"p-3 bg-muted rounded-md",children:a.jsx("p",{className:"whitespace-pre-wrap text-sm",children:n.message})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"font-semibold",children:"Статистика доставки"}),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[a.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[a.jsx("p",{className:"text-xs text-muted-foreground",children:"Всего получателей"}),a.jsx("p",{className:"text-2xl font-bold",children:n.total_recipients})]}),a.jsxs("div",{className:"p-3 bg-green-50 rounded-md",children:[a.jsx("p",{className:"text-xs text-green-700",children:"Успешно"}),a.jsx("p",{className:"text-2xl font-bold text-green-700",children:n.successful_sends})]}),a.jsxs("div",{className:"p-3 bg-red-50 rounded-md",children:[a.jsx("p",{className:"text-xs text-red-700",children:"Ошибок"}),a.jsx("p",{className:"text-2xl font-bold text-red-700",children:n.failed_sends})]})]})]}),"draft"!==n.status&&l.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("h3",{className:"font-semibold",children:["Получатели (",l.length,")"]}),a.jsx("div",{className:"border rounded-md max-h-[300px] overflow-y-auto",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-muted sticky top-0",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left p-2 font-medium",children:"Email"}),a.jsx("th",{className:"text-left p-2 font-medium",children:"Имя"}),a.jsx("th",{className:"text-center p-2 font-medium",children:"Статус"})]})}),a.jsx("tbody",{children:l.map(e=>a.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[a.jsx("td",{className:"p-2",children:e.user_email}),a.jsx("td",{className:"p-2",children:e.user_name}),a.jsx("td",{className:"p-2",children:a.jsxs("div",{className:"flex flex-col items-center gap-1",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[x(e.status),a.jsxs("span",{className:"text-xs",children:["sent"===e.status&&"Отправлено","failed"===e.status&&"Ошибка","pending"===e.status&&"В очереди"]})]}),e.error_message&&a.jsx("span",{className:"text-xs text-red-600",children:e.error_message})]})})]},e.user_id))})]})})]})]})]})})};function vi(){const[e,s]=t.useState([]),[r,n]=t.useState(!1),[i,l]=t.useState(null),[o,c]=t.useState(!1),[d,u]=t.useState(!1),[m,h]=t.useState(null),[x,p]=t.useState(1),[g,f]=t.useState(0),j=Math.ceil(g/20),[v,y]=t.useState("all"),[b,N]=t.useState(""),[w,_]=t.useState("");t.useEffect(()=>{S()},[x,v,b,w]);const S=async()=>{n(!0),l(null);try{const e={page:x,page_size:20};"all"!==v&&(e.status=v),b&&(e.date_from=b),w&&(e.date_to=w);const t=await ln.getBroadcasts(e);t.success&&t.data?(s(t.data.results||[]),f(t.data.count||0)):(l(t.error||"Не удалось загрузить рассылки"),s([]))}catch(e){l((null==e?void 0:e.message)||"Ошибка загрузки рассылок"),s([])}finally{n(!1)}},k=e=>{switch(e){case"draft":return a.jsx(Ya,{variant:"secondary",className:"bg-gray-100 text-gray-800",children:"Черновик"});case"sent":return a.jsx(Ya,{variant:"default",className:"bg-green-100 text-green-800",children:"Отправлено"});case"failed":return a.jsx(Ya,{variant:"destructive",children:"Ошибка"});default:return null}},C=e=>{var s,t;switch(e.target_group){case"all_students":return"Все студенты";case"all_teachers":return"Все учителя";case"all_tutors":return"Все тьютеры";case"all_parents":return"Все родители";case"by_subject":return`По предмету: ${(null==(s=e.metadata)?void 0:s.subject_name)||"N/A"}`;case"by_tutor":return`По тьютору: ${(null==(t=e.metadata)?void 0:t.tutor_name)||"N/A"}`;case"custom":return"Кастомная группа";default:return e.target_group}},E=(e,s=80)=>e.length<=s?e:e.substring(0,s)+"...";return a.jsxs("div",{className:"container mx-auto p-4",children:[a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs($a,{className:"flex items-center gap-2",children:[a.jsx(Ie,{className:"h-5 w-5"}),"Управление рассылками"]}),a.jsxs(Ba,{type:"button",onClick:()=>c(!0),children:[a.jsx(Be,{className:"h-4 w-4 mr-2"}),"Создать рассылку"]})]})}),a.jsxs(Va,{children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[a.jsxs(Nn,{value:v,onValueChange:y,children:[a.jsx(_n,{className:"w-[180px]",children:a.jsx(wn,{placeholder:"Все статусы"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"all",children:"Все статусы"}),a.jsx(En,{value:"draft",children:"Черновик"}),a.jsx(En,{value:"sent",children:"Отправлено"}),a.jsx(En,{value:"failed",children:"Ошибка"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Pr,{type:"date",placeholder:"Дата от",value:b,onChange:e=>N(e.target.value),className:"w-[160px]"}),a.jsx("span",{className:"text-muted-foreground",children:"—"}),a.jsx(Pr,{type:"date",placeholder:"Дата до",value:w,onChange:e=>_(e.target.value),className:"w-[160px]"})]}),("all"!==v||b||w)&&a.jsx(Ba,{type:"button",variant:"outline",size:"sm",onClick:()=>{y("all"),N(""),_("")},children:"Сбросить фильтры"})]}),i&&a.jsxs("div",{className:"flex items-center gap-2 text-red-500 mb-4 p-3 bg-red-50 rounded-md",children:[a.jsx(be,{className:"h-5 w-5"}),a.jsx("p",{children:i})]}),r?a.jsx("div",{className:"space-y-2",children:[...Array(10)].map((e,s)=>a.jsx(Fr,{className:"h-16 w-full"},s))}):0===e.length?a.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[a.jsx(Ie,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),a.jsx("p",{children:"Рассылок пока нет"})]}):a.jsx("div",{className:"border rounded-md overflow-hidden",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"bg-muted",children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-left p-3 font-medium",children:"Дата"}),a.jsx("th",{className:"text-left p-3 font-medium",children:"Кто создал"}),a.jsx("th",{className:"text-left p-3 font-medium",children:"Целевая группа"}),a.jsx("th",{className:"text-left p-3 font-medium",children:"Сообщение"}),a.jsx("th",{className:"text-center p-3 font-medium",children:"Статус"}),a.jsx("th",{className:"text-center p-3 font-medium",children:"Получателей"}),a.jsx("th",{className:"text-center p-3 font-medium",children:"Действия"})]})}),a.jsx("tbody",{children:e.map(e=>a.jsxs("tr",{className:"border-t hover:bg-muted/50",children:[a.jsx("td",{className:"p-3",children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:ls(new Date(e.created_at),"dd.MM.yyyy",{locale:os})}),a.jsx("span",{className:"text-xs text-muted-foreground",children:ls(new Date(e.created_at),"HH:mm",{locale:os})})]})}),a.jsx("td",{className:"p-3",children:e.created_by.full_name}),a.jsx("td",{className:"p-3 text-xs",children:C(e)}),a.jsx("td",{className:"p-3",children:a.jsx("span",{className:"text-xs cursor-help",title:e.message,children:E(e.message)})}),a.jsx("td",{className:"p-3 text-center",children:k(e.status)}),a.jsx("td",{className:"p-3 text-center",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("span",{className:"font-medium text-green-700",children:e.successful_sends}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["/ ",e.total_recipients]}),e.failed_sends>0&&a.jsxs("span",{className:"text-xs text-red-600",children:["(",e.failed_sends," ошибок)"]})]})}),a.jsx("td",{className:"p-3",children:a.jsx("div",{className:"flex items-center justify-center gap-2",children:a.jsx(Ba,{type:"button",variant:"outline",size:"sm",onClick:()=>{return s=e.id,h(s),void u(!0);var s},children:a.jsx(Qe,{className:"h-4 w-4"})})})})]},e.id))})]})}),j>1&&a.jsxs("div",{className:"flex items-center justify-between mt-4",children:[a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Показано ",e.length," из ",g]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ba,{type:"button",variant:"outline",size:"sm",onClick:()=>p(e=>Math.max(1,e-1)),disabled:1===x||r,children:a.jsx(ts,{className:"h-4 w-4"})}),a.jsxs("span",{className:"text-sm",children:["Страница ",x," из ",j]}),a.jsx(Ba,{type:"button",variant:"outline",size:"sm",onClick:()=>p(e=>Math.min(j,e+1)),disabled:x===j||r,children:a.jsx(as,{className:"h-4 w-4"})})]})]})]})]}),a.jsx(fi,{open:o,onOpenChange:c,onSuccess:()=>{p(1),S()}}),a.jsx(ji,{broadcastId:m,open:d,onOpenChange:u})]})}function yi(){const[e,s]=t.useState(null),[r,n]=t.useState(null),[i,l]=t.useState([]),[o,c]=t.useState([]),[d,u]=t.useState(!0),[m,h]=t.useState(null),[x,p]=t.useState(new Date),[g,f]=t.useState(!0),[j,v]=t.useState("24h");t.useEffect(()=>{if(y(),g){const e=setInterval(y,3e4);return()=>clearInterval(e)}},[g]);const y=async()=>{var e,t;try{u(!0),h(null);const a=await Sa.request("/core/metrics/");a.data&&(s(a.data),la.info("[SystemMonitoring] Metrics loaded:",a.data),c(e=>[...e.slice(-23),{timestamp:new Date,cpu:a.data.cpu.usage_percent,memory:a.data.memory.used_percent,disk:a.data.disk.used_percent}]));const r=await Sa.request("/core/monitoring/celery/");(null==(e=r.data)?void 0:e.data)&&n(r.data.data);const i=await Sa.request("/core/alerts/");(null==(t=i.data)?void 0:t.alerts)&&l(i.data.alerts),p(new Date)}catch(a){la.error("[SystemMonitoring] Failed to load metrics:",a),h("Failed to load system metrics. Please try again.")}finally{u(!1)}},b=e=>{switch(e){case"healthy":return"text-green-600 bg-green-50";case"warning":return"text-yellow-600 bg-yellow-50";case"critical":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},N=e=>{switch(e){case"healthy":return a.jsx(We,{className:"h-4 w-4"});case"warning":return a.jsx(ke,{className:"h-4 w-4"});case"critical":return a.jsx(be,{className:"h-4 w-4"});default:return a.jsx(Ae,{className:"h-4 w-4"})}},w=o.map((e,s)=>({name:`${s}`,cpu:parseFloat(e.cpu.toFixed(1)),memory:parseFloat(e.memory.toFixed(1)),disk:parseFloat(e.disk.toFixed(1))}));return d&&!e?a.jsx("div",{className:"container mx-auto p-4",children:a.jsxs("div",{className:"flex items-center justify-center h-96",children:[a.jsx(we,{className:"h-8 w-8 animate-spin text-muted-foreground"}),a.jsx("span",{className:"ml-2 text-muted-foreground",children:"Loading metrics..."})]})}):a.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"System Monitoring"}),a.jsxs("p",{className:"text-muted-foreground mt-1",children:["Last updated: ",x.toLocaleTimeString()]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Ba,{onClick:y,disabled:d,variant:"outline",className:"flex items-center gap-2",children:[a.jsx(we,{className:"h-4 w-4 "+(d?"animate-spin":"")}),"Refresh"]}),a.jsxs(Ba,{onClick:()=>{if(!e||!r)return void la.warn("[SystemMonitoring] No metrics to export");const s=[["System Metrics Export",(new Date).toISOString()],[""],["CPU Usage %",e.cpu.usage_percent.toString()],["Memory Usage %",e.memory.used_percent.toString()],["Disk Usage %",e.disk.used_percent.toString()],["Database Response Time (ms)",e.database.response_time_ms.toString()],["Cache Status",e.cache.status],[""],["Celery Tasks (24h)"],["Total",r.executions_24h.total.toString()],["Success",r.executions_24h.success.toString()],["Failed",r.executions_24h.failed.toString()],["Success Rate %",r.executions_24h.success_rate.toString()]].map(e=>e.join(",")).join("\n"),t=new Blob([s],{type:"text/csv"}),a=window.URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=`system-metrics-${(new Date).toISOString().split("T")[0]}.csv`,n.click(),window.URL.revokeObjectURL(a)},disabled:!e,variant:"outline",className:"flex items-center gap-2",children:[a.jsx(Te,{className:"h-4 w-4"}),"Export CSV"]}),a.jsxs(Ba,{onClick:()=>f(!g),variant:g?"default":"outline",className:"flex items-center gap-2",children:[a.jsx(cs,{className:"h-4 w-4"}),g?"Auto (30s)":"Manual"]})]})]}),a.jsx("div",{className:"flex gap-2",children:["1h","24h","7d"].map(e=>a.jsx(Ba,{onClick:()=>v(e),variant:j===e?"default":"outline",size:"sm",children:e},e))}),m&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(An,{children:"Error"}),a.jsx(Pn,{children:m})]}),i.length>0&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[a.jsx(ke,{className:"h-5 w-5"}),"Active Alerts (",i.length,")"]}),i.map((e,s)=>a.jsxs(Rn,{variant:"critical"===e.severity?"destructive":"default",children:["critical"===e.severity?a.jsx(be,{className:"h-4 w-4"}):a.jsx(ke,{className:"h-4 w-4"}),a.jsx(An,{children:e.component}),a.jsx(Pn,{children:e.message})]},s))]}),e&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[a.jsxs(Fa,{className:b(e.cpu.status),children:[a.jsx(Ma,{className:"pb-3",children:a.jsxs($a,{className:"text-sm font-medium flex items-center gap-2",children:[a.jsx(vs,{className:"h-4 w-4"}),"CPU Usage"]})}),a.jsx(Va,{children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-2xl font-bold",children:[e.cpu.usage_percent.toFixed(1),"%"]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[N(e.cpu.status),a.jsx("span",{className:"capitalize",children:e.cpu.status})]}),a.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.cpu.core_count," cores"]})]})})]}),a.jsxs(Fa,{className:b(e.memory.status),children:[a.jsx(Ma,{className:"pb-3",children:a.jsxs($a,{className:"text-sm font-medium flex items-center gap-2",children:[a.jsx(Ae,{className:"h-4 w-4"}),"Memory Usage"]})}),a.jsx(Va,{children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-2xl font-bold",children:[e.memory.used_percent.toFixed(1),"%"]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[N(e.memory.status),a.jsx("span",{className:"capitalize",children:e.memory.status})]}),a.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.memory.available_gb.toFixed(1),"GB available"]})]})})]}),a.jsxs(Fa,{className:b(e.disk.status),children:[a.jsx(Ma,{className:"pb-3",children:a.jsxs($a,{className:"text-sm font-medium flex items-center gap-2",children:[a.jsx(ys,{className:"h-4 w-4"}),"Disk Usage"]})}),a.jsx(Va,{children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-2xl font-bold",children:[e.disk.used_percent.toFixed(1),"%"]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[N(e.disk.status),a.jsx("span",{className:"capitalize",children:e.disk.status})]}),a.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.disk.free_gb.toFixed(1),"GB free"]})]})})]}),a.jsxs(Fa,{className:b(e.database.status),children:[a.jsx(Ma,{className:"pb-3",children:a.jsxs($a,{className:"text-sm font-medium flex items-center gap-2",children:[a.jsx(bs,{className:"h-4 w-4"}),"Database"]})}),a.jsx(Va,{children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-2xl font-bold",children:[e.database.response_time_ms.toFixed(0),"ms"]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[N(e.database.status),a.jsx("span",{className:"capitalize",children:e.database.status})]}),a.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.database.user_count," users"]})]})})]}),a.jsxs(Fa,{className:b(e.cache.status),children:[a.jsx(Ma,{className:"pb-3",children:a.jsxs($a,{className:"text-sm font-medium flex items-center gap-2",children:[a.jsx(Ns,{className:"h-4 w-4"}),"Cache"]})}),a.jsx(Va,{children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"text-2xl font-bold",children:[e.cache.response_time_ms.toFixed(0),"ms"]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[N(e.cache.status),a.jsx("span",{className:"capitalize",children:e.cache.is_working?"Working":"Down"})]})]})})]})]}),w.length>1&&a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsx($a,{children:"Performance Trends (Last 24 Hours)"})}),a.jsx(Va,{children:a.jsx(Nt,{width:"100%",height:300,children:a.jsxs(wt,{data:w,children:[a.jsx(_t,{strokeDasharray:"3 3"}),a.jsx(St,{dataKey:"name"}),a.jsx(kt,{domain:[0,100]}),a.jsx(Ct,{formatter:e=>`${e.toFixed(1)}%`}),a.jsx(Et,{}),a.jsx(Tt,{type:"monotone",dataKey:"cpu",stroke:"#ef4444",dot:!1,name:"CPU %"}),a.jsx(Tt,{type:"monotone",dataKey:"memory",stroke:"#f59e0b",dot:!1,name:"Memory %"}),a.jsx(Tt,{type:"monotone",dataKey:"disk",stroke:"#3b82f6",dot:!1,name:"Disk %"})]})})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsx($a,{children:"CPU Distribution"})}),a.jsx(Va,{children:a.jsx(Nt,{width:"100%",height:250,children:a.jsxs(Rt,{children:[a.jsxs(At,{data:[{name:"Used",value:e.cpu.usage_percent},{name:"Available",value:Math.max(0,100-e.cpu.usage_percent)}],cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,dataKey:"value",children:[a.jsx(Pt,{fill:"#ef4444"}),a.jsx(Pt,{fill:"#e5e7eb"})]}),a.jsx(Ct,{formatter:e=>`${e.toFixed(1)}%`})]})})})]}),a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsx($a,{children:"Memory Distribution"})}),a.jsx(Va,{children:a.jsx(Nt,{width:"100%",height:250,children:a.jsxs(Rt,{children:[a.jsxs(At,{data:[{name:"Used",value:e.memory.used_percent},{name:"Available",value:Math.max(0,100-e.memory.used_percent)}],cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,dataKey:"value",children:[a.jsx(Pt,{fill:"#f59e0b"}),a.jsx(Pt,{fill:"#e5e7eb"})]}),a.jsx(Ct,{formatter:e=>`${e.toFixed(1)}%`})]})})})]}),a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsx($a,{children:"Disk Distribution"})}),a.jsx(Va,{children:a.jsx(Nt,{width:"100%",height:250,children:a.jsxs(Rt,{children:[a.jsxs(At,{data:[{name:"Used",value:e.disk.used_percent},{name:"Free",value:Math.max(0,100-e.disk.used_percent)}],cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,dataKey:"value",children:[a.jsx(Pt,{fill:"#3b82f6"}),a.jsx(Pt,{fill:"#e5e7eb"})]}),a.jsx(Ct,{formatter:e=>`${e.toFixed(1)}%`})]})})})]})]})]}),r&&a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsx($a,{children:"Celery Task Execution (24h)"})}),a.jsxs(Va,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Tasks"}),a.jsx("div",{className:"text-2xl font-bold",children:r.executions_24h.total})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:"Success"}),a.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.executions_24h.success})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:"Failed"}),a.jsx("div",{className:"text-2xl font-bold text-red-600",children:r.executions_24h.failed})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:"Success Rate"}),a.jsxs("div",{className:"text-2xl font-bold",children:[r.executions_24h.success_rate.toFixed(1),"%"]})]})]}),a.jsxs("div",{className:"mt-4 p-4 bg-muted rounded",children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:"Avg Duration"}),a.jsxs("div",{className:"text-lg font-semibold",children:[r.executions_24h.avg_duration_seconds.toFixed(2),"s"]})]})]})]}),(null==e?void 0:e.external_services)&&a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsx($a,{children:"External Services"})}),a.jsx(Va,{children:a.jsx("div",{className:"space-y-3",children:Object.entries(e.external_services).map(([e,s])=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded",children:[a.jsx("span",{className:"capitalize font-medium",children:e}),a.jsxs("div",{className:"flex items-center gap-2",children:[N(s.status),a.jsx("span",{className:"capitalize text-sm",children:s.status}),s.response_time_ms&&a.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",s.response_time_ms.toFixed(0),"ms)"]})]})]},e))})})]})]})}const bi=async(e={})=>{const s=new URLSearchParams;e.date_from&&s.append("date_from",e.date_from),e.date_to&&s.append("date_to",e.date_to),e.type&&s.append("type",e.type),e.channel&&s.append("channel",e.channel),e.granularity&&s.append("granularity",e.granularity);return await Sa.get(`/notifications/analytics/metrics/?${s.toString()}`)},Ni=async(e={})=>{const s=new URLSearchParams;e.date_from&&s.append("date_from",e.date_from),e.date_to&&s.append("date_to",e.date_to);return await Sa.get(`/notifications/analytics/performance/?${s.toString()}`)},wi=async(e={})=>{const s=new URLSearchParams;e.date_from&&s.append("date_from",e.date_from),e.date_to&&s.append("date_to",e.date_to),e.limit&&s.append("limit",e.limit.toString());return await Sa.get(`/notifications/analytics/top-types/?${s.toString()}`)},_i=["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899"],Si={email:"#3b82f6",push:"#10b981",sms:"#f59e0b",in_app:"#8b5cf6"},ki=({active:e,payload:s,label:t})=>e&&s&&s.length?a.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded shadow-lg",children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t}),s.map((e,s)=>a.jsxs("p",{style:{color:e.color},className:"text-sm",children:[e.name,": ","number"==typeof e.value?e.value.toLocaleString():e.value]},s))]}):null,Ci=({title:e,value:s,change:t,unit:r,icon:n})=>a.jsxs(Fa,{children:[a.jsx(Ma,{className:"pb-2",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx($a,{className:"text-sm font-medium text-gray-600",children:e}),n&&a.jsx("div",{className:"text-gray-400",children:n})]})}),a.jsxs(Va,{children:[a.jsxs("div",{className:"flex items-baseline justify-between",children:[a.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s}),void 0!==t&&a.jsxs("div",{className:"flex items-center text-xs font-semibold "+(t>=0?"text-green-600":"text-red-600"),children:[t>=0?a.jsx(ws,{className:"w-3 h-3 mr-1"}):a.jsx(Ss,{className:"w-3 h-3 mr-1"}),Math.abs(t),"%"]})]}),r&&a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:r})]})]}),Ei=({onFilterChange:e,currentFilters:s})=>{const[r,n]=t.useState(s);t.useEffect(()=>{n(s)},[s]);const i=(e,s)=>{const t={...r,[e]:s};n(t)};return a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsxs($a,{className:"text-lg flex items-center",children:[a.jsx(_s,{className:"w-4 h-4 mr-2"}),"Filters"]})}),a.jsxs(Va,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date From"}),a.jsx("input",{type:"date",value:r.date_from||"",onChange:e=>i("date_from",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date To"}),a.jsx("input",{type:"date",value:r.date_to||"",onChange:e=>i("date_to",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Granularity"}),a.jsxs("select",{value:r.granularity||"day",onChange:e=>n({...r,granularity:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[a.jsx("option",{value:"hour",children:"Hourly"}),a.jsx("option",{value:"day",children:"Daily"}),a.jsx("option",{value:"week",children:"Weekly"})]})]}),a.jsxs("div",{className:"flex items-end gap-2",children:[a.jsx(Ba,{onClick:()=>{e(r)},className:"flex-1",variant:"default",children:"Apply"}),a.jsx(Ba,{onClick:()=>{const s={date_from:new Date(Date.now()-6048e5).toISOString().split("T")[0],date_to:(new Date).toISOString().split("T")[0],granularity:"day"};n(s),e(s)},variant:"outline",className:"flex-1",children:"Reset"})]})]}),a.jsxs("div",{className:"mt-4 flex gap-2",children:[a.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Channels:"}),["email","push","sms","in_app"].map(e=>a.jsx("button",{onClick:()=>(e=>{const s={...r,channel:r.channel===e?void 0:e};n(s)})(e),className:"px-3 py-1 rounded text-xs font-medium transition-colors "+(r.channel===e?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e},e))]})]})]})},Ti=()=>{var e,s,r,n,i,l,o,c,d,u,m,h,x,p,g;const[f,j]=t.useState({date_from:new Date(Date.now()-6048e5).toISOString().split("T")[0],date_to:(new Date).toISOString().split("T")[0],granularity:"day"}),{data:v,isLoading:y,error:b,refetch:N}=ct({queryKey:["notificationMetrics",f],queryFn:()=>bi(f),staleTime:6e4,retry:2}),{data:w,isLoading:_,error:S}=ct({queryKey:["channelPerformance",f.date_from,f.date_to],queryFn:()=>Ni(f),staleTime:6e4,retry:2}),{data:k,isLoading:C,error:E}=ct({queryKey:["topNotificationTypes",f.date_from,f.date_to],queryFn:()=>wi({...f,limit:5}),staleTime:6e4,retry:2}),T=y||_||C,R=t.useMemo(()=>v&&v.by_time||[],[v]),A=t.useMemo(()=>(null==w?void 0:w.channels)?w.channels:[],[w]),P=t.useMemo(()=>(null==k?void 0:k.top_types)?k.top_types.slice(0,5):[],[k]),L=t.useMemo(()=>{var e,s,t,a,r;return v?{totalSent:null!=(e=v.total_sent)?e:0,totalDelivered:null!=(s=v.total_delivered)?s:0,totalOpened:null!=(t=v.total_opened)?t:0,deliveryRate:null!=(a=v.delivery_rate)?a:0,openRate:null!=(r=v.open_rate)?r:0}:null},[v]);if(T)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"flex flex-col items-center gap-3",children:[a.jsx(we,{className:"w-8 h-8 text-blue-600 animate-spin"}),a.jsx("p",{className:"text-gray-600",children:"Loading analytics data..."})]})});if(b||S||E){const e=b||S||E;return la.error("Analytics data fetch failed:",e),a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs(Rn,{className:"border-red-200 bg-red-50",children:[a.jsx(be,{className:"h-4 w-4 text-red-600"}),a.jsx(Pn,{className:"text-red-700",children:"Failed to load analytics data. Please try again or contact support."})]})})}return a.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Notification Analytics"}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Monitor notification delivery, open rates, and channel performance"})]}),a.jsxs(Ba,{onClick:()=>{N()},variant:"outline",size:"sm",className:"flex items-center gap-2",children:[a.jsx(we,{className:"w-4 h-4"}),"Refresh"]})]}),a.jsx(Ei,{onFilterChange:e=>{j(e)},currentFilters:f}),L?a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[a.jsx(Ci,{title:"Total Sent",value:(null!=(e=L.totalSent)?e:0).toLocaleString(),icon:a.jsx(Ie,{className:"w-4 h-4"})}),a.jsx(Ci,{title:"Delivered",value:(null!=(s=L.totalDelivered)?s:0).toLocaleString(),icon:a.jsx(We,{className:"w-4 h-4"})}),a.jsx(Ci,{title:"Opened",value:(null!=(r=L.totalOpened)?r:0).toLocaleString(),icon:a.jsx(vs,{className:"w-4 h-4"})}),a.jsx(Ci,{title:"Delivery Rate",value:`${(null!=(n=L.deliveryRate)?n:0).toFixed(1)}%`,unit:"% of sent",icon:a.jsx(De,{className:"w-4 h-4"})}),a.jsx(Ci,{title:"Open Rate",value:`${(null!=(i=L.openRate)?i:0).toFixed(1)}%`,unit:"% of sent",icon:a.jsx(ws,{className:"w-4 h-4"})})]}):a.jsxs(Rn,{className:"border-blue-200 bg-blue-50",children:[a.jsx(be,{className:"h-4 w-4 text-blue-600"}),a.jsx(Pn,{className:"text-blue-700",children:"No analytics data available for the selected period"})]}),a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Notification Metrics Over Time"}),a.jsx(Ua,{children:"Daily notification counts and open rates"})]}),a.jsx(Va,{children:R.length>0?a.jsx(Nt,{width:"100%",height:300,children:a.jsxs(wt,{data:R,margin:{top:5,right:30,left:0,bottom:5},children:[a.jsx(_t,{strokeDasharray:"3 3"}),a.jsx(St,{dataKey:"time",tick:{fill:"#6b7280"},style:{fontSize:"12px"}}),a.jsx(kt,{tick:{fill:"#6b7280"},style:{fontSize:"12px"}}),a.jsx(Ct,{content:a.jsx(ki,{})}),a.jsx(Et,{}),a.jsx(Tt,{type:"monotone",dataKey:"count",stroke:_i[0],dot:!1,strokeWidth:2,name:"Sent"}),a.jsx(Tt,{type:"monotone",dataKey:"sent",stroke:_i[1],dot:!1,strokeWidth:2,name:"Processed"}),a.jsx(Tt,{type:"monotone",dataKey:"opened",stroke:_i[2],dot:!1,strokeWidth:2,name:"Opened"})]})}):a.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:"No data available for selected period"})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Channel Performance"}),a.jsx(Ua,{children:"Delivery rates by notification channel"})]}),a.jsxs(Va,{children:[A.length>0?a.jsx(Nt,{width:"100%",height:300,children:a.jsxs(Lt,{data:A,margin:{top:5,right:30,left:0,bottom:5},children:[a.jsx(_t,{strokeDasharray:"3 3"}),a.jsx(St,{dataKey:"channel",tick:{fill:"#6b7280"},style:{fontSize:"12px"}}),a.jsx(kt,{tick:{fill:"#6b7280"},style:{fontSize:"12px"}}),a.jsx(Ct,{content:a.jsx(ki,{})}),a.jsx(Et,{}),a.jsx(qt,{dataKey:"count",fill:_i[0],name:"Sent"}),a.jsx(qt,{dataKey:"delivered",fill:_i[2],name:"Delivered"}),a.jsx(qt,{dataKey:"failed",fill:_i[1],name:"Failed"})]})}):a.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:"No channel data available"}),a.jsx("div",{className:"mt-6 space-y-2",children:A.map(e=>{var s,t,r;return a.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Si[e.channel]||_i[0]}}),a.jsx("span",{className:"font-medium text-sm text-gray-700 capitalize",children:e.channel||"Unknown"})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[(null!=(s=e.delivery_rate)?s:0).toFixed(1),"% delivery rate"]}),a.jsxs("span",{className:"text-xs text-gray-500",children:[(null!=(t=e.delivered)?t:0).toLocaleString(),"/",(null!=(r=e.count)?r:0).toLocaleString()]})]})]},e.channel)})})]})]}),a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Top Performing Notification Types"}),a.jsx(Ua,{children:"Types with highest open rates"})]}),a.jsx(Va,{children:P.length>0?a.jsxs(a.Fragment,{children:[a.jsx(Nt,{width:"100%",height:300,children:a.jsxs(Rt,{children:[a.jsx(At,{data:P,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,open_rate:s})=>`${e}: ${s.toFixed(1)}%`,outerRadius:80,fill:"#8884d8",dataKey:"open_rate",children:P.map((e,s)=>a.jsx(Pt,{fill:_i[s%_i.length]},`cell-${s}`))}),a.jsx(Ct,{formatter:e=>`${e.toFixed(1)}%`})]})}),a.jsx("div",{className:"mt-6 space-y-2",children:P.map((e,s)=>{var t,r;return a.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:_i[s%_i.length]}}),a.jsx("span",{className:"font-medium text-sm text-gray-700 capitalize",children:(e.type||"Unknown").replace(/_/g," ")})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{className:"text-sm text-gray-600",children:[(null!=(t=e.open_rate)?t:0).toFixed(1),"% open rate"]}),a.jsxs("span",{className:"text-xs text-gray-500",children:[(null!=(r=e.count)?r:0).toLocaleString()," sent"]})]})]},e.type||s)})})]}):a.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:"No type data available"})})]})]}),(null==v?void 0:v.summary)?a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Delivery Summary"}),a.jsx(Ua,{children:"Detailed delivery statistics and error analysis"})]}),a.jsxs(Va,{children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Average Delivery Time"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:null!=(l=v.summary.avg_delivery_time)?l:"N/A"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Failed"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:(null!=(o=v.summary.total_failed)?o:0).toLocaleString()})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),a.jsxs("p",{className:"text-2xl font-bold text-green-600 mt-2",children:[(null!=(c=v.summary.failures)?c:0)+(null!=(d=v.summary.total_sent)?d:0)>0?(100*(1-(null!=(u=v.summary.failures)?u:0)/((null!=(m=v.summary.failures)?m:0)+(null!=(h=v.summary.total_sent)?h:0)))).toFixed(1):"0","%"]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Engagement Rate"}),a.jsxs("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:[(null!=(x=v.summary.total_sent)?x:0)>0?((null!=(p=v.summary.total_opened)?p:0)/(null!=(g=v.summary.total_sent)?g:0)*100).toFixed(1):"0","%"]})]})]}),v.summary.error_reasons&&v.summary.error_reasons.length>0&&a.jsxs("div",{className:"mt-6 pt-6 border-t",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Top Error Reasons"}),a.jsx("ul",{className:"space-y-2",children:v.summary.error_reasons.map((e,s)=>a.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[a.jsxs("span",{className:"text-red-600 font-bold",children:[s+1,"."]}),a.jsx("span",{className:"text-gray-700",children:e})]},s))})]})]})]}):null]})},Ri=t.forwardRef(({className:e,...s},t)=>a.jsx("div",{className:"relative w-full overflow-auto",children:a.jsx("table",{ref:t,className:Bt("w-full caption-bottom text-sm",e),...s})}));Ri.displayName="Table";const Ai=t.forwardRef(({className:e,...s},t)=>a.jsx("thead",{ref:t,className:Bt("[&_tr]:border-b",e),...s}));Ai.displayName="TableHeader";const Pi=t.forwardRef(({className:e,...s},t)=>a.jsx("tbody",{ref:t,className:Bt("[&_tr:last-child]:border-0",e),...s}));Pi.displayName="TableBody";t.forwardRef(({className:e,...s},t)=>a.jsx("tfoot",{ref:t,className:Bt("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s})).displayName="TableFooter";const Li=t.forwardRef(({className:e,...s},t)=>a.jsx("tr",{ref:t,className:Bt("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...s}));Li.displayName="TableRow";const qi=t.forwardRef(({className:e,...s},t)=>a.jsx("th",{ref:t,className:Bt("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...s}));qi.displayName="TableHead";const Ii=t.forwardRef(({className:e,...s},t)=>a.jsx("td",{ref:t,className:Bt("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...s}));Ii.displayName="TableCell";t.forwardRef(({className:e,...s},t)=>a.jsx("caption",{ref:t,className:Bt("mt-4 text-sm text-muted-foreground",e),...s})).displayName="TableCaption";const zi={async getTemplates(e=1,s=20,t){const a=new URLSearchParams;return a.append("page",e.toString()),a.append("page_size",s.toString()),(null==t?void 0:t.type)&&a.append("type",t.type),void 0!==(null==t?void 0:t.is_active)&&a.append("is_active",t.is_active.toString()),(null==t?void 0:t.search)&&a.append("search",t.search),Sa.request(`/notifications/templates/?${a.toString()}`,{method:"GET"})},getTemplate:async e=>Sa.request(`/notifications/templates/${e}/`,{method:"GET"}),createTemplate:async e=>Sa.request("/notifications/templates/",{method:"POST",body:JSON.stringify(e)}),updateTemplate:async(e,s)=>Sa.request(`/notifications/templates/${e}/`,{method:"PATCH",body:JSON.stringify(s)}),deleteTemplate:async e=>Sa.request(`/notifications/templates/${e}/`,{method:"DELETE"}),previewTemplate:async(e,s)=>Sa.request(`/notifications/templates/${e}/preview/`,{method:"POST",body:JSON.stringify({context:s})}),validateTemplate:async(e,s)=>Sa.request("/notifications/templates/validate/",{method:"POST",body:JSON.stringify({title_template:e,message_template:s})}),cloneTemplate:async e=>Sa.request(`/notifications/templates/${e}/clone/`,{method:"POST"})},Di=ks({name:Es().min(1,"Название обязательно").max(200),description:Es().max(1e3).optional().default(""),type:Es().min(1,"Тип уведомления обязателен"),title_template:Es().min(1,"Шаблон заголовка обязателен"),message_template:Es().min(1,"Шаблон сообщения обязателен"),is_active:Cs().default(!0)}),Oi=e=>{var s,t;if(e.error&&"string"==typeof e.error)return e.error;if((null==(s=e.data)?void 0:s.detail)&&"string"==typeof e.data.detail)return e.data.detail;if((null==(t=e.data)?void 0:t.error)&&"string"==typeof e.data.error)return e.data.error;if(e.data&&"object"==typeof e.data){const s=[];if(Object.entries(e.data).forEach(([e,t])=>{Array.isArray(t)?s.push(`${e}: ${t.join(", ")}`):"string"==typeof t&&s.push(`${e}: ${t}`)}),s.length>0)return s.join("; ")}return"Неизвестная ошибка сервера"},Fi=[{value:"assignment_new",label:"Новое задание"},{value:"assignment_due",label:"Срок сдачи задания"},{value:"assignment_graded",label:"Задание оценено"},{value:"material_new",label:"Новый материал"},{value:"message_new",label:"Новое сообщение"},{value:"report_ready",label:"Отчет готов"},{value:"payment_success",label:"Платеж успешен"},{value:"payment_failed",label:"Платеж не прошел"},{value:"system",label:"Системное уведомление"},{value:"reminder",label:"Напоминание"},{value:"student_created",label:"Ученик создан"},{value:"subject_assigned",label:"Предмет назначен"},{value:"material_published",label:"Материал опубликован"},{value:"homework_submitted",label:"Домашнее задание отправлено"},{value:"payment_processed",label:"Платеж обработан"},{value:"invoice_sent",label:"Счет выставлен"},{value:"invoice_paid",label:"Счет оплачен"},{value:"invoice_overdue",label:"Счет просрочен"},{value:"invoice_viewed",label:"Счет просмотрен"}],Mi=[{name:"user_name",description:"Имя пользователя",example:"Иван Сидоров"},{name:"user_email",description:"Email пользователя",example:"ivan@example.com"},{name:"subject",description:"Название предмета",example:"Математика"},{name:"date",description:"Дата",example:"2025-12-27"},{name:"title",description:"Название/заголовок",example:"Контрольная работа"},{name:"grade",description:"Оценка",example:"5"},{name:"feedback",description:"Обратная связь",example:"Отличная работа!"}],$i=({open:e,onOpenChange:s,template:r,onSuccess:n})=>{const[i,l]=t.useState(!1),[o,c]=t.useState(!1),[d,u]=t.useState([]),[m,h]=t.useState(null),[x,p]=t.useState(!1),{register:g,handleSubmit:f,watch:j,getValues:v,formState:{errors:y},reset:b,setValue:N}=Rs({resolver:As(Di),defaultValues:r||{name:"",description:"",type:"",title_template:"",message_template:"",is_active:!0}}),w=j("title_template"),_=j("message_template"),S=j("type"),k=j("is_active");t.useEffect(()=>{e&&r?b(r):e&&b({name:"",description:"",type:"",title_template:"",message_template:"",is_active:!0})},[e,r,b]);const C=(e,s)=>{if(!e)return"";let t=e;return Object.entries(s).forEach(([e,s])=>{const a=new RegExp(`{{\\s*${e}\\s*}}`,"g");t=t.replace(a,s||`[${e}]`)}),t};return a.jsxs(a.Fragment,{children:[a.jsx(dn,{open:e,onOpenChange:s,children:a.jsxs(xn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsx(pn,{children:a.jsx(fn,{children:r?"Редактировать шаблон":"Создать новый шаблон"})}),a.jsxs("form",{onSubmit:f(async e=>{l(!0),u([]);try{if(r){const t=await zi.updateTemplate(r.id,e);if(t.success)_e.success("Шаблон обновлен"),n(),s(!1);else{const e=Oi(t);_e.error(e)}}else{const t=await zi.createTemplate(e);if(t.success)_e.success("Шаблон создан"),n(),s(!1);else{const e=Oi(t);_e.error(e)}}}catch(t){_e.error((null==t?void 0:t.message)||"Ошибка сохранения шаблона")}finally{l(!1)}}),className:"space-y-4",children:[d.length>0&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:a.jsx("ul",{className:"list-disc pl-5 space-y-1",children:d.map((e,s)=>a.jsx("li",{children:e},s))})})]}),a.jsxs("div",{children:[a.jsx(cn,{htmlFor:"name",children:"Название"}),a.jsx(Pr,{id:"name",placeholder:"Название шаблона",...g("name")}),y.name&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:y.name.message})]}),a.jsxs("div",{children:[a.jsx(cn,{htmlFor:"description",children:"Описание"}),a.jsx(yn,{id:"description",placeholder:"Описание шаблона",className:"h-20",...g("description")})]}),a.jsxs("div",{children:[a.jsx(cn,{htmlFor:"type",children:"Тип уведомления"}),a.jsxs(Nn,{value:S||"",onValueChange:e=>N("type",e),children:[a.jsx(_n,{children:a.jsx(wn,{placeholder:"Выберите тип"})}),a.jsx(Cn,{children:Fi.map(e=>a.jsx(En,{value:e.value,children:e.label},e.value))})]}),y.type&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:y.type.message})]}),a.jsxs("div",{children:[a.jsx(cn,{htmlFor:"title_template",children:"Шаблон заголовка"}),a.jsx(yn,{id:"title_template",placeholder:"Пример: Новое задание: {{title}}",className:"h-20 font-mono text-sm",...g("title_template")}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Используйте переменные в формате: ","{{variable_name}}"]}),y.title_template&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:y.title_template.message})]}),a.jsxs("div",{children:[a.jsx(cn,{htmlFor:"message_template",children:"Шаблон сообщения"}),a.jsx(yn,{id:"message_template",placeholder:"Пример: Привет {{user_name}}, у вас новое задание по {{subject}}...",className:"h-32 font-mono text-sm",...g("message_template")}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Используйте переменные в формате: ","{{variable_name}}"]}),y.message_template&&a.jsx("p",{className:"text-sm text-red-500 mt-1",children:y.message_template.message})]}),a.jsxs(Fa,{className:"bg-gray-50",children:[a.jsx(Ma,{className:"pb-3",children:a.jsx($a,{className:"text-sm",children:"Доступные переменные"})}),a.jsx(Va,{children:a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Mi.map(e=>a.jsxs("div",{className:"p-2 bg-white border rounded text-sm",children:[a.jsxs("code",{className:"text-blue-600 font-mono",children:["{{",e.name,"}"]}),a.jsx("p",{className:"text-gray-600",children:e.description}),a.jsxs("p",{className:"text-gray-400 text-xs",children:["Пример: ",e.example]})]},e.name))})})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(In,{id:"is_active",checked:k,onCheckedChange:e=>N("is_active",e)}),a.jsx(cn,{htmlFor:"is_active",className:"cursor-pointer",children:"Активен"})]}),a.jsxs(gn,{className:"space-x-2",children:[a.jsxs(Ba,{type:"button",variant:"outline",onClick:async()=>{p(!0),u([]);try{const e=v(),s=[];if(e.type||s.push("Выберите тип уведомления"),e.title_template||s.push("Заполните шаблон заголовка"),e.message_template||s.push("Заполните шаблон сообщения"),s.length>0)return u(s),void p(!1);const t={user_name:"Иван Сидоров",user_email:"ivan@example.com",subject:"Математика",date:ls(new Date,"dd.MM.yyyy",{locale:os}),title:"Контрольная работа",grade:"5",feedback:"Отличная работа!"};if(null==r?void 0:r.id){const s=await zi.previewTemplate(r.id,t);if(s.success&&s.data)h({title:s.data.rendered_title,message:s.data.rendered_message}),c(!0);else{const s=C(e.title_template,t),a=C(e.message_template,t);h({title:s,message:a}),c(!0)}}else{const s=C(e.title_template,t),a=C(e.message_template,t);h({title:s,message:a}),c(!0)}}catch(e){u([(null==e?void 0:e.message)||"Ошибка предпросмотра"])}finally{p(!1)}},disabled:x||!w||!_,children:[x?a.jsx(Ee,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Предпросмотр"]}),a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:i,children:"Отмена"}),a.jsx(Ba,{type:"submit",disabled:i,children:i?a.jsx(Ee,{className:"h-4 w-4 mr-2 animate-spin"}):a.jsx(a.Fragment,{children:r?a.jsxs(a.Fragment,{children:[a.jsx(Ts,{className:"h-4 w-4 mr-2"}),"Обновить"]}):a.jsxs(a.Fragment,{children:[a.jsx(Be,{className:"h-4 w-4 mr-2"}),"Создать"]})})})]})]})]})}),a.jsx(dn,{open:o,onOpenChange:c,children:a.jsxs(xn,{className:"max-w-2xl",children:[a.jsx(pn,{children:a.jsx(fn,{children:"Предпросмотр шаблона"})}),m&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx(cn,{children:"Заголовок"}),a.jsx("div",{className:"p-3 bg-gray-50 border rounded mt-1 text-sm",children:m.title})]}),a.jsxs("div",{children:[a.jsx(cn,{children:"Сообщение"}),a.jsx("div",{className:"p-3 bg-gray-50 border rounded mt-1 text-sm whitespace-pre-wrap",children:m.message})]})]}),a.jsx(gn,{children:a.jsx(Ba,{onClick:()=>c(!1),children:"Закрыть"})})]})})]})},Ui=()=>{const[e,s]=t.useState([]),[r,n]=t.useState(!0),[i,l]=t.useState(null),[o,c]=t.useState(1),[d,u]=t.useState(0),m=Math.ceil(d/20),[h,x]=t.useState(!1),[p,g]=t.useState(!1),[f,j]=t.useState(null),[v,y]=t.useState(!1),[b,N]=t.useState(null),[w,_]=t.useState(!1),[S,k]=t.useState("all"),[C,E]=t.useState("all"),[T,R]=t.useState("");t.useEffect(()=>{A()},[o,S,C,T]);const A=async()=>{n(!0),l(null);try{const e=await zi.getTemplates(o,20,{type:S&&"all"!==S?S:void 0,is_active:C&&"all"!==C?"true"===C:void 0,search:T||void 0});e.success&&e.data?(s(e.data.results||[]),u(e.data.count||0)):l(e.error||"Ошибка загрузки шаблонов")}catch(e){l((null==e?void 0:e.message)||"Ошибка загрузки шаблонов")}finally{n(!1)}},P=e=>{const s=Fi.find(s=>s.value===e);return(null==s?void 0:s.label)||e};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Шаблоны уведомлений"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Управление шаблонами для отправки уведомлений"})]}),a.jsxs(Ba,{onClick:()=>x(!0),children:[a.jsx(Be,{className:"h-4 w-4 mr-2"}),"Новый шаблон"]})]}),i&&a.jsxs(Rn,{variant:"destructive",children:[a.jsx(be,{className:"h-4 w-4"}),a.jsx(Pn,{children:i})]}),a.jsx(Fa,{children:a.jsx(Va,{className:"pt-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx(cn,{htmlFor:"search",children:"Поиск"}),a.jsx(Pr,{id:"search",placeholder:"Введите название или описание",value:T,onChange:e=>{R(e.target.value),c(1)}})]}),a.jsxs("div",{children:[a.jsx(cn,{htmlFor:"type-filter",children:"Тип уведомления"}),a.jsxs(Nn,{value:S,onValueChange:e=>{k(e),c(1)},children:[a.jsx(_n,{children:a.jsx(wn,{placeholder:"Все типы"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"all",children:"Все типы"}),Fi.map(e=>a.jsx(En,{value:e.value,children:e.label},e.value))]})]})]}),a.jsxs("div",{children:[a.jsx(cn,{htmlFor:"active-filter",children:"Статус"}),a.jsxs(Nn,{value:C,onValueChange:e=>{E(e),c(1)},children:[a.jsx(_n,{children:a.jsx(wn,{placeholder:"Все"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"all",children:"Все"}),a.jsx(En,{value:"true",children:"Активные"}),a.jsx(En,{value:"false",children:"Неактивные"})]})]})]})]})})}),a.jsx(Fa,{children:a.jsx(Va,{className:"pt-6",children:r?a.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((e,s)=>a.jsx(Fr,{className:"h-16"},s))}):0===e.length?a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-gray-500",children:"Шаблоны не найдены"})}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs(Ri,{children:[a.jsx(Ai,{children:a.jsxs(Li,{children:[a.jsx(qi,{children:"Название"}),a.jsx(qi,{children:"Тип"}),a.jsx(qi,{children:"Статус"}),a.jsx(qi,{children:"Создано"}),a.jsx(qi,{className:"text-right",children:"Действия"})]})}),a.jsx(Pi,{children:e.map(e=>a.jsxs(Li,{children:[a.jsx(Ii,{children:a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:e.name}),e.description&&a.jsxs("p",{className:"text-sm text-gray-600",children:[e.description.substring(0,60),e.description.length>60?"...":""]})]})}),a.jsx(Ii,{children:a.jsx(Ya,{variant:"outline",children:P(e.type)})}),a.jsx(Ii,{children:e.is_active?a.jsxs(Ya,{className:"bg-green-100 text-green-800",children:[a.jsx(rs,{className:"h-3 w-3 mr-1"}),"Активен"]}):a.jsx(Ya,{variant:"secondary",children:"Неактивен"})}),a.jsx(Ii,{children:ls(new Date(e.created_at),"dd.MM.yyyy",{locale:os})}),a.jsxs(Ii,{className:"text-right space-x-2",children:[a.jsx(Ba,{variant:"ghost",size:"sm",onClick:()=>(e=>{j(e),g(!0)})(e),title:"Редактировать",children:a.jsx(Ts,{className:"h-4 w-4"})}),a.jsx(Ba,{variant:"ghost",size:"sm",onClick:()=>(async e=>{try{const s=await zi.cloneTemplate(e.id);if(s.success)_e.success("Шаблон скопирован"),A();else{const e=Oi(s);_e.error(e)}}catch(s){_e.error((null==s?void 0:s.message)||"Ошибка копирования")}})(e),title:"Скопировать",children:a.jsx(Ve,{className:"h-4 w-4"})}),a.jsx(Ba,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,N(s),void y(!0);var s},title:"Удалить",className:"text-red-600 hover:text-red-800",children:a.jsx(He,{className:"h-4 w-4"})})]})]},e.id))})]})})})}),m>1&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("p",{className:"text-sm text-gray-600",children:["Всего: ",d," шаблонов"]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Ba,{variant:"outline",size:"sm",onClick:()=>c(e=>Math.max(1,e-1)),disabled:1===o,children:a.jsx(ts,{className:"h-4 w-4"})}),a.jsxs("p",{className:"text-sm",children:["Страница ",o," из ",m]}),a.jsx(Ba,{variant:"outline",size:"sm",onClick:()=>c(e=>Math.min(m,e+1)),disabled:o===m,children:a.jsx(as,{className:"h-4 w-4"})})]})]}),a.jsx($i,{open:h,onOpenChange:x,onSuccess:()=>{c(1),A()}}),f&&a.jsx($i,{open:p,onOpenChange:g,template:f,onSuccess:A}),a.jsx(gr,{open:v,onOpenChange:y,children:a.jsxs(vr,{children:[a.jsxs(yr,{children:[a.jsx(Nr,{children:"Удалить шаблон?"}),a.jsx(wr,{children:"Это действие нельзя отменить. Шаблон будет удален."})]}),a.jsxs(_r,{onClick:async()=>{if(b){_(!0);try{const e=await zi.deleteTemplate(b);if(e.success)_e.success("Шаблон удален"),y(!1),N(null),A();else{const s=Oi(e);_e.error(s)}}catch(e){_e.error((null==e?void 0:e.message)||"Ошибка удаления")}finally{_(!1)}}},disabled:w,className:"bg-red-600 hover:bg-red-700",children:[w?a.jsx(Ee,{className:"h-4 w-4 mr-2 animate-spin"}):null,"Удалить"]}),a.jsx(Sr,{children:"Отмена"})]})})]})};function Vi(){return a.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:a.jsx(Ui,{})})}const Wi=Ls,Hi=t.createContext({}),Bi=({...e})=>a.jsx(Hi.Provider,{value:{name:e.name},children:a.jsx(qs,{...e})}),Xi=()=>{const e=t.useContext(Hi),s=t.useContext(Ji),{getFieldState:a,formState:r}=Ps(),n=a(e.name,r);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:i}=s;return{id:i,name:e.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},Ji=t.createContext({}),Ki=t.forwardRef(({className:e,...s},r)=>{const n=t.useId();return a.jsx(Ji.Provider,{value:{id:n},children:a.jsx("div",{ref:r,className:Bt("space-y-2",e),...s})})});Ki.displayName="FormItem";const Gi=t.forwardRef(({className:e,...s},t)=>{const{error:r,formItemId:n}=Xi();return a.jsx(cn,{ref:t,className:Bt(r&&"text-destructive",e),htmlFor:n,...s})});Gi.displayName="FormLabel";const Yi=t.forwardRef(({...e},s)=>{const{error:t,formItemId:r,formDescriptionId:n,formMessageId:i}=Xi();return a.jsx(f,{ref:s,id:r,"aria-describedby":t?`${n} ${i}`:`${n}`,"aria-invalid":!!t,...e})});Yi.displayName="FormControl";const Qi=t.forwardRef(({className:e,...s},t)=>{const{formDescriptionId:r}=Xi();return a.jsx("p",{ref:t,id:r,className:Bt("text-sm text-muted-foreground",e),...s})});Qi.displayName="FormDescription";const Zi=t.forwardRef(({className:e,children:s,...t},r)=>{const{error:n,formMessageId:i}=Xi(),l=n?String(null==n?void 0:n.message):s;return l?a.jsx("p",{ref:r,id:i,className:Bt("text-sm font-medium text-destructive",e),...t,children:l}):null});Zi.displayName="FormMessage";const el=ks({assignments_enabled:Cs().default(!0),payments_enabled:Cs().default(!0),notifications_enabled:Cs().default(!0),chat_enabled:Cs().default(!0),knowledge_graph_enabled:Cs().default(!0)}),sl=ks({api_requests_per_minute:Is().min(1).max(1e3).default(60),login_attempts_per_minute:Is().min(1).max(60).default(5),brute_force_lockout_duration:Is().min(1).max(1440).default(30)}),tl=ks({smtp_host:Es().min(1,"SMTP host is required"),smtp_port:Is().min(1).max(65535).default(587),from_address:Es().email("Invalid email address"),use_tls:Cs().default(!0),test_email:Es().email("Invalid email address").optional()}),al=ks({yookassa_shop_id:Es().min(1,"Shop ID is required"),yookassa_enabled:Cs().default(!0),payment_methods:Ds(Es()).default(["card"]),currency:zs(["RUB","USD","EUR"]).default("RUB")}),rl=ks({email_notifications_enabled:Cs().default(!0),sms_notifications_enabled:Cs().default(!1),push_notifications_enabled:Cs().default(!0),notify_on_assignment_submission:Cs().default(!0),notify_on_chat_message:Cs().default(!0),notify_on_grade_posted:Cs().default(!0),notify_on_schedule_change:Cs().default(!0)}),nl=ks({company_name:Es().min(1,"Company name is required"),logo_url:Es().url("Invalid URL").optional().or(Os("")),primary_color:Es().regex(/^#[0-9a-f]{6}$/i,"Invalid color format").default("#3b82f6"),theme:zs(["light","dark","auto"]).default("auto")}),il=ks({password_min_length:Is().min(8).max(20).default(12),require_uppercase:Cs().default(!0),require_numbers:Cs().default(!0),require_special_characters:Cs().default(!0),session_timeout_minutes:Is().min(5).max(1440).default(30),https_enforcement:Cs().default(!0),require_2fa_for_admins:Cs().default(!0)});function ll(){const[e,s]=t.useState(!0),[r,n]=t.useState(!1),[i,l]=t.useState({}),[o,c]=t.useState(null),[d,u]=t.useState(!1),m=Rs({resolver:As(el),defaultValues:{assignments_enabled:!0,payments_enabled:!0,notifications_enabled:!0,chat_enabled:!0,knowledge_graph_enabled:!0}}),h=Rs({resolver:As(sl),defaultValues:{api_requests_per_minute:60,login_attempts_per_minute:5,brute_force_lockout_duration:30}}),x=Rs({resolver:As(tl),defaultValues:{smtp_host:"",smtp_port:587,from_address:"",use_tls:!0,test_email:""}}),p=Rs({resolver:As(al),defaultValues:{yookassa_shop_id:"",yookassa_enabled:!0,payment_methods:["card"],currency:"RUB"}}),g=Rs({resolver:As(rl),defaultValues:{email_notifications_enabled:!0,sms_notifications_enabled:!1,push_notifications_enabled:!0,notify_on_assignment_submission:!0,notify_on_chat_message:!0,notify_on_grade_posted:!0,notify_on_schedule_change:!0}}),f=Rs({resolver:As(nl),defaultValues:{company_name:"THE_BOT",logo_url:"",primary_color:"#3b82f6",theme:"auto"}}),j=Rs({resolver:As(il),defaultValues:{password_min_length:12,require_uppercase:!0,require_numbers:!0,require_special_characters:!0,session_timeout_minutes:30,https_enforcement:!0,require_2fa_for_admins:!0}});t.useEffect(()=>{v()},[]);const v=async()=>{try{s(!0);const e=await Sa.request("/admin/config/");if(e.success&&e.data){const s=e.data;if(la.info("[SystemSettings] Settings loaded:",s),s.feature_flags&&m.reset(s.feature_flags),s.rate_limits&&h.reset(s.rate_limits),s.email_settings&&x.reset(s.email_settings),s.payment_settings&&p.reset(s.payment_settings),s.notifications&&g.reset(s.notifications),s.ui_settings){const e=s.ui_settings;f.reset(e),e.logo_url&&c(e.logo_url)}s.security_settings&&j.reset(s.security_settings),s.metadata&&l(s.metadata)}}catch(e){la.error("[SystemSettings] Failed to load settings:",e),_e.error("Failed to load settings")}finally{s(!1)}},y=async(e,s,t)=>{try{n(!0);(await Sa.request(`/admin/config/${e}/`,{method:"PUT",body:JSON.stringify(s)})).success?(u(!1),_e.success(`${t} settings saved successfully`),la.info(`[SystemSettings] ${t} saved:`,s)):_e.error(`Failed to save ${t} settings`)}catch(a){la.error(`[SystemSettings] Failed to save ${t}:`,a),_e.error(`Error saving ${t} settings`)}finally{n(!1)}};return e?a.jsx("div",{className:"flex items-center justify-center h-screen",children:a.jsx("div",{className:"text-lg text-muted-foreground",children:"Loading settings..."})}):a.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Oe,{className:"h-8 w-8"}),a.jsx("h1",{className:"text-3xl font-bold",children:"System Settings"})]}),a.jsx("p",{className:"text-muted-foreground",children:"Configure platform-wide settings and features"})]}),d&&a.jsxs(Rn,{className:"bg-yellow-50 border-yellow-200",children:[a.jsx(be,{className:"h-4 w-4 text-yellow-600"}),a.jsx(Pn,{className:"text-yellow-800",children:"You have unsaved changes. Please save before leaving this page."})]}),a.jsxs(Un,{defaultValue:"feature-flags",className:"w-full",children:[a.jsxs(Vn,{className:"grid w-full grid-cols-4 lg:grid-cols-7",children:[a.jsxs(Wn,{value:"feature-flags",className:"text-xs sm:text-sm",children:[a.jsx(Fs,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"Features"})]}),a.jsx(Wn,{value:"rate-limits",className:"text-xs sm:text-sm",children:"Rate Limits"}),a.jsxs(Wn,{value:"email",className:"text-xs sm:text-sm",children:[a.jsx(Ms,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"Email"})]}),a.jsxs(Wn,{value:"payment",className:"text-xs sm:text-sm",children:[a.jsx($s,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"Payment"})]}),a.jsxs(Wn,{value:"notifications",className:"text-xs sm:text-sm",children:[a.jsx(ze,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"Notify"})]}),a.jsxs(Wn,{value:"ui",className:"text-xs sm:text-sm",children:[a.jsx(Us,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"UI"})]}),a.jsxs(Wn,{value:"security",className:"text-xs sm:text-sm",children:[a.jsx(Vs,{className:"h-4 w-4 mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"Security"})]})]}),a.jsx(Hn,{value:"feature-flags",children:a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Feature Flags"}),a.jsx(Ua,{children:"Enable or disable platform features"})]}),a.jsx(Va,{children:a.jsx(Wi,{...m,children:a.jsxs("form",{onSubmit:m.handleSubmit(e=>{u(!0),y("feature-flags",e,"Feature Flags")}),className:"space-y-6",children:[a.jsx(Bi,{control:m.control,name:"assignments_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Assignments Enabled"}),a.jsx(Qi,{children:"Allow students to submit assignments"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:m.control,name:"payments_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Payments Enabled"}),a.jsx(Qi,{children:"Enable payment processing for subscriptions"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:m.control,name:"notifications_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Notifications Enabled"}),a.jsx(Qi,{children:"Send email and push notifications"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:m.control,name:"chat_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Chat Enabled"}),a.jsx(Qi,{children:"Enable real-time messaging between users"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:m.control,name:"knowledge_graph_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Knowledge Graph Enabled"}),a.jsx(Qi,{children:"Use knowledge graph for lesson planning"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx("div",{className:"flex gap-3 pt-4",children:a.jsxs(Ba,{type:"submit",disabled:r,className:"gap-2",children:[a.jsx(Ws,{className:"h-4 w-4"}),"Save Changes"]})})]})})})]})}),a.jsx(Hn,{value:"rate-limits",children:a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Rate Limits"}),a.jsx(Ua,{children:"Configure API and authentication rate limits"})]}),a.jsx(Va,{children:a.jsx(Wi,{...h,children:a.jsxs("form",{onSubmit:h.handleSubmit(e=>{u(!0),y("rate-limits",e,"Rate Limits")}),className:"space-y-6",children:[a.jsx(Bi,{control:h.control,name:"api_requests_per_minute",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"API Requests Per Minute"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"number",min:1,max:1e3,...e,onChange:s=>e.onChange(parseInt(s.target.value))})}),a.jsx(Qi,{children:"Maximum API requests allowed per minute (1-1000)"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:h.control,name:"login_attempts_per_minute",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Login Attempts Per Minute"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"number",min:1,max:60,...e,onChange:s=>e.onChange(parseInt(s.target.value))})}),a.jsx(Qi,{children:"Maximum login attempts allowed per minute (1-60)"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:h.control,name:"brute_force_lockout_duration",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Brute Force Lockout Duration (minutes)"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"number",min:1,max:1440,...e,onChange:s=>e.onChange(parseInt(s.target.value))})}),a.jsx(Qi,{children:"How long to lock account after failed attempts (1-1440 minutes)"}),a.jsx(Zi,{})]})}),a.jsx("div",{className:"flex gap-3 pt-4",children:a.jsxs(Ba,{type:"submit",disabled:r,className:"gap-2",children:[a.jsx(Ws,{className:"h-4 w-4"}),"Save Changes"]})})]})})})]})}),a.jsx(Hn,{value:"email",children:a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Email Settings"}),a.jsx(Ua,{children:"Configure SMTP for sending emails"})]}),a.jsx(Va,{children:a.jsx(Wi,{...x,children:a.jsxs("form",{onSubmit:x.handleSubmit(e=>{u(!0),y("email-settings",e,"Email Settings")}),className:"space-y-6",children:[a.jsx(Bi,{control:x.control,name:"smtp_host",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"SMTP Host"}),a.jsx(Yi,{children:a.jsx(Pr,{placeholder:"smtp.gmail.com",...e})}),a.jsx(Qi,{children:"SMTP server hostname"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:x.control,name:"smtp_port",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"SMTP Port"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"number",min:1,max:65535,...e,onChange:s=>e.onChange(parseInt(s.target.value))})}),a.jsx(Qi,{children:"SMTP server port (usually 587 or 465)"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:x.control,name:"from_address",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"From Address"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"email",placeholder:"noreply@example.com",...e})}),a.jsx(Qi,{children:"Email address emails will be sent from"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:x.control,name:"use_tls",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Use TLS"}),a.jsx(Qi,{children:"Use TLS encryption for SMTP connection"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsxs("div",{className:"space-y-3 border-t pt-6",children:[a.jsx("h3",{className:"font-medium",children:"Test Email Connection"}),a.jsx(Bi,{control:x.control,name:"test_email",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Test Email Address"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"email",placeholder:"test@example.com",...e})}),a.jsx(Qi,{children:"Send a test email to verify SMTP settings"})]})}),a.jsx(Ba,{type:"button",variant:"outline",onClick:async()=>{try{n(!0);const e=x.getValues("test_email");if(!e)return void _e.error("Please enter an email address");(await Sa.request("/admin/config/test-email/",{method:"POST",body:JSON.stringify({test_email:e})})).success?_e.success("Test email sent successfully"):_e.error("Failed to send test email")}catch(e){la.error("[SystemSettings] Email test failed:",e),_e.error("Error testing email connection")}finally{n(!1)}},disabled:r,children:"Send Test Email"})]}),a.jsx("div",{className:"flex gap-3 pt-4",children:a.jsxs(Ba,{type:"submit",disabled:r,className:"gap-2",children:[a.jsx(Ws,{className:"h-4 w-4"}),"Save Changes"]})})]})})})]})}),a.jsx(Hn,{value:"payment",children:a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Payment Settings"}),a.jsx(Ua,{children:"Configure YooKassa payment processing"})]}),a.jsx(Va,{children:a.jsx(Wi,{...p,children:a.jsxs("form",{onSubmit:p.handleSubmit(e=>{u(!0),y("payment-settings",e,"Payment Settings")}),className:"space-y-6",children:[a.jsx(Bi,{control:p.control,name:"yookassa_shop_id",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"YooKassa Shop ID"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"password",placeholder:"••••••••",autoComplete:"new-password",...e})}),a.jsx(Qi,{children:"Your YooKassa merchant shop ID"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:p.control,name:"yookassa_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"YooKassa Enabled"}),a.jsx(Qi,{children:"Enable YooKassa payment processing"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Supported Payment Methods"}),a.jsx("div",{className:"space-y-3 mt-3",children:["card","wallet","bank_transfer"].map(e=>a.jsxs("div",{className:"flex items-center",children:[a.jsx(In,{id:e,checked:p.getValues("payment_methods").includes(e),onCheckedChange:s=>{const t=p.getValues("payment_methods");s?p.setValue("payment_methods",[...t,e]):p.setValue("payment_methods",t.filter(s=>s!==e))}}),a.jsx(cn,{htmlFor:e,className:"ml-2 cursor-pointer",children:"card"===e?"Credit/Debit Card":"wallet"===e?"Digital Wallet":"Bank Transfer"})]},e))})]}),a.jsx(Bi,{control:p.control,name:"currency",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Currency"}),a.jsxs(Nn,{onValueChange:e.onChange,defaultValue:e.value,children:[a.jsx(Yi,{children:a.jsx(_n,{children:a.jsx(wn,{})})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"RUB",children:"Russian Ruble (RUB)"}),a.jsx(En,{value:"USD",children:"US Dollar (USD)"}),a.jsx(En,{value:"EUR",children:"Euro (EUR)"})]})]}),a.jsx(Qi,{children:"Primary currency for payment processing"}),a.jsx(Zi,{})]})}),a.jsx("div",{className:"flex gap-3 pt-4",children:a.jsxs(Ba,{type:"submit",disabled:r,className:"gap-2",children:[a.jsx(Ws,{className:"h-4 w-4"}),"Save Changes"]})})]})})})]})}),a.jsx(Hn,{value:"notifications",children:a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Notifications"}),a.jsx(Ua,{children:"Configure notification channels and preferences"})]}),a.jsx(Va,{children:a.jsx(Wi,{...g,children:a.jsxs("form",{onSubmit:g.handleSubmit(e=>{u(!0),y("notifications",e,"Notifications")}),className:"space-y-6",children:[a.jsxs("div",{className:"border-b pb-6",children:[a.jsx("h3",{className:"font-medium mb-4",children:"Notification Channels"}),a.jsx(Bi,{control:g.control,name:"email_notifications_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4 mb-3",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Email Notifications"}),a.jsx(Qi,{children:"Send notifications via email"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:g.control,name:"sms_notifications_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4 mb-3",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"SMS Notifications"}),a.jsx(Qi,{children:"Send notifications via SMS"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:g.control,name:"push_notifications_enabled",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Push Notifications"}),a.jsx(Qi,{children:"Send push notifications to apps"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium mb-4",children:"Event Notifications"}),a.jsx(Bi,{control:g.control,name:"notify_on_assignment_submission",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center gap-3 mb-3",children:[a.jsx(Yi,{children:a.jsx(In,{checked:e.value,onCheckedChange:e.onChange})}),a.jsx(cn,{className:"cursor-pointer",children:"Assignment Submissions"})]})}),a.jsx(Bi,{control:g.control,name:"notify_on_chat_message",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center gap-3 mb-3",children:[a.jsx(Yi,{children:a.jsx(In,{checked:e.value,onCheckedChange:e.onChange})}),a.jsx(cn,{className:"cursor-pointer",children:"New Chat Messages"})]})}),a.jsx(Bi,{control:g.control,name:"notify_on_grade_posted",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center gap-3 mb-3",children:[a.jsx(Yi,{children:a.jsx(In,{checked:e.value,onCheckedChange:e.onChange})}),a.jsx(cn,{className:"cursor-pointer",children:"Grade Posted"})]})}),a.jsx(Bi,{control:g.control,name:"notify_on_schedule_change",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center gap-3",children:[a.jsx(Yi,{children:a.jsx(In,{checked:e.value,onCheckedChange:e.onChange})}),a.jsx(cn,{className:"cursor-pointer",children:"Schedule Changes"})]})})]}),a.jsx("div",{className:"flex gap-3 pt-4",children:a.jsxs(Ba,{type:"submit",disabled:r,className:"gap-2",children:[a.jsx(Ws,{className:"h-4 w-4"}),"Save Changes"]})})]})})})]})}),a.jsx(Hn,{value:"ui",children:a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"UI Settings"}),a.jsx(Ua,{children:"Customize the appearance of the platform"})]}),a.jsx(Va,{children:a.jsx(Wi,{...f,children:a.jsxs("form",{onSubmit:f.handleSubmit(e=>{u(!0),y("ui-settings",e,"UI Settings")}),className:"space-y-6",children:[a.jsx(Bi,{control:f.control,name:"company_name",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Company Name"}),a.jsx(Yi,{children:a.jsx(Pr,{placeholder:"THE_BOT",...e})}),a.jsx(Qi,{children:"Display name for your platform"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:f.control,name:"logo_url",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Logo URL"}),a.jsx(Yi,{children:a.jsx(Pr,{placeholder:"https://example.com/logo.png",...e,onChange:s=>{e.onChange(s),s.target.value&&c(s.target.value)}})}),a.jsx(Qi,{children:"URL to your company logo"}),o&&a.jsx("div",{className:"mt-2 p-2 bg-muted rounded",children:a.jsx("img",{src:o,alt:"Logo preview",className:"h-12 object-contain"})}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:f.control,name:"primary_color",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Primary Color"}),a.jsxs("div",{className:"flex gap-3 items-center",children:[a.jsx(Yi,{children:a.jsx(Pr,{type:"color",...e,className:"h-10 w-20"})}),a.jsx(Pr,{type:"text",value:e.value,onChange:e.onChange,placeholder:"#3b82f6",className:"flex-1"})]}),a.jsx(Qi,{children:"Primary brand color (hex format)"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:f.control,name:"theme",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Theme"}),a.jsxs(Nn,{onValueChange:e.onChange,defaultValue:e.value,children:[a.jsx(Yi,{children:a.jsx(_n,{children:a.jsx(wn,{})})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"light",children:"Light"}),a.jsx(En,{value:"dark",children:"Dark"}),a.jsx(En,{value:"auto",children:"Auto (Follow System)"})]})]}),a.jsx(Qi,{children:"Default theme for the platform"}),a.jsx(Zi,{})]})}),a.jsx("div",{className:"flex gap-3 pt-4",children:a.jsxs(Ba,{type:"submit",disabled:r,className:"gap-2",children:[a.jsx(Ws,{className:"h-4 w-4"}),"Save Changes"]})})]})})})]})}),a.jsx(Hn,{value:"security",children:a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx($a,{children:"Security Settings"}),a.jsx(Ua,{children:"Configure security policies and requirements"})]}),a.jsx(Va,{children:a.jsx(Wi,{...j,children:a.jsxs("form",{onSubmit:j.handleSubmit(e=>{u(!0),y("security-settings",e,"Security Settings")}),className:"space-y-6",children:[a.jsxs("div",{className:"border-b pb-6",children:[a.jsx("h3",{className:"font-medium mb-4",children:"Password Policy"}),a.jsx(Bi,{control:j.control,name:"password_min_length",render:({field:e})=>a.jsxs(Ki,{className:"mb-4",children:[a.jsx(Gi,{children:"Minimum Password Length"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"number",min:8,max:20,...e,onChange:s=>e.onChange(parseInt(s.target.value))})}),a.jsx(Qi,{children:"Minimum number of characters required (8-20)"}),a.jsx(Zi,{})]})}),a.jsx(Bi,{control:j.control,name:"require_uppercase",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4 mb-3",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Require Uppercase"}),a.jsx(Qi,{children:"Require at least one uppercase letter"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:j.control,name:"require_numbers",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4 mb-3",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Require Numbers"}),a.jsx(Qi,{children:"Require at least one number"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:j.control,name:"require_special_characters",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Require Special Characters"}),a.jsx(Qi,{children:"Require at least one special character (!@#$%^&*)"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})})]}),a.jsxs("div",{className:"border-b pb-6",children:[a.jsx("h3",{className:"font-medium mb-4",children:"Session Management"}),a.jsx(Bi,{control:j.control,name:"session_timeout_minutes",render:({field:e})=>a.jsxs(Ki,{children:[a.jsx(Gi,{children:"Session Timeout (minutes)"}),a.jsx(Yi,{children:a.jsx(Pr,{type:"number",min:5,max:1440,...e,onChange:s=>e.onChange(parseInt(s.target.value))})}),a.jsx(Qi,{children:"How long before inactive sessions expire (5-1440 minutes)"}),a.jsx(Zi,{})]})})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium mb-4",children:"Additional Security"}),a.jsx(Bi,{control:j.control,name:"https_enforcement",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4 mb-3",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"HTTPS Enforcement"}),a.jsx(Qi,{children:"Enforce HTTPS for all connections"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})}),a.jsx(Bi,{control:j.control,name:"require_2fa_for_admins",render:({field:e})=>a.jsxs(Ki,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[a.jsxs("div",{className:"space-y-0.5",children:[a.jsx(Gi,{children:"Require 2FA for Admins"}),a.jsx(Qi,{children:"Require two-factor authentication for admin users"})]}),a.jsx(Yi,{children:a.jsx(bn,{checked:e.value,onCheckedChange:e.onChange})})]})})]}),a.jsx("div",{className:"flex gap-3 pt-4",children:a.jsxs(Ba,{type:"submit",disabled:r,className:"gap-2",children:[a.jsx(Ws,{className:"h-4 w-4"}),"Save Changes"]})})]})})})]})})]}),a.jsx("div",{className:"flex justify-center pt-6",children:a.jsxs(Ba,{variant:"outline",onClick:async()=>{if(window.confirm("Are you sure you want to reset all settings to defaults? This cannot be undone."))try{n(!0);(await Sa.request("/admin/config/reset/",{method:"POST"})).success?(_e.success("Settings reset to defaults"),await v()):_e.error("Failed to reset settings")}catch(e){la.error("[SystemSettings] Failed to reset settings:",e),_e.error("Error resetting settings")}finally{n(!1)}},disabled:r,className:"gap-2",children:[a.jsx(ss,{className:"h-4 w-4"}),"Reset All Settings to Defaults"]})})]})}const ol=()=>a.jsxs("div",{className:"min-h-screen",children:[a.jsx("header",{className:"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-50",children:a.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-10 h-10 gradient-primary rounded-lg flex items-center justify-center",children:a.jsx(Xe,{className:"w-6 h-6 text-primary-foreground"})}),a.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"THE BOT"})]}),a.jsxs("nav",{className:"hidden md:flex items-center gap-6",children:[a.jsx("a",{href:"#features",className:"text-foreground/80 hover:text-foreground transition-colors",children:"Возможности"}),a.jsx("a",{href:"#roles",className:"text-foreground/80 hover:text-foreground transition-colors",children:"Для кого"}),a.jsx("a",{href:"#apply",className:"text-foreground/80 hover:text-foreground transition-colors",children:"Подать заявку"}),a.jsx(gt,{to:"/auth",children:a.jsx(Ba,{type:"button",variant:"outline",size:"sm",children:"Войти"})})]})]})}),a.jsx("section",{className:"container mx-auto px-4 py-20 md:py-32",children:a.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-8 animate-slide-up",children:[a.jsx("h1",{className:"bg-gradient-to-r from-primary via-primary-glow to-accent bg-clip-text text-transparent",children:"Образовательная платформа нового поколения"}),a.jsx("p",{className:"text-xl md:text-2xl text-muted-foreground max-w-2xl mx-auto",children:"Персонализированное обучение с трекингом прогресса, прямой связью с преподавателями и тьюторами"}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[a.jsx(gt,{to:"/application",children:a.jsx(Ba,{type:"button",size:"lg",className:"gradient-primary shadow-glow hover:opacity-90 transition-opacity",children:"Подать заявку"})}),a.jsx(gt,{to:"/auth",children:a.jsx(Ba,{type:"button",size:"lg",variant:"outline",children:"Личный кабинет"})})]})]})}),a.jsx("section",{id:"features",className:"py-20 bg-muted/30",children:a.jsxs("div",{className:"container mx-auto px-4",children:[a.jsx("h2",{className:"text-center mb-12",children:"Возможности платформы"}),a.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:cl.map((e,s)=>a.jsxs(Fa,{className:"p-6 hover:shadow-lg transition-shadow",children:[a.jsx("div",{className:"w-12 h-12 gradient-primary rounded-lg flex items-center justify-center mb-4",children:a.jsx(e.icon,{className:"w-6 h-6 text-primary-foreground"})}),a.jsx("h3",{className:"text-xl mb-2",children:e.title}),a.jsx("p",{className:"text-muted-foreground",children:e.description})]},s))})]})}),a.jsx("section",{id:"roles",className:"py-20",children:a.jsxs("div",{className:"container mx-auto px-4",children:[a.jsx("h2",{className:"text-center mb-12",children:"Для всех участников образовательного процесса"}),a.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:dl.map((e,s)=>a.jsx(Fa,{className:"p-8 hover:border-primary transition-colors",children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"w-14 h-14 gradient-secondary rounded-xl flex items-center justify-center flex-shrink-0",children:a.jsx(e.icon,{className:"w-7 h-7 text-secondary-foreground"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-2xl mb-3",children:e.title}),a.jsx("ul",{className:"space-y-2 text-muted-foreground",children:e.features.map((e,s)=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-primary mt-1",children:"•"}),a.jsx("span",{children:e})]},s))})]})]})},s))})]})}),a.jsx("section",{id:"apply",className:"py-20 bg-muted/30",children:a.jsx("div",{className:"container mx-auto px-4",children:a.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[a.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Подать заявку на обучение"}),a.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:"Заполните форму заявки, и наши специалисты свяжутся с вами в ближайшее время. После одобрения заявки вы получите данные для входа в систему через Telegram."}),a.jsx(gt,{to:"/application",children:a.jsx(Ba,{type:"button",size:"lg",className:"gradient-primary shadow-glow",children:"Подать заявку"})})]})})}),a.jsx("footer",{className:"border-t py-8 bg-card/50",children:a.jsx("div",{className:"container mx-auto px-4",children:a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 gradient-primary rounded-lg flex items-center justify-center",children:a.jsx(Xe,{className:"w-5 h-5 text-primary-foreground"})}),a.jsx("span",{className:"font-bold",children:"THE BOT"})]}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"© 2024 THE BOT. Все права защищены."})]})})})]}),cl=[{icon:Hs,title:"Трекинг прогресса",description:"Визуализация достижений и движения к образовательной цели в реальном времени"},{icon:qe,title:"Прямая связь",description:"Общение с преподавателями и тьюторами напрямую через платформу"},{icon:ws,title:"Персональные отчёты",description:"Подробная аналитика по каждому ученику для родителей и тьюторов"},{icon:Xe,title:"Материалы и задания",description:"Удобная система публикации и проверки домашних заданий"},{icon:Pe,title:"Многоролевая система",description:"Отдельные кабинеты для учеников, родителей, преподавателей и тьюторов"},{icon:Vs,title:"Безопасность данных",description:"Надёжная защита личной информации и образовательных материалов"}],dl=[{icon:Pe,title:"Ученики",features:["Доступ к образовательным материалам","Трекер прогресса с геймификацией","Возможность задавать вопросы преподавателям","Уведомления о проверке домашних заданий"]},{icon:Pe,title:"Родители",features:["Отчёты о прогрессе детей","Связь с тьютором","Доступ к образовательным целям","Уведомления о важных событиях"]},{icon:Pe,title:"Преподаватели",features:["Создание и публикация материалов","Проверка домашних заданий","Формирование отчётов по предмету","Ответы на вопросы учеников"]},{icon:Pe,title:"Тьюторы",features:["Управление группой учеников","Создание финальных отчётов","Координация с преподавателями","Консультации родителей"]}],ul=()=>a.jsx(ol,{}),ml=e=>{if(!e)return{isValid:!1,message:"Email is required"};const s=e.trim().toLowerCase();if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))return{isValid:!1,message:"Invalid email format"};const[t,a]=s.split("@");return t.length>64?{isValid:!1,message:"Email local part is too long (max 64 characters)"}:a.length>255?{isValid:!1,message:"Email domain is too long (max 255 characters)"}:s.includes("..")?{isValid:!1,message:"Email cannot contain consecutive dots"}:t.startsWith(".")||t.endsWith(".")?{isValid:!1,message:"Email local part cannot start or end with a dot"}:{isValid:!0}},hl={MIN_LENGTH:12,MAX_LENGTH:128,SPECIAL_CHARS:"!@#$%^&*()_+-=[]{}|;:,.<>?"},xl=e=>{if(!e)return{isValid:!1,message:"Phone number is required"};const s=e.replace(/[^\d+]/g,"");return/^\+?[1-9][\d]{4,15}$/.test(s)?{isValid:!0}:{isValid:!1,message:"Phone number must be in international format (e.g., +79991234567 or +7 (999) 123-45-67)"}},pl=t.memo(()=>{const e=xt(),{login:s,isLoading:r}=qa(),[n,i]=t.useState({emailOrUsername:"",password:""}),[l,o]=t.useState("email");return a.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-background via-muted/20 to-background auth-page",children:[a.jsx("header",{className:"bg-card/50 backdrop-blur-sm auth-header",children:a.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[a.jsxs(gt,{to:"/",className:"flex items-center gap-2 w-fit",children:[a.jsx("div",{className:"w-10 h-10 gradient-primary rounded-lg flex items-center justify-center",children:a.jsx(Xe,{className:"w-6 h-6 text-primary-foreground"})}),a.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"THE BOT"})]}),a.jsxs(Ba,{type:"button",variant:"ghost",onClick:()=>e("/"),className:"gap-2",children:[a.jsx(Bs,{className:"w-4 h-4"}),"На главную"]})]})}),a.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:a.jsxs(Fa,{className:"w-full max-w-md p-8 shadow-lg",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Добро пожаловать!"}),a.jsx("p",{className:"text-muted-foreground",children:"Войдите в свой аккаунт"})]}),a.jsxs("form",{onSubmit:async t=>{var a;t.preventDefault();const r=n.emailOrUsername.trim();if(!r)return void _e.error("Введите email или имя пользователя");if(!r.includes("@")||ml(r))try{0;const t=r.includes("@")?{email:r,password:n.password}:{username:r,password:n.password},a=await s(t);if(_e.success("Вход выполнен успешно!"),a.user.is_staff)return await new Promise(e=>setTimeout(e,50)),void e("/admin/staff");const i=a.user.role;switch(await new Promise(e=>setTimeout(e,50)),i){case"student":default:e("/dashboard/student");break;case"teacher":e("/dashboard/teacher");break;case"tutor":e("/dashboard/tutor");break;case"parent":e("/dashboard/parent")}}catch(i){la.error("Login error:",i);const e=(null==(a=null==i?void 0:i.message)?void 0:a.toString())||"",s=e.toLowerCase(),t=null==i?void 0:i.statusCode;429===t||e.includes("Слишком много попыток")?_e.error("Слишком много попыток входа. Подождите 5 минут"):408===t||e.includes("Истекло время ожидания")||s.includes("timeout")?_e.error("Время ожидания истекло. Проверьте соединение и повторите"):s.includes("неверн")||s.includes("invalid")||s.includes("credential")||s.includes("auth")?_e.error("Неверный логин или пароль"):s.includes("сеть")||s.includes("network")?_e.error("Ошибка сети. Проверьте интернет-соединение"):_e.error(e||"Произошла ошибка при входе")}else _e.error("Пожалуйста, введите корректный email адрес")},className:"space-y-4",children:[a.jsxs("div",{className:"flex gap-2 mb-4",children:[a.jsx(Ba,{type:"button",variant:"email"===l?"default":"outline",onClick:()=>o("email"),className:"flex-1",children:"Email"}),a.jsx(Ba,{type:"button",variant:"username"===l?"default":"outline",onClick:()=>o("username"),className:"flex-1",children:"Логин"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"login-identifier",children:"email"===l?"Email":"Имя пользователя"}),a.jsx(Pr,{id:"login-identifier",type:"email"===l?"email":"text",value:n.emailOrUsername,onChange:e=>i({...n,emailOrUsername:e.target.value}),placeholder:"email"===l?"Email":"Username",required:!0,"data-testid":"login-email-input",autoComplete:"email"===l?"email":"username"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"login-password",children:"Пароль"}),a.jsx(Pr,{id:"login-password",type:"password",autoComplete:"current-password",value:n.password,onChange:e=>i({...n,password:e.target.value}),placeholder:"Password",required:!0,"data-testid":"login-password-input"})]}),a.jsx(Ba,{type:"submit",className:"w-full gradient-primary shadow-glow",disabled:r,"data-testid":"login-submit-button",children:r?"Вход...":"Войти"})]})]})})]})});pl.displayName="Auth";const gl=({type:e,value:s,show:r=!0})=>{const[n,i]=t.useState(""),[l,o]=t.useState(!0);return t.useEffect(()=>{if(!s||!r)return i(""),void o(!0);let t={isValid:!0};switch(e){case"email":const e=ml(s);t={isValid:e,message:e?"":"Некорректный email адрес"};break;case"password":t=(e=>{const s=[];let t,a=0;return e?(e.length<hl.MIN_LENGTH?s.push(`Minimum ${hl.MIN_LENGTH} characters`):a+=20,e.length>hl.MAX_LENGTH?{isValid:!1,message:`Password is too long (max ${hl.MAX_LENGTH} characters)`,strength:"weak",score:0}:(/[A-Z]/.test(e)?a+=20:s.push("Uppercase letter (A-Z)"),/[a-z]/.test(e)?a+=20:s.push("Lowercase letter (a-z)"),/\d/.test(e)?a+=20:s.push("Number (0-9)"),new RegExp(`[${hl.SPECIAL_CHARS.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}]`).test(e)?a+=20:s.push("Special character (!@#$%^&*...)"),0===s.length?(t="very_strong",e.length>=16&&(a+=10),e.length>=20&&(a+=10)):t=1===s.length?"strong":2===s.length?"good":3===s.length?"fair":"weak",0===s.length?{isValid:!0,strength:t,score:Math.min(a,100),missingRequirements:[]}:{isValid:!1,message:`Password must contain: ${s.join(", ")}`,strength:t,score:Math.min(a,100),missingRequirements:s})):{isValid:!1,message:"Password is required",missingRequirements:["Password length (12+ characters)","Uppercase letter (A-Z)","Lowercase letter (a-z)","Number (0-9)","Special character (!@#$%^&*...)"]}})(s);break;case"name":t=(a=s)?a.length<2?{isValid:!1,message:"Name must be at least 2 characters"}:a.length>50?{isValid:!1,message:"Name cannot exceed 50 characters"}:/^[а-яА-ЯёЁa-zA-Z\s\-]+$/.test(a)?{isValid:!0}:{isValid:!1,message:"Name can only contain letters, spaces, and hyphens"}:{isValid:!1,message:"Name is required"};break;case"phone":t=xl(s)}var a;o(t.isValid),i(t.isValid?"":t.message||"")},[e,s,r]),n?a.jsx("div",{className:"text-sm mt-1 "+(l?"text-green-600":"text-red-600"),children:n}):null},fl=()=>{const e=xt(),[s,r]=t.useState(!1),[n,i]=t.useState(1),[l,o]=t.useState({first_name:"",last_name:"",email:"",phone:"",telegram_id:"",applicant_type:"",grade:"",subject:"",experience:"",motivation:"",parent_first_name:"",parent_last_name:"",parent_email:"",parent_phone:"",parent_telegram_id:""}),c=(e,s)=>{o(t=>({...t,[e]:s}))},d=()=>{if("student"===l.applicant_type){if(!l.parent_first_name.trim())return _e.error("Пожалуйста, введите имя родителя"),!1;if(!l.parent_last_name.trim())return _e.error("Пожалуйста, введите фамилию родителя"),!1;if(!ml(l.parent_email))return _e.error("Пожалуйста, введите корректный email родителя"),!1;const e=xl(l.parent_phone);if(!e.isValid)return _e.error(e.message),!1}return!0};return a.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-background via-muted/20 to-background",children:[a.jsx("header",{className:"border-b bg-card/50 backdrop-blur-sm sticky top-0 z-40",children:a.jsx("div",{className:"container mx-auto px-4 py-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs(gt,{to:"/",className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[a.jsx("div",{className:"w-10 h-10 gradient-primary rounded-lg flex items-center justify-center",children:a.jsx(Xe,{className:"w-6 h-6 text-primary-foreground"})}),a.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"THE BOT"})]}),a.jsxs(gt,{to:"/",className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors md:flex hidden",children:[a.jsx(Bs,{className:"w-4 h-4"}),a.jsx("span",{children:"На главную"})]})]})})}),a.jsx("nav",{className:"border-b bg-card/20 backdrop-blur-sm",children:a.jsx("div",{className:"container mx-auto px-4 py-3",children:a.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(gt,{to:"/",className:"text-muted-foreground hover:text-foreground transition-colors",children:"Главная"}),a.jsx(as,{className:"w-4 h-4 text-muted-foreground"}),a.jsx("span",{className:"text-foreground font-medium",children:"Подача заявки"})]})})}),a.jsx("div",{className:"border-b bg-card/30",children:a.jsx("div",{className:"container mx-auto px-4 py-4",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:"text-sm font-medium",children:["Шаг ",n," из ",3]})}),a.jsx("div",{className:"flex-1 max-w-sm",children:a.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:a.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:n/3*100+"%"}})})}),a.jsxs("div",{className:"text-sm text-muted-foreground text-right",children:[Math.round(n/3*100),"%"]})]})})}),a.jsx("div",{className:"flex-1 flex items-center justify-center px-4 py-8 md:py-12",children:a.jsx("div",{className:"w-full max-w-2xl",children:a.jsxs(Fa,{className:"p-6 md:p-8 shadow-lg",children:[1===n&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Личная информация"}),a.jsx("p",{className:"text-muted-foreground",children:"Укажите ваши основные данные"})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"first_name",children:"Имя *"}),a.jsx(Pr,{id:"first_name",value:l.first_name,onChange:e=>c("first_name",e.target.value),placeholder:"Иван",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"last_name",children:"Фамилия *"}),a.jsx(Pr,{id:"last_name",value:l.last_name,onChange:e=>c("last_name",e.target.value),placeholder:"Иванов",required:!0})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"email",children:"Email *"}),a.jsx(Pr,{id:"email",type:"email",value:l.email,onChange:e=>c("email",e.target.value),placeholder:"ivan@example.com",required:!0}),a.jsx(gl,{type:"email",value:l.email})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"phone",children:"Телефон *"}),a.jsx(Pr,{id:"phone",type:"tel",value:l.phone,onChange:e=>c("phone",e.target.value),placeholder:"+79991234567",required:!0}),a.jsx(gl,{type:"phone",value:l.phone})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"telegram_id",children:"Telegram ID (необязательно)"}),a.jsx(Pr,{id:"telegram_id",value:l.telegram_id,onChange:e=>c("telegram_id",e.target.value),placeholder:"@username или 123456789"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"applicant_type",children:"Тип заявки *"}),a.jsxs(Nn,{value:l.applicant_type,onValueChange:e=>c("applicant_type",e),children:[a.jsx(_n,{children:a.jsx(wn,{placeholder:"Выберите тип заявки"})}),a.jsxs(Cn,{children:[a.jsx(En,{value:"student",children:"Студент"}),a.jsx(En,{value:"teacher",children:"Преподаватель"}),a.jsx(En,{value:"parent",children:"Родитель"})]})]})]})]}),2===n&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Дополнительная информация"}),a.jsx("p",{className:"text-muted-foreground",children:"student"===l.applicant_type?"Укажите информацию о вашем обучении":"teacher"===l.applicant_type?"Укажите информацию о вашем преподавании":"Укажите дополнительную информацию"})]}),"student"===l.applicant_type&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"grade",children:"Класс *"}),a.jsx(Pr,{id:"grade",value:l.grade,onChange:e=>c("grade",e.target.value),placeholder:"10",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"motivation",children:"Цель обучения *"}),a.jsx(yn,{id:"motivation",value:l.motivation,onChange:e=>c("motivation",e.target.value),placeholder:"Хочу изучать программирование...",required:!0})]})]}),"teacher"===l.applicant_type&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"subject",children:"Предмет *"}),a.jsx(Pr,{id:"subject",value:l.subject,onChange:e=>c("subject",e.target.value),placeholder:"Математика",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"experience",children:"Опыт работы *"}),a.jsx(yn,{id:"experience",value:l.experience,onChange:e=>c("experience",e.target.value),placeholder:"5 лет преподавания математики в школе...",required:!0})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"motivation",children:"Дополнительная информация"}),a.jsx(yn,{id:"motivation",value:l.motivation,onChange:e=>c("motivation",e.target.value),placeholder:"Любая дополнительная информация..."})]})]}),3===n&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Информация о родителях"}),a.jsx("p",{className:"text-muted-foreground",children:"student"===l.applicant_type?"Укажите данные родителей для связи":"Эта информация не требуется для вашего типа заявки"})]}),"student"===l.applicant_type&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"parent_first_name",children:"Имя родителя *"}),a.jsx(Pr,{id:"parent_first_name",value:l.parent_first_name,onChange:e=>c("parent_first_name",e.target.value),placeholder:"Анна",required:!0})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"parent_last_name",children:"Фамилия родителя *"}),a.jsx(Pr,{id:"parent_last_name",value:l.parent_last_name,onChange:e=>c("parent_last_name",e.target.value),placeholder:"Иванова",required:!0})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"parent_email",children:"Email родителя *"}),a.jsx(Pr,{id:"parent_email",type:"email",value:l.parent_email,onChange:e=>c("parent_email",e.target.value),placeholder:"anna@example.com",required:!0}),a.jsx(gl,{type:"email",value:l.parent_email})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"parent_phone",children:"Телефон родителя *"}),a.jsx(Pr,{id:"parent_phone",type:"tel",value:l.parent_phone,onChange:e=>c("parent_phone",e.target.value),placeholder:"+79991234568",required:!0}),a.jsx(gl,{type:"phone",value:l.parent_phone})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(cn,{htmlFor:"parent_telegram_id",children:"Telegram ID родителя (необязательно)"}),a.jsx(Pr,{id:"parent_telegram_id",value:l.parent_telegram_id,onChange:e=>c("parent_telegram_id",e.target.value),placeholder:"@parent_username или 123456789"})]})]})]}),a.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-between gap-4 mt-8",children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>{n>1&&i(n-1)},disabled:1===n,className:"w-full sm:w-auto",children:"Назад"}),n<3?a.jsx(Ba,{type:"button",onClick:()=>{(1!==n||(()=>{if(!l.first_name.trim())return _e.error("Пожалуйста, введите имя"),!1;if(!l.last_name.trim())return _e.error("Пожалуйста, введите фамилию"),!1;if(!ml(l.email))return _e.error("Пожалуйста, введите корректный email"),!1;const e=xl(l.phone);return e.isValid?!!l.applicant_type||(_e.error("Пожалуйста, выберите тип заявки"),!1):(_e.error(e.message),!1)})())&&(2!==n||(()=>{if("student"===l.applicant_type){if(!l.grade.trim())return _e.error("Пожалуйста, укажите класс"),!1;if(!l.motivation.trim())return _e.error("Пожалуйста, укажите цель обучения"),!1}else if("teacher"===l.applicant_type){if(!l.subject.trim())return _e.error("Пожалуйста, укажите предмет"),!1;if(!l.experience.trim())return _e.error("Пожалуйста, укажите опыт работы"),!1}return!0})())&&(3!==n||d())&&n<3&&i(n+1)},className:"w-full sm:w-auto",children:"Далее"}):a.jsx(Ba,{type:"button",onClick:async()=>{if(d()){r(!0);try{const s=await Sa.createApplication(l);if(s.success&&s.data){_e.success("Заявка успешно подана!");const t=s.data.tracking_token;t?e(`/application-status/${t}`):_e.error("Ошибка: не получен tracking token")}else _e.error(s.error||"Ошибка при подаче заявки")}catch(s){la.error("Application error:",s);const e=(null==s?void 0:s.message)||(null==s?void 0:s.error)||"Произошла ошибка при подаче заявки";_e.error(e)}finally{r(!1)}}},disabled:s,className:"w-full sm:w-auto gradient-primary shadow-glow",children:s?"Отправка...":"Подать заявку"})]})]})})})]})},jl=()=>{const{trackingToken:e}=ft(),[s,r]=t.useState(null),[n,i]=t.useState(!0),[l,o]=t.useState(!1),c=async()=>{if(e)try{const s=`/api/applications/status/${e}/`,t=await fetch(s),a=await oa(t);a.success?r(a.data):404===t.status?_e.error("Заявка не найдена"):_e.error(a.error||"Ошибка при получении статуса заявки")}catch(s){_e.error("Произошла ошибка при загрузке статуса заявки"),la.error("Status fetch error:",s)}finally{i(!1),o(!1)}};t.useEffect(()=>{c()},[e]);return n?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-muted/20 to-background",children:a.jsxs("div",{className:"text-center",children:[a.jsx(we,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),a.jsx("p",{className:"text-muted-foreground",children:"Загрузка статуса заявки..."})]})}):s?a.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-background via-muted/20 to-background",children:[a.jsx("header",{className:"border-b bg-card/50 backdrop-blur-sm",children:a.jsx("div",{className:"container mx-auto px-4 py-4",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs(gt,{to:"/",className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-10 h-10 gradient-primary rounded-lg flex items-center justify-center",children:a.jsx(Xe,{className:"w-6 h-6 text-primary-foreground"})}),a.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"THE BOT"})]}),a.jsxs(gt,{to:"/",className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors",children:[a.jsx(Bs,{className:"w-4 h-4"}),a.jsx("span",{children:"На главную"})]})]})})}),a.jsx("div",{className:"flex-1 flex items-center justify-center p-4",children:a.jsxs(Fa,{className:"w-full max-w-2xl p-8 shadow-lg",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"flex justify-center mb-4",children:(e=>{switch(e){case"approved":return a.jsx(We,{className:"w-6 h-6 text-green-500"});case"rejected":return a.jsx(js,{className:"w-6 h-6 text-red-500"});default:return a.jsx(cs,{className:"w-6 h-6 text-yellow-500"})}})(s.status)}),a.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Статус заявки"}),a.jsx(Ya,{variant:(e=>{switch(e){case"approved":return"default";case"rejected":return"destructive";default:return"secondary"}})(s.status),className:"text-lg px-4 py-2",children:(e=>{switch(e){case"approved":return"Одобрена";case"rejected":return"Отклонена";default:return"На рассмотрении"}})(s.status)})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-muted/50 rounded-lg p-6",children:[a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Информация о заявителе"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Имя"}),a.jsxs("p",{className:"font-medium",children:[s.first_name," ",s.last_name]})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),a.jsx("p",{className:"font-medium",children:s.email})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Тип заявки"}),a.jsx("p",{className:"font-medium",children:(e=>{switch(e){case"student":return"Студент";case"teacher":return"Преподаватель";case"parent":return"Родитель";default:return e}})(s.applicant_type)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Дата подачи"}),a.jsx("p",{className:"font-medium",children:new Date(s.created_at).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})]}),"approved"===s.status&&a.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(We,{className:"w-5 h-5 text-green-600"}),a.jsx("h3",{className:"text-lg font-semibold text-green-800",children:"Заявка одобрена!"})]}),a.jsx("p",{className:"text-green-700",children:"Ваша заявка была одобрена. Данные для входа в систему отправлены на ваш Telegram. Если у вас есть вопросы, обратитесь к администратору."}),a.jsx("div",{className:"mt-4",children:a.jsx(gt,{to:"/auth",children:a.jsx(Ba,{type:"button",className:"bg-green-600 hover:bg-green-700",children:"Войти в систему"})})})]}),"rejected"===s.status&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(js,{className:"w-5 h-5 text-red-600"}),a.jsx("h3",{className:"text-lg font-semibold text-red-800",children:"Заявка отклонена"})]}),s.rejection_reason&&a.jsxs("p",{className:"text-red-700 mb-4",children:[a.jsx("strong",{children:"Причина отклонения:"})," ",s.rejection_reason]}),a.jsx("p",{className:"text-red-700",children:"К сожалению, ваша заявка была отклонена. Вы можете подать новую заявку, исправив указанные недостатки."}),a.jsx("div",{className:"mt-4",children:a.jsx(gt,{to:"/application",children:a.jsx(Ba,{type:"button",variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-50",children:"Подать новую заявку"})})})]}),"pending"===s.status&&a.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(cs,{className:"w-5 h-5 text-yellow-600"}),a.jsx("h3",{className:"text-lg font-semibold text-yellow-800",children:"Заявка на рассмотрении"})]}),a.jsx("p",{className:"text-yellow-700",children:"Ваша заявка находится на рассмотрении. Мы уведомим вас о результате через Telegram. Обычно рассмотрение занимает 1-3 рабочих дня."}),a.jsxs("div",{className:"mt-4 flex gap-2",children:[a.jsx(Ba,{type:"button",variant:"outline",onClick:()=>{o(!0),c()},disabled:l,className:"border-yellow-300 text-yellow-700 hover:bg-yellow-50",children:l?a.jsxs(a.Fragment,{children:[a.jsx(we,{className:"w-4 h-4 mr-2 animate-spin"}),"Обновление..."]}):a.jsxs(a.Fragment,{children:[a.jsx(we,{className:"w-4 h-4 mr-2"}),"Обновить статус"]})}),a.jsx(gt,{to:"/application",children:a.jsx(Ba,{type:"button",variant:"outline",children:"Подать новую заявку"})})]})]}),a.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[a.jsxs("p",{children:["Номер отслеживания: ",a.jsx("code",{className:"bg-muted px-2 py-1 rounded",children:s.tracking_token})]}),a.jsxs("p",{className:"mt-1",children:["Последнее обновление: ",new Date(s.updated_at).toLocaleString("ru-RU")]})]})]})]})})]}):a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-background via-muted/20 to-background",children:a.jsxs(Fa,{className:"w-full max-w-md p-8 text-center",children:[a.jsx(js,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),a.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Заявка не найдена"}),a.jsx("p",{className:"text-muted-foreground mb-6",children:"Заявка с указанным номером не найдена или была удалена."}),a.jsx(gt,{to:"/application",children:a.jsx(Ba,{type:"button",children:"Подать новую заявку"})})]})})},vl=()=>{const e=jt(),s=xt(),{user:r}=qa();t.useEffect(()=>{la.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]);return a.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gradient-to-br from-background via-muted/20 to-background p-4",children:a.jsx(Fa,{className:"max-w-md w-full p-8 shadow-lg",children:a.jsxs("div",{className:"text-center space-y-6",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-destructive/10 text-destructive",children:a.jsx("span",{className:"text-4xl font-bold",children:"404"})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h1",{className:"text-3xl font-bold",children:"Упс! Страница не найдена"}),a.jsx("p",{className:"text-muted-foreground",children:"Похоже, страница, которую вы ищете, не существует или была перемещена"})]}),a.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[a.jsxs(Ba,{type:"button",onClick:()=>{window.history.length>1?s(-1):s("/")},variant:"outline",className:"w-full gap-2",children:[a.jsx(Bs,{className:"w-4 h-4"}),"Вернуться назад"]}),a.jsxs(Ba,{type:"button",onClick:()=>s("/"),variant:"default",className:"w-full gap-2",children:[a.jsx(Ne,{className:"w-4 h-4"}),"На главную"]}),r&&a.jsxs(Ba,{type:"button",onClick:()=>s((null==r?void 0:r.role)?`/dashboard/${r.role}`:"/"),className:"w-full gap-2 gradient-primary shadow-glow",children:[a.jsx(Xs,{className:"w-4 h-4"}),"В мой кабинет"]})]}),a.jsxs("p",{className:"text-sm text-muted-foreground pt-4",children:["Путь: ",a.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:e.pathname})]})]})})})},yl=()=>{const e=xt();return a.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-red-50 to-orange-50",children:a.jsxs("div",{className:"text-center max-w-md px-6",children:[a.jsx("div",{className:"mb-8 flex justify-center",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-0 bg-red-500 rounded-full opacity-20 animate-pulse"}),a.jsx(Js,{className:"w-24 h-24 text-red-600 relative z-10"})]})}),a.jsx("h1",{className:"text-5xl font-bold text-gray-900 mb-4",children:"403"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Доступ запрещён"}),a.jsx("p",{className:"text-gray-600 mb-8",children:"У вас нет прав для доступа к этой странице. Пожалуйста, войдите с правильной ролью или вернитесь на главную страницу."}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[a.jsx(Ba,{type:"button",onClick:()=>{e(-1)},variant:"outline",className:"w-full sm:w-auto",children:"Назад"}),a.jsx(Ba,{type:"button",onClick:()=>{e("/")},className:"w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white",children:"На главную"})]}),a.jsx("div",{className:"mt-12 text-sm text-gray-500",children:a.jsx("p",{children:"Если вы считаете, что это ошибка, обратитесь к администратору"})})]})})};class bl{constructor(e){s(this,"ws",null),s(this,"config"),s(this,"reconnectAttempts",0),s(this,"reconnectTimer",null),s(this,"heartbeatTimer",null),s(this,"subscriptions",new Map),s(this,"messageQueue",[]),s(this,"isConnecting",!1),s(this,"connectionState","disconnected"),s(this,"connectionCallbacks",[]),s(this,"currentUrl",null),s(this,"authErrorCallbacks",[]),this.config={reconnectInterval:5e3,maxReconnectAttempts:10,heartbeatInterval:3e4,messageQueueSize:100,...e},this.currentUrl=e.url}async connect(e){var s;e&&this.currentUrl!==e&&(la.debug(`[WebSocket] Switching URL from ${this.currentUrl} to ${e}`),this.disconnect(),this.currentUrl=e);const t=this.currentUrl||this.config.url;if(this.isConnecting||"connected"===this.connectionState)return void la.debug("[WebSocket] Already connecting or connected to:",t);this.isConnecting=!0,this.connectionState="connecting",this.notifyConnectionChange(!1);const a=t.split("?"),r=a.length>1?a[1]:"no-params";la.info("[WebSocket] Connection attempt:",{fullUrl:t,basePath:a[0],queryParams:r,hasToken:r.includes("token="),tokenPreview:r.includes("token=")?(null==(s=r.split("token=")[1])?void 0:s.substring(0,10))+"...":"NO-TOKEN"});try{this.ws=new WebSocket(t),this.ws.onopen=()=>{la.debug("[WebSocket] Connected successfully to:",t),this.connectionState="connected",this.reconnectAttempts=0,this.isConnecting=!1,this.notifyConnectionChange(!0),this.startHeartbeat(),this.processMessageQueue()},this.ws.onmessage=e=>{var s;try{const t=JSON.parse(e.data);la.debug("[WebSocketService] Raw WebSocket message received:",{type:t.type,hasMessage:!!t.message,messageId:null==(s=t.message)?void 0:s.id,fullPayload:t});try{if("undefined"!=typeof window){const e=window;Array.isArray(e.__wsMessages)||(e.__wsMessages=[]),e.__wsMessages.push(t)}}catch{}this.handleMessage(t)}catch(t){la.error("[WebSocket] Error parsing message:",t)}},this.ws.onclose=e=>{la.debug("[WebSocket] Disconnected:",e.code,e.reason),this.connectionState="disconnected",this.isConnecting=!1,this.notifyConnectionChange(!1),this.stopHeartbeat(),4001===e.code?(la.error("[WebSocket] Authentication error - token invalid or expired"),this.notifyAuthError(e.code,e.reason||"Authentication failed")):4002===e.code?(la.error("[WebSocket] Access denied - insufficient permissions"),this.notifyAuthError(e.code,e.reason||"Access denied")):this.scheduleReconnect()},this.ws.onerror=e=>{la.error("[WebSocket] Connection error:",e),this.isConnecting=!1,this.connectionState="disconnected",this.notifyConnectionChange(!1)}}catch(n){la.error("[WebSocket] Failed to create connection:",n),this.isConnecting=!1,this.connectionState="disconnected",this.notifyConnectionChange(!1),this.scheduleReconnect()}}disconnect(){this.stopHeartbeat(),this.clearReconnectTimer(),this.ws&&(this.ws.close(1e3,"Client disconnect"),this.ws=null),this.connectionState="disconnected",this.isConnecting=!1,this.notifyConnectionChange(!1)}retryConnection(){la.info("[WebSocket] Manual retry connection requested"),this.clearReconnectTimer(),this.reconnectAttempts=0,this.connect()}send(e){if(this.ws&&this.ws.readyState===WebSocket.OPEN)try{this.ws.send(JSON.stringify(e))}catch(s){la.error("Error sending WebSocket message:",s),this.queueMessage(e)}else this.queueMessage(e)}subscribe(e,s){const t=`${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.subscriptions.set(t,{channel:e,callback:s,id:t}),this.send({type:"subscribe",data:{channel:e}}),t}unsubscribe(e){const s=this.subscriptions.get(e);s&&(this.subscriptions.delete(e),this.send({type:"unsubscribe",data:{channel:s.channel}}))}isConnected(){var e;return"connected"===this.connectionState&&(null==(e=this.ws)?void 0:e.readyState)===WebSocket.OPEN}onConnectionChange(e){this.connectionCallbacks.push(e)}offConnectionChange(e){const s=this.connectionCallbacks.indexOf(e);s>-1&&this.connectionCallbacks.splice(s,1)}getReconnectionInfo(){const e=null!==this.reconnectTimer;return{isReconnecting:e,attempt:this.reconnectAttempts,maxAttempts:this.config.maxReconnectAttempts||10,nextRetryDelay:e?this.getReconnectDelay():0}}onAuthError(e){this.authErrorCallbacks.push(e)}offAuthError(e){const s=this.authErrorCallbacks.indexOf(e);s>-1&&this.authErrorCallbacks.splice(s,1)}notifyAuthError(e,s){this.authErrorCallbacks.forEach(t=>{try{t(e,s)}catch(a){la.error("Error in auth error callback:",a)}})}handleMessage(e){"pong"!==e.type&&("error"!==e.type?(la.debug("[WebSocketService] Broadcasting to",this.subscriptions.size,"subscriptions"),this.subscriptions.forEach(s=>{try{la.debug("[WebSocketService] Calling subscription callback for channel:",s.channel),s.callback(e)}catch(t){la.error("Error in subscription callback:",t)}})):la.error("WebSocket server error:",e.error))}getReconnectDelay(){const e=1e3*Math.pow(2,this.reconnectAttempts);return Math.min(e,3e4)}scheduleReconnect(){if(this.reconnectAttempts>=this.config.maxReconnectAttempts)return la.error(`[WebSocket] Max reconnection attempts (${this.config.maxReconnectAttempts}) reached`),void this.notifyConnectionChange(!1);this.reconnectAttempts++;const e=this.getReconnectDelay();la.info(`[WebSocket] Scheduling reconnection attempt ${this.reconnectAttempts}/${this.config.maxReconnectAttempts} in ${e}ms`),this.reconnectTimer=setTimeout(()=>{la.info(`[WebSocket] Executing reconnection attempt ${this.reconnectAttempts}/${this.config.maxReconnectAttempts}`),this.connect()},e)}clearReconnectTimer(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}startHeartbeat(){this.stopHeartbeat(),this.heartbeatTimer=setInterval(()=>{this.isConnected()&&this.send({type:"ping"})},this.config.heartbeatInterval)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}queueMessage(e){this.messageQueue.length>=this.config.messageQueueSize&&this.messageQueue.shift(),this.messageQueue.push(e)}processMessageQueue(){if(0===this.messageQueue.length)return;la.info(`[WebSocket] Processing message queue: ${this.messageQueue.length} messages`);let e=0;for(;this.messageQueue.length>0&&this.isConnected();){const t=this.messageQueue.shift();if(t)try{this.send(t),e++}catch(s){la.error("[WebSocket] Error processing queued message:",s),this.messageQueue.unshift(t);break}}la.info(`[WebSocket] Processed ${e} queued messages, ${this.messageQueue.length} remaining`)}notifyConnectionChange(e){this.connectionCallbacks.forEach(s=>{try{s(e)}catch(t){la.error("Error in connection change callback:",t)}})}}function Nl(){if("undefined"!=typeof window){const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/ws`;return la.debug("[WebSocket Config] Using auto-detected base URL from window.location:",e),e}return la.debug("[WebSocket Config] Using fallback base URL (SSR/build-time)"),"ws://localhost:8000/ws"}const wl=new bl({url:`${Nl()}/chat/general/`,reconnectInterval:1e3,maxReconnectAttempts:10,heartbeatInterval:3e4,messageQueueSize:100});const _l=new class{constructor(){s(this,"subscriptions",new Map),s(this,"eventHandlers",{}),s(this,"userId",null),wl.onConnectionChange(e=>{e&&this.resubscribeAll()})}connectToNotifications(e,s){this.userId=e,this.eventHandlers={...this.eventHandlers,...s};const t=`notifications_${e}`,a=wl.subscribe(t,e=>{this.handleNotificationMessage(e)});if(this.subscriptions.set(t,a),!wl.isConnected()){const s=Nl(),{accessToken:t}=ba.getTokens(),a=t||localStorage.getItem("auth_token");if(!a)return la.error("[NotificationWebSocket] ERROR: No auth token available for WebSocket connection!",{userId:e,tokenStorageResult:t,localStorageToken:localStorage.getItem("auth_token"),allLocalStorageKeys:Object.keys(localStorage)}),void(this.eventHandlers.onError&&this.eventHandlers.onError("Authentication token not found. Please log in again."));const r=`${s}/notifications/${e}/${`?token=${a}`}`;la.info("[NotificationWebSocket] Connecting to notifications:",{userId:e,hasToken:!!a,tokenLength:a.length,tokenStart:a.substring(0,10),fullUrl:r}),wl.connect(r)}}connectToDashboard(e,s){this.userId=e,this.eventHandlers={...this.eventHandlers,...s};const t=`dashboard_${e}`,a=wl.subscribe(t,e=>{this.handleNotificationMessage(e)});if(this.subscriptions.set(t,a),!wl.isConnected()){const s=Nl(),{accessToken:t}=ba.getTokens(),a=t||localStorage.getItem("auth_token");if(!a)return la.error("[NotificationWebSocket] ERROR: No auth token available for dashboard WebSocket connection!",{userId:e,tokenStorageResult:t,localStorageToken:localStorage.getItem("auth_token"),allLocalStorageKeys:Object.keys(localStorage)}),void(this.eventHandlers.onError&&this.eventHandlers.onError("Authentication token not found. Please log in again."));const r=`${s}/notifications/${e}/${`?token=${a}`}`;la.info("[NotificationWebSocket] Connecting to dashboard updates:",{userId:e,hasToken:!!a,tokenLength:a.length,tokenStart:a.substring(0,10),fullUrl:r}),wl.connect(r)}}disconnectFromNotifications(){this.subscriptions.forEach(e=>{wl.unsubscribe(e)}),this.subscriptions.clear(),this.userId=null}sendTestNotification(e,s,t){if(!this.userId)return;const a={id:Date.now(),type:e,title:s,message:t,created_at:(new Date).toISOString(),is_read:!1};this.eventHandlers.onNotification&&this.eventHandlers.onNotification(a)}handleNotificationMessage(e){switch(e.type){case"notification":e.data&&this.eventHandlers.onNotification&&this.eventHandlers.onNotification(e.data);break;case"dashboard_update":e.data&&this.eventHandlers.onDashboardUpdate&&this.eventHandlers.onDashboardUpdate(e.data);break;case"error":e.error&&this.eventHandlers.onError&&this.eventHandlers.onError(e.error)}}resubscribeAll(){this.userId&&this.subscriptions.forEach((e,s)=>{const t=wl.subscribe(s,e=>{this.handleNotificationMessage(e)});this.subscriptions.set(s,t)})}isConnected(){return wl.isConnected()}onConnectionChange(e){wl.onConnectionChange(e)}getCurrentUserId(){return this.userId}};function Sl({className:e,showZero:s=!1}){const{user:r}=qa(),{data:n,isLoading:i}=ct({queryKey:["chat","notifications"],queryFn:async()=>{const e=await Sa.request("/chat/notifications/");if(e.error)throw new Error(e.error);return e.data},refetchInterval:3e4,staleTime:1e4}),[l,o]=t.useState(0);if(t.useEffect(()=>{if(r)return _l.connectToNotifications(r.id,{onNotification:e=>{e.is_read||o(e=>e+1)},onError:e=>{la.error("WebSocket notification error:",e)}}),()=>{_l.disconnectFromNotifications()}},[r]),i)return null;const c=((null==n?void 0:n.unread_messages)||0)+((null==n?void 0:n.unread_threads)||0)+l;return 0!==c||s?a.jsx(Ya,{variant:"destructive",className:Bt("ml-auto h-5 min-w-[20px] flex items-center justify-center text-xs animate-pulse",e),children:c>99?"99+":c}):null}const kl=e=>{if(!e)return"";const s=new URLSearchParams;if(e.status){(Array.isArray(e.status)?e.status:[e.status]).forEach(e=>s.append("status",e))}e.student_id&&s.append("student_id",String(e.student_id)),e.date_from&&s.append("date_from",e.date_from),e.date_to&&s.append("date_to",e.date_to),e.ordering&&s.append("ordering",e.ordering),void 0!==e.limit&&s.append("limit",String(e.limit)),void 0!==e.offset&&s.append("offset",String(e.offset));const t=s.toString();return t?`?${t}`:""},Cl={getTutorInvoices:async e=>{var s;const t=`/invoices/tutor/${kl(e)}`,a=await Sa.request(t);if(a.error)throw new Error(a.error);return(null==(s=a.data)?void 0:s.data)||{count:0,results:[]}},getTutorInvoiceDetail:async e=>{var s;const t=await Sa.request(`/invoices/tutor/${e}/`);if(t.error)throw new Error(t.error);if(!(null==(s=t.data)?void 0:s.data))throw new Error("Invoice not found");return t.data.data},createInvoice:async e=>{var s;const t=await Sa.request("/invoices/tutor/",{method:"POST",body:JSON.stringify(e)});if(t.error)throw new Error(t.error);if(!(null==(s=t.data)?void 0:s.data))throw new Error("Failed to create invoice");return t.data.data},updateInvoice:async(e,s)=>{var t;const a=await Sa.request(`/invoices/tutor/${e}/`,{method:"PATCH",body:JSON.stringify(s)});if(a.error)throw new Error(a.error);if(!(null==(t=a.data)?void 0:t.data))throw new Error("Failed to update invoice");return a.data.data},deleteTutorInvoice:async e=>{const s=await Sa.request(`/invoices/tutor/${e}/`,{method:"DELETE"});if(s.error)throw new Error(s.error)},sendInvoice:async e=>{var s;const t=await Sa.request(`/invoices/tutor/${e}/send/`,{method:"POST"});if(t.error)throw new Error(t.error);if(!(null==(s=t.data)?void 0:s.data))throw new Error("Failed to send invoice");return t.data.data},cancelInvoice:async e=>{var s;const t=await Sa.request(`/invoices/tutor/${e}/`,{method:"DELETE"});if(t.error)throw new Error(t.error);if(!(null==(s=t.data)?void 0:s.data))throw new Error("Failed to cancel invoice");return t.data.data},getTutorStudents:async()=>{var e;const s=await Sa.request("/tutor/students/");if(s.error)throw new Error(s.error);return Array.isArray(s.data)?s.data:(null==(e=s.data)?void 0:e.results)||[]},getParentInvoices:async e=>{const s=`/invoices/parent/${kl(e)}`,t=await Sa.request(s);if(t.error)throw new Error(t.error);return t.data||{count:0,results:[]}},getParentInvoiceDetail:async e=>{const s=await Sa.request(`/invoices/parent/${e}/`);if(s.error)throw new Error(s.error);if(!s.data)throw new Error("Invoice not found");return s.data},markInvoiceViewed:async e=>{const s=await Sa.request(`/invoices/parent/${e}/mark_viewed/`,{method:"POST"});if(s.error)throw new Error(s.error);if(!s.data)throw new Error("Failed to mark invoice as viewed");return s.data},initiateInvoicePayment:async e=>{const s=await Sa.request(`/invoices/parent/${e}/pay/`,{method:"POST"});if(s.error)throw new Error(s.error);if(!s.data)throw new Error("Failed to initiate payment");return s.data},getUnpaidInvoiceCount:async()=>{var e;const s=await Sa.request("/invoices/parent/unpaid-count/");return s.error?0:(null==(e=s.data)?void 0:e.count)||0},getInvoiceSummary:async()=>{const e=await Sa.request("/invoices/parent/summary/");return e.error?{total_unpaid_amount:0,overdue_count:0,upcoming_count:0}:e.data||{total_unpaid_amount:0,overdue_count:0,upcoming_count:0}}},{getTutorInvoices:El,getTutorInvoiceDetail:Tl,deleteTutorInvoice:Rl,markInvoiceViewed:Al,getUnpaidInvoiceCount:Pl}=Cl,Ll=[{title:"Главная",url:"/dashboard/parent",icon:Ne},{title:"Мои дети",url:"/dashboard/parent/children",icon:Pe},{title:"История платежей",url:"/dashboard/parent/payment-history",icon:$s},{title:"Счета",url:"/dashboard/parent/invoices",icon:Ks,hasBadge:!0},{title:"Статистика",url:"/dashboard/parent/statistics",icon:De},{title:"Отчёты",url:"/dashboard/parent/reports",icon:Je},{title:"Форум",url:"/dashboard/parent/forum",icon:Ns},{title:"Сообщения",url:"/dashboard/parent/chat",icon:Ns}];function ql(){const{state:e}=$r(),{signOut:s}=qa(),{data:t}=ct({queryKey:["parent-invoices-unpaid-count"],queryFn:async()=>{try{return await Cl.getUnpaidCount()}catch(e){return 0}},staleTime:6e4,refetchInterval:12e4});return a.jsxs(Vr,{collapsible:"icon",children:[a.jsx(Xr,{children:a.jsxs(Jr,{children:[a.jsx(Kr,{children:"Навигация"}),a.jsx(Gr,{children:a.jsx(Yr,{children:Ll.map(s=>a.jsx(Qr,{children:a.jsx(en,{asChild:!0,children:a.jsxs(ht,{to:s.url,className:({isActive:e})=>e?"bg-sidebar-accent":"",children:[a.jsx(s.icon,{className:"h-4 w-4"}),"expanded"===e&&a.jsxs("div",{className:"flex items-center justify-between w-full",children:[a.jsx("span",{children:s.title}),"Форум"===s.title&&a.jsx(Sl,{}),s.hasBadge&&t&&t>0&&a.jsx(Ya,{variant:"destructive",className:"ml-auto",children:t})]})]})})},s.title))})})]})}),a.jsx(Br,{children:a.jsxs(Yr,{children:[a.jsx(Qr,{children:a.jsx(en,{asChild:!0,children:a.jsxs(ht,{to:"/profile",children:[a.jsx(Ze,{className:"h-4 w-4"}),"expanded"===e&&a.jsx("span",{children:"Профиль"})]})})}),a.jsx(Qr,{children:a.jsxs(Ba,{type:"button",variant:"ghost",className:"w-full justify-start",onClick:async()=>{await s()},children:[a.jsx(Fe,{className:"h-4 w-4 mr-2"}),"expanded"===e&&a.jsx("span",{children:"Выход"})]})})]})})]})}const Il=new class{async invalidateEndpoint(e){try{const s=e.startsWith("/")?e.substring(1):e;fa.delete(s),fa.clearPattern(s),la.info(`[CacheInvalidation] Invalidated cache for endpoint: ${e}`)}catch(s){la.error("[CacheInvalidation] Failed to invalidate cache:",s)}}async invalidatePattern(e){try{fa.clearPattern(e),la.info(`[CacheInvalidation] Invalidated cache by pattern: ${e}`)}catch(s){la.error("[CacheInvalidation] Failed to invalidate cache by pattern:",s)}}async invalidateAll(){try{fa.clear(),la.info("[CacheInvalidation] Cleared all cache")}catch(e){la.error("[CacheInvalidation] Failed to clear all cache:",e)}}async invalidateEndpoints(e){await Promise.all(e.map(e=>this.invalidateEndpoint(e)))}},zl={getDashboard:async()=>{const e=await Sa.getStudentDashboard();if(e.error)throw new Error(e.error);if(!e.data)throw new Error("Не удалось загрузить данные дашборда");return e.data},getAssignedMaterials:async()=>{var e;const s=await Sa.request("/materials/student/assigned/");if(s.error)throw new Error(s.error);return null!=(e=s.data)?e:[]},updateMaterialProgress:async(e,s)=>{const t=await Sa.request(`/materials/${e}/progress/`,{method:"POST",body:JSON.stringify({progress_percentage:s})});if(t.error)throw new Error(t.error);await Il.invalidateEndpoint("/materials/student/")},getSubjects:async()=>{var e;const s=await Sa.request("/materials/student/subjects/");if(s.error)throw new Error(s.error);return(null==(e=s.data)?void 0:e.subjects)||[]}},Dl={getDashboard:async()=>{const e=await Sa.getParentDashboard();if(e.error)throw new Error(e.error);if(!e.data)throw new Error("Не удалось загрузить данные дашборда");return e.data},getChildren:async()=>{var e;const s=await Sa.request("/dashboard/parent/children/");if(s.error)throw new Error(s.error);return null!=(e=s.data)?e:[]},getChildSubjects:async e=>{var s;const t=await Sa.request(`/dashboard/parent/children/${e}/subjects/`);if(t.error)throw new Error(t.error);return null!=(s=t.data)?s:[]},getChildProgress:async e=>{var s;const t=await Sa.request(`/dashboard/parent/children/${e}/progress/`);if(t.error)throw new Error(t.error);return null!=(s=t.data)?s:{}},initiatePayment:async(e,s,t)=>{const a={description:t.description,create_subscription:t.create_subscription||!1};void 0!==t.amount&&(a.amount=t.amount);const r=await Sa.request(`/dashboard/parent/children/${e}/payment/${s}/`,{method:"POST",body:JSON.stringify(a)});if(r.error)throw new Error(r.error);if(await Il.invalidateEndpoint("/dashboard/parent/children/"),!r.data)throw new Error("Не удалось инициировать оплату");return r.data},cancelSubscription:async(e,s)=>{const t=await Sa.request(`/dashboard/parent/children/${e}/subscription/${s}/cancel/`,{method:"POST"});if(t.error)throw new Error(t.error);if(await Il.invalidateEndpoint("/dashboard/parent/children/"),!t.data)throw new Error("Не удалось отменить подписку");return t.data},getPaymentHistory:async()=>{var e;const s=await Sa.request("/dashboard/parent/payments/");if(s.error)throw new Error(s.error);return null!=(e=s.data)?e:[]},getPaymentStatus:async e=>{var s;const t=await Sa.request(`/dashboard/parent/children/${e}/payments/`);if(t.error)throw new Error(t.error);return null!=(s=t.data)?s:{}}},Ol=({className:e})=>a.jsxs("div",{className:Bt("space-y-6",e),children:[a.jsxs(Fa,{className:"p-6",children:[a.jsx(Fr,{className:"h-8 w-64 mb-2"}),a.jsx(Fr,{className:"h-4 w-48"})]}),a.jsxs(Fa,{className:"p-6 gradient-primary text-primary-foreground shadow-glow",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[a.jsx(Fr,{className:"w-12 h-12 rounded-full bg-primary-foreground/20"}),a.jsxs("div",{className:"flex-1",children:[a.jsx(Fr,{className:"h-6 w-32 mb-2 bg-primary-foreground/20"}),a.jsx(Fr,{className:"h-4 w-48 bg-primary-foreground/20"})]})]}),a.jsx(Fr,{className:"h-3 w-full bg-primary-foreground/20 mb-2"}),a.jsx("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[1,2,3].map(e=>a.jsxs("div",{className:"text-center",children:[a.jsx(Fr,{className:"h-8 w-16 mx-auto mb-2 bg-primary-foreground/20"}),a.jsx(Fr,{className:"h-4 w-20 mx-auto bg-primary-foreground/20"})]},e))})]}),a.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:[1,2].map(e=>a.jsxs(Fa,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(Fr,{className:"w-5 h-5"}),a.jsx(Fr,{className:"h-6 w-32"})]}),a.jsx("div",{className:"space-y-3",children:[1,2,3].map(e=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx(Fr,{className:"h-4 w-3/4 mb-1"}),a.jsx(Fr,{className:"h-3 w-1/2"})]}),a.jsx(Fr,{className:"h-6 w-16"})]},e))})]},e))}),a.jsxs(Fa,{className:"p-6",children:[a.jsx(Fr,{className:"h-6 w-32 mb-4"}),a.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>a.jsxs("div",{className:"h-20 bg-muted rounded-lg flex flex-col items-center justify-center gap-2",children:[a.jsx(Fr,{className:"w-6 h-6"}),a.jsx(Fr,{className:"h-4 w-20"})]},e))})]})]}),Fl=({size:e="md",className:s,text:t})=>a.jsxs("div",{className:Bt("flex items-center justify-center gap-2",s),children:[a.jsx(Ee,{className:Bt("animate-spin",{sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"}[e])}),t&&a.jsx("span",{className:"text-sm text-muted-foreground",children:t})]}),Ml=({error:e,onRetry:s,className:t,showRetry:r=!0})=>a.jsx(Fa,{className:Bt("p-6 text-center",t),children:a.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[a.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center",children:a.jsx(be,{className:"w-8 h-8 text-destructive"})}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Произошла ошибка"}),a.jsx("p",{className:"text-muted-foreground",children:e})]}),r&&s&&a.jsxs(Ba,{type:"button",onClick:s,variant:"outline",children:[a.jsx(we,{className:"w-4 h-4 mr-2"}),"Попробовать снова"]})]})}),$l=({title:e,description:s,icon:t,action:r,className:n})=>a.jsx(Fa,{className:Bt("p-8 text-center",n),children:a.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t&&a.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center",children:t}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h3",{className:"text-lg font-semibold",children:e}),a.jsx("p",{className:"text-muted-foreground",children:s})]}),r&&r]})}),Ul=({isLoading:e,error:s,onRetry:t,children:r,className:n})=>e?a.jsx("div",{className:Bt("flex items-center justify-center p-8",n),children:a.jsx(Fl,{size:"lg",text:"Загрузка..."})}):s?a.jsx(Ml,{error:s,onRetry:t,className:n}):a.jsx(a.Fragment,{children:r}),Vl={pending:{label:"Ожидает оплаты",icon:cs,variant:"secondary",className:"bg-amber-50/80 text-amber-700 border-amber-300/50 hover:bg-amber-100/80 dark:bg-amber-950/30 dark:text-amber-400 dark:border-amber-800/50"},waiting_for_payment:{label:"Ожидание платежа",icon:$s,variant:"default",className:"bg-blue-50/80 text-blue-700 border-blue-300/50 hover:bg-blue-100/80 dark:bg-blue-950/30 dark:text-blue-400 dark:border-blue-800/50"},paid:{label:"Оплачен",icon:rs,variant:"default",className:"bg-green-50/80 text-green-700 border-green-300/50 hover:bg-green-100/80 dark:bg-green-950/30 dark:text-green-400 dark:border-green-800/50"},expired:{label:"Просрочен",icon:js,variant:"destructive",className:"bg-red-50/80 text-red-700 border-red-300/50 hover:bg-red-100/80 dark:bg-red-950/30 dark:text-red-400 dark:border-red-800/50"},refunded:{label:"Возвращен",icon:be,variant:"outline",className:"bg-slate-50/80 text-slate-700 border-slate-300/50 hover:bg-slate-100/80 dark:bg-slate-950/30 dark:text-slate-400 dark:border-slate-800/50"},overdue:{label:"Просрочен",icon:js,variant:"destructive",className:"bg-red-50/80 text-red-700 border-red-300/50 hover:bg-red-100/80 dark:bg-red-950/30 dark:text-red-400 dark:border-red-800/50"},no_payment:{label:"Требуется оплата",icon:be,variant:"destructive",className:"bg-orange-50/80 text-orange-700 border-orange-400/50 hover:bg-orange-100/80 dark:bg-orange-950/30 dark:text-orange-400 dark:border-orange-800/50 animate-pulse"}},Wl=({status:e,size:s="default",showIcon:t=!0,className:r})=>{const n=Vl[e]||Vl.no_payment,i=n.icon;return a.jsxs(Ya,{variant:n.variant,className:Bt("inline-flex items-center gap-1.5 font-medium transition-all duration-200 border",n.className,{sm:"text-xs px-2 py-0.5",default:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"}[s],r),children:[t&&a.jsx(i,{className:Bt({sm:"h-3 w-3",default:"h-3.5 w-3.5",lg:"h-4 w-4"}[s],"shrink-0")}),a.jsx("span",{className:"whitespace-nowrap",children:n.label})]})},Hl=()=>ct({queryKey:["parent-dashboard"],queryFn:async()=>{var e,s;la.debug("[useParentDashboard] Fetching dashboard data...");const t=await Sa.getParentDashboard();if(la.debug("[useParentDashboard] Full response:",t),la.debug("[useParentDashboard] Response.data:",t.data),la.debug("[useParentDashboard] Response.data.children:",null==(e=t.data)?void 0:e.children),t.error)throw la.error("[useParentDashboard] Error:",t.error),new Error(t.error);if(!t.data)throw la.error("[useParentDashboard] No data in response!"),new Error("Данные дашборда отсутствуют");return la.debug("[useParentDashboard] Returning data with",(null==(s=t.data.children)?void 0:s.length)||0,"children"),t.data},staleTime:6e4,refetchOnWindowFocus:!0,refetchOnMount:!0}),Bl=()=>ct({queryKey:["parent-children"],queryFn:()=>Dl.getChildren(),staleTime:6e4}),Xl=e=>ct({queryKey:["parent-child-subjects",e],queryFn:()=>Dl.getChildSubjects(e),enabled:!!e,staleTime:6e4}),Jl=(e,s,t)=>{const a=ot();return dt({mutationFn:()=>Dl.initiatePayment(e,s,{...(null==t?void 0:t.amount)&&{amount:t.amount},description:(null==t?void 0:t.description)||"Оплата за предмет",create_subscription:!1!==(null==t?void 0:t.create_subscription)}),onSuccess:s=>{a.invalidateQueries({queryKey:["parent-children"]}),a.invalidateQueries({queryKey:["parent-child-subjects",e]}),(null==s?void 0:s.payment_id)&&sessionStorage.setItem("pending_payment_id",s.payment_id);const t=(null==s?void 0:s.confirmation_url)||(null==s?void 0:s.payment_url)||(null==s?void 0:s.return_url);t&&(window.location.href=t)}})},Kl=e=>ct({queryKey:["parent-child-progress",e],queryFn:()=>Dl.getChildProgress(e),enabled:!!e,staleTime:6e4}),Gl=(e,s)=>{switch(e){case"student":return a.jsxs("div",{className:"space-y-3",children:[s.grade&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Hs,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Класс"}),a.jsx("p",{className:"text-sm text-foreground",children:s.grade})]})]}),s.learningGoal&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Xe,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Цель обучения"}),a.jsx("p",{className:"text-sm text-foreground",children:s.learningGoal})]})]}),void 0!==s.progressPercentage&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Gs,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1 w-full",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Прогресс обучения"}),a.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:a.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(s.progressPercentage,100)}%`}})}),a.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.progressPercentage.toFixed(1),"% выполнено"]})]})]}),void 0!==s.subjectsCount&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Pe,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Предметы"}),a.jsxs("p",{className:"text-sm text-foreground",children:[s.subjectsCount," предметов"]})]})]})]});case"teacher":return a.jsxs("div",{className:"space-y-3",children:[s.subjects&&s.subjects.length>0&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Xe,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Предметы"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:s.subjects.map((e,s)=>a.jsx(Ya,{variant:"outline",className:"text-xs",children:"string"==typeof e?e:e.name},s))})]})]}),void 0!==s.experience&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Ys,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Опыт работы"}),a.jsxs("p",{className:"text-sm text-foreground",children:[s.experience," ",1===s.experience?"год":"лет"]})]})]}),void 0!==s.studentsCount&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Pe,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Ученики"}),a.jsxs("p",{className:"text-sm text-foreground",children:[s.studentsCount," ученик(ов)"]})]})]}),void 0!==s.materialsCount&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Gs,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Материалы"}),a.jsxs("p",{className:"text-sm text-foreground",children:[s.materialsCount," материалов"]})]})]})]});case"tutor":return a.jsxs("div",{className:"space-y-3",children:[s.specialization&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Xe,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Специализация"}),a.jsx("p",{className:"text-sm text-foreground",children:s.specialization})]})]}),void 0!==s.experience&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Ys,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Опыт работы"}),a.jsxs("p",{className:"text-sm text-foreground",children:[s.experience," ",1===s.experience?"год":"лет"]})]})]}),void 0!==s.studentsCount&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Pe,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Управляемые ученики"}),a.jsxs("p",{className:"text-sm text-foreground",children:[s.studentsCount," ученик(ов)"]})]})]}),void 0!==s.reportsCount&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Gs,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Отправленные отчеты"}),a.jsx("p",{className:"text-sm text-foreground",children:s.reportsCount})]})]})]});case"parent":return a.jsxs("div",{className:"space-y-3",children:[void 0!==s.childrenCount&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Pe,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Дети"}),a.jsxs("p",{className:"text-sm text-foreground",children:[s.childrenCount," ",1===s.childrenCount?"ребёнок":"детей"]})]})]}),s.childrenNames&&s.childrenNames.length>0&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Gs,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Имена детей"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:s.childrenNames.map((e,s)=>a.jsx(Ya,{variant:"outline",className:"text-xs",children:e},s))})]})]}),void 0!==s.activeSubscriptions&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Ys,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Активные подписки"}),a.jsx("p",{className:"text-sm text-foreground",children:s.activeSubscriptions})]})]}),void 0!==s.unreadReports&&a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Ms,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Непрочитанные отчеты"}),a.jsx("p",{className:"text-sm text-foreground",children:s.unreadReports})]})]})]});default:return null}},Yl=({userName:e,userEmail:s,userRole:r,avatarUrl:n,profileData:i,onEdit:l,className:o})=>{const c={student:{label:"Ученик",variant:"default"},teacher:{label:"Преподаватель",variant:"secondary"},tutor:{label:"Тьютор",variant:"destructive"},parent:{label:"Родитель",variant:"outline"}}[r];const d=t.useMemo(()=>e.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().slice(0,2),[e]);return a.jsxs(Fa,{className:Bt("w-full overflow-hidden transition-shadow hover:shadow-md",o),children:[a.jsx("div",{className:"h-24 bg-gradient-to-r from-primary/10 to-primary/5"}),a.jsx(Ma,{className:"pt-0",children:a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4 -mt-16 relative z-10",children:[a.jsxs("div",{className:"flex gap-4 items-start flex-1",children:[a.jsxs(Fn,{className:"h-24 w-24 border-4 border-background",children:[a.jsx(Mn,{src:n,alt:e}),a.jsx($n,{className:"text-lg font-semibold bg-primary text-primary-foreground",children:d})]}),a.jsxs("div",{className:"pt-6 flex-1 min-w-0",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2",children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-bold leading-tight break-words",children:e}),a.jsx(Ya,{variant:c.variant,className:"w-fit",children:c.label})]}),a.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground truncate",children:[a.jsx(Ms,{className:"h-4 w-4 flex-shrink-0"}),a.jsx("span",{className:"text-sm truncate",children:s})]})]})]}),l&&a.jsxs(Ba,{type:"button",onClick:l,variant:"outline",size:"sm",className:"w-full sm:w-auto flex gap-2",children:[a.jsx(Ge,{className:"h-4 w-4"}),a.jsx("span",{className:"hidden sm:inline",children:"Редактировать"}),a.jsx("span",{className:"sm:hidden",children:"Редакт."})]})]})}),a.jsx(Va,{className:"pt-0",children:Gl(r,i)})]})},Ql=()=>{var e,s,r;const{user:n}=qa(),i=xt();Ht();const l=tr(),o=sr(),{data:c,isLoading:d,error:u,refetch:m}=Hl(),{profileData:h,isLoading:x}=Ia(),p=(null==u?void 0:u.message)||null;t.useEffect(()=>{let e;const s=()=>{document.hasFocus()&&(clearTimeout(e),e=setTimeout(()=>{m()},1e3))};return window.addEventListener("focus",s),()=>{window.removeEventListener("focus",s),clearTimeout(e)}},[m]),t.useEffect(()=>{var e;if(u){401===((null==u?void 0:u.status)||(null==(e=null==u?void 0:u.response)?void 0:e.status))&&(la.warn("[ParentDashboard] Received 401 Unauthorized"),l("Ваша сессия истекла. Пожалуйста, заново авторизуйтесь."),setTimeout(()=>{i("/login")},2e3))}},[u,i,l]);return a.jsx(Ur,{children:a.jsxs("div",{className:"flex min-h-screen w-full",children:[a.jsx(ql,{}),a.jsxs(Hr,{children:[a.jsxs("header",{className:"sticky top-0 z-10 flex h-16 items-center gap-4 border-b bg-background px-6",children:[a.jsx(Wr,{}),a.jsx("div",{className:"flex-1"})]}),a.jsx("main",{className:"p-6",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold","aria-label":"Личный кабинет родителя",children:"Личный кабинет родителя"}),a.jsx("p",{className:"text-muted-foreground",children:"Следите за успехами ваших детей"})]}),p&&a.jsx(Ml,{error:p,onRetry:()=>m()}),d&&a.jsx(Ol,{}),!d&&!p&&c&&a.jsxs(a.Fragment,{children:[x?a.jsx(Fa,{className:"p-6",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(Fr,{className:"h-32 w-full"}),a.jsx(Fr,{className:"h-4 w-3/4"}),a.jsx(Fr,{className:"h-4 w-1/2"})]})}):(null==h?void 0:h.user)?a.jsx(Yl,{userName:h.user.full_name||h.user.email.split("@")[0],userEmail:h.user.email,userRole:"parent",avatarUrl:h.user.avatar_url,profileData:{childrenCount:(null==(g=null==c?void 0:c.children)?void 0:g.length)||0,childrenNames:(null==(f=null==c?void 0:c.children)?void 0:f.map(e=>e.name))||[],activeSubscriptions:(null==(j=null==c?void 0:c.children)?void 0:j.reduce((e,s)=>{var t;return e+((null==(t=s.subjects)?void 0:t.filter(e=>e.has_subscription).length)||0)},0))||0,unreadReports:((null==c?void 0:c.reports)||[]).length}}):a.jsx(Ml,{error:"Не удалось загрузить данные профиля",onRetry:()=>window.location.reload()}),a.jsxs(Fa,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(Pe,{className:"w-5 h-5 text-primary"}),a.jsx("h3",{className:"text-xl font-bold",children:"Профили детей"}),a.jsxs(Ya,{variant:"outline",children:[(null==(e=c.children)?void 0:e.length)||0," детей"]})]}),a.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:c.children&&c.children.length>0?c.children.map(e=>a.jsx(Fa,{className:"p-4 hover:border-primary transition-colors cursor-pointer",onClick:()=>{return s=e.id,void i(`/dashboard/parent/children/${s}`);var s},children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsxs(Fn,{className:"w-16 h-16",children:[a.jsx(Mn,{src:e.avatar}),a.jsx($n,{className:"gradient-primary text-primary-foreground text-lg",children:e.name.split(" ").map(e=>e[0]).join("")})]}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("h4",{className:"font-bold text-lg",children:e.name}),a.jsxs(Ya,{variant:"outline",children:[e.grade," класс"]})]}),a.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:e.goal}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-muted-foreground",children:"Тьютор"}),a.jsx("div",{className:"font-medium",children:e.tutor_name})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-muted-foreground",children:"Прогресс"}),a.jsxs("div",{className:"font-medium text-success",children:[e.progress_percentage,"%"]})]})]}),a.jsxs("div",{className:"mt-3 space-y-2",children:[e.subjects.slice(0,2).map(s=>a.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border-2 transition-all "+("no_payment"===s.payment_status||"overdue"===s.payment_status?"bg-orange-50 border-orange-400 shadow-md dark:bg-orange-950/20 dark:border-orange-800":"bg-muted border-transparent"),children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("div",{className:"text-sm font-medium",children:s.name}),("no_payment"===s.payment_status||"overdue"===s.payment_status)&&a.jsx(Ya,{variant:"destructive",className:"text-xs font-bold bg-orange-600 hover:bg-orange-700 animate-pulse",children:"ТРЕБУЕТСЯ ОПЛАТА"})]}),a.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("span",{children:["Преподаватель: ",s.teacher_name]}),a.jsx(Wl,{status:s.payment_status,size:"sm"}),s.has_subscription&&a.jsx(Ya,{variant:"secondary",className:"text-xs",children:"Подписка активна"})]}),s.next_payment_date&&(()=>{const e=new Date(s.next_payment_date);return!isNaN(e.getTime())?a.jsxs("div",{className:"text-xs text-blue-600",children:["Следующий платеж:"," ",e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})]}):null})(),"no_payment"===s.payment_status&&a.jsx("div",{className:"text-xs text-orange-700 dark:text-orange-400 font-medium mt-1",children:'Нажмите "Подключить предмет" для оплаты'})]})]}),a.jsx("div",{className:"flex gap-2 items-center",children:s.has_subscription&&"paid"===s.payment_status?a.jsx(Ba,{type:"button",size:"sm",variant:"outline",onClick:async t=>{if(t.stopPropagation(),!s.enrollment_id)return void l("Ошибка: не указан идентификатор зачисления. Обновите страницу.");if(window.confirm(`Отключить предмет "${s.name}"?`))try{await(async(e,s)=>{var t,a;try{const t=await Dl.cancelSubscription(e,s);t&&(t.success||t.message)?(o(t.message||"Подписка успешно отменена"),await m()):(null==t?void 0:t.error)?l(t.error):(o("Подписка успешно отменена"),await m())}catch(r){la.error("Cancel subscription error:",r);const e=(null==(a=null==(t=r.response)?void 0:t.data)?void 0:a.error)||r.message||"Произошла ошибка при отмене подписки";l(e)}})(e.id,s.enrollment_id)}catch(a){la.error("Cancel subscription error:",a),l("Произошла ошибка при отключении предмета")}},children:"Отключить предмет"}):a.jsxs(Ba,{type:"button",size:"sm",variant:("overdue"===s.payment_status||"no_payment"===s.payment_status||s.payment_status,"default"),className:"no_payment"===s.payment_status||"overdue"===s.payment_status?"bg-orange-600 hover:bg-orange-700 text-white font-semibold shadow-lg border-2 border-orange-700 dark:bg-orange-600 dark:hover:bg-orange-700":"",disabled:!s.enrollment_id,onClick:t=>{t.stopPropagation(),s.enrollment_id?(async(e,s,t,a,r)=>{if(r.stopPropagation(),s)try{const r=await Dl.initiatePayment(e,s,{description:`Оплата за предмет "${t}" (преподаватель: ${a})`,create_subscription:!0}),n=(null==r?void 0:r.confirmation_url)||(null==r?void 0:r.payment_url)||(null==r?void 0:r.return_url);n?window.location.href=n:l("Не удалось создать платеж. Проверьте настройки ЮКассы.")}catch(n){la.error("Payment error:",n),l(n.message||"Произошла ошибка при создании платежа")}else l("Ошибка: не указан идентификатор зачисления. Обновите страницу.")})(e.id,s.enrollment_id,s.name,s.teacher_name,t):l("Ошибка: не указан идентификатор зачисления. Обновите страницу.")},children:[a.jsx($s,{className:"w-4 h-4 mr-1"}),"waiting_for_payment"===s.payment_status?"Перейти к оплате":"Подключить предмет"]})})]},s.enrollment_id||s.id)),e.subjects.length>2&&a.jsxs("div",{className:"text-xs text-muted-foreground text-center",children:["+",e.subjects.length-2," других предметов"]})]})]})]})},e.id)):a.jsx("div",{className:"col-span-2",children:a.jsx($l,{title:"Нет зарегистрированных детей",description:"Пока нет зарегистрированных детей. Обратитесь к администратору для регистрации.",icon:a.jsx(Pe,{className:"w-8 h-8 text-muted-foreground"})})})})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs(Fa,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(Je,{className:"w-5 h-5 text-primary"}),a.jsx("h3",{className:"text-xl font-bold",children:"Последние отчёты"})]}),a.jsxs("div",{className:"space-y-3",children:[(null!=(s=c.reports)?s:[]).slice(0,3).map(e=>{const s=e.created_at?new Date(e.created_at):null,t=s&&!isNaN(s.getTime());return a.jsxs("div",{className:"p-4 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer",onClick:()=>{return s=e.id,void i(`/dashboard/parent/reports/${s}`);var s},children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:e.student_name||"Студент"}),a.jsx("div",{className:"text-sm text-muted-foreground",children:e.week_start&&e.week_end?`${new Date(e.week_start).toLocaleDateString("ru-RU")} - ${new Date(e.week_end).toLocaleDateString("ru-RU")}`:"Еженедельный отчет"}),e.title&&a.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.title})]}),a.jsx(Ya,{variant:"sent"===e.status?"default":"read"===e.status?"secondary":"outline",children:"sent"===e.status?"Отправлен":"read"===e.status?"Прочитан":"draft"===e.status?"Черновик":"Новый"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx(Le,{className:"w-3 h-3"}),t?s.toLocaleDateString("ru-RU"):"Дата неизвестна",e.tutor_name&&a.jsxs(a.Fragment,{children:[a.jsx("span",{children:"•"}),a.jsx("span",{children:e.tutor_name})]})]})]},e.id)}),0===(null!=(r=c.reports)?r:[]).length&&a.jsx($l,{title:"Нет новых отчетов",description:"Пока нет отчетов от тьюторов. Ожидайте новых отчетов о прогрессе вашего ребенка.",icon:a.jsx(Je,{className:"w-8 h-8 text-muted-foreground"})})]}),a.jsx(Ba,{type:"button",variant:"outline",className:"w-full mt-4",onClick:()=>i("/dashboard/parent/reports"),children:"Смотреть все отчёты"})]}),a.jsxs(Fa,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(ws,{className:"w-5 h-5 text-primary"}),a.jsx("h3",{className:"text-xl font-bold",children:"Статистика"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-primary",children:c.statistics.total_children}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"Детей"})]}),a.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[a.jsxs("div",{className:"text-2xl font-bold text-success",children:[c.statistics.average_progress,"%"]}),a.jsx("div",{className:"text-sm text-muted-foreground",children:"Средний прогресс"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Оплачено"}),a.jsx("span",{className:"font-medium text-success",children:c.statistics.completed_payments})]}),a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Ожидает оплаты"}),a.jsx("span",{className:"font-medium text-warning",children:c.statistics.pending_payments})]}),a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Просрочено"}),a.jsx("span",{className:"font-medium text-destructive",children:c.statistics.overdue_payments})]})]})]})]})]}),a.jsxs(Fa,{className:"p-6",children:[a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Быстрые действия"}),a.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>i("/dashboard/parent/children"),children:[a.jsx(Pe,{className:"w-6 h-6"}),a.jsx("span",{children:"Управление детьми"})]}),a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>i("/dashboard/parent/forum"),children:[a.jsx(Ns,{className:"w-6 h-6"}),a.jsx("span",{children:"Форум"})]}),a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>i("/dashboard/parent/chat"),children:[a.jsx(qe,{className:"w-6 h-6"}),a.jsx("span",{children:"Сообщения"})]}),a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>i("/dashboard/parent/payment-history"),children:[a.jsx($s,{className:"w-6 h-6"}),a.jsx("span",{children:"Оплаты"})]}),a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>i("/dashboard/parent/reports"),children:[a.jsx(Je,{className:"w-6 h-6"}),a.jsx("span",{children:"Отчёты"})]}),a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>i("/dashboard/parent/statistics"),children:[a.jsx(ws,{className:"w-6 h-6"}),a.jsx("span",{children:"Статистика"})]})]})]})]})]})})]})]})});var g,f,j},Zl=t.forwardRef(({className:e,value:s,...t},r)=>a.jsx(me,{ref:r,className:Bt("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...t,children:a.jsx(he,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Zl.displayName=me.displayName;const eo=[{title:"Главная",url:"/dashboard/student",icon:Ne},{title:"Предметы",url:"/dashboard/student/subjects",icon:Xe},{title:"Материалы",url:"/dashboard/student/materials",icon:Xe},{title:"Расписание",url:"/dashboard/student/schedule",icon:Le},{title:"Форум",url:"/dashboard/student/forum",icon:Ns},{title:"Сообщения",url:"/dashboard/student/chat",icon:Ns},{title:"Граф знаний",url:"/dashboard/student/knowledge-graph",icon:Qs}];function so(){const{state:e}=$r(),{signOut:s}=qa();return a.jsxs(Vr,{collapsible:"icon",children:[a.jsx(Xr,{children:a.jsxs(Jr,{children:[a.jsx(Kr,{children:"Навигация"}),a.jsx(Gr,{children:a.jsx(Yr,{children:eo.map(s=>a.jsx(Qr,{children:a.jsx(en,{asChild:!0,children:a.jsxs(ht,{to:s.url,className:({isActive:e})=>e?"bg-sidebar-accent":"",children:[a.jsx(s.icon,{className:"h-4 w-4"}),"expanded"===e&&a.jsxs("div",{className:"flex items-center justify-between w-full",children:[a.jsx("span",{children:s.title}),"Форум"===s.title&&a.jsx(Sl,{})]})]})})},s.title))})})]})}),a.jsx(Br,{children:a.jsxs(Yr,{children:[a.jsx(Qr,{children:a.jsx(en,{asChild:!0,children:a.jsxs(ht,{to:"/profile",children:[a.jsx(Ze,{className:"h-4 w-4"}),"expanded"===e&&a.jsx("span",{children:"Профиль"})]})})}),a.jsx(Qr,{children:a.jsxs(Ba,{type:"button",variant:"ghost",className:"w-full justify-start",onClick:async()=>{try{await s()}catch(e){la.error("StudentSidebar sign out error:",e)}},children:[a.jsx(Fe,{className:"h-4 w-4 mr-2"}),"expanded"===e&&a.jsx("span",{children:"Выход"})]})})]})})]})}const to=({cachedData:e,onRetry:s,className:t})=>a.jsxs("div",{className:Bt("space-y-6",t),children:[a.jsx(Fa,{className:"p-4 border-warning",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Se,{className:"w-5 h-5 text-warning"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-warning",children:"Режим офлайн"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Некоторые данные могут быть устаревшими"})]}),s&&a.jsxs(Ba,{type:"button",size:"sm",onClick:s,className:"ml-auto",children:[a.jsx(we,{className:"w-4 h-4 mr-2"}),"Обновить"]})]})}),(null==e?void 0:e.materials)&&e.materials.length>0&&a.jsxs(Fa,{className:"p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(Xe,{className:"w-5 h-5"}),a.jsx("h3",{className:"font-semibold",children:"Материалы (кэшированные)"}),a.jsx(Ya,{variant:"secondary",children:"Офлайн"})]}),a.jsxs("div",{className:"space-y-2",children:[e.materials.slice(0,3).map((e,s)=>a.jsx("div",{className:"p-2 bg-muted rounded text-sm",children:e.title||`Материал ${s+1}`},s)),e.materials.length>3&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["И еще ",e.materials.length-3," материалов..."]})]})]}),(null==e?void 0:e.messages)&&e.messages.length>0&&a.jsxs(Fa,{className:"p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(Ns,{className:"w-5 h-5"}),a.jsx("h3",{className:"font-semibold",children:"Сообщения (кэшированные)"}),a.jsx(Ya,{variant:"secondary",children:"Офлайн"})]}),a.jsxs("div",{className:"space-y-2",children:[e.messages.slice(0,3).map((e,s)=>a.jsxs("div",{className:"p-2 bg-muted rounded text-sm",children:[a.jsx("div",{className:"font-medium",children:e.sender_name||"Пользователь"}),a.jsx("div",{className:"text-muted-foreground",children:e.content})]},s)),e.messages.length>3&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["И еще ",e.messages.length-3," сообщений..."]})]})]}),(null==e?void 0:e.reports)&&e.reports.length>0&&a.jsxs(Fa,{className:"p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(Je,{className:"w-5 h-5"}),a.jsx("h3",{className:"font-semibold",children:"Отчеты (кэшированные)"}),a.jsx(Ya,{variant:"secondary",children:"Офлайн"})]}),a.jsxs("div",{className:"space-y-2",children:[e.reports.slice(0,3).map((e,s)=>a.jsxs("div",{className:"p-2 bg-muted rounded text-sm",children:[a.jsx("div",{className:"font-medium",children:e.student_name||`Отчет ${s+1}`}),a.jsx("div",{className:"text-muted-foreground",children:e.created_at})]},s)),e.reports.length>3&&a.jsxs("p",{className:"text-xs text-muted-foreground",children:["И еще ",e.reports.length-3," отчетов..."]})]})]}),(!e||0===Object.keys(e).length)&&a.jsx(Fa,{className:"p-8 text-center",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(Se,{className:"w-12 h-12 text-muted-foreground mx-auto"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold",children:"Нет кэшированных данных"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Восстановите подключение к интернету для загрузки данных"})]})]})})]}),ao={createLesson:async e=>{const s=await Sa.post("/scheduling/lessons/",e);if(s.error)throw new Error(s.error);return s.data},getLessons:async e=>{const s=await Sa.get("/scheduling/lessons/",{params:e});if(s.error)throw new Error(s.error);const t=s.data;return Array.isArray(t)?t:t.results},getLesson:async e=>{const s=await Sa.get(`/scheduling/lessons/${e}/`);if(s.error)throw new Error(s.error);return s.data},updateLesson:async(e,s)=>{const t=await Sa.patch(`/scheduling/lessons/${e}/`,s);if(t.error)throw new Error(t.error);return t.data},deleteLesson:async e=>{const s=await Sa.delete(`/scheduling/lessons/${e}/`);if(s.error)throw new Error(s.error)},getMySchedule:async e=>{const s=await Sa.get("/scheduling/lessons/my-schedule/",{params:e});if(s.error)throw new Error(s.error);const t=s.data;return Array.isArray(t)?t:t.results},getStudentSchedule:async(e,s)=>{const t=parseInt(e,10);if(isNaN(t))throw new Error(`Invalid studentId: ${e}. Expected a numeric value.`);const a=await Sa.get(`/scheduling/tutor/students/${t}/schedule/`,{params:s});if(a.error)throw new Error(a.error);const r=a.data;return r&&"object"==typeof r&&"lessons"in r?r.lessons.map(s=>{var t,a;return{id:s.id,teacher:s.teacher_id,student:e,subject:s.subject_id,teacher_id:s.teacher_id,subject_id:s.subject_id,teacher_name:s.teacher_name||"",subject_name:s.subject_name||"",date:s.date,start_time:s.start_time,end_time:s.end_time,status:s.status,description:s.description||"",telemost_link:s.telemost_link||"",created_at:s.created_at||(new Date).toISOString(),updated_at:s.updated_at||(new Date).toISOString(),is_upcoming:null!=(t=s.is_upcoming)&&t,can_cancel:null!=(a=s.can_cancel)&&a,datetime_start:s.datetime_start||`${s.date}T${s.start_time}`,datetime_end:s.datetime_end||`${s.date}T${s.end_time}`}}):[]},getUpcomingLessons:async(e=10)=>{const s=await Sa.get("/scheduling/lessons/upcoming/",{params:{limit:e}});if(s.error)throw new Error(s.error);const t=s.data;return Array.isArray(t)?t:t.results},getParentChildSchedule:async(e,s)=>{const t=parseInt(e,10);if(isNaN(t))throw new Error(`Invalid childId: ${e}. Expected a numeric value.`);const a=await Sa.get(`/scheduling/parent/children/${t}/schedule/`,{params:s});if(a.error)throw new Error(a.error);const r=a.data;return r&&"object"==typeof r&&"lessons"in r?{student:r.student,lessons:r.lessons.map(s=>{var t,a;return{id:s.id,teacher:s.teacher_id,student:e,subject:s.subject_id,teacher_id:s.teacher_id,subject_id:s.subject_id,teacher_name:s.teacher_name||"",subject_name:s.subject_name||"",date:s.date,start_time:s.start_time,end_time:s.end_time,status:s.status,description:s.description||"",telemost_link:s.telemost_link||"",created_at:s.created_at||(new Date).toISOString(),updated_at:s.updated_at||(new Date).toISOString(),is_upcoming:null!=(t=s.is_upcoming)&&t,can_cancel:null!=(a=s.can_cancel)&&a,datetime_start:s.datetime_start||`${s.date}T${s.start_time}`,datetime_end:s.datetime_end||`${s.date}T${s.end_time}`}}),total_lessons:r.total_lessons}:{student:{id:e,name:"",email:""},lessons:[],total_lessons:0}},getParentAllSchedules:async()=>{const e=await Sa.get("/scheduling/parent/schedule/");if(e.error)throw new Error(e.error);const s=e.data;return s&&"object"==typeof s&&"children"in s?{children:s.children.map(e=>({id:e.id,name:e.name,lessons:e.lessons.map(s=>{var t,a;return{id:s.id,teacher:s.teacher_id,student:e.id,subject:s.subject_id,teacher_id:s.teacher_id,subject_id:s.subject_id,teacher_name:s.teacher_name||"",subject_name:s.subject_name||"",date:s.date,start_time:s.start_time,end_time:s.end_time,status:s.status,description:s.description||"",telemost_link:s.telemost_link||"",created_at:s.created_at||(new Date).toISOString(),updated_at:s.updated_at||(new Date).toISOString(),is_upcoming:null!=(t=s.is_upcoming)&&t,can_cancel:null!=(a=s.can_cancel)&&a,datetime_start:s.datetime_start||`${s.date}T${s.start_time}`,datetime_end:s.datetime_end||`${s.date}T${s.end_time}`}})})),total_children:s.total_children}:{children:[],total_children:0}}},ro=e=>{const s=ct({queryKey:["lessons","student",null==e?void 0:e.date_from,null==e?void 0:e.date_to,null==e?void 0:e.subject,null==e?void 0:e.status],queryFn:async()=>{try{return await ao.getMySchedule(e)}catch(s){throw la.error("Error fetching student schedule:",s),s}},retry:1,staleTime:6e4,refetchOnMount:!0,refetchOnWindowFocus:!1}),a=t.useMemo(()=>{const e=new Map;return(s.data||[]).forEach(s=>{const t=s.subject_name||s.subject||"unknown";e.has(t)||e.set(t,[]),e.get(t).push(s)}),Object.fromEntries(e)},[s.data]),r=t.useMemo(()=>(s.data||[]).filter(e=>e.is_upcoming),[s.data]);return{lessons:s.data||[],lessonsBySubject:a,upcomingLessons:r,isLoading:s.isLoading,error:s.error}};const no=({datetime_start:e})=>{const s=new Date(e),{timeLeft:r,isUrgent:n,isStartingNow:i}=function(e){const[s,a]=t.useState(new Date);t.useEffect(()=>{const e=setInterval(()=>{a(new Date)},1e3);return()=>clearInterval(e)},[]);const r=Zs(e,s);if(r<=0)return{timeLeft:"Начинается сейчас!",isUrgent:!1,isStartingNow:!0,totalSeconds:0};const n=et(e,s),i=st(e,s),l=tt(e,s);let o="";var c;return o=n>0?`Через ${n} ${c=n,1===c?"день":c>=2&&c<=4?"дня":"дней"}`:i>0?`Через ${i} ${function(e){return 1===e||21===e?"час":e>=2&&e<=4||e>=22&&e<=24?"часа":"часов"}(i)}`:`Через ${l} ${function(e){return 1===e||21===e||31===e||41===e||51===e?"минуту":e>=2&&e<=4||e>=22&&e<=24||e>=32&&e<=34||e>=42&&e<=44||e>=52&&e<=54?"минуты":"минут"}(l)}`,{timeLeft:o,isUrgent:i<1,isStartingNow:!1,totalSeconds:r}}(s);return a.jsx("div",{className:"text-lg font-bold "+(n?"text-destructive":i?"text-green-600":"text-foreground"),children:r})},io=()=>{const e=xt(),{upcomingLessons:s,isLoading:t}=ro(),r=s.slice(0,3),n=r[0];return t?a.jsxs(Fa,{children:[a.jsxs(Ma,{children:[a.jsx(Fr,{className:"h-6 w-48"}),a.jsx(Fr,{className:"h-4 w-64 mt-2"})]}),a.jsxs(Va,{className:"space-y-4",children:[a.jsx(Fr,{className:"h-24 w-full"}),a.jsx(Fr,{className:"h-20 w-full"}),a.jsx(Fr,{className:"h-20 w-full"})]})]}):a.jsxs(Fa,{children:[a.jsx(Ma,{children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{children:[a.jsxs($a,{className:"flex items-center gap-2",children:[a.jsx(Le,{className:"w-5 h-5 text-primary"}),"Мои занятия"]}),a.jsx(Ua,{children:"Расписание уроков"})]})})}),a.jsxs(Va,{className:"space-y-6",children:[n?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"gradient-primary p-4 rounded-lg text-primary-foreground",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold mb-1",children:"Следующий урок"}),a.jsx(no,{datetime_start:n.datetime_start})]}),a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Fn,{className:"w-10 h-10",children:a.jsx($n,{className:"bg-primary-foreground/20 text-primary-foreground text-xs font-bold",children:n.teacher_name.split(" ").map(e=>e[0]).join("").toUpperCase()})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-semibold text-sm",children:n.teacher_name}),a.jsx("div",{className:"text-xs text-primary-foreground/80",children:n.subject_name}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-primary-foreground/80 mt-1",children:[a.jsx(Le,{className:"w-3 h-3"}),ls(new Date(n.date),"d MMMM",{locale:os}),a.jsx(cs,{className:"w-3 h-3 ml-1"}),n.start_time.slice(0,5)," - ",n.end_time.slice(0,5)]})]})]}),n.telemost_link&&a.jsx(Ba,{type:"button",asChild:!0,variant:"secondary",className:"w-full text-sm",children:a.jsxs("a",{href:n.telemost_link,target:"_blank",rel:"noopener noreferrer",children:[a.jsx(ds,{className:"w-4 h-4 mr-2"}),"Присоединиться к уроку"]})})]})}),r.length>1&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("h4",{className:"font-semibold text-sm text-foreground",children:"Предстоящие занятия"}),a.jsx("div",{className:"space-y-2",children:r.slice(1).map(e=>a.jsx("div",{className:"p-3 bg-muted rounded-lg hover:bg-muted/80 transition-colors",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Fn,{className:"w-8 h-8 flex-shrink-0",children:a.jsx($n,{className:"text-xs text-muted-foreground",children:e.teacher_name.split(" ").map(e=>e[0]).join("").toUpperCase()})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-sm truncate",children:e.teacher_name}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-0.5",children:[a.jsx("span",{children:ls(new Date(e.date),"d MMM",{locale:os})}),a.jsx("span",{children:"•"}),a.jsx("span",{children:e.start_time.slice(0,5)}),a.jsx("span",{children:"•"}),a.jsx("span",{children:e.subject_name})]})]})]})},e.id))})]})]}):a.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[a.jsx(Le,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),a.jsx("p",{className:"text-sm font-medium",children:"Нет предстоящих занятий"}),a.jsx("p",{className:"text-xs mt-1 text-muted-foreground/80",children:"Обратитесь к преподавателю для планирования уроков"})]}),a.jsxs(Ba,{type:"button",variant:"outline",className:"w-full",onClick:()=>e("/dashboard/student/schedule"),children:["Посмотреть расписание",a.jsx(at,{className:"w-4 h-4 ml-2"})]})]})]})},lo=()=>{var e,s,r,n,i,l,o,c,d,u,m,h,x,p,g,f;const{user:j,signOut:v}=qa(),y=xt();Ht(),tr(),sr(),ir();const b=(()=>{const[e,s]=t.useState({isOnline:navigator.onLine,retryCount:0});return t.useEffect(()=>{const e=()=>{s(e=>({...e,isOnline:!0,retryCount:0,lastSeen:new Date}))},t=()=>{s(e=>({...e,isOnline:!1}))};return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),e})(),{data:N,isLoading:w,error:_,refetch:S}=ct({queryKey:["student-dashboard"],queryFn:async()=>{const e=await Sa.getStudentDashboard();if(e.error)throw new Error(e.error);return e.data},staleTime:6e4,refetchOnWindowFocus:!0,refetchOnMount:!0}),{profileData:k,isLoading:C,error:E,refetch:T}=Ia(),R=(null==_?void 0:_.message)||null;return a.jsx(Ur,{children:a.jsxs("div",{className:"flex min-h-screen w-full",children:[a.jsx(so,{}),a.jsxs(Hr,{children:[a.jsxs("header",{className:"sticky top-0 z-10 flex h-16 items-center gap-4 border-b bg-background px-6",children:[a.jsx(Wr,{}),a.jsx("div",{className:"flex-1"})]}),a.jsx("main",{className:"px-6 pb-6 pt-4",children:a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-3xl font-bold",children:["Привет, ",(null==j?void 0:j.first_name)||"Студент","! 👋"]}),a.jsx("p",{className:"text-muted-foreground",children:"Продолжай двигаться к своей цели"})]}),C?a.jsx(Fa,{className:"p-6",children:a.jsxs("div",{className:"space-y-4",children:[a.jsx(Fr,{className:"h-24 w-24 rounded-full"}),a.jsx(Fr,{className:"h-8 w-1/3"}),a.jsx(Fr,{className:"h-4 w-1/2"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(Fr,{className:"h-4 w-full"}),a.jsx(Fr,{className:"h-4 w-5/6"})]})]})}):E?a.jsx(Ml,{title:"Не удалось загрузить профиль",description:E.message||"Произошла ошибка при загрузке данных профиля. Попробуйте ещё раз.",onRetry:()=>{T()}}):(null==k?void 0:k.user)?a.jsx(Yl,{userName:k.user.full_name||k.user.email,userEmail:k.user.email,userRole:"student",profileData:{grade:k.user.grade||"Не указан",learningGoal:k.user.learning_goal||"Не указана",progressPercentage:null!=(s=null==(e=null==N?void 0:N.progress_statistics)?void 0:e.completion_percentage)?s:0,subjectsCount:Object.keys((null==N?void 0:N.materials_by_subject)||{}).length||0},onEdit:()=>{y("/profile/student")}}):null,!b.isOnline&&a.jsx(to,{cachedData:N?{materials:Object.values(N.materials_by_subject||{}).flatMap(e=>e.materials),reports:N.recent_activity||[]}:void 0,onRetry:S}),a.jsx(Ul,{isLoading:w,error:R,onRetry:S,children:N&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[a.jsxs(Fa,{className:"p-6 gradient-primary text-primary-foreground shadow-glow lg:col-span-2",children:[a.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-primary-foreground/20 rounded-full flex items-center justify-center",children:a.jsx(Hs,{className:"w-6 h-6"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-xl font-bold",children:"Твой прогресс"}),a.jsx("p",{className:"text-primary-foreground/80",children:"Продолжай двигаться к цели"})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsxs("span",{children:["Выполнено материалов: ",null!=(n=null==(r=N.progress_statistics)?void 0:r.completed_materials)?n:0," из ",null!=(l=null==(i=N.progress_statistics)?void 0:i.total_materials)?l:0]}),a.jsxs("span",{className:"font-bold",children:[null!=(c=null==(o=N.progress_statistics)?void 0:o.completion_percentage)?c:0,"%"]})]}),a.jsx(Zl,{value:null!=(u=null==(d=N.progress_statistics)?void 0:d.completion_percentage)?u:0,className:"h-3 bg-primary-foreground/20"})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold",children:null!=(h=null==(m=N.progress_statistics)?void 0:m.completed_materials)?h:0}),a.jsx("div",{className:"text-sm text-primary-foreground/80",children:"Завершено"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold",children:null!=(p=null==(x=N.progress_statistics)?void 0:x.in_progress_materials)?p:0}),a.jsx("div",{className:"text-sm text-primary-foreground/80",children:"В процессе"})]}),a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(null!=(f=null==(g=N.progress_statistics)?void 0:g.average_progress)?f:0),"%"]}),a.jsx("div",{className:"text-sm text-primary-foreground/80",children:"Средний прогресс"})]})]})]}),a.jsx("div",{className:"lg:col-span-1",children:a.jsx(io,{})})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs(Fa,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(Xe,{className:"w-5 h-5 text-primary"}),a.jsx("h3",{className:"text-xl font-bold",children:"Текущие материалы"})]}),a.jsxs("div",{className:"space-y-3",children:[Object.values((null==N?void 0:N.materials_by_subject)||{}).flatMap(e=>e.materials).slice(0,3).map(e=>{var s,t,r,n,i,l,o,c,d,u,m,h;return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg hover:bg-muted/80 transition-colors cursor-pointer",onClick:()=>{return s=e.id,void y(`/dashboard/student/materials/${s}`);var s},children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",children:e.title}),a.jsx("div",{className:"text-sm text-muted-foreground",children:e.description||"Без описания"}),(null!=(t=null==(s=e.progress)?void 0:s.progress_percentage)?t:0)>0&&a.jsxs("div",{className:"mt-1",children:[a.jsx(Zl,{value:null!=(n=null==(r=e.progress)?void 0:r.progress_percentage)?n:0,className:"h-2"}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:[null!=(l=null==(i=e.progress)?void 0:i.progress_percentage)?l:0,"% завершено"]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:["file"===e.type&&a.jsx(ds,{className:"w-4 h-4 text-muted-foreground"}),a.jsx(Ya,{variant:(null==(o=e.progress)?void 0:o.is_completed)?"default":(null!=(d=null==(c=e.progress)?void 0:c.progress_percentage)?d:0)>0?"secondary":"outline",children:(null==(u=e.progress)?void 0:u.is_completed)?"Завершено":(null!=(h=null==(m=e.progress)?void 0:m.progress_percentage)?h:0)>0?"В процессе":"Не начато"})]})]},e.id)}),0===Object.values((null==N?void 0:N.materials_by_subject)||{}).flatMap(e=>e.materials).length&&a.jsx($l,{title:"Нет доступных материалов",description:"Пока нет материалов для изучения. Обратитесь к преподавателю.",icon:a.jsx(Xe,{className:"w-8 h-8 text-muted-foreground"})})]}),a.jsx(Ba,{type:"button",variant:"outline",className:"w-full mt-4",onClick:()=>y("/dashboard/student/materials"),children:"Смотреть все материалы"})]}),a.jsxs(Fa,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(Xe,{className:"w-5 h-5 text-primary"}),a.jsx("h3",{className:"text-xl font-bold",children:"Мои предметы"}),a.jsx(Ya,{variant:"secondary",className:"ml-auto",children:Object.keys((null==N?void 0:N.materials_by_subject)||{}).length})]}),w?a.jsx("div",{children:"Загрузка..."}):a.jsxs("div",{className:"space-y-3",children:[Object.values((null==N?void 0:N.materials_by_subject)||{}).map(e=>{var s;return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:e.subject_info.name}),a.jsxs("div",{className:"text-sm text-muted-foreground",children:["Преподаватель: ",(null==(s=e.subject_info.teacher)?void 0:s.full_name)||"Не назначен"]}),a.jsxs("div",{className:"text-xs text-muted-foreground",children:["Материалов: ",e.materials.length]})]}),a.jsx(Ba,{type:"button",size:"sm",onClick:()=>y(`/dashboard/student/materials?subject=${e.subject_info.id}`),children:"Материалы"})]},e.subject_info.id)}),0===Object.keys((null==N?void 0:N.materials_by_subject)||{}).length&&a.jsx($l,{title:"Нет назначенных предметов",description:"Обратитесь к тьютору для назначения предметов.",icon:a.jsx(Xe,{className:"w-8 h-8 text-muted-foreground"})})]})]})]}),a.jsxs(Fa,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx(We,{className:"w-5 h-5 text-primary"}),a.jsx("h3",{className:"text-xl font-bold",children:"Последние задания"})]}),a.jsxs("div",{className:"space-y-3",children:[((null==N?void 0:N.recent_activity)||[]).slice(0,3).map(e=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",children:e.title}),a.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[a.jsx(cs,{className:"w-3 h-3"}),e.deadline]})]}),a.jsx(Ya,{variant:"completed"===e.status?"default":"overdue"===e.status?"destructive":"outline",children:"completed"===e.status?"Выполнено":"overdue"===e.status?"Просрочено":"В процессе"})]},e.id)),0===((null==N?void 0:N.recent_activity)||[]).length&&a.jsx($l,{title:"Нет активных заданий",description:"Пока нет заданий для выполнения. Ожидайте новых заданий от преподавателя.",icon:a.jsx(We,{className:"w-8 h-8 text-muted-foreground"})})]})]}),a.jsxs(Fa,{className:"p-6",children:[a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Быстрые действия"}),a.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>y("/dashboard/student/materials"),children:[a.jsx(Xe,{className:"w-6 h-6"}),a.jsx("span",{children:"Материалы"})]}),a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>y("/dashboard/student/forum"),children:[a.jsx(qe,{className:"w-6 h-6"}),a.jsx("span",{children:"Форум"})]}),a.jsxs(Ba,{type:"button",variant:"outline",className:"h-auto flex-col gap-2 py-6",onClick:()=>y("/dashboard/student/chat"),children:[a.jsx(qe,{className:"w-6 h-6"}),a.jsx("span",{children:"Сообщения"})]})]})]})]})})]})})]})]})})},oo=t.lazy(()=>zt(()=>import("./PaymentHistory-BlYakbKD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),co=t.lazy(()=>zt(()=>import("./PaymentSuccess-lya934BX.js"),__vite__mapDeps([10,1,2,3,4,5,8,7,9]))),uo=t.lazy(()=>zt(()=>import("./InvoicesPage-DPR4hTjd.js"),__vite__mapDeps([11,1,2,3,4,5,8,12,6,7,9]))),mo=t.lazy(()=>zt(()=>import("./TeacherDashboard-BQRpF3j6.js"),__vite__mapDeps([13,1,14,2,3,4,5,15,8,16,17,7,9]))),ho=t.lazy(()=>zt(()=>import("./TutorDashboard-CkfTILMk.js"),__vite__mapDeps([18,1,19,2,3,4,5,20,8,7,9]))),xo=t.lazy(()=>zt(()=>import("./Materials-BJzALYrl.js"),__vite__mapDeps([21,1,4,3,5,22,7,8,2,9]))),po=t.lazy(()=>zt(()=>import("./Subjects-DzuBabfw.js"),__vite__mapDeps([23,1,4,3,5,7,8,2,9]))),go=t.lazy(()=>zt(()=>import("./Assignments-B_8OJyS3.js"),__vite__mapDeps([24,1,25,8,4,3,5,26,2,7,9]))),fo=t.lazy(()=>zt(()=>import("./Materials-D7ay7HrY.js"),__vite__mapDeps([27,1,14,2,3,4,5,7,8,9]))),jo=t.lazy(()=>zt(()=>import("./CreateMaterial-Co0RYYVw.js"),__vite__mapDeps([28,1,14,2,3,4,5,7,8,9]))),vo=t.lazy(()=>zt(()=>import("./Reports-Bf9XxZmE.js"),__vite__mapDeps([29,1,14,2,3,4,5,30,31,7,8,9]))),yo=t.lazy(()=>zt(()=>import("./StudyPlans-Byi1NlvE.js"),__vite__mapDeps([32,1,14,2,3,4,5,22,7,8,9]))),bo=t.lazy(()=>zt(()=>import("./Submissions-CGlMBFcK.js"),__vite__mapDeps([33,1,15,8,4,3,5,16,14,2,22,7,9]))),No=t.lazy(()=>zt(()=>import("./AssignSubject-Cp1yglSn.js"),__vite__mapDeps([34,1,14,2,3,4,5,7,8,9]))),wo=t.lazy(()=>zt(()=>import("./Assignments-BbfLJGzg.js"),__vite__mapDeps([35,1,14,2,3,4,5,25,8,26,15,16,7,9]))),_o=t.lazy(()=>zt(()=>import("./TeacherStudyPlanGeneratorPage-DphgSch0.js"),__vite__mapDeps([36,1,14,2,3,4,5,15,8,16,7,9]))),So=t.lazy(()=>zt(()=>import("./Reports-DcY-gmQE.js"),__vite__mapDeps([37,1,19,2,3,4,5,30,31,7,8,9]))),ko=t.lazy(()=>zt(()=>import("./Students-QBA9p8He.js"),__vite__mapDeps([38,1,19,2,3,4,5,20,8,39,7,40,41,9]))),Co=t.lazy(()=>zt(()=>import("./InvoicesPage-Dt4qnN7c.js"),__vite__mapDeps([42,1,19,2,3,4,5,8,12,7,9]))),Eo=t.lazy(()=>zt(()=>import("./Children-BFhUTNud.js"),__vite__mapDeps([43,1,2,3,4,5,7,8,9]))),To=t.lazy(()=>zt(()=>import("./ChildDetail-D7_rlWq0.js"),__vite__mapDeps([44,1,2,3,4,5,7,8,9]))),Ro=t.lazy(()=>zt(()=>import("./Statistics-UhcEGwif.js"),__vite__mapDeps([45,1,4,3,5,7,8,2,9]))),Ao=t.lazy(()=>zt(()=>import("./Reports-5dZrw0qD.js"),__vite__mapDeps([46,1,30,4,3,5,7,8,2,9])));t.lazy(()=>zt(()=>import("./Chat-BM0ORLG-.js"),__vite__mapDeps([47,1,4,3,5,7,8,2,9])));const Po=t.lazy(()=>zt(()=>import("./StudentSchedulePage-BSS44VZ7.js"),__vite__mapDeps([48,1,41,4,3,5,7,8,2,9]))),Lo=t.lazy(()=>zt(()=>import("./TeacherSchedulePage-CVkLN_K2.js"),__vite__mapDeps([49,1,14,2,3,4,5,15,8,16,17,7,9]))),qo=t.lazy(()=>zt(()=>import("./TutorSchedulePage-DcnzHVOA.js"),__vite__mapDeps([50,1,19,2,3,4,5,20,8,40,41,7,9]))),Io=t.lazy(()=>zt(()=>import("./ParentSchedulePage-0YcKatx-.js"),__vite__mapDeps([51,1,8,4,3,5,41,2,7,9]))),zo=t.lazy(()=>zt(()=>import("./Forum-BDZdA2sq.js"),__vite__mapDeps([52,1,8,4,3,5,53,14,2,19,7,9]))),Do=t.lazy(()=>zt(()=>import("./ChatPage-BcvF6_Nh.js"),__vite__mapDeps([54,1,55,4,3,5,8,53,2,7,9])).then(e=>({default:e.StudentChatPage}))),Oo=t.lazy(()=>zt(()=>import("./ChatPage-DXyhRqkh.js"),__vite__mapDeps([56,1,14,2,3,4,5,55,8,53,7,9])).then(e=>({default:e.TeacherChatPage}))),Fo=t.lazy(()=>zt(()=>import("./ChatPage-Dq0u1oYF.js"),__vite__mapDeps([57,1,55,4,3,5,8,53,2,7,9])).then(e=>({default:e.ParentChatPage}))),Mo=t.lazy(()=>zt(()=>import("./ChatPage-B2jj5Zny.js"),__vite__mapDeps([58,1,19,2,3,4,5,55,8,53,7,9])).then(e=>({default:e.TutorChatPage}))),$o=t.lazy(()=>zt(()=>import("./LessonViewer-Cdt-Ha3a.js"),__vite__mapDeps([59,1,8,4,3,5,39,7,2,9]))),Uo=t.lazy(()=>zt(()=>import("./LessonViewerPage-vtmAVHqk.js"),__vite__mapDeps([60,1,8,4,3,5,61,39,7,2,9]))),Vo=t.lazy(()=>zt(()=>import("./KnowledgeGraphPage-DoAfbWoo.js"),__vite__mapDeps([62,1,8,4,3,5,61,63,2,7,9]))),Wo=t.lazy(()=>zt(()=>import("./ContentCreatorPage-CyNiP1Dy.js"),__vite__mapDeps([64,1,14,2,3,4,5,8,65,26,39,7,16,9]))),Ho=t.lazy(()=>zt(()=>import("./LessonCreatorPage-CpTBl5kS.js"),__vite__mapDeps([66,1,14,2,3,4,5,8,65,26,7,9]))),Bo=t.lazy(()=>zt(()=>import("./GraphEditorPage-MewfKlxG.js"),__vite__mapDeps([67,1,14,2,3,4,5,8,61,63,15,16,7,9]))),Xo=t.lazy(()=>zt(()=>import("./ProgressViewerPage-D2UF32Gt.js"),__vite__mapDeps([68,1,14,2,3,4,5,8,15,16,7,9]))),Jo=t.lazy(()=>zt(()=>import("./ProfilePage-D_c_VkXW.js"),__vite__mapDeps([69,1,4,3,5,70,8,2,7,9]))),Ko=t.lazy(()=>zt(()=>import("./StudentProfilePage-C76N9EHw.js"),__vite__mapDeps([71,1,8,4,3,5,70,2,7,9]))),Go=t.lazy(()=>zt(()=>import("./TeacherProfilePage-BSJhvSQB.js"),__vite__mapDeps([72,1,8,4,3,5,70,2,7,9]))),Yo=t.lazy(()=>zt(()=>import("./TutorProfilePage-BSRYgDCn.js"),__vite__mapDeps([73,1,8,4,3,5,70,2,7,9]))),Qo=t.lazy(()=>zt(()=>import("./ParentProfilePage-CxFsU2g1.js"),__vite__mapDeps([74,1,8,4,3,5,70,2,7,9]))),Zo=t.lazy(()=>zt(()=>import("./NotificationSettings-DpqmDCHd.js"),__vite__mapDeps([75,1,4,3,5,2,7,8,9]))),ec=()=>{const{user:e,isLoading:s}=qa();if(s)return a.jsx(lr,{size:"lg",text:"Загрузка..."});if(!e)return a.jsx(mt,{to:"/auth/signin",replace:!0});switch(e.role){case"student":return a.jsx(mt,{to:"/dashboard/student",replace:!0});case"teacher":return a.jsx(mt,{to:"/dashboard/teacher",replace:!0});case"tutor":return a.jsx(mt,{to:"/dashboard/tutor",replace:!0});case"parent":return a.jsx(mt,{to:"/dashboard/parent",replace:!0});default:return e.is_staff?a.jsx(mt,{to:"/admin/monitoring",replace:!0}):a.jsx(mt,{to:"/auth/signin",replace:!0})}},sc=()=>{const{user:e,isLoading:s}=qa();if(s)return a.jsx(lr,{size:"lg",text:"Загрузка..."});if(!e)return a.jsx(mt,{to:"/auth/signin",replace:!0});switch(e.role){case"student":return a.jsx(mt,{to:"/dashboard/student/assignments",replace:!0});case"teacher":return a.jsx(mt,{to:"/dashboard/teacher/assignments",replace:!0});default:return a.jsx(mt,{to:"/dashboard",replace:!0})}},tc=({children:e})=>{const s=xt();return t.useEffect(()=>{!function(e,s){Cr=e,Er=s}(Aa,s)},[s]),a.jsx(a.Fragment,{children:e})},ac=new rt({defaultOptions:{queries:{staleTime:6e4,gcTime:3e5,retry:2,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!0},mutations:{retry:1}}}),rc=()=>a.jsx(nr,{children:a.jsx(ut,{client:ac,children:a.jsx(La,{children:a.jsxs(ta,{children:[a.jsx(ea,{}),a.jsx(sa,{}),a.jsx(kr,{}),a.jsx(vt,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:a.jsx(tc,{children:a.jsxs(yt,{children:[a.jsx(bt,{path:"/",element:a.jsx(ul,{})}),a.jsx(bt,{path:"/auth",element:a.jsx(mt,{to:"/auth/signin",replace:!0})}),a.jsx(bt,{path:"/auth/signin",element:a.jsx(pl,{})}),a.jsx(bt,{path:"/auth/signup",element:a.jsx(mt,{to:"/application",replace:!0})}),a.jsx(bt,{path:"/application",element:a.jsx(fl,{})}),a.jsx(bt,{path:"/application-status/:trackingToken",element:a.jsx(jl,{})}),a.jsxs(bt,{path:"/admin",element:a.jsx(or,{children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(nn,{})})}),children:[a.jsx(bt,{index:!0,element:a.jsx(mt,{to:"/admin/monitoring",replace:!0})}),a.jsx(bt,{path:"monitoring",element:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(yi,{})})}),a.jsx(bt,{path:"accounts",element:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(ni,{})})}),a.jsx(bt,{path:"staff",element:a.jsx(mt,{to:"/admin/accounts?tab=staff",replace:!0})}),a.jsx(bt,{path:"schedule",element:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(di,{})})}),a.jsx(bt,{path:"chats",element:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(gi,{})})}),a.jsx(bt,{path:"broadcasts",element:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(vi,{})})}),a.jsx(bt,{path:"notifications",element:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Ti,{})})}),a.jsx(bt,{path:"notification-templates",element:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Vi,{})})}),a.jsx(bt,{path:"settings",element:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(ll,{})})}),a.jsx(bt,{path:"system-monitoring",element:a.jsx(mt,{to:"/admin/monitoring",replace:!0})}),a.jsx(bt,{path:"account-management",element:a.jsx(mt,{to:"/admin/accounts",replace:!0})}),a.jsx(bt,{path:"audit",element:a.jsx(mt,{to:"/admin/monitoring",replace:!0})}),a.jsx(bt,{path:"jobs",element:a.jsx(mt,{to:"/admin/monitoring",replace:!0})})]}),a.jsx(bt,{path:"/dashboard",element:a.jsx(ec,{})}),a.jsx(bt,{path:"/dashboard/assignments",element:a.jsx(sc,{})}),a.jsx(bt,{path:"/dashboard/student",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(lo,{})})}),a.jsx(bt,{path:"/dashboard/student/subjects",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(po,{})})})}),a.jsx(bt,{path:"/dashboard/student/materials",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(xo,{})})})}),a.jsx(bt,{path:"/dashboard/student/schedule",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Po,{})})})}),a.jsx(bt,{path:"/dashboard/student/forum",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(zo,{})})})}),a.jsx(bt,{path:"/dashboard/student/chat",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Do,{})})})}),a.jsx(bt,{path:"/dashboard/student/assignments",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(go,{})})})}),a.jsx(bt,{path:"/dashboard/student/knowledge-graph",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Vo,{})})})}),a.jsx(bt,{path:"/dashboard/student/lesson/:lessonId",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Uo,{})})})}),a.jsx(bt,{path:"/dashboard/student/knowledge-graph/:graphId/lesson/:lessonId",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx($o,{})})})}),a.jsx(bt,{path:"/dashboard/teacher",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(mo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/materials",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(fo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/materials/create",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(jo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/reports",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(vo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/study-plans",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(yo,{})})})}),a.jsx(bt,{path:"/teacher/reports",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(vo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/submissions/pending",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(bo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/assign-subject",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(No,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/schedule",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Lo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/forum",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(zo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/chat",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Oo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/assignments",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(wo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/study-plan-generator",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(_o,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/content-creator",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Wo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/lesson-creator",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Ho,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/lesson-creator/:lessonId",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Ho,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/graph-editor",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Bo,{})})})}),a.jsx(bt,{path:"/dashboard/teacher/progress",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Xo,{})})})}),a.jsx(bt,{path:"/dashboard/tutor",element:a.jsx(Oa,{requiredRole:"tutor",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(ho,{})})})}),a.jsx(bt,{path:"/dashboard/tutor/students",element:a.jsx(Oa,{requiredRole:"tutor",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(ko,{})})})}),a.jsx(bt,{path:"/dashboard/tutor/reports",element:a.jsx(Oa,{requiredRole:"tutor",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(So,{})})})}),a.jsx(bt,{path:"/dashboard/tutor/forum",element:a.jsx(Oa,{requiredRole:"tutor",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(zo,{})})})}),a.jsx(bt,{path:"/dashboard/tutor/chat",element:a.jsx(Oa,{requiredRole:"tutor",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Mo,{})})})}),a.jsx(bt,{path:"/dashboard/tutor/schedule",element:a.jsx(Oa,{requiredRole:"tutor",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(qo,{})})})}),a.jsx(bt,{path:"/dashboard/tutor/invoices",element:a.jsx(Oa,{requiredRole:"tutor",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Co,{})})})}),a.jsx(bt,{path:"/dashboard/parent",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Ql,{})})})}),a.jsx(bt,{path:"/dashboard/parent/children",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Eo,{})})})}),a.jsx(bt,{path:"/dashboard/parent/children/:id",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(To,{})})})}),a.jsx(bt,{path:"/dashboard/parent/payment-history",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(oo,{})})})}),a.jsx(bt,{path:"/dashboard/parent/payment-success",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(co,{})})})}),a.jsx(bt,{path:"/dashboard/parent/invoices",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(uo,{})})})}),a.jsx(bt,{path:"/dashboard/parent/statistics",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Ro,{})})})}),a.jsx(bt,{path:"/dashboard/parent/reports",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Ao,{})})})}),a.jsx(bt,{path:"/dashboard/parent/forum",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(zo,{})})})}),a.jsx(bt,{path:"/dashboard/parent/chat",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Fo,{})})})}),a.jsx(bt,{path:"/dashboard/parent/schedule",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Io,{})})})}),a.jsx(bt,{path:"/profile",element:a.jsx(Oa,{children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Jo,{})})})}),a.jsx(bt,{path:"/profile/student",element:a.jsx(Oa,{requiredRole:"student",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Ko,{})})})}),a.jsx(bt,{path:"/profile/teacher",element:a.jsx(Oa,{requiredRole:"teacher",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Go,{})})})}),a.jsx(bt,{path:"/profile/tutor",element:a.jsx(Oa,{requiredRole:"tutor",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Yo,{})})})}),a.jsx(bt,{path:"/profile/parent",element:a.jsx(Oa,{requiredRole:"parent",children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Qo,{})})})}),a.jsx(bt,{path:"/settings/notifications",element:a.jsx(Oa,{children:a.jsx(t.Suspense,{fallback:a.jsx(lr,{size:"lg"}),children:a.jsx(Zo,{})})})}),a.jsx(bt,{path:"/unauthorized",element:a.jsx(yl,{})}),a.jsx(bt,{path:"*",element:a.jsx(vl,{})})]})})})]})})})}),nc={en:{common:{app:{title:"THE_BOT Educational Platform",description:"Personalized learning platform with real-time communication"},navigation:{dashboard:"Dashboard",materials:"Materials",assignments:"Assignments",chat:"Chat",schedule:"Schedule",reports:"Reports",settings:"Settings",profile:"Profile",admin:"Admin Panel",logout:"Logout",home:"Home"},roles:{student:"Student",teacher:"Teacher",tutor:"Tutor",parent:"Parent",admin:"Administrator"},common:{save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",create:"Create",submit:"Submit",loading:"Loading...",error:"Error",success:"Success",warning:"Warning",info:"Info",confirm:"Confirm",back:"Back",next:"Next",previous:"Previous",search:"Search",filter:"Filter",sort:"Sort",export:"Export",import:"Import",download:"Download",upload:"Upload",close:"Close",open:"Open",settings:"Settings",help:"Help",about:"About",language:"Language",theme:"Theme",light:"Light",dark:"Dark",auto:"Auto",yes:"Yes",no:"No",ok:"OK",more:"More",less:"Less",clear:"Clear",apply:"Apply",reset:"Reset",copy:"Copy",copied:"Copied!",showing:"Showing",of:"of",to:"to",results:"results",noData:"No data available",noResults:"No results found",loading_data:"Loading data...",try_again:"Try Again",go_back:"Go Back"},time:{today:"Today",tomorrow:"Tomorrow",yesterday:"Yesterday",thisWeek:"This Week",lastWeek:"Last Week",thisMonth:"This Month",lastMonth:"Last Month",thisYear:"This Year",lastYear:"Last Year",justNow:"Just now",minutesAgo:"{{count}} minute ago",minutesAgo_plural:"{{count}} minutes ago",hoursAgo:"{{count}} hour ago",hoursAgo_plural:"{{count}} hours ago",daysAgo:"{{count}} day ago",daysAgo_plural:"{{count}} days ago",monthsAgo:"{{count}} month ago",monthsAgo_plural:"{{count}} months ago"},status:{active:"Active",inactive:"Inactive",pending:"Pending",completed:"Completed",failed:"Failed",processing:"Processing",cancelled:"Cancelled",paused:"Paused",in_progress:"In Progress",submitted:"Submitted",graded:"Graded",draft:"Draft",published:"Published",archived:"Archived"},actions:{view:"View",preview:"Preview",download:"Download",share:"Share",print:"Print",archive:"Archive",unarchive:"Unarchive",duplicate:"Duplicate",move:"Move",rename:"Rename",refresh:"Refresh",expand:"Expand",collapse:"Collapse",reply:"Reply",replyAll:"Reply All",forward:"Forward"},pagination:{first:"First",last:"Last",previous:"Previous",next:"Next",page:"Page",itemsPerPage:"Items per page"}},forms:{labels:{email:"Email",password:"Password",confirmPassword:"Confirm Password",firstName:"First Name",lastName:"Last Name",fullName:"Full Name",username:"Username",title:"Title",description:"Description",content:"Content",subject:"Subject",message:"Message",name:"Name",phone:"Phone",address:"Address",city:"City",state:"State",country:"Country",zipCode:"Zip Code",date:"Date",time:"Time",startDate:"Start Date",endDate:"End Date",startTime:"Start Time",endTime:"End Time",file:"File",files:"Files",category:"Category",tag:"Tag",tags:"Tags",status:"Status",priority:"Priority",notes:"Notes",comment:"Comment",comments:"Comments",attachment:"Attachment",attachments:"Attachments"},placeholders:{enterEmail:"Enter your email",enterPassword:"Enter your password",enterFullName:"Enter your full name",enterUsername:"Enter a username",enterTitle:"Enter title",enterDescription:"Enter description",enterContent:"Enter content",enterMessage:"Enter your message",searchPlaceholder:"Search...",selectOption:"Select an option",selectFile:"Select a file",dragDropFile:"Drag and drop a file here or click to select",dragDropFiles:"Drag and drop files here or click to select",typeMessage:"Type a message...",typeComment:"Type a comment..."},hints:{passwordRequirements:"Password must be at least 8 characters with uppercase, lowercase, and numbers",emailFormat:"Please enter a valid email address",phoneFormat:"Please enter a valid phone number",fileSize:"File size must be less than {{size}}MB",fileType:"Allowed file types: {{types}}"},buttons:{submit:"Submit",save:"Save",saveChanges:"Save Changes",cancel:"Cancel",delete:"Delete",deleteConfirm:"Delete this item?",edit:"Edit",create:"Create",createNew:"Create New",update:"Update",send:"Send",reset:"Reset",clear:"Clear",login:"Login",logout:"Logout",register:"Register",signUp:"Sign Up",signIn:"Sign In",forgotPassword:"Forgot Password?",resetPassword:"Reset Password",changePassword:"Change Password",upload:"Upload",browse:"Browse",download:"Download",export:"Export",import:"Import",share:"Share",print:"Print",closeForm:"Close"}},errors:{http:{400:"Bad Request - Invalid input",401:"Unauthorized - Please log in",403:"Forbidden - You don't have permission",404:"Not Found - Resource doesn't exist",409:"Conflict - Resource already exists",413:"Payload Too Large - File is too large",415:"Unsupported Media Type - File format not allowed",429:"Too Many Requests - Please try again later",500:"Server Error - Something went wrong",502:"Bad Gateway - Service unavailable",503:"Service Unavailable - Please try again later",504:"Gateway Timeout - Request took too long"},validation:{required:"This field is required",email:"Please enter a valid email address",password:"Password must be at least 8 characters",passwordMismatch:"Passwords do not match",username:"Username must be 3-20 characters",minLength:"Minimum length is {{min}} characters",maxLength:"Maximum length is {{max}} characters",pattern:"Invalid format",number:"Must be a number",date:"Please enter a valid date",url:"Please enter a valid URL",phone:"Please enter a valid phone number",whitespace:"Cannot contain only whitespace",duplicateEmail:"This email is already registered",duplicateUsername:"This username is already taken"},authentication:{invalidCredentials:"Invalid email or password",accountLocked:"Account locked due to multiple failed login attempts",accountDisabled:"Your account has been disabled",accountNotVerified:"Please verify your email to log in",sessionExpired:"Your session has expired. Please log in again",tokenExpired:"Your authentication token has expired",invalidToken:"Invalid or expired authentication token",unauthorized:"You are not authorized to perform this action",forbidden:"Access denied",requiresLogin:"Please log in to continue"},authorization:{insufficientPermissions:"You do not have permission to perform this action",roleRequired:"This action requires {{role}} role",accountTypeRequired:"This action requires {{accountType}} account type"},form:{submitError:"Error submitting form. Please try again",validationFailed:"Please fix the errors below",requiredFields:"Please fill in all required fields"},upload:{fileRequired:"Please select a file",fileTooLarge:"File is too large. Maximum size is {{size}}MB",invalidFileType:"Invalid file type. Allowed types: {{types}}",uploadFailed:"File upload failed. Please try again",uploadCancelled:"File upload cancelled",virusScanFailed:"File failed security scan",infectiousContent:"File contains potentially harmful content",uploadInProgress:"Upload in progress, please wait..."},network:{noConnection:"No internet connection",connectionError:"Connection error. Please check your internet",timeout:"Request timed out. Please try again",offline:"You are offline. Please check your connection",retrying:"Retrying..."},notFound:{page:"Page not found",resource:"Resource not found",material:"Material not found",assignment:"Assignment not found",user:"User not found",chatRoom:"Chat room not found"},conflict:{alreadyExists:"This resource already exists",alreadySubmitted:"You have already submitted this assignment",alreadyEnrolled:"You are already enrolled in this course"},generic:{somethingWentWrong:"Something went wrong. Please try again",tryAgain:"Please try again",contactSupport:"If the problem persists, please contact support",reportIssue:"Report this issue"}},messages:{success:{saved:"Changes saved successfully",created:"Created successfully",deleted:"Deleted successfully",updated:"Updated successfully",submitted:"Submitted successfully",uploaded:"File uploaded successfully",downloaded:"Downloaded successfully",exported:"Exported successfully",imported:"Imported successfully",copied:"Copied to clipboard",shared:"Shared successfully",emailSent:"Email sent successfully",passwordChanged:"Password changed successfully",profileUpdated:"Profile updated successfully",enrolled:"Enrolled successfully",completed:"Completed successfully"},info:{processing:"Processing...",loading:"Loading...",savingChanges:"Saving changes...",checkingEmail:"Checking email...",verifyingFile:"Verifying file...",noData:"No data available",noResults:"No results found",emptyList:"This list is empty",selectItem:"Please select an item",loadMore:"Load more",showMore:"Show more",showLess:"Show less"},warning:{unsavedChanges:"You have unsaved changes. Are you sure you want to leave?",deleteConfirm:"Are you sure you want to delete this item? This action cannot be undone.",permanentDelete:"This will permanently delete the item. Are you sure?",invalidInput:"Please check your input",expiring:"This will expire soon",expired:"This has expired",expiringSession:"Your session will expire in {{minutes}} minutes",limitReached:"You have reached the limit",quotaExceeded:"Your quota has been exceeded"},notifications:{newMessage:"You have a new message",newMessages:"You have {{count}} new messages",newNotification:"You have a new notification",newNotifications:"You have {{count}} new notifications",assignmentDue:"Assignment due in {{hours}} hours",assignmentOverdue:"Assignment is overdue",classStarting:"Class starting in {{minutes}} minutes",mentionedYou:"{{user}} mentioned you",repliedToYou:"{{user}} replied to you"},confirmation:{delete:"Are you sure you want to delete this?",logout:"Are you sure you want to log out?",clearData:"Are you sure you want to clear all data?",submitAssignment:"Are you sure you want to submit this assignment?",publishMaterial:"Are you sure you want to publish this material?"},prompts:{enterName:"Please enter a name",enterEmail:"Please enter an email",enterMessage:"Please enter a message",selectFile:"Please select a file",selectDate:"Please select a date",selectTime:"Please select a time"}},validation:{email:{required:"Email is required",invalid:"Please enter a valid email address",alreadyExists:"This email is already registered"},password:{required:"Password is required",minLength:"Password must be at least 8 characters long",uppercase:"Password must contain at least one uppercase letter",lowercase:"Password must contain at least one lowercase letter",number:"Password must contain at least one number",special:"Password must contain at least one special character (!@#$%^&*)",mismatch:"Passwords do not match"},username:{required:"Username is required",minLength:"Username must be at least 3 characters",maxLength:"Username must be no more than 20 characters",invalidChars:"Username can only contain letters, numbers, and underscores",alreadyExists:"This username is already taken"},name:{required:"Name is required",minLength:"Name must be at least 2 characters",maxLength:"Name must be no more than 50 characters"},date:{required:"Date is required",invalid:"Please enter a valid date",inPast:"Date cannot be in the past",inFuture:"Date cannot be in the future",afterStart:"End date must be after start date",beforeEnd:"Start date must be before end date"},file:{required:"File is required",tooLarge:"File is too large (max {{size}}MB)",invalidType:"Invalid file type. Allowed: {{types}}",empty:"File is empty",corrupted:"File appears to be corrupted"},form:{required:"This field is required",minLength:"Minimum length is {{min}} characters",maxLength:"Maximum length is {{max}} characters",pattern:"Invalid format",custom:"This field is invalid"},phone:{required:"Phone number is required",invalid:"Please enter a valid phone number"},url:{required:"URL is required",invalid:"Please enter a valid URL"},number:{required:"Number is required",invalid:"Must be a valid number",min:"Must be at least {{min}}",max:"Must be no more than {{max}}"},selection:{required:"Please select an option",minItems:"Please select at least {{min}} items",maxItems:"You can select up to {{max}} items"}}},ru:{common:{app:{title:"THE_BOT Образовательная платформа",description:"Платформа персонализированного обучения с общением в реальном времени"},navigation:{dashboard:"Панель управления",materials:"Материалы",assignments:"Задания",chat:"Чат",schedule:"Расписание",reports:"Отчеты",settings:"Настройки",profile:"Профиль",admin:"Панель администратора",logout:"Выход",home:"Главная"},roles:{student:"Студент",teacher:"Преподаватель",tutor:"Репетитор",parent:"Родитель",admin:"Администратор"},common:{save:"Сохранить",cancel:"Отмена",delete:"Удалить",edit:"Изменить",create:"Создать",submit:"Отправить",loading:"Загрузка...",error:"Ошибка",success:"Успешно",warning:"Предупреждение",info:"Информация",confirm:"Подтвердить",back:"Назад",next:"Далее",previous:"Назад",search:"Поиск",filter:"Фильтр",sort:"Сортировка",export:"Экспорт",import:"Импорт",download:"Загрузить",upload:"Загрузить",close:"Закрыть",open:"Открыть",settings:"Настройки",help:"Помощь",about:"О приложении",language:"Язык",theme:"Тема",light:"Светлая",dark:"Темная",auto:"Автоматически",yes:"Да",no:"Нет",ok:"ОК",more:"Еще",less:"Скрыть",clear:"Очистить",apply:"Применить",reset:"Сбросить",copy:"Копировать",copied:"Скопировано!",showing:"Показано",of:"из",to:"до",results:"результатов",noData:"Нет доступных данных",noResults:"Результаты не найдены",loading_data:"Загрузка данных...",try_again:"Попробовать снова",go_back:"Вернуться"},time:{today:"Сегодня",tomorrow:"Завтра",yesterday:"Вчера",thisWeek:"На этой неделе",lastWeek:"На прошлой неделе",thisMonth:"В этом месяце",lastMonth:"В прошлом месяце",thisYear:"В этом году",lastYear:"В прошлом году",justNow:"Только что",minutesAgo:"{{count}} минуту назад",minutesAgo_plural:"{{count}} минут назад",hoursAgo:"{{count}} час назад",hoursAgo_plural:"{{count}} часов назад",daysAgo:"{{count}} день назад",daysAgo_plural:"{{count}} дней назад",monthsAgo:"{{count}} месяц назад",monthsAgo_plural:"{{count}} месяцев назад"},status:{active:"Активно",inactive:"Неактивно",pending:"Ожидание",completed:"Завершено",failed:"Ошибка",processing:"Обработка",cancelled:"Отменено",paused:"Пауза",in_progress:"В процессе",submitted:"Отправлено",graded:"Оценено",draft:"Черновик",published:"Опубликовано",archived:"Архивировано"},actions:{view:"Просмотр",preview:"Предпросмотр",download:"Загрузить",share:"Поделиться",print:"Печать",archive:"Архивировать",unarchive:"Разархивировать",duplicate:"Дублировать",move:"Переместить",rename:"Переименовать",refresh:"Обновить",expand:"Развернуть",collapse:"Свернуть",reply:"Ответить",replyAll:"Ответить всем",forward:"Переслать"},pagination:{first:"Первая",last:"Последняя",previous:"Предыдущая",next:"Следующая",page:"Страница",itemsPerPage:"Элементов на странице"}},forms:{labels:{email:"Электронная почта",password:"Пароль",confirmPassword:"Подтвердить пароль",firstName:"Имя",lastName:"Фамилия",fullName:"Полное имя",username:"Имя пользователя",title:"Название",description:"Описание",content:"Содержание",subject:"Тема",message:"Сообщение",name:"Имя",phone:"Телефон",address:"Адрес",city:"Город",state:"Область",country:"Страна",zipCode:"Почтовый индекс",date:"Дата",time:"Время",startDate:"Дата начала",endDate:"Дата окончания",startTime:"Время начала",endTime:"Время окончания",file:"Файл",files:"Файлы",category:"Категория",tag:"Тег",tags:"Теги",status:"Статус",priority:"Приоритет",notes:"Примечания",comment:"Комментарий",comments:"Комментарии",attachment:"Вложение",attachments:"Вложения"},placeholders:{enterEmail:"Введите вашу электронную почту",enterPassword:"Введите пароль",enterFullName:"Введите ваше полное имя",enterUsername:"Введите имя пользователя",enterTitle:"Введите название",enterDescription:"Введите описание",enterContent:"Введите содержание",enterMessage:"Введите ваше сообщение",searchPlaceholder:"Поиск...",selectOption:"Выберите вариант",selectFile:"Выберите файл",dragDropFile:"Перетащите файл сюда или нажмите для выбора",dragDropFiles:"Перетащите файлы сюда или нажмите для выбора",typeMessage:"Введите сообщение...",typeComment:"Введите комментарий..."},hints:{passwordRequirements:"Пароль должен содержать минимум 8 символов с прописными, строчными буквами и цифрами",emailFormat:"Введите действительный адрес электронной почты",phoneFormat:"Введите действительный номер телефона",fileSize:"Размер файла не должен превышать {{size}}МБ",fileType:"Допустимые типы файлов: {{types}}"},buttons:{submit:"Отправить",save:"Сохранить",saveChanges:"Сохранить изменения",cancel:"Отмена",delete:"Удалить",deleteConfirm:"Удалить этот элемент?",edit:"Изменить",create:"Создать",createNew:"Создать новый",update:"Обновить",send:"Отправить",reset:"Сбросить",clear:"Очистить",login:"Вход",logout:"Выход",register:"Регистрация",signUp:"Зарегистрироваться",signIn:"Войти",forgotPassword:"Забыли пароль?",resetPassword:"Сбросить пароль",changePassword:"Изменить пароль",upload:"Загрузить",browse:"Обзор",download:"Загрузить",export:"Экспорт",import:"Импорт",share:"Поделиться",print:"Печать",closeForm:"Закрыть"}},errors:{http:{400:"Неверный запрос - Некорректный ввод",401:"Не авторизовано - Пожалуйста, войдите в систему",403:"Запрещено - У вас нет прав доступа",404:"Не найдено - Ресурс не существует",409:"Конфликт - Ресурс уже существует",413:"Полезная нагрузка слишком велика - Файл слишком большой",415:"Неподдерживаемый тип мультимедиа - Формат файла не допущен",429:"Слишком много запросов - Попробуйте позже",500:"Ошибка сервера - Что-то пошло не так",502:"Неверный шлюз - Сервис недоступен",503:"Сервис недоступен - Пожалуйста, попробуйте позже",504:"Timeout шлюза - Запрос занял слишком много времени"},validation:{required:"Это поле обязательно",email:"Пожалуйста, введите действительный адрес электронной почты",password:"Пароль должен быть не менее 8 символов",passwordMismatch:"Пароли не совпадают",username:"Имя пользователя должно быть 3-20 символов",minLength:"Минимальная длина {{min}} символов",maxLength:"Максимальная длина {{max}} символов",pattern:"Неверный формат",number:"Должно быть число",date:"Пожалуйста, введите действительную дату",url:"Пожалуйста, введите действительный URL",phone:"Пожалуйста, введите действительный номер телефона",whitespace:"Не может содержать только пробелы",duplicateEmail:"Эта электронная почта уже зарегистрирована",duplicateUsername:"Это имя пользователя уже занято"},authentication:{invalidCredentials:"Неверная электронная почта или пароль",accountLocked:"Аккаунт заблокирован из-за нескольких неудачных попыток входа",accountDisabled:"Ваш аккаунт был отключен",accountNotVerified:"Пожалуйста, подтвердите вашу электронную почту для входа",sessionExpired:"Ваша сессия истекла. Пожалуйста, войдите снова",tokenExpired:"Ваш токен аутентификации истек",invalidToken:"Неверный или истекший токен аутентификации",unauthorized:"У вас нет прав для выполнения этого действия",forbidden:"Доступ запрещен",requiresLogin:"Пожалуйста, войдите для продолжения"},authorization:{insufficientPermissions:"У вас нет прав для выполнения этого действия",roleRequired:"Это действие требует роль {{role}}",accountTypeRequired:"Это действие требует тип аккаунта {{accountType}}"},form:{submitError:"Ошибка отправки формы. Пожалуйста, попробуйте снова",validationFailed:"Пожалуйста, исправьте ошибки ниже",requiredFields:"Пожалуйста, заполните все обязательные поля"},upload:{fileRequired:"Пожалуйста, выберите файл",fileTooLarge:"Файл слишком большой. Максимальный размер {{size}}МБ",invalidFileType:"Неверный тип файла. Допустимые типы: {{types}}",uploadFailed:"Загрузка файла не удалась. Пожалуйста, попробуйте снова",uploadCancelled:"Загрузка файла отменена",virusScanFailed:"Файл не прошел проверку безопасности",infectiousContent:"Файл содержит потенциально вредоносный контент",uploadInProgress:"Загрузка в процессе, пожалуйста, ждите..."},network:{noConnection:"Нет подключения к интернету",connectionError:"Ошибка подключения. Пожалуйста, проверьте подключение к интернету",timeout:"Истекло время ожидания. Пожалуйста, попробуйте снова",offline:"Вы не в сети. Пожалуйста, проверьте подключение",retrying:"Повторная попытка..."},notFound:{page:"Страница не найдена",resource:"Ресурс не найден",material:"Материал не найден",assignment:"Задание не найдено",user:"Пользователь не найден",chatRoom:"Комната чата не найдена"},conflict:{alreadyExists:"Этот ресурс уже существует",alreadySubmitted:"Вы уже отправили это задание",alreadyEnrolled:"Вы уже зарегистрированы в этом курсе"},generic:{somethingWentWrong:"Что-то пошло не так. Пожалуйста, попробуйте снова",tryAgain:"Пожалуйста, попробуйте снова",contactSupport:"Если проблема сохраняется, пожалуйста, свяжитесь с поддержкой",reportIssue:"Сообщить об этой проблеме"}},messages:{success:{saved:"Изменения сохранены успешно",created:"Создано успешно",deleted:"Удалено успешно",updated:"Обновлено успешно",submitted:"Отправлено успешно",uploaded:"Файл загружен успешно",downloaded:"Загружено успешно",exported:"Экспортировано успешно",imported:"Импортировано успешно",copied:"Скопировано в буфер обмена",shared:"Поделено успешно",emailSent:"Электронное письмо отправлено успешно",passwordChanged:"Пароль изменен успешно",profileUpdated:"Профиль обновлен успешно",enrolled:"Зарегистрированы успешно",completed:"Завершено успешно"},info:{processing:"Обработка...",loading:"Загрузка...",savingChanges:"Сохранение изменений...",checkingEmail:"Проверка электронной почты...",verifyingFile:"Проверка файла...",noData:"Нет доступных данных",noResults:"Результаты не найдены",emptyList:"Этот список пуст",selectItem:"Пожалуйста, выберите элемент",loadMore:"Загрузить больше",showMore:"Показать больше",showLess:"Показать меньше"},warning:{unsavedChanges:"У вас есть несохраненные изменения. Вы уверены, что хотите уйти?",deleteConfirm:"Вы уверены, что хотите удалить этот элемент? Это действие невозможно отменить.",permanentDelete:"Это навсегда удалит элемент. Вы уверены?",invalidInput:"Пожалуйста, проверьте ввод",expiring:"Это скоро истечет",expired:"Это истекло",expiringSession:"Ваша сессия истечет через {{minutes}} минут",limitReached:"Вы достигли лимита",quotaExceeded:"Ваша квота превышена"},notifications:{newMessage:"У вас есть новое сообщение",newMessages:"У вас есть {{count}} новых сообщений",newNotification:"У вас есть новое уведомление",newNotifications:"У вас есть {{count}} новых уведомлений",assignmentDue:"Задание выполняется через {{hours}} часов",assignmentOverdue:"Задание просрочено",classStarting:"Урок начинается через {{minutes}} минут",mentionedYou:"{{user}} упомянул вас",repliedToYou:"{{user}} ответил вам"},confirmation:{delete:"Вы уверены, что хотите удалить это?",logout:"Вы уверены, что хотите выйти из системы?",clearData:"Вы уверены, что хотите очистить все данные?",submitAssignment:"Вы уверены, что хотите отправить это задание?",publishMaterial:"Вы уверены, что хотите опубликовать этот материал?"},prompts:{enterName:"Пожалуйста, введите имя",enterEmail:"Пожалуйста, введите электронную почту",enterMessage:"Пожалуйста, введите сообщение",selectFile:"Пожалуйста, выберите файл",selectDate:"Пожалуйста, выберите дату",selectTime:"Пожалуйста, выберите время"}},validation:{email:{required:"Электронная почта обязательна",invalid:"Пожалуйста, введите действительный адрес электронной почты",alreadyExists:"Эта электронная почта уже зарегистрирована"},password:{required:"Пароль обязателен",minLength:"Пароль должен быть не менее 8 символов",uppercase:"Пароль должен содержать минимум одну прописную букву",lowercase:"Пароль должен содержать минимум одну строчную букву",number:"Пароль должен содержать минимум одну цифру",special:"Пароль должен содержать минимум один специальный символ (!@#$%^&*)",mismatch:"Пароли не совпадают"},username:{required:"Имя пользователя обязательно",minLength:"Имя пользователя должно быть не менее 3 символов",maxLength:"Имя пользователя не должно превышать 20 символов",invalidChars:"Имя пользователя может содержать только буквы, цифры и подчеркивания",alreadyExists:"Это имя пользователя уже занято"},name:{required:"Имя обязательно",minLength:"Имя должно быть не менее 2 символов",maxLength:"Имя не должно превышать 50 символов"},date:{required:"Дата обязательна",invalid:"Пожалуйста, введите действительную дату",inPast:"Дата не может быть в прошлом",inFuture:"Дата не может быть в будущем",afterStart:"Дата окончания должна быть после даты начала",beforeEnd:"Дата начала должна быть до даты окончания"},file:{required:"Файл обязателен",tooLarge:"Файл слишком большой (макс {{size}}МБ)",invalidType:"Неверный тип файла. Допустимые: {{types}}",empty:"Файл пуст",corrupted:"Файл похоже поврежден"},form:{required:"Это поле обязательно",minLength:"Минимальная длина {{min}} символов",maxLength:"Максимальная длина {{max}} символов",pattern:"Неверный формат",custom:"Это поле некорректно"},phone:{required:"Номер телефона обязателен",invalid:"Пожалуйста, введите действительный номер телефона"},url:{required:"URL обязателен",invalid:"Пожалуйста, введите действительный URL"},number:{required:"Число обязательно",invalid:"Должно быть действительное число",min:"Должно быть не менее {{min}}",max:"Не должно быть более {{max}}"},selection:{required:"Пожалуйста, выберите вариант",minItems:"Пожалуйста, выберите минимум {{min}} элементов",maxItems:"Вы можете выбрать до {{max}} элементов"}}},es:{common:{app:{title:"Plataforma Educativa THE_BOT",description:"Plataforma de aprendizaje personalizado con comunicación en tiempo real"},navigation:{dashboard:"Panel de control",materials:"Materiales",assignments:"Tareas",chat:"Chat",schedule:"Horario",reports:"Reportes",settings:"Configuración",profile:"Perfil",admin:"Panel de Administración",logout:"Cerrar sesión",home:"Inicio"},roles:{student:"Estudiante",teacher:"Profesor",tutor:"Tutor",parent:"Padre",admin:"Administrador"},common:{save:"Guardar",cancel:"Cancelar",delete:"Eliminar",edit:"Editar",create:"Crear",submit:"Enviar",loading:"Cargando...",error:"Error",success:"Éxito",warning:"Advertencia",info:"Información",confirm:"Confirmar",back:"Atrás",next:"Siguiente",previous:"Anterior",search:"Buscar",filter:"Filtro",sort:"Ordenar",export:"Exportar",import:"Importar",download:"Descargar",upload:"Cargar",close:"Cerrar",open:"Abrir",settings:"Configuración",help:"Ayuda",about:"Acerca de",language:"Idioma",theme:"Tema",light:"Claro",dark:"Oscuro",auto:"Automático",yes:"Sí",no:"No",ok:"OK",more:"Más",less:"Menos",clear:"Limpiar",apply:"Aplicar",reset:"Restablecer",copy:"Copiar",copied:"¡Copiado!",showing:"Mostrando",of:"de",to:"a",results:"resultados",noData:"Sin datos disponibles",noResults:"No se encontraron resultados",loading_data:"Cargando datos...",try_again:"Intentar de nuevo",go_back:"Volver"},time:{today:"Hoy",tomorrow:"Mañana",yesterday:"Ayer",thisWeek:"Esta semana",lastWeek:"La semana pasada",thisMonth:"Este mes",lastMonth:"El mes pasado",thisYear:"Este año",lastYear:"El año pasado",justNow:"Justo ahora",minutesAgo:"hace {{count}} minuto",minutesAgo_plural:"hace {{count}} minutos",hoursAgo:"hace {{count}} hora",hoursAgo_plural:"hace {{count}} horas",daysAgo:"hace {{count}} día",daysAgo_plural:"hace {{count}} días",monthsAgo:"hace {{count}} mes",monthsAgo_plural:"hace {{count}} meses"},status:{active:"Activo",inactive:"Inactivo",pending:"Pendiente",completed:"Completado",failed:"Fallido",processing:"Procesando",cancelled:"Cancelado",paused:"Pausado",in_progress:"En progreso",submitted:"Enviado",graded:"Calificado",draft:"Borrador",published:"Publicado",archived:"Archivado"},actions:{view:"Ver",preview:"Vista previa",download:"Descargar",share:"Compartir",print:"Imprimir",archive:"Archivar",unarchive:"Desarchivar",duplicate:"Duplicar",move:"Mover",rename:"Renombrar",refresh:"Actualizar",expand:"Expandir",collapse:"Contraer",reply:"Responder",replyAll:"Responder a todos",forward:"Reenviar"},pagination:{first:"Primero",last:"Último",previous:"Anterior",next:"Siguiente",page:"Página",itemsPerPage:"Elementos por página"}},forms:{labels:{email:"Correo electrónico",password:"Contraseña",confirmPassword:"Confirmar contraseña",firstName:"Nombre",lastName:"Apellido",fullName:"Nombre completo",username:"Nombre de usuario",title:"Título",description:"Descripción",content:"Contenido",subject:"Asunto",message:"Mensaje",name:"Nombre",phone:"Teléfono",address:"Dirección",city:"Ciudad",state:"Estado",country:"País",zipCode:"Código postal",date:"Fecha",time:"Hora",startDate:"Fecha de inicio",endDate:"Fecha de finalización",startTime:"Hora de inicio",endTime:"Hora de finalización",file:"Archivo",files:"Archivos",category:"Categoría",tag:"Etiqueta",tags:"Etiquetas",status:"Estado",priority:"Prioridad",notes:"Notas",comment:"Comentario",comments:"Comentarios",attachment:"Adjunto",attachments:"Adjuntos"},placeholders:{enterEmail:"Ingrese su correo electrónico",enterPassword:"Ingrese su contraseña",enterFullName:"Ingrese su nombre completo",enterUsername:"Ingrese un nombre de usuario",enterTitle:"Ingrese el título",enterDescription:"Ingrese la descripción",enterContent:"Ingrese el contenido",enterMessage:"Ingrese su mensaje",searchPlaceholder:"Buscar...",selectOption:"Seleccione una opción",selectFile:"Seleccione un archivo",dragDropFile:"Arrastra un archivo aquí o haz clic para seleccionar",dragDropFiles:"Arrastra archivos aquí o haz clic para seleccionar",typeMessage:"Escribe un mensaje...",typeComment:"Escribe un comentario..."},hints:{passwordRequirements:"La contraseña debe tener al menos 8 caracteres con mayúsculas, minúsculas y números",emailFormat:"Por favor, ingrese una dirección de correo válida",phoneFormat:"Por favor, ingrese un número de teléfono válido",fileSize:"El tamaño del archivo no debe exceder {{size}}MB",fileType:"Tipos de archivo permitidos: {{types}}"},buttons:{submit:"Enviar",save:"Guardar",saveChanges:"Guardar cambios",cancel:"Cancelar",delete:"Eliminar",deleteConfirm:"¿Eliminar este elemento?",edit:"Editar",create:"Crear",createNew:"Crear nuevo",update:"Actualizar",send:"Enviar",reset:"Restablecer",clear:"Limpiar",login:"Iniciar sesión",logout:"Cerrar sesión",register:"Registrarse",signUp:"Registrarse",signIn:"Iniciar sesión",forgotPassword:"¿Olvidó su contraseña?",resetPassword:"Restablecer contraseña",changePassword:"Cambiar contraseña",upload:"Cargar",browse:"Examinar",download:"Descargar",export:"Exportar",import:"Importar",share:"Compartir",print:"Imprimir",closeForm:"Cerrar"}},errors:{http:{400:"Solicitud incorrecta - Entrada inválida",401:"No autorizado - Por favor, inicie sesión",403:"Prohibido - No tiene permiso",404:"No encontrado - El recurso no existe",409:"Conflicto - El recurso ya existe",413:"Carga útil demasiado grande - El archivo es demasiado grande",415:"Tipo de contenido no compatible - Formato de archivo no permitido",429:"Demasiadas solicitudes - Por favor, intente más tarde",500:"Error del servidor - Algo salió mal",502:"Puerta de enlace defectuosa - Servicio no disponible",503:"Servicio no disponible - Por favor, intente más tarde",504:"Tiempo de espera de la puerta de enlace - La solicitud tardó demasiado"},validation:{required:"Este campo es requerido",email:"Por favor, ingrese una dirección de correo válida",password:"La contraseña debe tener al menos 8 caracteres",passwordMismatch:"Las contraseñas no coinciden",username:"El nombre de usuario debe tener 3-20 caracteres",minLength:"La longitud mínima es {{min}} caracteres",maxLength:"La longitud máxima es {{max}} caracteres",pattern:"Formato inválido",number:"Debe ser un número",date:"Por favor, ingrese una fecha válida",url:"Por favor, ingrese una URL válida",phone:"Por favor, ingrese un número de teléfono válido",whitespace:"No puede contener solo espacios en blanco",duplicateEmail:"Este correo ya está registrado",duplicateUsername:"Este nombre de usuario ya está en uso"},authentication:{invalidCredentials:"Correo o contraseña inválidos",accountLocked:"Cuenta bloqueada por múltiples intentos fallidos de inicio de sesión",accountDisabled:"Su cuenta ha sido deshabilitada",accountNotVerified:"Por favor, verifique su correo para iniciar sesión",sessionExpired:"Su sesión ha expirado. Por favor, inicie sesión de nuevo",tokenExpired:"Su token de autenticación ha expirado",invalidToken:"Token de autenticación inválido o expirado",unauthorized:"No está autorizado para realizar esta acción",forbidden:"Acceso denegado",requiresLogin:"Por favor, inicie sesión para continuar"},authorization:{insufficientPermissions:"No tiene permiso para realizar esta acción",roleRequired:"Esta acción requiere el rol {{role}}",accountTypeRequired:"Esta acción requiere el tipo de cuenta {{accountType}}"},form:{submitError:"Error al enviar el formulario. Por favor, intente de nuevo",validationFailed:"Por favor, corrija los errores a continuación",requiredFields:"Por favor, complete todos los campos requeridos"},upload:{fileRequired:"Por favor, seleccione un archivo",fileTooLarge:"El archivo es demasiado grande. El tamaño máximo es {{size}}MB",invalidFileType:"Tipo de archivo inválido. Tipos permitidos: {{types}}",uploadFailed:"Error al cargar el archivo. Por favor, intente de nuevo",uploadCancelled:"Carga de archivo cancelada",virusScanFailed:"El archivo no pasó la verificación de seguridad",infectiousContent:"El archivo contiene contenido potencialmente dañino",uploadInProgress:"Carga en progreso, por favor espere..."},network:{noConnection:"Sin conexión a internet",connectionError:"Error de conexión. Por favor, compruebe su conexión",timeout:"Se agotó el tiempo de espera. Por favor, intente de nuevo",offline:"Está sin conexión. Por favor, compruebe su conexión",retrying:"Reintentar..."},notFound:{page:"Página no encontrada",resource:"Recurso no encontrado",material:"Material no encontrado",assignment:"Tarea no encontrada",user:"Usuario no encontrado",chatRoom:"Sala de chat no encontrada"},conflict:{alreadyExists:"Este recurso ya existe",alreadySubmitted:"Ya ha enviado esta tarea",alreadyEnrolled:"Ya está inscrito en este curso"},generic:{somethingWentWrong:"Algo salió mal. Por favor, intente de nuevo",tryAgain:"Por favor, intente de nuevo",contactSupport:"Si el problema persiste, por favor contacte al soporte",reportIssue:"Reportar este problema"}},messages:{success:{saved:"Cambios guardados con éxito",created:"Creado exitosamente",deleted:"Eliminado exitosamente",updated:"Actualizado exitosamente",submitted:"Enviado exitosamente",uploaded:"Archivo cargado exitosamente",downloaded:"Descargado exitosamente",exported:"Exportado exitosamente",imported:"Importado exitosamente",copied:"Copiado al portapapeles",shared:"Compartido exitosamente",emailSent:"Correo enviado exitosamente",passwordChanged:"Contraseña cambiada exitosamente",profileUpdated:"Perfil actualizado exitosamente",enrolled:"Inscrito exitosamente",completed:"Completado exitosamente"},info:{processing:"Procesando...",loading:"Cargando...",savingChanges:"Guardando cambios...",checkingEmail:"Verificando correo...",verifyingFile:"Verificando archivo...",noData:"Sin datos disponibles",noResults:"No se encontraron resultados",emptyList:"Esta lista está vacía",selectItem:"Por favor, seleccione un elemento",loadMore:"Cargar más",showMore:"Mostrar más",showLess:"Mostrar menos"},warning:{unsavedChanges:"Tiene cambios sin guardar. ¿Está seguro de que desea irse?",deleteConfirm:"¿Está seguro de que desea eliminar este elemento? Esta acción no se puede deshacer.",permanentDelete:"Esto eliminará permanentemente el elemento. ¿Está seguro?",invalidInput:"Por favor, compruebe su entrada",expiring:"Esto pronto vencerá",expired:"Esto ha vencido",expiringSession:"Su sesión vencerá en {{minutes}} minutos",limitReached:"Ha alcanzado el límite",quotaExceeded:"Su cuota ha sido excedida"},notifications:{newMessage:"Tiene un nuevo mensaje",newMessages:"Tiene {{count}} nuevos mensajes",newNotification:"Tiene una nueva notificación",newNotifications:"Tiene {{count}} nuevas notificaciones",assignmentDue:"Tarea vence en {{hours}} horas",assignmentOverdue:"La tarea está vencida",classStarting:"La clase comienza en {{minutes}} minutos",mentionedYou:"{{user}} lo mencionó",repliedToYou:"{{user}} le respondió"},confirmation:{delete:"¿Está seguro de que desea eliminar esto?",logout:"¿Está seguro de que desea cerrar sesión?",clearData:"¿Está seguro de que desea borrar todos los datos?",submitAssignment:"¿Está seguro de que desea enviar esta tarea?",publishMaterial:"¿Está seguro de que desea publicar este material?"},prompts:{enterName:"Por favor, ingrese un nombre",enterEmail:"Por favor, ingrese un correo",enterMessage:"Por favor, ingrese un mensaje",selectFile:"Por favor, seleccione un archivo",selectDate:"Por favor, seleccione una fecha",selectTime:"Por favor, seleccione una hora"}},validation:{email:{required:"El correo es requerido",invalid:"Por favor, ingrese una dirección de correo válida",alreadyExists:"Este correo ya está registrado"},password:{required:"La contraseña es requerida",minLength:"La contraseña debe tener al menos 8 caracteres",uppercase:"La contraseña debe contener al menos una letra mayúscula",lowercase:"La contraseña debe contener al menos una letra minúscula",number:"La contraseña debe contener al menos un número",special:"La contraseña debe contener al menos un carácter especial (!@#$%^&*)",mismatch:"Las contraseñas no coinciden"},username:{required:"El nombre de usuario es requerido",minLength:"El nombre de usuario debe tener al menos 3 caracteres",maxLength:"El nombre de usuario no debe exceder 20 caracteres",invalidChars:"El nombre de usuario solo puede contener letras, números y guiones bajos",alreadyExists:"Este nombre de usuario ya está en uso"},name:{required:"El nombre es requerido",minLength:"El nombre debe tener al menos 2 caracteres",maxLength:"El nombre no debe exceder 50 caracteres"},date:{required:"La fecha es requerida",invalid:"Por favor, ingrese una fecha válida",inPast:"La fecha no puede estar en el pasado",inFuture:"La fecha no puede estar en el futuro",afterStart:"La fecha de finalización debe ser después de la fecha de inicio",beforeEnd:"La fecha de inicio debe ser antes de la fecha de finalización"},file:{required:"El archivo es requerido",tooLarge:"El archivo es demasiado grande (máx {{size}}MB)",invalidType:"Tipo de archivo inválido. Permitidos: {{types}}",empty:"El archivo está vacío",corrupted:"El archivo parece estar corrupto"},form:{required:"Este campo es requerido",minLength:"La longitud mínima es {{min}} caracteres",maxLength:"La longitud máxima es {{max}} caracteres",pattern:"Formato inválido",custom:"Este campo es inválido"},phone:{required:"El número de teléfono es requerido",invalid:"Por favor, ingrese un número de teléfono válido"},url:{required:"La URL es requerida",invalid:"Por favor, ingrese una URL válida"},number:{required:"El número es requerido",invalid:"Debe ser un número válido",min:"Debe ser al menos {{min}}",max:"No debe ser más de {{max}}"},selection:{required:"Por favor, seleccione una opción",minItems:"Por favor, seleccione al menos {{min}} elementos",maxItems:"Puede seleccionar hasta {{max}} elementos"}}},fr:{common:{app:{title:"Plateforme Éducative THE_BOT",description:"Plateforme d'apprentissage personnalisé avec communication en temps réel"},navigation:{dashboard:"Tableau de bord",materials:"Matériaux",assignments:"Tâches",chat:"Chat",schedule:"Horaire",reports:"Rapports",settings:"Paramètres",profile:"Profil",admin:"Panneau d'administration",logout:"Déconnexion",home:"Accueil"},roles:{student:"Étudiant",teacher:"Professeur",tutor:"Tuteur",parent:"Parent",admin:"Administrateur"},common:{save:"Enregistrer",cancel:"Annuler",delete:"Supprimer",edit:"Modifier",create:"Créer",submit:"Soumettre",loading:"Chargement...",error:"Erreur",success:"Succès",warning:"Avertissement",info:"Information",confirm:"Confirmer",back:"Retour",next:"Suivant",previous:"Précédent",search:"Rechercher",filter:"Filtrer",sort:"Trier",export:"Exporter",import:"Importer",download:"Télécharger",upload:"Téléverser",close:"Fermer",open:"Ouvrir",settings:"Paramètres",help:"Aide",about:"À propos",language:"Langue",theme:"Thème",light:"Clair",dark:"Sombre",auto:"Automatique",yes:"Oui",no:"Non",ok:"OK",more:"Plus",less:"Moins",clear:"Effacer",apply:"Appliquer",reset:"Réinitialiser",copy:"Copier",copied:"Copié !",showing:"Affichage",of:"de",to:"à",results:"résultats",noData:"Aucune donnée disponible",noResults:"Aucun résultat trouvé",loading_data:"Chargement des données...",try_again:"Réessayer",go_back:"Retour"},time:{today:"Aujourd'hui",tomorrow:"Demain",yesterday:"Hier",thisWeek:"Cette semaine",lastWeek:"La semaine dernière",thisMonth:"Ce mois",lastMonth:"Le mois dernier",thisYear:"Cette année",lastYear:"L'année dernière",justNow:"À l'instant",minutesAgo:"il y a {{count}} minute",minutesAgo_plural:"il y a {{count}} minutes",hoursAgo:"il y a {{count}} heure",hoursAgo_plural:"il y a {{count}} heures",daysAgo:"il y a {{count}} jour",daysAgo_plural:"il y a {{count}} jours",monthsAgo:"il y a {{count}} mois",monthsAgo_plural:"il y a {{count}} mois"},status:{active:"Actif",inactive:"Inactif",pending:"En attente",completed:"Terminé",failed:"Échoué",processing:"Traitement en cours",cancelled:"Annulé",paused:"Pausé",in_progress:"En cours",submitted:"Soumis",graded:"Noté",draft:"Brouillon",published:"Publié",archived:"Archivé"},actions:{view:"Afficher",preview:"Aperçu",download:"Télécharger",share:"Partager",print:"Imprimer",archive:"Archiver",unarchive:"Désarchiver",duplicate:"Dupliquer",move:"Déplacer",rename:"Renommer",refresh:"Actualiser",expand:"Développer",collapse:"Réduire",reply:"Répondre",replyAll:"Répondre à tous",forward:"Transférer"},pagination:{first:"Premier",last:"Dernier",previous:"Précédent",next:"Suivant",page:"Page",itemsPerPage:"Éléments par page"}},forms:{labels:{email:"Adresse électronique",password:"Mot de passe",confirmPassword:"Confirmer le mot de passe",firstName:"Prénom",lastName:"Nom de famille",fullName:"Nom complet",username:"Nom d'utilisateur",title:"Titre",description:"Description",content:"Contenu",subject:"Sujet",message:"Message",name:"Nom",phone:"Téléphone",address:"Adresse",city:"Ville",state:"État",country:"Pays",zipCode:"Code postal",date:"Date",time:"Heure",startDate:"Date de début",endDate:"Date de fin",startTime:"Heure de début",endTime:"Heure de fin",file:"Fichier",files:"Fichiers",category:"Catégorie",tag:"Étiquette",tags:"Étiquettes",status:"Statut",priority:"Priorité",notes:"Notes",comment:"Commentaire",comments:"Commentaires",attachment:"Pièce jointe",attachments:"Pièces jointes"},placeholders:{enterEmail:"Entrez votre adresse électronique",enterPassword:"Entrez votre mot de passe",enterFullName:"Entrez votre nom complet",enterUsername:"Entrez un nom d'utilisateur",enterTitle:"Entrez le titre",enterDescription:"Entrez la description",enterContent:"Entrez le contenu",enterMessage:"Entrez votre message",searchPlaceholder:"Rechercher...",selectOption:"Sélectionnez une option",selectFile:"Sélectionnez un fichier",dragDropFile:"Glissez-déposez un fichier ici ou cliquez pour sélectionner",dragDropFiles:"Glissez-déposez des fichiers ici ou cliquez pour sélectionner",typeMessage:"Tapez un message...",typeComment:"Tapez un commentaire..."},hints:{passwordRequirements:"Le mot de passe doit contenir au moins 8 caractères avec des majuscules, des minuscules et des chiffres",emailFormat:"Veuillez entrer une adresse e-mail valide",phoneFormat:"Veuillez entrer un numéro de téléphone valide",fileSize:"La taille du fichier ne doit pas dépasser {{size}}MB",fileType:"Types de fichiers autorisés : {{types}}"},buttons:{submit:"Soumettre",save:"Enregistrer",saveChanges:"Enregistrer les modifications",cancel:"Annuler",delete:"Supprimer",deleteConfirm:"Supprimer cet élément ?",edit:"Modifier",create:"Créer",createNew:"Créer un nouveau",update:"Mettre à jour",send:"Envoyer",reset:"Réinitialiser",clear:"Effacer",login:"Connexion",logout:"Déconnexion",register:"S'inscrire",signUp:"S'inscrire",signIn:"Se connecter",forgotPassword:"Mot de passe oublié ?",resetPassword:"Réinitialiser le mot de passe",changePassword:"Changer le mot de passe",upload:"Téléverser",browse:"Parcourir",download:"Télécharger",export:"Exporter",import:"Importer",share:"Partager",print:"Imprimer",closeForm:"Fermer"}},errors:{http:{400:"Mauvaise requête - Entrée invalide",401:"Non autorisé - Veuillez vous connecter",403:"Interdit - Vous n'avez pas la permission",404:"Non trouvé - La ressource n'existe pas",409:"Conflit - La ressource existe déjà",413:"Charge utile trop grande - Le fichier est trop volumineux",415:"Type de média non supporté - Format de fichier non autorisé",429:"Trop de requêtes - Veuillez réessayer plus tard",500:"Erreur serveur - Une erreur s'est produite",502:"Mauvaise passerelle - Service indisponible",503:"Service indisponible - Veuillez réessayer plus tard",504:"Expiration de la passerelle - La requête a pris trop de temps"},validation:{required:"Ce champ est requis",email:"Veuillez entrer une adresse e-mail valide",password:"Le mot de passe doit contenir au moins 8 caractères",passwordMismatch:"Les mots de passe ne correspondent pas",username:"Le nom d'utilisateur doit contenir 3-20 caractères",minLength:"La longueur minimale est {{min}} caractères",maxLength:"La longueur maximale est {{max}} caractères",pattern:"Format invalide",number:"Doit être un nombre",date:"Veuillez entrer une date valide",url:"Veuillez entrer une URL valide",phone:"Veuillez entrer un numéro de téléphone valide",whitespace:"Ne peut contenir que des espaces",duplicateEmail:"Cet e-mail est déjà enregistré",duplicateUsername:"Ce nom d'utilisateur est déjà pris"},authentication:{invalidCredentials:"E-mail ou mot de passe invalide",accountLocked:"Compte verrouillé en raison de plusieurs tentatives de connexion échouées",accountDisabled:"Votre compte a été désactivé",accountNotVerified:"Veuillez vérifier votre e-mail pour vous connecter",sessionExpired:"Votre session a expiré. Veuillez vous reconnecter",tokenExpired:"Votre token d'authentification a expiré",invalidToken:"Token d'authentification invalide ou expiré",unauthorized:"Vous n'êtes pas autorisé à effectuer cette action",forbidden:"Accès refusé",requiresLogin:"Veuillez vous connecter pour continuer"},authorization:{insufficientPermissions:"Vous n'avez pas la permission d'effectuer cette action",roleRequired:"Cette action nécessite le rôle {{role}}",accountTypeRequired:"Cette action nécessite le type de compte {{accountType}}"},form:{submitError:"Erreur lors de l'envoi du formulaire. Veuillez réessayer",validationFailed:"Veuillez corriger les erreurs ci-dessous",requiredFields:"Veuillez compléter tous les champs obligatoires"},upload:{fileRequired:"Veuillez sélectionner un fichier",fileTooLarge:"Le fichier est trop volumineux. La taille maximale est {{size}}MB",invalidFileType:"Type de fichier invalide. Types autorisés : {{types}}",uploadFailed:"Impossible de télécharger le fichier. Veuillez réessayer",uploadCancelled:"Téléchargement du fichier annulé",virusScanFailed:"Le fichier n'a pas passé le contrôle de sécurité",infectiousContent:"Le fichier contient un contenu potentiellement dangereux",uploadInProgress:"Téléchargement en cours, veuillez attendre..."},network:{noConnection:"Pas de connexion Internet",connectionError:"Erreur de connexion. Veuillez vérifier votre connexion",timeout:"Délai d'expiration. Veuillez réessayer",offline:"Vous êtes hors ligne. Veuillez vérifier votre connexion",retrying:"Nouvelle tentative..."},notFound:{page:"Page non trouvée",resource:"Ressource non trouvée",material:"Matériel non trouvé",assignment:"Tâche non trouvée",user:"Utilisateur non trouvé",chatRoom:"Salle de discussion non trouvée"},conflict:{alreadyExists:"Cette ressource existe déjà",alreadySubmitted:"Vous avez déjà soumis cette tâche",alreadyEnrolled:"Vous êtes déjà inscrit à ce cours"},generic:{somethingWentWrong:"Une erreur s'est produite. Veuillez réessayer",tryAgain:"Veuillez réessayer",contactSupport:"Si le problème persiste, veuillez contacter le support",reportIssue:"Signaler ce problème"}},messages:{success:{saved:"Modifications enregistrées avec succès",created:"Créé avec succès",deleted:"Supprimé avec succès",updated:"Mis à jour avec succès",submitted:"Soumis avec succès",uploaded:"Fichier téléchargé avec succès",downloaded:"Téléchargé avec succès",exported:"Exporté avec succès",imported:"Importé avec succès",copied:"Copié dans le presse-papiers",shared:"Partagé avec succès",emailSent:"E-mail envoyé avec succès",passwordChanged:"Mot de passe changé avec succès",profileUpdated:"Profil mis à jour avec succès",enrolled:"Inscrit avec succès",completed:"Complété avec succès"},info:{processing:"Traitement...",loading:"Chargement...",savingChanges:"Enregistrement des modifications...",checkingEmail:"Vérification de l'e-mail...",verifyingFile:"Vérification du fichier...",noData:"Aucune donnée disponible",noResults:"Aucun résultat trouvé",emptyList:"Cette liste est vide",selectItem:"Veuillez sélectionner un élément",loadMore:"Charger plus",showMore:"Afficher plus",showLess:"Afficher moins"},warning:{unsavedChanges:"Vous avez des modifications non enregistrées. Êtes-vous sûr de vouloir partir ?",deleteConfirm:"Êtes-vous sûr de vouloir supprimer cet élément ? Cette action ne peut pas être annulée.",permanentDelete:"Cela supprimera définitivement l'élément. Êtes-vous sûr ?",invalidInput:"Veuillez vérifier votre entrée",expiring:"Cela va bientôt expirer",expired:"Cela a expiré",expiringSession:"Votre session expirera dans {{minutes}} minutes",limitReached:"Vous avez atteint la limite",quotaExceeded:"Votre quota a été dépassé"},notifications:{newMessage:"Vous avez un nouveau message",newMessages:"Vous avez {{count}} nouveaux messages",newNotification:"Vous avez une nouvelle notification",newNotifications:"Vous avez {{count}} nouvelles notifications",assignmentDue:"Tâche due dans {{hours}} heures",assignmentOverdue:"La tâche est en retard",classStarting:"Le cours commence dans {{minutes}} minutes",mentionedYou:"{{user}} vous a mentionné",repliedToYou:"{{user}} vous a répondu"},confirmation:{delete:"Êtes-vous sûr de vouloir supprimer ceci ?",logout:"Êtes-vous sûr de vouloir vous déconnecter ?",clearData:"Êtes-vous sûr de vouloir effacer toutes les données ?",submitAssignment:"Êtes-vous sûr de vouloir soumettre cette tâche ?",publishMaterial:"Êtes-vous sûr de vouloir publier ce matériel ?"},prompts:{enterName:"Veuillez entrer un nom",enterEmail:"Veuillez entrer un e-mail",enterMessage:"Veuillez entrer un message",selectFile:"Veuillez sélectionner un fichier",selectDate:"Veuillez sélectionner une date",selectTime:"Veuillez sélectionner une heure"}},validation:{email:{required:"L'e-mail est requis",invalid:"Veuillez entrer une adresse e-mail valide",alreadyExists:"Cet e-mail est déjà enregistré"},password:{required:"Le mot de passe est requis",minLength:"Le mot de passe doit contenir au moins 8 caractères",uppercase:"Le mot de passe doit contenir au moins une lettre majuscule",lowercase:"Le mot de passe doit contenir au moins une lettre minuscule",number:"Le mot de passe doit contenir au moins un chiffre",special:"Le mot de passe doit contenir au moins un caractère spécial (!@#$%^&*)",mismatch:"Les mots de passe ne correspondent pas"},username:{required:"Le nom d'utilisateur est requis",minLength:"Le nom d'utilisateur doit contenir au moins 3 caractères",maxLength:"Le nom d'utilisateur ne doit pas dépasser 20 caractères",invalidChars:"Le nom d'utilisateur ne peut contenir que des lettres, des chiffres et des traits de soulignement",alreadyExists:"Ce nom d'utilisateur est déjà pris"},name:{required:"Le nom est requis",minLength:"Le nom doit contenir au moins 2 caractères",maxLength:"Le nom ne doit pas dépasser 50 caractères"},date:{required:"La date est requise",invalid:"Veuillez entrer une date valide",inPast:"La date ne peut pas être dans le passé",inFuture:"La date ne peut pas être dans le futur",afterStart:"La date de fin doit être après la date de début",beforeEnd:"La date de début doit être avant la date de fin"},file:{required:"Le fichier est requis",tooLarge:"Le fichier est trop volumineux (max {{size}}MB)",invalidType:"Type de fichier invalide. Autorisés : {{types}}",empty:"Le fichier est vide",corrupted:"Le fichier semble être corrompu"},form:{required:"Ce champ est requis",minLength:"La longueur minimale est {{min}} caractères",maxLength:"La longueur maximale est {{max}} caractères",pattern:"Format invalide",custom:"Ce champ est invalide"},phone:{required:"Le numéro de téléphone est requis",invalid:"Veuillez entrer un numéro de téléphone valide"},url:{required:"L'URL est requise",invalid:"Veuillez entrer une URL valide"},number:{required:"Le nombre est requis",invalid:"Doit être un nombre valide",min:"Doit être au moins {{min}}",max:"Ne doit pas dépasser {{max}}"},selection:{required:"Veuillez sélectionner une option",minItems:"Veuillez sélectionner au moins {{min}} éléments",maxItems:"Vous pouvez sélectionner jusqu'à {{max}} éléments"}}}};nt.use(it).use(lt).init({resources:nc,fallbackLng:"en",defaultNS:"common",fallbackNS:"common",ns:["common","forms","errors","messages","validation"],interpolation:{escapeValue:!1,prefix:"{{",suffix:"}}"},detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"],lookupLocalStorage:"i18n_language"},react:{useSuspense:!1,bindI18n:"languageChanged loaded",bindI18nStore:"added removed",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transKeepBasicHtmlNodesFor:["br","strong","i","p"]},load:"languageOnly"}),ur().catch(e=>{console.error("Failed to register service worker:",e)}),n.createRoot(document.getElementById("root")).render(a.jsx(rc,{}));export{yn as $,Fn as A,Ba as B,Fa as C,dn as D,Lr as E,Cl as F,Ml as G,Ol as H,Ha as I,Ma as J,$a as K,Va as L,qa as M,Yl as N,tr as O,ql as P,sr as Q,ir as R,Ur as S,Ri as T,Ia as U,Rn as V,Pn as W,$l as X,Ua as Y,cn as Z,Pr as _,Hr as a,so as a0,Zl as a1,zl as a2,Un as a3,Vn as a4,Wn as a5,Hn as a6,gn as a7,un as a8,In as a9,Gi as aA,Qi as aB,Bi as aC,Ki as aD,Yi as aE,Zi as aF,ao as aG,Hl as aH,$r as aI,Vr as aJ,Xr as aK,Jr as aL,Kr as aM,Gr as aN,Yr as aO,Qr as aP,en as aQ,Sl as aR,Br as aS,bl as aT,Wa as aU,lr as aV,vn as aW,Wt as aX,bn as aY,ja as aZ,gr as aa,vr as ab,yr as ac,Nr as ad,wr as ae,br as af,Sr as ag,_r as ah,zt as ai,fa as aj,An as ak,ta as al,aa as am,ra as an,na as ao,wl as ap,Nl as aq,ba as ar,rn as as,Bl as at,Jl as au,Xl as av,Kl as aw,ui as ax,ro as ay,Wi as az,Fr as b,Ya as c,Wl as d,Wr as e,Sa as f,Nn as g,_n as h,wn as i,Cn as j,En as k,la as l,Ai as m,Li as n,qi as o,Dl as p,Pi as q,Bt as r,Ii as s,Mn as t,Ht as u,$n as v,xn as w,pn as x,fn as y,jn as z};
