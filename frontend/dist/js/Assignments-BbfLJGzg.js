import{r as e,j as s}from"./react-core-JVqWokWt.js";import{M as a,S as t,a as l,e as c,B as r,a3 as i,a4 as n,a5 as d,a6 as m,C as x,L as o,b as h,D as u,w as j,x as p,y as N,_ as g,$ as v,g as y,h as f,i as b,j as w,k as C,a7 as k,c as S,J as _,K as M,Y as D,l as A}from"./main-fde3JC90.js";import{T as O}from"./TeacherSidebar-Bwv8PTW2.js";import{u as P,b as z,c as F,d as H,e as T}from"./useAssignments-DmsJPlD2.js";import{u as $}from"./useTeacher-DJCQuFgv.js";import{N as q}from"./react-router-WAeXREDX.js";import{aq as E,ao as I,$ as L,am as V,aD as B,aE as J,aF as K,au as W,an as X}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";import"./migration-O34B3Isr.js";import"./teacher-BhCI6v5d.js";const Y=()=>{const{user:Y}=a(),{data:Z=[],isLoading:G,error:Q}=P(),{data:R}=$(),U=z(),ee=F(),[se,ae]=e.useState("all"),[te,le]=e.useState(!1),[ce,re]=e.useState(!1),[ie,ne]=e.useState(!1),[de,me]=e.useState(null),[xe,oe]=e.useState(null),[he,ue]=e.useState(""),[je,pe]=e.useState(""),[Ne,ge]=e.useState(""),[ve,ye]=e.useState("homework"),[fe,be]=e.useState(100),[we,Ce]=e.useState(""),[ke,Se]=e.useState(""),[_e,Me]=e.useState([]),[De,Ae]=e.useState(0),[Oe,Pe]=e.useState(""),{data:ze=[]}=H((null==de?void 0:de.id)||0),Fe=T((null==xe?void 0:xe.id)||0);if("teacher"!==(null==Y?void 0:Y.role))return s.jsx(q,{to:"/dashboard",replace:!0});const He=(null==R?void 0:R.students)||[],Te=e.useMemo(()=>Z.reduce((e,s)=>e,0),[Z]),$e=()=>{ue(""),pe(""),ge(""),ye("homework"),be(100),Ce(""),Se(""),Me([])};return s.jsxs(t,{children:[s.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[s.jsx(O,{}),s.jsxs(l,{className:"flex-1",children:[s.jsxs("header",{className:"sticky top-0 z-10 flex h-16 items-center border-b bg-background px-6",children:[s.jsx(c,{}),s.jsxs("h1",{className:"ml-4 text-xl font-semibold flex items-center gap-2",children:[s.jsx(E,{className:"w-5 h-5"}),"Задания"]}),s.jsx("div",{className:"ml-auto",children:s.jsxs(r,{type:"button",onClick:()=>le(!0),children:[s.jsx(I,{className:"w-4 h-4 mr-2"}),"Создать задание"]})})]}),s.jsx("main",{className:"p-6",children:s.jsx("div",{className:"space-y-6",children:s.jsxs(i,{value:se,onValueChange:e=>ae(e),children:[s.jsxs(n,{className:"grid w-full sm:w-auto grid-cols-2",children:[s.jsxs(d,{value:"all",children:["Все задания (",Z.length,")"]}),s.jsxs(d,{value:"grading",children:["На проверке (",Te,")"]})]}),s.jsx(m,{value:"all",className:"space-y-4 mt-6",children:G?s.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,a)=>s.jsx(x,{children:s.jsx(o,{className:"p-6",children:s.jsxs("div",{className:"space-y-3",children:[s.jsx(h,{className:"h-6 w-1/2"}),s.jsx(h,{className:"h-4 w-full"}),s.jsx(h,{className:"h-4 w-2/3"})]})})},`assignment-skeleton-${a}`))}):Q?s.jsx(x,{className:"border-destructive",children:s.jsxs(o,{className:"p-12 text-center",children:[s.jsx(L,{className:"w-12 h-12 mx-auto mb-4 text-destructive"}),s.jsx("h3",{className:"text-lg font-semibold mb-2 text-destructive",children:"Ошибка загрузки заданий"}),s.jsx("p",{className:"text-muted-foreground",children:Q instanceof Error?Q.message:"Не удалось загрузить задания"})]})}):0===Z.length?s.jsx(x,{children:s.jsxs(o,{className:"p-12 text-center",children:[s.jsx(E,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Нет заданий"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"Вы еще не создали ни одного задания"}),s.jsxs(r,{type:"button",onClick:()=>le(!0),children:[s.jsx(I,{className:"w-4 h-4 mr-2"}),"Создать первое задание"]})]})}):s.jsx("div",{className:"grid gap-4",children:Z.map(e=>{const a=new Date(e.due_date),t=a<new Date;return s.jsxs(x,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[s.jsx(_,{children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs(M,{className:"text-lg flex items-center gap-2",children:[s.jsx(E,{className:"w-5 h-5"}),e.title]}),s.jsx(D,{className:"mt-2",children:e.description})]}),s.jsxs(S,{variant:t?"destructive":"outline",children:["draft"===e.status&&"Черновик","published"===e.status&&"Опубликовано","closed"===e.status&&"Закрыто"]})]})}),s.jsxs(o,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(K,{className:"w-4 h-4"}),s.jsxs("span",{children:["Срок: ",B(a,"dd MMMM yyyy, HH:mm",{locale:J})]})]}),s.jsxs(S,{variant:"outline",children:[e.max_score," баллов"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(S,{variant:"secondary",className:"text-xs",children:["homework"===e.type&&"Домашнее задание","test"===e.type&&"Тест","project"===e.type&&"Проект","essay"===e.type&&"Эссе","practical"===e.type&&"Практическая работа"]}),s.jsxs(S,{variant:"outline",className:"text-xs",children:["Уровень ",e.difficulty_level]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(r,{type:"button",size:"sm",variant:"outline",onClick:()=>(e=>{me(e),re(!0)})(e),children:[s.jsx(W,{className:"w-4 h-4 mr-2"}),"Ответы"]}),s.jsxs(r,{type:"button",size:"sm",variant:"destructive",onClick:()=>(async e=>{window.confirm("Вы уверены, что хотите удалить это задание?")&&await ee.mutateAsync(e)})(e.id),disabled:ee.isPending,children:[s.jsx(X,{className:"w-4 h-4 mr-2"}),"Удалить"]})]})]})]},e.id)})})}),s.jsx(m,{value:"grading",className:"space-y-4 mt-6",children:s.jsx(x,{children:s.jsxs(o,{className:"p-12 text-center",children:[s.jsx(V,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Все проверено"}),s.jsx("p",{className:"text-muted-foreground",children:"Нет заданий, ожидающих проверки"})]})})})]})})})]})]}),s.jsx(u,{open:te,onOpenChange:le,children:s.jsxs(j,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsx(p,{children:s.jsx(N,{children:"Создать задание"})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Название"}),s.jsx(g,{value:he,onChange:e=>ue(e.target.value),placeholder:"Название задания"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Описание"}),s.jsx(v,{value:je,onChange:e=>pe(e.target.value),placeholder:"Краткое описание задания",rows:3})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Инструкции"}),s.jsx(v,{value:Ne,onChange:e=>ge(e.target.value),placeholder:"Подробные инструкции по выполнению",rows:5})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Тип"}),s.jsxs(y,{value:ve,onValueChange:ye,children:[s.jsx(f,{children:s.jsx(b,{})}),s.jsxs(w,{children:[s.jsx(C,{value:"homework",children:"Домашнее задание"}),s.jsx(C,{value:"test",children:"Тест"}),s.jsx(C,{value:"project",children:"Проект"}),s.jsx(C,{value:"essay",children:"Эссе"}),s.jsx(C,{value:"practical",children:"Практическая работа"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Максимальный балл"}),s.jsx(g,{type:"number",value:fe,onChange:e=>be(Number(e.target.value)),min:1})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Дата начала"}),s.jsx(g,{type:"datetime-local",value:we,onChange:e=>Ce(e.target.value)})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Срок сдачи"}),s.jsx(g,{type:"datetime-local",value:ke,onChange:e=>Se(e.target.value)})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Назначить студентам (опционально)"}),s.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Выберите студентов для назначения задания"}),s.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-lg p-2 space-y-1",children:He.map(e=>s.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-muted rounded cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:_e.includes(e.id),onChange:s=>{s.target.checked?Me([..._e,e.id]):Me(_e.filter(s=>s!==e.id))},className:"rounded"}),s.jsx("span",{className:"text-sm",children:e.full_name})]},e.id))})]})]}),s.jsxs(k,{children:[s.jsx(r,{type:"button",variant:"outline",onClick:()=>{le(!1),$e()},children:"Отмена"}),s.jsx(r,{type:"button",onClick:async()=>{if(!(he.trim()&&je.trim()&&we&&ke))return;const e={title:he,description:je,instructions:Ne,type:ve,max_score:fe,start_date:new Date(we).toISOString(),due_date:new Date(ke).toISOString(),assigned_to:_e};try{await U.mutateAsync(e),le(!1),$e()}catch(s){A.error("Failed to create assignment:",s)}},disabled:!he.trim()||!je.trim()||!we||!ke||U.isPending,children:U.isPending?"Создание...":"Создать"})]})]})}),s.jsx(u,{open:ce,onOpenChange:re,children:s.jsxs(j,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[s.jsx(p,{children:s.jsxs(N,{children:["Ответы на задание: ",null==de?void 0:de.title]})}),s.jsx("div",{className:"space-y-4",children:0===ze.length?s.jsxs("div",{className:"p-12 text-center",children:[s.jsx(E,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),s.jsx("p",{className:"text-muted-foreground",children:"Пока нет ответов на это задание"})]}):s.jsx("div",{className:"space-y-3",children:ze.map(e=>s.jsx(x,{children:s.jsx(o,{className:"p-4",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium",children:e.student.full_name}),s.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Отправлено: ",B(new Date(e.submitted_at),"dd MMMM yyyy, HH:mm",{locale:J})]}),"graded"===e.status&&void 0!==e.score&&s.jsxs(S,{variant:"outline",className:"mt-2",children:[e.score," / ",e.max_score," баллов"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:["submitted"===e.status&&s.jsx(r,{type:"button",size:"sm",onClick:()=>{oe(e),Ae(0),Pe(""),ne(!0)},children:"Оценить"}),s.jsxs(S,{variant:"graded"===e.status?"default":"secondary",children:["submitted"===e.status&&"Отправлено","graded"===e.status&&"Оценено","returned"===e.status&&"Возвращено"]})]})]})})},e.id))})})]})}),s.jsx(u,{open:ie,onOpenChange:ne,children:s.jsxs(j,{className:"max-w-2xl",children:[s.jsx(p,{children:s.jsxs(N,{children:["Оценить ответ: ",null==xe?void 0:xe.student.full_name]})}),s.jsx("div",{className:"space-y-4",children:xe&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[s.jsx("p",{className:"text-sm font-medium mb-2",children:"Ответ студента:"}),s.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:xe.content})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"text-sm font-medium",children:["Балл (из ",xe.max_score,")"]}),s.jsx(g,{type:"number",value:De,onChange:e=>Ae(Number(e.target.value)),min:0,max:xe.max_score||100})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Комментарий"}),s.jsx(v,{value:Oe,onChange:e=>Pe(e.target.value),placeholder:"Напишите комментарий к ответу...",rows:5})]})]})}),s.jsxs(k,{children:[s.jsx(r,{type:"button",variant:"outline",onClick:()=>{ne(!1),Ae(0),Pe(""),oe(null)},children:"Отмена"}),s.jsx(r,{type:"button",onClick:async()=>{if(xe)try{await Fe.mutateAsync({score:De,feedback:Oe,status:"graded"}),ne(!1),Ae(0),Pe(""),oe(null)}catch(e){A.error("Failed to grade submission:",e)}},disabled:Fe.isPending,children:Fe.isPending?"Сохранение...":"Сохранить оценку"})]})]})})]})};export{Y as default};
