{
  "audit_configuration": {
    "version": "1.0.0",
    "last_updated": "2025-12-27",
    "environment": "production",
    "compliance_framework": ["GDPR", "SOC2_TYPE_II", "ISO_27001"],
    "description": "Comprehensive audit trail configuration for THE_BOT Platform compliance"
  },
  "cloudtrail_configuration": {
    "enabled": true,
    "multi_region": true,
    "log_file_validation": true,
    "include_global_events": true,
    "organization_trail": false,
    "encryption": {
      "enabled": true,
      "kms_key": "alias/thebot-audit-logs-production",
      "algorithm": "aws:kms"
    },
    "s3_logging": {
      "bucket": "thebot-audit-logs-{account-id}-{region}",
      "prefix": "cloudtrail/",
      "versioning": "Enabled",
      "mfa_delete": true,
      "public_access_blocked": true
    },
    "cloudwatch_logs": {
      "enabled": true,
      "group": "/aws/thebot/compliance/production",
      "retention_days": 90,
      "retention_policy": "GDPR_MINIMUM_90_DAYS"
    }
  },
  "event_logging": {
    "management_events": {
      "enabled": true,
      "read_write_type": "All",
      "description": "All API calls for compliance tracking"
    },
    "data_events": {
      "enabled": true,
      "resources": [
        {
          "type": "AWS::S3::Object",
          "values": ["arn:aws:s3:::*/"],
          "description": "S3 object access logging"
        },
        {
          "type": "AWS::Lambda::Function",
          "values": ["arn:aws:lambda:*:*:function/*"],
          "description": "Lambda function invocations"
        },
        {
          "type": "AWS::RDS::DBCluster",
          "values": ["arn:aws:rds:*:*:cluster/*"],
          "description": "Database cluster access"
        },
        {
          "type": "AWS::DynamoDB::Table",
          "values": ["arn:aws:dynamodb:*:*:table/*"],
          "description": "DynamoDB table operations"
        }
      ]
    },
    "insight_events": {
      "enabled": true,
      "types": [
        "ApiCallRateInsight",
        "ApiCallRateUnusualActivity"
      ],
      "description": "AWS CloudTrail Insights for anomaly detection"
    }
  },
  "data_retention_policy": {
    "version": "1.0.0",
    "description": "Data retention policy for GDPR and regulatory compliance",
    "retention_periods": {
      "audit_logs": {
        "duration_days": 365,
        "archival_days": 30,
        "archival_storage": "GLACIER",
        "gdpr_compliant": true,
        "regulation": "GDPR Article 5 - Data Integrity and Confidentiality"
      },
      "cloudwatch_logs": {
        "duration_days": 90,
        "regulation": "SOC 2 Type II - Minimum 90 days",
        "automation": "AWS CloudWatch Logs automatic deletion"
      },
      "access_logs": {
        "duration_days": 90,
        "description": "S3 access logs, ELB access logs"
      },
      "user_data": {
        "duration_days": 2555,
        "description": "Active user data retention (7 years for legal compliance)",
        "gdpr_right_to_be_forgotten": true,
        "deletion_process": "Automated anonymization on user deletion"
      },
      "deleted_user_data": {
        "duration_days": 30,
        "description": "Archived deleted user data in secure storage",
        "encryption": "AES-256"
      },
      "backup_data": {
        "duration_days": 90,
        "archival_days": 30,
        "description": "Database backups retention"
      },
      "logs_temporary": {
        "duration_days": 7,
        "description": "Temporary application logs"
      }
    }
  },
  "gdpr_compliance": {
    "enabled": true,
    "framework": "GDPR (General Data Protection Regulation)",
    "enforcement_date": "2018-05-25",
    "data_subject_rights": {
      "right_to_access": {
        "enabled": true,
        "endpoint": "POST /api/gdpr/data-export",
        "format": "ZIP with JSON",
        "response_time_days": 30,
        "description": "Allow users to download all their personal data"
      },
      "right_to_rectification": {
        "enabled": true,
        "endpoints": [
          "PUT /api/users/profile",
          "PUT /api/users/contact-information"
        ],
        "description": "Allow users to correct inaccurate data"
      },
      "right_to_erasure": {
        "enabled": true,
        "endpoint": "DELETE /api/gdpr/account",
        "process": "User data anonymization + deletion",
        "retention_after_deletion": 30,
        "hard_delete_after": 90,
        "audit_trail_retention": "Indefinite (legal requirement)"
      },
      "right_to_restrict_processing": {
        "enabled": true,
        "description": "Allow users to restrict their data usage"
      },
      "right_to_data_portability": {
        "enabled": true,
        "endpoint": "POST /api/gdpr/data-export",
        "formats": ["JSON", "CSV"],
        "description": "Export data in structured machine-readable format"
      },
      "right_to_object": {
        "enabled": true,
        "description": "Object to processing for marketing purposes"
      },
      "automated_decision_making": {
        "enabled": false,
        "description": "No fully automated decisions affecting users"
      }
    },
    "data_processing_agreements": {
      "processor_contracts": true,
      "third_party_processing": [
        {
          "vendor": "AWS",
          "purpose": "Infrastructure hosting",
          "data_processing_agreement": "AWS Data Processing Agreement"
        },
        {
          "vendor": "YooKassa",
          "purpose": "Payment processing",
          "data_processing_agreement": "PCI DSS Compliant"
        }
      ]
    },
    "privacy_notice": {
      "location": "/legal/privacy-policy",
      "required_information": [
        "Data controller identity",
        "Processing purposes",
        "Legal basis for processing",
        "Recipients of data",
        "Retention period",
        "Data subject rights",
        "Complaint rights",
        "Automated decision-making"
      ]
    },
    "data_breach_notification": {
      "enabled": true,
      "authority_notification_hours": 72,
      "incident_response_team": "security@thebot.com",
      "procedure": "Automatic SNS notification on security events"
    }
  },
  "soc2_compliance": {
    "enabled": true,
    "framework": "SOC 2 Type II",
    "audit_period": "12-month rolling",
    "trust_service_criteria": {
      "cc_security": {
        "enabled": true,
        "controls": [
          "CC6.1 - Logical access controls",
          "CC6.2 - Authentication",
          "CC7.1 - Access logging",
          "CC7.2 - Log retention"
        ]
      },
      "cc_availability": {
        "enabled": true,
        "controls": [
          "A1.1 - Availability objectives",
          "A1.2 - System monitoring"
        ]
      },
      "cc_processing_integrity": {
        "enabled": true,
        "controls": [
          "PI1.1 - System capabilities"
        ]
      },
      "cc_confidentiality": {
        "enabled": true,
        "controls": [
          "C1.1 - Confidentiality controls"
        ]
      }
    },
    "audit_requirements": {
      "log_retention": "Minimum 90 days",
      "access_logging": "All user actions logged",
      "change_management": "Documented and approved",
      "incident_response": "Documented procedures"
    }
  },
  "monitoring_and_alerting": {
    "cloudwatch_metrics": {
      "unauthorized_api_calls": {
        "enabled": true,
        "threshold": 1,
        "period_seconds": 300,
        "actions": ["SNS_NOTIFICATION"]
      },
      "policy_changes": {
        "enabled": true,
        "threshold": 1,
        "period_seconds": 300,
        "actions": ["SNS_NOTIFICATION"]
      },
      "cloudtrail_changes": {
        "enabled": true,
        "threshold": 1,
        "period_seconds": 300,
        "actions": ["SNS_NOTIFICATION"]
      },
      "root_account_usage": {
        "enabled": true,
        "threshold": 1,
        "period_seconds": 300,
        "actions": ["SNS_NOTIFICATION"]
      },
      "mfa_disabled": {
        "enabled": true,
        "threshold": 1,
        "period_seconds": 300,
        "actions": ["SNS_NOTIFICATION"]
      },
      "s3_public_access": {
        "enabled": true,
        "threshold": 1,
        "period_seconds": 300,
        "actions": ["SNS_NOTIFICATION"]
      }
    },
    "log_filter_patterns": {
      "unauthorized_access": "{ ($.errorCode = \"*UnauthorizedOperation\") || ($.errorCode = \"AccessDenied*\") }",
      "policy_changes": "{ ($.eventName = DeleteGroupPolicy) || ($.eventName = DeleteRolePolicy) || ($.eventName = PutGroupPolicy) || ($.eventName = AttachRolePolicy) || ($.eventName = DetachRolePolicy) }",
      "cloudtrail_modifications": "{ ($.eventName = CreateTrail) || ($.eventName = UpdateTrail) || ($.eventName = DeleteTrail) || ($.eventName = StopLogging) }",
      "root_usage": "{ $.userIdentity.type = \"Root\" && $.userIdentity.invokedBy NOT EXISTS }",
      "mfa_changes": "{ ($.eventName = DeactivateMFADevice) || ($.eventName = DeleteVirtualMFADevice) }"
    },
    "notification_channels": {
      "email": {
        "enabled": true,
        "address": "security@thebot.com",
        "alerts": "All critical events"
      },
      "slack": {
        "enabled": true,
        "webhook": "SLACK_WEBHOOK_URL",
        "channel": "#compliance-alerts",
        "alerts": "Critical and high severity"
      },
      "pagerduty": {
        "enabled": false,
        "integration_key": "PagerDuty integration key",
        "alerts": "Severity >= High"
      }
    }
  },
  "access_control": {
    "mfa_requirement": {
      "enabled": true,
      "root_account": true,
      "iam_users": true,
      "service_accounts": false,
      "requirement_level": "MANDATORY"
    },
    "password_policy": {
      "minimum_length": 12,
      "require_uppercase": true,
      "require_lowercase": true,
      "require_numbers": true,
      "require_special_characters": true,
      "password_expiration_days": 90,
      "password_reuse_prevention": 5,
      "max_login_attempts": 5,
      "lockout_duration_minutes": 30
    },
    "role_based_access_control": {
      "enabled": true,
      "principle": "Least Privilege",
      "regular_review": "Quarterly",
      "approval_process": "Manager + Security team"
    },
    "privileged_access_management": {
      "enabled": true,
      "root_account_usage": "Prohibited except emergencies",
      "emergency_access": "Documented and approved",
      "session_recording": "All privileged sessions logged"
    }
  },
  "encryption": {
    "at_rest": {
      "enabled": true,
      "algorithm": "AES-256",
      "kms_managed": true,
      "key_rotation": "Automatic (yearly)"
    },
    "in_transit": {
      "enabled": true,
      "protocol": "TLS 1.2+",
      "certificate_management": "AWS ACM"
    },
    "key_management": {
      "kms_key_id": "alias/thebot-audit-logs-production",
      "key_rotation_enabled": true,
      "key_rotation_period_days": 365,
      "key_policy": "Deny unencrypted operations"
    }
  },
  "compliance_checks": {
    "automated_checks": {
      "enabled": true,
      "frequency": "Daily",
      "tools": ["AWS Config", "AWS Security Hub", "AWS GuardDuty"]
    },
    "manual_reviews": {
      "frequency": "Quarterly",
      "scope": [
        "Access control reviews",
        "Encryption verification",
        "Log retention validation",
        "Change management records"
      ]
    },
    "third_party_audits": {
      "enabled": true,
      "frequency": "Annually",
      "scope": "SOC 2 Type II"
    }
  },
  "incident_response": {
    "enabled": true,
    "contact_email": "security@thebot.com",
    "escalation_procedure": [
      "1. Automatic alert via SNS (0-5 min)",
      "2. Manual review by security team (5-30 min)",
      "3. Escalation to management (30-60 min)",
      "4. External notification if required (within 72 hours per GDPR)"
    ],
    "response_time_sla": {
      "critical": "30 minutes",
      "high": "2 hours",
      "medium": "8 hours",
      "low": "24 hours"
    }
  },
  "documentation": {
    "audit_trail": "Complete API call history stored in S3 and CloudWatch",
    "evidence_location": "s3://thebot-audit-logs-{account-id}-{region}/cloudtrail/",
    "log_format": "JSON (CloudTrail standard format)",
    "retention_policy_document": "docs/COMPLIANCE_AUDIT.md",
    "gdpr_procedures": "docs/COMPLIANCE_AUDIT.md#GDPR",
    "soc2_procedures": "docs/COMPLIANCE_AUDIT.md#SOC2",
    "incident_response_plan": "docs/INCIDENT_RESPONSE_PLAN.md"
  }
}
