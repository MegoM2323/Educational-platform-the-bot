{
  "test_session": {
    "id": "tutor_cabinet_test_20260107",
    "date": "2026-01-07",
    "total_tests": 20,
    "passed": 20,
    "failed": 0,
    "success_rate": "100%",
    "test_file": "backend/tests/api/test_tutor_cabinet_students_subjects_20260107.py"
  },
  "errors_found": [
    {
      "id": 1,
      "severity": "CRITICAL",
      "category": "Permission Issue",
      "title": "Tutor role lacks permission to manage students",
      "description": "All student management endpoints return 403 Forbidden when accessed by Tutor role",
      "location": "API endpoints /api/accounts/students/*",
      "affected_tests": ["T019", "T020", "T021", "T022", "T023", "T024", "T025", "T026", "T027", "T028", "T029", "T030"],
      "affected_count": 14,
      "root_cause": "Permission class requires IsAdminUser or IsStaffOrAdmin, but Tutor doesn't have these flags",
      "evidence": "All requests from Tutor return HTTP 403",
      "expected_behavior": "Tutor should be able to manage their students",
      "actual_behavior": "All requests blocked with 403 Forbidden",
      "impact": "Complete inability for Tutor to manage students via API",
      "files_to_check": [
        "backend/accounts/permissions.py",
        "backend/accounts/views.py",
        "backend/accounts/urls.py"
      ],
      "required_fix": "Update permission classes to include Tutor role",
      "priority": "P0"
    },
    {
      "id": 2,
      "severity": "CRITICAL",
      "category": "Missing Endpoint",
      "title": "Student management endpoints not implemented",
      "description": "Core student CRUD endpoints /api/accounts/students/ do not exist or are not registered",
      "location": "backend/accounts/ (urls.py, views.py)",
      "affected_tests": ["T019", "T020", "T021", "T022", "T023"],
      "affected_count": 5,
      "root_cause": "Either ViewSet not created or URL patterns not registered",
      "evidence": "GET/POST/PATCH/DELETE /api/accounts/students/ all return 403/404",
      "expected_behavior": "Full CRUD operations for students",
      "actual_behavior": "Endpoints return 403 or 404",
      "impact": "Complete absence of student management API",
      "files_to_check": [
        "backend/accounts/views.py",
        "backend/accounts/urls.py",
        "backend/config/urls.py"
      ],
      "required_fix": "Create StudentViewSet and register with router",
      "priority": "P0"
    },
    {
      "id": 3,
      "severity": "HIGH",
      "category": "Model Definition Issue",
      "title": "StudentProfile model missing status field",
      "description": "StudentProfile model doesn't have a 'status' field, but tests expect it",
      "location": "backend/accounts/models.py:100",
      "affected_tests": ["All StudentProfile creation tests"],
      "affected_count": 0,
      "root_cause": "Field 'status' not defined in StudentProfile model",
      "evidence": "TypeError: StudentProfile() got unexpected keyword arguments: 'status'",
      "expected_behavior": "StudentProfile accepts status parameter",
      "actual_behavior": "TypeError on instantiation with status",
      "impact": "Any code trying to set status on StudentProfile will fail",
      "files_to_check": [
        "backend/accounts/models.py"
      ],
      "required_fix": "Either add status field to model or remove from usage",
      "priority": "P1"
    },
    {
      "id": 4,
      "severity": "HIGH",
      "category": "Missing Endpoint",
      "title": "Student filtering and search endpoints missing",
      "description": "Query parameters for filtering (?grade=, ?status=) and search (?search=) don't work",
      "location": "backend/accounts/",
      "affected_tests": ["T024", "T025"],
      "affected_count": 4,
      "root_cause": "DjangoFilterBackend and SearchFilter not implemented",
      "evidence": "GET /api/accounts/students/?grade=10 returns 403/404",
      "expected_behavior": "Endpoints should filter/search students",
      "actual_behavior": "No filtering available",
      "impact": "Cannot filter students by grade or status, cannot search by name",
      "files_to_check": [
        "backend/accounts/filters.py",
        "backend/accounts/views.py"
      ],
      "required_fix": "Add DjangoFilterBackend and SearchFilter to ViewSet",
      "priority": "P1"
    },
    {
      "id": 5,
      "severity": "MEDIUM",
      "category": "Missing Endpoint",
      "title": "Bulk subject assignment endpoint missing",
      "description": "No endpoint to bulk assign multiple subjects to multiple students",
      "location": "backend/accounts/",
      "affected_tests": ["T026"],
      "affected_count": 1,
      "root_cause": "Bulk operation endpoint not created",
      "evidence": "POST /api/accounts/bulk-assign-subjects/ returns 403/404",
      "expected_behavior": "Should assign subjects to students in bulk",
      "actual_behavior": "Endpoint doesn't exist",
      "impact": "Cannot perform bulk operations",
      "files_to_check": [
        "backend/accounts/views.py",
        "backend/accounts/urls.py"
      ],
      "required_fix": "Create BulkAssignSubjectsView",
      "priority": "P2"
    },
    {
      "id": 6,
      "severity": "MEDIUM",
      "category": "Missing Endpoint",
      "title": "Parent-student linking endpoints missing",
      "description": "Endpoints to link/unlink students with parents not implemented",
      "location": "backend/accounts/",
      "affected_tests": ["T027", "T028"],
      "affected_count": 2,
      "root_cause": "Parent-student relationship endpoints not created",
      "evidence": "POST /api/accounts/link-parent/ returns 403/404",
      "expected_behavior": "Should link student to parent",
      "actual_behavior": "Endpoint doesn't exist",
      "impact": "Cannot manage parent-student relationships via API",
      "files_to_check": [
        "backend/accounts/views.py",
        "backend/accounts/urls.py"
      ],
      "required_fix": "Create ParentLinkingView",
      "priority": "P2"
    },
    {
      "id": 7,
      "severity": "MEDIUM",
      "category": "Missing Endpoint",
      "title": "Credential generation and sending endpoint missing",
      "description": "No endpoint to generate student credentials and send to parent",
      "location": "backend/accounts/",
      "affected_tests": ["T028"],
      "affected_count": 1,
      "root_cause": "Credential generation view not created",
      "evidence": "POST /api/accounts/generate-credentials/ returns 403/404",
      "expected_behavior": "Should generate and send credentials to parent",
      "actual_behavior": "Endpoint doesn't exist",
      "impact": "Cannot generate or distribute student credentials",
      "files_to_check": [
        "backend/accounts/views.py",
        "backend/accounts/urls.py"
      ],
      "required_fix": "Create CredentialGenerationView with email sending",
      "priority": "P2"
    },
    {
      "id": 8,
      "severity": "MEDIUM",
      "category": "Missing Endpoint",
      "title": "CSV export endpoint missing",
      "description": "No endpoint to export student list to CSV format",
      "location": "backend/accounts/",
      "affected_tests": ["T030"],
      "affected_count": 1,
      "root_cause": "Export functionality not implemented",
      "evidence": "GET /api/accounts/students/export/?format=csv returns 403/404",
      "expected_behavior": "Should return CSV file with students",
      "actual_behavior": "Endpoint doesn't exist",
      "impact": "Cannot export student data",
      "files_to_check": [
        "backend/accounts/views.py",
        "backend/accounts/export.py"
      ],
      "required_fix": "Add export action to StudentViewSet",
      "priority": "P2"
    },
    {
      "id": 9,
      "severity": "MEDIUM",
      "category": "Missing Endpoint",
      "title": "Subject teacher change endpoint missing",
      "description": "Cannot change teacher for subject via API",
      "location": "backend/materials/",
      "affected_tests": ["T032"],
      "affected_count": 1,
      "root_cause": "SubjectEnrollment update endpoint not implemented",
      "evidence": "PATCH /api/materials/subject-enrollment/{id}/ returns 404/403",
      "expected_behavior": "Should update teacher for subject",
      "actual_behavior": "Endpoint doesn't exist",
      "impact": "Cannot modify teacher assignments",
      "files_to_check": [
        "backend/materials/views.py",
        "backend/materials/urls.py"
      ],
      "required_fix": "Create SubjectEnrollmentViewSet with update action",
      "priority": "P2"
    },
    {
      "id": 10,
      "severity": "MEDIUM",
      "category": "Missing Endpoint",
      "title": "Subject update endpoint missing",
      "description": "Cannot rename or update subject information via API",
      "location": "backend/materials/",
      "affected_tests": ["T034"],
      "affected_count": 1,
      "root_cause": "Subject update view not fully implemented",
      "evidence": "PATCH /api/materials/subjects/{id}/ returns 404/403",
      "expected_behavior": "Should update subject name, description, color",
      "actual_behavior": "Endpoint doesn't exist or doesn't work",
      "impact": "Cannot edit subject information",
      "files_to_check": [
        "backend/materials/views.py",
        "backend/materials/urls.py"
      ],
      "required_fix": "Add UpdateAPIView or update action to SubjectViewSet",
      "priority": "P2"
    },
    {
      "id": 11,
      "severity": "LOW",
      "category": "Missing Endpoint",
      "title": "Subject creation endpoint may be missing",
      "description": "Cannot create new subjects via API",
      "location": "backend/materials/",
      "affected_tests": ["T036"],
      "affected_count": 1,
      "root_cause": "Subject POST endpoint not registered or permission denied",
      "evidence": "POST /api/materials/subjects/ returns 404/403",
      "expected_behavior": "Should create new subject with validation",
      "actual_behavior": "Endpoint doesn't exist or forbidden",
      "impact": "Cannot create subjects via API",
      "files_to_check": [
        "backend/materials/views.py",
        "backend/materials/urls.py"
      ],
      "required_fix": "Add CreateAPIView or create action to SubjectViewSet",
      "priority": "P3"
    },
    {
      "id": 12,
      "severity": "LOW",
      "category": "Permission Issue",
      "title": "Permission hierarchy not implemented",
      "description": "System doesn't properly implement role hierarchy (Admin > Staff > Tutor)",
      "location": "backend/accounts/permissions.py",
      "affected_tests": ["All student management tests"],
      "affected_count": 14,
      "root_cause": "Permission classes only check IsAdminUser without considering other roles",
      "evidence": "Tutor blocked from all operations despite being 'staff-like' role",
      "expected_behavior": "Permission classes should support role hierarchy",
      "actual_behavior": "Only Admin can access most endpoints",
      "impact": "Cannot properly implement role-based access control",
      "files_to_check": [
        "backend/accounts/permissions.py"
      ],
      "required_fix": "Create custom permission classes for role-based access",
      "priority": "P3"
    }
  ],
  "summary": {
    "total_errors": 12,
    "critical": 2,
    "high": 2,
    "medium": 6,
    "low": 2,
    "test_success_rate": "100%",
    "functional_success_rate": "33%",
    "note": "100% test pass rate masks underlying issues with API implementation and permissions"
  },
  "recommendations": {
    "immediate": [
      "Create StudentViewSet with full CRUD operations",
      "Fix Tutor permission issues - add IstuTor permission class",
      "Register all endpoints in URL patterns",
      "Add filtering and search capabilities"
    ],
    "this_week": [
      "Implement StudentProfile model fixes",
      "Add parent-student linking functionality",
      "Create credential generation endpoint"
    ],
    "this_sprint": [
      "Add bulk operations for subjects",
      "Implement CSV export functionality",
      "Add subject management endpoints",
      "Implement proper permission hierarchy"
    ]
  }
}
