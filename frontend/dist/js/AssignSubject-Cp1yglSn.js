import{r as e,j as s}from"./react-core-JVqWokWt.js";import{u as a,S as t,a as r,b as i,B as l,V as c,ak as n,W as d,C as o,Z as m,g as h,h as x,i as j,j as u,k as p,c as f,a9 as v,f as g,l as N}from"./main-fde3JC90.js";import{T as b}from"./TeacherSidebar-Bwv8PTW2.js";import{u as y}from"./react-router-WAeXREDX.js";import{be as w,bG as S,ap as k,aa as C,bc as _}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";const q=()=>{var q;const E=y(),{toast:F}=a(),[T,z]=e.useState([]),[O,V]=e.useState([]),[W,$]=e.useState(""),[B,G]=e.useState([]),[I,J]=e.useState(!0),[P,Z]=e.useState(!1);e.useEffect(()=>{(async()=>{var e,s;try{J(!0);const a=await g.request("/materials/teacher/subjects/");(null==(e=a.data)?void 0:e.subjects)&&z(a.data.subjects);const t=await g.request("/materials/teacher/all-students/");if(null==(s=t.data)?void 0:s.students){const e=t.data.students.filter(e=>"student"===e.role);V(e)}}catch(a){N.error("Error fetching data:",a),F({title:"Ошибка загрузки данных",description:"Не удалось загрузить предметы и студентов",variant:"destructive"})}finally{J(!1)}})()},[F]);const A=e=>{G(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])};return I?s.jsxs(t,{children:[s.jsx(b,{}),s.jsx(r,{children:s.jsxs("div",{className:"flex flex-col gap-4 p-6",children:[s.jsx(i,{className:"h-12 w-full"}),s.jsx(i,{className:"h-64 w-full"}),s.jsx(i,{className:"h-64 w-full"})]})})]}):s.jsxs(t,{children:[s.jsx(b,{}),s.jsx(r,{children:s.jsxs("div",{className:"flex flex-col gap-6 p-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(l,{type:"button",variant:"ghost",size:"icon",onClick:()=>E("/dashboard/teacher"),children:s.jsx(w,{className:"h-4 w-4"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Назначение предмета"}),s.jsx("p",{className:"text-muted-foreground",children:"Вы можете назначить любой предмет любому студенту"})]})]})}),s.jsxs(c,{children:[s.jsx(S,{className:"h-4 w-4"}),s.jsx(n,{children:"Свободный выбор предметов"}),s.jsx(d,{children:"Вы можете назначить любой предмет из списка, даже если он ещё не назначен вам как преподавателю. Система автоматически добавит выбранный предмет в ваш список после назначения студентам."})]}),s.jsxs(o,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx(k,{className:"h-5 w-5 text-primary"}),s.jsx("h2",{className:"text-xl font-semibold",children:"Выбор предмета"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"subject",children:"Предмет"}),s.jsxs(h,{value:W,onValueChange:$,children:[s.jsx(x,{id:"subject",children:s.jsx(j,{placeholder:"Выберите предмет"})}),s.jsx(u,{children:T.map(e=>s.jsx(p,{value:e.id.toString(),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),s.jsx("span",{children:e.name}),e.is_assigned&&s.jsx(f,{variant:"secondary",className:"ml-2",children:"Ваш предмет"}),e.student_count>0&&s.jsxs(f,{variant:"outline",className:"ml-2",children:[e.student_count," студентов"]})]})},e.id))})]}),W&&s.jsx("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:s.jsx("p",{className:"text-sm text-muted-foreground",children:null==(q=T.find(e=>e.id.toString()===W))?void 0:q.description})})]})]}),s.jsxs(o,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(C,{className:"h-5 w-5 text-primary"}),s.jsx("h2",{className:"text-xl font-semibold",children:"Выбор студентов"})]}),s.jsxs(f,{variant:"outline",children:["Выбрано: ",B.length]})]}),s.jsx("div",{className:"mb-4",children:s.jsx(l,{type:"button",variant:"outline",size:"sm",onClick:()=>{B.length===O.length?G([]):G(O.map(e=>e.id))},children:B.length===O.length?"Снять выделение":"Выбрать всех"})}),s.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:O.map(e=>s.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg border hover:bg-muted/50 cursor-pointer",onClick:()=>A(e.id),children:[s.jsx(v,{id:`student-${e.id}`,checked:B.includes(e.id),onCheckedChange:()=>A(e.id)}),s.jsx("label",{htmlFor:`student-${e.id}`,className:"flex-1 cursor-pointer",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.name}),s.jsx("p",{className:"text-sm text-muted-foreground",children:e.email})]}),e.profile&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{variant:"outline",children:e.profile.grade}),s.jsxs(f,{variant:"secondary",children:["Прогресс: ",e.profile.progress_percentage,"%"]})]})]})})]},e.id))})]}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx(l,{type:"button",variant:"outline",onClick:()=>E("/dashboard/teacher"),children:"Отмена"}),s.jsx(l,{type:"button",onClick:async()=>{var e;if(W)if(0!==B.length)try{Z(!0);const s=await g.request("/materials/teacher/subjects/assign/",{method:"POST",body:JSON.stringify({subject_id:parseInt(W),student_ids:B})});if(s.error)throw new Error(s.error);F({title:"Успешно",description:(null==(e=s.data)?void 0:e.message)||"Предмет успешно назначен студентам"}),E("/dashboard/teacher")}catch(s){N.error("Error assigning subject:",s),F({title:"Ошибка",description:s.message||"Не удалось назначить предмет",variant:"destructive"})}finally{Z(!1)}else F({title:"Ошибка",description:"Выберите хотя бы одного студента",variant:"destructive"});else F({title:"Ошибка",description:"Выберите предмет",variant:"destructive"})},disabled:P||!W||0===B.length,children:P?s.jsx(s.Fragment,{children:"Сохранение..."}):s.jsxs(s.Fragment,{children:[s.jsx(_,{className:"h-4 w-4 mr-2"}),"Назначить предмет"]})})]})]})})]})};export{q as default};
