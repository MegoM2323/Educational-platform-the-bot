version: '3.8'

services:
  # Redis Cluster Master 1
  redis-6379:
    image: redis:7-alpine
    container_name: redis-cluster-6379
    ports:
      - "6379:6379"
      - "16379:16379"
    volumes:
      - ./redis-6379.conf:/usr/local/etc/redis/redis.conf
      - redis-6379-data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6379", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped

  redis-6380:
    image: redis:7-alpine
    container_name: redis-cluster-6380
    ports:
      - "6380:6380"
      - "16380:16380"
    volumes:
      - ./redis-6380.conf:/usr/local/etc/redis/redis.conf
      - redis-6380-data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6380", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped
    depends_on:
      - redis-6379

  redis-6381:
    image: redis:7-alpine
    container_name: redis-cluster-6381
    ports:
      - "6381:6381"
      - "16381:16381"
    volumes:
      - ./redis-6381.conf:/usr/local/etc/redis/redis.conf
      - redis-6381-data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6381", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped
    depends_on:
      - redis-6379

  redis-6382:
    image: redis:7-alpine
    container_name: redis-cluster-6382
    ports:
      - "6382:6382"
      - "16382:16382"
    volumes:
      - ./redis-6382.conf:/usr/local/etc/redis/redis.conf
      - redis-6382-data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6382", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped
    depends_on:
      - redis-6379

  redis-6383:
    image: redis:7-alpine
    container_name: redis-cluster-6383
    ports:
      - "6383:6383"
      - "16383:16383"
    volumes:
      - ./redis-6383.conf:/usr/local/etc/redis/redis.conf
      - redis-6383-data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6383", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped
    depends_on:
      - redis-6379

  redis-6384:
    image: redis:7-alpine
    container_name: redis-cluster-6384
    ports:
      - "6384:6384"
      - "16384:16384"
    volumes:
      - ./redis-6384.conf:/usr/local/etc/redis/redis.conf
      - redis-6384-data:/data
    command: redis-server /usr/local/etc/redis/redis.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "6384", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped
    depends_on:
      - redis-6379

  redis-sentinel-1:
    image: redis:7-alpine
    container_name: redis-sentinel-1
    ports:
      - "26379:26379"
    volumes:
      - ./sentinel.conf:/usr/local/etc/redis/sentinel.conf
      - sentinel-1-data:/data
    command: redis-sentinel /usr/local/etc/redis/sentinel.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "26379", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped
    depends_on:
      - redis-6379
      - redis-6380
      - redis-6381
      - redis-6382
      - redis-6383
      - redis-6384

  redis-sentinel-2:
    image: redis:7-alpine
    container_name: redis-sentinel-2
    ports:
      - "26380:26379"
    volumes:
      - ./sentinel.conf:/usr/local/etc/redis/sentinel.conf
      - sentinel-2-data:/data
    command: redis-sentinel /usr/local/etc/redis/sentinel.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "26379", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped
    depends_on:
      - redis-6379
      - redis-6380
      - redis-6381
      - redis-6382
      - redis-6383
      - redis-6384

  redis-sentinel-3:
    image: redis:7-alpine
    container_name: redis-sentinel-3
    ports:
      - "26381:26379"
    volumes:
      - ./sentinel.conf:/usr/local/etc/redis/sentinel.conf
      - sentinel-3-data:/data
    command: redis-sentinel /usr/local/etc/redis/sentinel.conf
    networks:
      - redis-cluster
    healthcheck:
      test: ["CMD", "redis-cli", "-p", "26379", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped
    depends_on:
      - redis-6379
      - redis-6380
      - redis-6381
      - redis-6382
      - redis-6383
      - redis-6384

networks:
  redis-cluster:
    driver: bridge

volumes:
  redis-6379-data:
  redis-6380-data:
  redis-6381-data:
  redis-6382-data:
  redis-6383-data:
  redis-6384-data:
  sentinel-1-data:
  sentinel-2-data:
  sentinel-3-data:
