import{r as e,j as s}from"./react-core-JVqWokWt.js";import{f as a,M as l,u as r,S as t,a as i,e as n,C as d,J as c,K as x,Y as o,L as h,Z as m,g as u,h as j,i as p,j as v,k as g,_ as N,al as b,am as f,an as y,ao as S,$ as w,B as C,V as k,W as F}from"./main-fde3JC90.js";import{T}from"./TeacherSidebar-Bwv8PTW2.js";import{u as _}from"./useTeacher-DJCQuFgv.js";import{b as I,a as L}from"./react-query-DqnBFrGE.js";import{N as V}from"./react-router-WAeXREDX.js";import{bH as D,bG as A,bI as E,bJ as B,$ as q}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";import"./teacher-BhCI6v5d.js";const W=async e=>{const s=await a.post("/materials/study-plan/generate/",e);if(s.error)throw new Error(s.error);return s.data},$=async e=>{const s=await a.get(`/materials/study-plan/generation/${e}/`);if(s.error)throw new Error(s.error);return s.data},J=["Математика","Физика","Химия","Информатика","Русский язык","Литература","История","Обществознание","Английский язык","Биология","География"],K=[{value:"Повышение успеваемости",label:"Повышение успеваемости"},{value:"ОГЭ",label:"Подготовка к ОГЭ"},{value:"ЕГЭ базовый",label:"ЕГЭ (базовый уровень)"},{value:"ЕГЭ профиль",label:"ЕГЭ (профильный уровень)"},{value:"Лицей",label:"Поступление в лицей"},{value:"Олимпиада",label:"Олимпиадная подготовка"}],M=[{value:"базовый",label:"Базовый"},{value:"средний",label:"Средний"},{value:"полный",label:"Полный"}],O=[{value:"минимум",label:"Минимум примеров"},{value:"стандартный",label:"Стандартное количество"},{value:"максимум",label:"Максимум примеров"}],P=[{value:"русский",label:"Русский"},{value:"английский",label:"Английский"}],X=()=>{const{user:a}=l(),{data:X,isLoading:Z}=_(),{toast:z}=r(),G=I({mutationFn:e=>W(e)}),[H,Y]=e.useState(""),[Q,R]=e.useState(""),[U,ee]=e.useState(""),[se,ae]=e.useState(""),[le,re]=e.useState(""),[te,ie]=e.useState(""),[ne,de]=e.useState(""),[ce,xe]=e.useState("12"),[oe,he]=e.useState("10"),[me,ue]=e.useState("6"),[je,pe]=e.useState("средний"),[ve,ge]=e.useState("стандартный"),[Ne,be]=e.useState("10-25"),[fe,ye]=e.useState("русский"),[Se,we]=e.useState(null),[Ce,ke]=e.useState(!1),{data:Fe,isLoading:Te}=((e,s=!1)=>L({queryKey:["study-plan-generation",e],queryFn:()=>$(e),enabled:s&&null!==e,refetchInterval:e=>("pending"===(null==e?void 0:e.status)||"processing"===(null==e?void 0:e.status))&&3e3,refetchOnWindowFocus:!1,staleTime:0}))(Se,Ce);if("teacher"!==(null==a?void 0:a.role))return s.jsx(V,{to:"/dashboard",replace:!0});const _e=(null==X?void 0:X.students)||[],[Ie,Le]=e.useState({});return e.useEffect(()=>{Fe&&("completed"===Fe.status?(ke(!1),z({title:"Генерация завершена",description:"Файлы готовы для скачивания"})):"failed"===Fe.status&&(ke(!1),z({title:"Ошибка генерации",description:Fe.error||"Произошла ошибка при генерации",variant:"destructive"})))},[Fe,z]),e.useEffect(()=>{if(H){const e=_e.find(e=>String(e.id)===H);e&&e.grade&&ee(String(e.grade))}},[H,_e]),s.jsx(t,{children:s.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[s.jsx(T,{}),s.jsxs(i,{className:"flex-1",children:[s.jsxs("div",{className:"flex h-14 items-center border-b px-6",children:[s.jsx(n,{}),s.jsxs("h1",{className:"ml-4 text-xl font-semibold flex items-center gap-2",children:[s.jsx(D,{className:"w-5 h-5 text-purple-500"}),"Генератор учебных планов"]})]}),s.jsxs("div",{className:"space-y-6 p-6 max-w-5xl",children:[s.jsx(d,{children:s.jsxs(c,{children:[s.jsx(x,{children:"AI-генерация учебных материалов"}),s.jsx(o,{children:"Создавайте персонализированные учебные планы с помощью искусственного интеллекта. Система автоматически сгенерирует задачник, справочник, видеоподборку и недельный план занятий."})]})}),s.jsxs(d,{children:[s.jsx(c,{children:s.jsx(x,{children:"Параметры генерации"})}),s.jsx(h,{children:s.jsxs("form",{onSubmit:async e=>{var s;if(e.preventDefault(),!(()=>{const e={};if(H||(e.student="Выберите студента"),Q||(e.subject="Выберите предмет"),U){const s=parseInt(U);(isNaN(s)||s<7||s>11)&&(e.grade="Класс должен быть от 7 до 11")}else e.grade="Укажите класс";se.trim()||(e.topic="Укажите тему"),le.trim()||(e.subtopics="Укажите подтемы"),te||(e.goal="Выберите цель");const s=parseInt(ce),a=parseInt(oe),l=parseInt(me);return(isNaN(s)||s<1||s>20)&&(e.aTasks="Количество задач A: 1-20"),(isNaN(a)||a<1||a>20)&&(e.bTasks="Количество задач B: 1-20"),(isNaN(l)||l<1||l>20)&&(e.cTasks="Количество задач C: 1-20"),Le(e),0===Object.keys(e).length})())return void z({title:"Ошибка валидации",description:"Пожалуйста, заполните все обязательные поля корректно",variant:"destructive"});const a=_e.find(e=>String(e.id)===H);if(!a)return void z({title:"Ошибка",description:"Студент не найден",variant:"destructive"});const l=null==(s=a.subjects)?void 0:s.find(e=>e.name===Q);if(!l)return void z({title:"Ошибка",description:"Предмет не найден в списке студента",variant:"destructive"});const r={student_id:parseInt(H),subject_id:parseInt(l.id),grade:parseInt(U),topic:se.trim(),subtopics:le.trim(),goal:te,task_counts:{A:parseInt(ce),B:parseInt(oe),C:parseInt(me)},constraints:ne.trim()||void 0,reference_level:je,examples_count:ve,video_duration:Ne,video_language:fe};try{ke(!0);const e=await G.mutateAsync(r);we(e.generation_id),z({title:"Генерация запущена",description:"Это может занять 2-3 минуты. Следите за статусом на странице."})}catch(t){ke(!1),z({title:"Ошибка генерации",description:t instanceof Error?t.message:"Не удалось запустить генерацию",variant:"destructive"})}},className:"space-y-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Общие параметры"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(m,{htmlFor:"student",children:["Студент ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs(u,{value:H,onValueChange:Y,children:[s.jsx(j,{id:"student",children:s.jsx(p,{placeholder:"Выберите студента"})}),s.jsx(v,{children:_e.map(e=>s.jsx(g,{value:String(e.id),children:e.full_name||e.name},e.id))})]}),Ie.student&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.student})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(m,{htmlFor:"subject",children:["Предмет ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs(u,{value:Q,onValueChange:R,children:[s.jsx(j,{id:"subject",children:s.jsx(p,{placeholder:"Выберите предмет"})}),s.jsx(v,{children:J.map(e=>s.jsx(g,{value:e,children:e},e))})]}),Ie.subject&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.subject})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(m,{htmlFor:"grade",children:["Класс ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(N,{id:"grade",type:"number",min:"7",max:"11",value:U,onChange:e=>ee(e.target.value),placeholder:"7-11"}),Ie.grade&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.grade})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(m,{htmlFor:"goal",children:["Цель обучения ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs(u,{value:te,onValueChange:ie,children:[s.jsx(j,{id:"goal",children:s.jsx(p,{placeholder:"Выберите цель"})}),s.jsx(v,{children:K.map(e=>s.jsx(g,{value:e.value,children:e.label},e.value))})]}),Ie.goal&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.goal})]}),s.jsxs("div",{className:"space-y-2 md:col-span-2",children:[s.jsxs(m,{htmlFor:"topic",children:["Тема ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx(N,{id:"topic",value:se,onChange:e=>ae(e.target.value),placeholder:"Например: Квадратные уравнения"}),Ie.topic&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.topic})]}),s.jsxs("div",{className:"space-y-2 md:col-span-2",children:[s.jsx(b,{children:s.jsxs(f,{children:[s.jsx(y,{asChild:!0,children:s.jsxs(m,{htmlFor:"subtopics",className:"flex items-center gap-1",children:["Подтемы ",s.jsx("span",{className:"text-red-500",children:"*"}),s.jsx(A,{className:"w-4 h-4 text-muted-foreground"})]})}),s.jsxs(S,{children:[s.jsx("p",{children:"Перечислите ключевые подтемы через запятую"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Пример: решение, дискриминант, теорема Виета"})]})]})}),s.jsx(w,{id:"subtopics",value:le,onChange:e=>re(e.target.value),placeholder:"решение, дискриминант, теорема Виета",rows:3}),Ie.subtopics&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.subtopics})]}),s.jsxs("div",{className:"space-y-2 md:col-span-2",children:[s.jsx(b,{children:s.jsxs(f,{children:[s.jsx(y,{asChild:!0,children:s.jsxs(m,{htmlFor:"constraints",className:"flex items-center gap-1",children:["Ограничения (опционально)",s.jsx(A,{className:"w-4 h-4 text-muted-foreground"})]})}),s.jsxs(S,{children:[s.jsx("p",{children:"Укажите дополнительные требования"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Пример: Время: 60 мин, без калькулятора"})]})]})}),s.jsx(w,{id:"constraints",value:ne,onChange:e=>de(e.target.value),placeholder:"Например: Время: 60 мин, без калькулятора",rows:2})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Параметры задачника"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"aTasks",children:"Задачи уровня A (1-20)"}),s.jsx(N,{id:"aTasks",type:"number",min:"1",max:"20",value:ce,onChange:e=>xe(e.target.value)}),Ie.aTasks&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.aTasks})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"bTasks",children:"Задачи уровня B (1-20)"}),s.jsx(N,{id:"bTasks",type:"number",min:"1",max:"20",value:oe,onChange:e=>he(e.target.value)}),Ie.bTasks&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.bTasks})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"cTasks",children:"Задачи уровня C (1-20)"}),s.jsx(N,{id:"cTasks",type:"number",min:"1",max:"20",value:me,onChange:e=>ue(e.target.value)}),Ie.cTasks&&s.jsx("p",{className:"text-sm text-red-500",children:Ie.cTasks})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Параметры справочника"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"referenceLevel",children:"Уровень детализации"}),s.jsxs(u,{value:je,onValueChange:pe,children:[s.jsx(j,{id:"referenceLevel",children:s.jsx(p,{})}),s.jsx(v,{children:M.map(e=>s.jsx(g,{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"examplesCount",children:"Количество примеров"}),s.jsxs(u,{value:ve,onValueChange:ge,children:[s.jsx(j,{id:"examplesCount",children:s.jsx(p,{})}),s.jsx(v,{children:O.map(e=>s.jsx(g,{value:e.value,children:e.label},e.value))})]})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-semibold border-b pb-2",children:"Параметры видеоподборки"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"videoDuration",children:"Длительность видео (мин)"}),s.jsx(N,{id:"videoDuration",value:Ne,onChange:e=>be(e.target.value),placeholder:"10-25"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{htmlFor:"videoLanguage",children:"Язык видео"}),s.jsxs(u,{value:fe,onValueChange:ye,children:[s.jsx(j,{id:"videoLanguage",children:s.jsx(p,{})}),s.jsx(v,{children:P.map(e=>s.jsx(g,{value:e.value,children:e.label},e.value))})]})]})]})]}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsx(C,{type:"submit",size:"lg",disabled:Ce||Z,className:"min-w-[200px]",children:Ce?s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Генерация..."]}):s.jsxs(s.Fragment,{children:[s.jsx(D,{className:"w-4 h-4 mr-2"}),"Сгенерировать план"]})})})]})})]}),Ce&&s.jsx(d,{children:s.jsx(h,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(E,{className:"w-5 h-5 animate-spin text-purple-500"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold",children:"Генерация учебного плана... это может занять 2-3 минуты"}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:["Статус:"," ","pending"===(null==Fe?void 0:Fe.status)?"В очереди":"processing"===(null==Fe?void 0:Fe.status)?"Обработка":"Ожидание"]})]})]})})}),"completed"===(null==Fe?void 0:Fe.status)&&Fe.files&&s.jsxs(d,{children:[s.jsxs(c,{children:[s.jsx(x,{className:"text-green-600",children:"Генерация завершена"}),s.jsx(o,{children:"Все файлы готовы для скачивания"})]}),s.jsx(h,{children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Fe.files.map((e,a)=>s.jsx(C,{variant:"outline",className:"justify-start h-auto py-3",asChild:!0,children:s.jsxs("a",{href:e.url,download:e.filename,target:"_blank",rel:"noopener noreferrer",children:[s.jsx(B,{className:"w-4 h-4 mr-2 flex-shrink-0"}),s.jsx("span",{className:"text-left",children:{problem_set:"Задачник (PDF)",reference_guide:"Справочник (PDF)",video_list:"Видеоподборка (MD)",weekly_plan:"Недельный план (TXT)"}[e.type]||e.type})]})},a))})})]}),"failed"===(null==Fe?void 0:Fe.status)&&s.jsxs(k,{variant:"destructive",children:[s.jsx(q,{className:"w-4 h-4"}),s.jsxs(F,{children:[s.jsx("strong",{children:"Ошибка генерации:"})," ",Fe.error||"Произошла неизвестная ошибка"]})]})]})]})]})})};export{X as default};
