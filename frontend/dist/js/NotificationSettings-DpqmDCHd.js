import{r as e,j as s}from"./react-core-JVqWokWt.js";import{a_ as a,a$ as n,ay as i,$ as t,aA as l,a2 as r,aW as c,aY as o,aX as d}from"./vendor-DC2AZkDs.js";import{aV as m,B as h,V as u,W as x,az as j,C as b,J as f,K as g,Y as p,L as v,aC as y,aD as N,aA as _,aB as C,aE as w,aY as S,g as T,h as k,i as E,j as A,k as q,aF as M,_ as z,l as G,f as H}from"./main-fde3JC90.js";import{u as D}from"./react-router-WAeXREDX.js";import"./react-dom-DyRXjBRd.js";import"./d3-lib-BmB4v4DK.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";const F=c({assignments_enabled:d().default(!0),materials_enabled:d().default(!0),messages_enabled:d().default(!0),payments_enabled:d().default(!0),invoices_enabled:d().default(!0),system_enabled:d().default(!0),email_enabled:d().default(!0),push_enabled:d().default(!0),sms_enabled:d().default(!1),quiet_hours_enabled:d().default(!1),quiet_hours_start:o().regex(/^\d{2}:\d{2}$/,"Invalid time format (HH:MM)").default("22:00"),quiet_hours_end:o().regex(/^\d{2}:\d{2}$/,"Invalid time format (HH:MM)").default("08:00"),timezone:o().default("UTC")}),P=[{value:"UTC",label:"UTC (Coordinated Universal Time)"},{value:"Europe/Moscow",label:"Europe/Moscow (MSK)"},{value:"Europe/London",label:"Europe/London (GMT/BST)"},{value:"Europe/Paris",label:"Europe/Paris (CET/CEST)"},{value:"Europe/Berlin",label:"Europe/Berlin (CET/CEST)"},{value:"America/New_York",label:"America/New_York (EST/EDT)"},{value:"America/Los_Angeles",label:"America/Los_Angeles (PST/PDT)"},{value:"America/Chicago",label:"America/Chicago (CST/CDT)"},{value:"Asia/Tokyo",label:"Asia/Tokyo (JST)"},{value:"Asia/Shanghai",label:"Asia/Shanghai (CST)"},{value:"Asia/Hong_Kong",label:"Asia/Hong_Kong (HKT)"},{value:"Australia/Sydney",label:"Australia/Sydney (AEDT/AEST)"},{value:"Asia/Singapore",label:"Asia/Singapore (SGT)"},{value:"Asia/Dubai",label:"Asia/Dubai (GST)"}],B=()=>{const c=D(),[o,d]=e.useState(!0),[B,I]=e.useState(!1),[L,U]=e.useState(!1),[Y,$]=e.useState(null),[K,R]=e.useState(null),V=a({resolver:n(F),mode:"onBlur",defaultValues:{assignments_enabled:!0,materials_enabled:!0,messages_enabled:!0,payments_enabled:!0,invoices_enabled:!0,system_enabled:!0,email_enabled:!0,push_enabled:!0,sms_enabled:!1,quiet_hours_enabled:!1,quiet_hours_start:"22:00",quiet_hours_end:"08:00",timezone:"UTC"}});e.useEffect(()=>{(async()=>{var e,s,a,n,i,t,l,o,m,h,u,x,j;try{d(!0),R(null),G.debug("[NotificationSettings] Fetching notification preferences...");const r=await H.fetch("/accounts/notification-settings/","GET");if(!r.ok){if(401===r.status)return void c("/auth");throw new Error(`Failed to fetch notification settings (${r.status})`)}const b=await r.json();G.debug("[NotificationSettings] Fetched settings:",b);const f=b.data||b;V.reset({assignments_enabled:null==(e=f.assignments_enabled)||e,materials_enabled:null==(s=f.materials_enabled)||s,messages_enabled:null==(a=f.messages_enabled)||a,payments_enabled:null==(n=f.payments_enabled)||n,invoices_enabled:null==(i=f.invoices_enabled)||i,system_enabled:null==(t=f.system_enabled)||t,email_enabled:null==(l=f.email_enabled)||l,push_enabled:null==(o=f.push_enabled)||o,sms_enabled:null!=(m=f.sms_enabled)&&m,quiet_hours_enabled:null!=(h=f.quiet_hours_enabled)&&h,quiet_hours_start:null!=(u=f.quiet_hours_start)?u:"22:00",quiet_hours_end:null!=(x=f.quiet_hours_end)?x:"08:00",timezone:null!=(j=f.timezone)?j:"UTC"})}catch(b){G.error("[NotificationSettings] Error fetching settings:",b);const e=b instanceof Error?b.message:"Failed to load notification settings";R(e),r.error("Failed to load notification settings")}finally{d(!1)}})()},[V,c]);return o?s.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4 flex items-center justify-center",children:s.jsx(m,{size:"lg",text:"Loading notification settings..."})}):s.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:s.jsxs("div",{className:"max-w-4xl mx-auto",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs(h,{variant:"outline",size:"sm",onClick:()=>c(-1),className:"mb-4",children:[s.jsx(i,{className:"w-4 h-4 mr-2"}),"Back"]}),s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Notification Settings"}),s.jsx("p",{className:"text-gray-600",children:"Manage how and when you receive notifications about your activities"})]}),K&&s.jsxs(u,{variant:"destructive",className:"mb-6",children:[s.jsx(t,{className:"h-4 w-4"}),s.jsx(x,{children:K})]}),L&&s.jsxs(u,{className:"mb-6 bg-green-50 text-green-800 border-green-200",children:[s.jsx(l,{className:"h-4 w-4"}),s.jsx(x,{children:"Your notification settings have been saved successfully!"})]}),Y&&s.jsxs(u,{variant:"destructive",className:"mb-6",children:[s.jsx(t,{className:"h-4 w-4"}),s.jsx(x,{children:Y})]}),s.jsx(j,{...V,children:s.jsxs("form",{onSubmit:V.handleSubmit(async e=>{try{I(!0),$(null),U(!1),G.debug("[NotificationSettings] Saving notification settings:",e);const s=await H.fetch("/accounts/notification-settings/","PATCH",e);if(!s.ok){if(401===s.status)return void c("/auth");const e=await s.json().catch(()=>({})),a=e.error||e.detail||`Failed to save settings (${s.status})`;throw new Error(a)}G.debug("[NotificationSettings] Settings saved successfully"),U(!0),r.success("Notification settings saved successfully"),setTimeout(()=>U(!1),3e3)}catch(s){G.error("[NotificationSettings] Error saving settings:",s);const e=s instanceof Error?s.message:"Failed to save notification settings";$(e),r.error(e)}finally{I(!1)}}),className:"space-y-6",children:[s.jsxs(b,{children:[s.jsxs(f,{children:[s.jsxs(g,{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-2xl",children:"ðŸ“¬"}),"Notification Types"]}),s.jsx(p,{children:"Choose which types of notifications you want to receive"})]}),s.jsxs(v,{className:"space-y-4",children:[s.jsx(y,{control:V.control,name:"assignments_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"Assignments"}),s.jsx(C,{children:"Get notified about new assignments and submission deadlines"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx(y,{control:V.control,name:"materials_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"Materials"}),s.jsx(C,{children:"Get notified when new learning materials are shared"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx(y,{control:V.control,name:"messages_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"Messages"}),s.jsx(C,{children:"Get notified about new direct messages and chat replies"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx(y,{control:V.control,name:"payments_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"Payments"}),s.jsx(C,{children:"Get notified about payment requests and confirmations"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx(y,{control:V.control,name:"invoices_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"Invoices"}),s.jsx(C,{children:"Get notified about new invoices and billing updates"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx(y,{control:V.control,name:"system_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"System Notifications"}),s.jsx(C,{children:"Get notified about important system updates and announcements"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})})]})]}),s.jsxs(b,{children:[s.jsxs(f,{children:[s.jsxs(g,{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-2xl",children:"ðŸ“±"}),"Notification Channels"]}),s.jsx(p,{children:"Choose how you want to receive notifications"})]}),s.jsxs(v,{className:"space-y-4",children:[s.jsx(y,{control:V.control,name:"email_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"Email Notifications"}),s.jsx(C,{children:"Receive notifications via email"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx(y,{control:V.control,name:"push_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"Push Notifications"}),s.jsx(C,{children:"Receive browser and mobile push notifications"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx(y,{control:V.control,name:"sms_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0 rounded-lg border p-4",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"SMS Notifications"}),s.jsx(C,{children:"Receive important notifications via SMS (may incur costs)"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:s.jsxs("div",{className:"flex gap-3",children:[s.jsx("span",{className:"text-xl",children:"ðŸ“¢"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-blue-900",children:"In-App Notifications"}),s.jsx("p",{className:"text-sm text-blue-800",children:"In-app notifications are always enabled so you never miss important updates"})]})]})})]})]}),s.jsxs(b,{children:[s.jsxs(f,{children:[s.jsxs(g,{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-2xl",children:"ðŸŒ™"}),"Quiet Hours"]}),s.jsx(p,{children:"Configure times when you don't want to receive notifications (except urgent ones)"})]}),s.jsxs(v,{className:"space-y-6",children:[s.jsx(y,{control:V.control,name:"quiet_hours_enabled",render:({field:e})=>s.jsxs(N,{className:"flex items-center justify-between space-y-0",children:[s.jsxs("div",{className:"space-y-0.5",children:[s.jsx(_,{className:"text-base font-semibold",children:"Enable Quiet Hours"}),s.jsx(C,{children:"Don't receive notifications during specified times"})]}),s.jsx(w,{children:s.jsx(S,{checked:e.value,onCheckedChange:e.onChange})})]})}),V.watch("quiet_hours_enabled")&&s.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[s.jsx(y,{control:V.control,name:"timezone",render:({field:e})=>s.jsxs(N,{children:[s.jsx(_,{className:"text-base font-semibold",children:"Timezone"}),s.jsxs(T,{value:e.value,onValueChange:e.onChange,children:[s.jsx(w,{children:s.jsx(k,{children:s.jsx(E,{placeholder:"Select timezone"})})}),s.jsx(A,{className:"max-h-64",children:P.map(e=>s.jsx(q,{value:e.value,children:e.label},e.value))})]}),s.jsx(C,{children:"Select your timezone for accurate quiet hours scheduling"}),s.jsx(M,{})]})}),s.jsx(y,{control:V.control,name:"quiet_hours_start",render:({field:e})=>s.jsxs(N,{children:[s.jsx(_,{className:"text-base font-semibold",children:"Start Time"}),s.jsx(w,{children:s.jsx(z,{type:"time",...e,className:"max-w-xs"})}),s.jsx(C,{children:"When to start quiet hours (24-hour format)"}),s.jsx(M,{})]})}),s.jsx(y,{control:V.control,name:"quiet_hours_end",render:({field:e})=>s.jsxs(N,{children:[s.jsx(_,{className:"text-base font-semibold",children:"End Time"}),s.jsx(w,{children:s.jsx(z,{type:"time",...e,className:"max-w-xs"})}),s.jsx(C,{children:"When to end quiet hours (24-hour format)"}),s.jsx(M,{})]})}),s.jsxs("div",{className:"rounded-lg bg-gray-100 p-3 text-sm text-gray-700",children:[s.jsx("p",{className:"font-medium mb-2",children:"Example:"}),s.jsx("p",{children:"If you set quiet hours from 22:00 to 08:00, you won't receive notifications between 10 PM and 8 AM in your timezone"})]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:justify-between",children:[s.jsx(h,{type:"button",variant:"outline",onClick:()=>{V.reset(),r.info("Settings reset to last saved values")},disabled:B,children:"Reset"}),s.jsx(h,{type:"submit",disabled:B||!V.formState.isDirty,className:"min-w-32",children:B?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(m,{size:"sm",text:""}),"Saving..."]}):"Save Settings"})]})]})})]})})};export{B as NotificationSettings,B as default};
