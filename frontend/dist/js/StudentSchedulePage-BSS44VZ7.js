import{r as e,j as s}from"./react-core-JVqWokWt.js";import{ay as a,S as l,a0 as t,a as r,e as c,C as n,J as i,K as m,L as d,g as o,h as x,i as h,j,k as u,a3 as p,a4 as g,a5 as N,a6 as f,b,B as v}from"./main-fde3JC90.js";import{L as w}from"./LessonCard-BUGWm0lu.js";import{ab as y,aU as T}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./react-router-WAeXREDX.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";const _=(e,s)=>{try{const a=new Date(`${e}T${s}`);return isNaN(a.getTime())?null:a}catch{return null}},C=()=>{const{lessons:C,isLoading:S,error:k}=a(),[$,L]=e.useState("upcoming"),[B,M]=e.useState("all"),[V,D]=e.useState("all"),q=e.useMemo(()=>{const e=new Date;e.setSeconds(0,0);const s=e.getTime();return C.filter(e=>{const a=_(e.date,e.start_time);if(!a)return console.warn(`Invalid date/time for lesson ${e.id}: ${e.date} ${e.start_time}`),!1;const l=a.getTime()>s;return!("upcoming"===$&&!l)&&(("past"!==$||!l)&&((!B||"all"===B||e.subject_name===B)&&(!V||"all"===V||e.teacher_name===V)))}).sort((e,s)=>{const a=_(e.date,e.start_time),l=_(s.date,s.start_time);return a?l?"upcoming"===$?a.getTime()-l.getTime():l.getTime()-a.getTime():-1:1})},[C,$,B,V]),z=e.useMemo(()=>[...new Set(C.map(e=>e.subject_name).filter(Boolean))].sort(),[C]),A=e.useMemo(()=>[...new Set(C.map(e=>e.teacher_name).filter(Boolean))].sort(),[C]);return s.jsx(l,{children:s.jsxs("div",{className:"flex min-h-screen w-full bg-background",children:[s.jsx(t,{}),s.jsxs(r,{className:"flex-1",children:[s.jsxs("header",{className:"sticky top-0 z-10 flex h-16 items-center border-b bg-background px-6",children:[s.jsx(c,{}),s.jsxs("h1",{className:"ml-4 text-xl font-semibold flex items-center gap-2",children:[s.jsx(y,{className:"w-5 h-5"}),"Мое расписание"]})]}),s.jsx("main",{className:"p-6",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs(n,{children:[s.jsx(i,{children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(T,{className:"w-5 h-5"}),s.jsx(m,{className:"text-lg",children:"Фильтры"})]})}),s.jsx(d,{children:s.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Предмет"}),s.jsxs(o,{value:B,onValueChange:M,children:[s.jsx(x,{children:s.jsx(h,{placeholder:"Все предметы"})}),s.jsxs(j,{children:[s.jsx(u,{value:"all",children:"Все предметы"}),z.map(e=>s.jsx(u,{value:e,children:e},e))]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Преподаватель"}),s.jsxs(o,{value:V,onValueChange:D,children:[s.jsx(x,{children:s.jsx(h,{placeholder:"Все преподаватели"})}),s.jsxs(j,{children:[s.jsx(u,{value:"all",children:"Все преподаватели"}),A.map(e=>s.jsx(u,{value:e,children:e},e))]})]})]})]})})]}),s.jsxs(p,{value:$,onValueChange:e=>L(e),children:[s.jsxs(g,{className:"grid w-full sm:w-auto grid-cols-2",children:[s.jsx(N,{value:"upcoming",children:"Предстоящие"}),s.jsx(N,{value:"past",children:"Прошедшие"})]}),s.jsx(f,{value:$,className:"space-y-4 mt-6",children:S?s.jsxs("div",{className:"space-y-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Загрузка расписания..."}),[...Array(3)].map((e,a)=>s.jsx(n,{className:"overflow-hidden",children:s.jsx(d,{className:"p-6",children:s.jsxs("div",{className:"space-y-3",children:[s.jsx(b,{className:"h-6 w-1/2"}),s.jsx(b,{className:"h-4 w-1/3"}),s.jsx(b,{className:"h-4 w-2/3"})]})})},`lesson-skeleton-${a}`))]}):k?s.jsx(n,{className:"border-destructive",children:s.jsxs(d,{className:"p-12 text-center",children:[s.jsx("div",{className:"mx-auto mb-4 w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center",children:s.jsx(y,{className:"w-6 h-6 text-destructive"})}),s.jsx("h3",{className:"text-lg font-semibold mb-2 text-destructive",children:"Ошибка загрузки расписания"}),s.jsx("p",{className:"text-muted-foreground mb-6",children:k instanceof Error?k.message:"Не удалось загрузить расписание. Попробуйте обновить страницу."}),s.jsx(v,{type:"button",onClick:()=>window.location.reload(),variant:"outline",children:"Обновить страницу"})]})}):0===q.length?s.jsx(n,{children:s.jsxs(d,{className:"p-12 text-center",children:[s.jsx(y,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground opacity-50"}),s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"upcoming"===$?"Нет предстоящих занятий":"Нет прошедших занятий"}),s.jsx("p",{className:"text-muted-foreground mb-6",children:"upcoming"===$?"Обратитесь к преподавателю для планирования занятий":"Ещё нет завершённых занятий"}),"upcoming"===$&&s.jsx(v,{type:"button",asChild:!0,children:s.jsx("a",{href:"/dashboard/student/materials",children:"Смотреть материалы"})})]})}):s.jsx("div",{className:"space-y-4",children:q.map(e=>s.jsx(w,{lesson:e},e.id))})})]})]})})]})]})})};export{C as default};
