# THE_BOT Helm Chart - Staging Environment Values
# Используй: helm install thebot ./charts/thebot -f values-staging.yaml

global:
  environment: staging

backend:
  replicaCount: 2

  image:
    tag: staging

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  env:
    DEBUG: "False"
    ENVIRONMENT: "staging"
    ALLOWED_HOSTS: "staging.thebot.com,api.staging.thebot.com"
    FRONTEND_URL: "https://staging.thebot.com"

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 4
    targetCPUUtilizationPercentage: 75
    targetMemoryUtilizationPercentage: 80

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

frontend:
  replicaCount: 2

  image:
    tag: staging

  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "400m"

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 3
    targetCPUUtilizationPercentage: 75

celery:
  replicaCount: 2

  image:
    tag: staging

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 4
    targetCPUUtilizationPercentage: 80

celeryBeat:
  replicaCount: 1

  image:
    tag: staging

postgresql:
  persistence:
    size: 20Gi
    storageClassName: "ssd"

  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "2000m"

  env:
    POSTGRES_DB: "thebot_staging"
    POSTGRES_USER: "thebot_user"

redis:
  persistence:
    size: 10Gi
    storageClassName: "ssd"

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

ingress:
  enabled: true
  className: "nginx"

  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-staging"
    nginx.ingress.kubernetes.io/rate-limit: "100"

  hosts:
    - host: "staging.thebot.com"
      paths:
        - path: /
          pathType: Prefix
          backend: frontend
        - path: /api
          pathType: Prefix
          backend: backend
        - path: /admin
          pathType: Prefix
          backend: backend

  tls:
    enabled: true
    - secretName: thebot-staging-tls
      hosts:
        - staging.thebot.com
        - api.staging.thebot.com

configMap:
  data:
    DATABASE_ENGINE: "postgresql"
    DATABASE_NAME: "thebot_staging"
    REDIS_BACKEND: "redis"
    CELERY_BROKER: "redis://redis:6379/0"
    CELERY_RESULT_BACKEND: "redis://redis:6379/1"
    LOG_LEVEL: "INFO"
    CACHE_TIMEOUT: "1800"
    API_PAGE_SIZE: "20"
    API_RATE_LIMIT: "5000/hour"

secrets:
  data:
    SECRET_KEY: "staging-secret-key-change-in-production"
    POSTGRES_PASSWORD: "staging_password_secure"
    DATABASE_URL: "postgresql://thebot_user:staging_password_secure@postgres:5432/thebot_staging"
    REDIS_URL: "redis://redis:6379/0"

rbac:
  enabled: true
  serviceAccount:
    create: true
    name: thebot-sa

networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
      ports:
        - protocol: TCP
          port: 8000
        - protocol: TCP
          port: 80

pvc:
  staticFiles:
    size: 5Gi
    storageClassName: "ssd"
  media:
    size: 10Gi
    storageClassName: "ssd"

monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s

logging:
  enabled: true
  level: INFO

migration:
  enabled: true

collectStatic:
  enabled: true
