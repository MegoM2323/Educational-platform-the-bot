import{j as e}from"./react-core-JVqWokWt.js";import{av as s,aw as a,S as i,P as t,a as n,e as l,C as r,a1 as c,d,au as m,c as o,B as x,p as j,l as h}from"./main-fde3JC90.js";import{b as u}from"./react-router-WAeXREDX.js";import{bu as p,b9 as f}from"./vendor-DC2AZkDs.js";import"./react-dom-DyRXjBRd.js";import"./radix-ui-Ch8xfAyl.js";import"./react-query-DqnBFrGE.js";import"./charts-CKrVAx-o.js";import"./d3-lib-BmB4v4DK.js";function v(){const m=u(),o=Number(m.id),{data:x,isLoading:j}=s(o),{data:h,isLoading:p}=a(o);return e.jsx(i,{children:e.jsxs("div",{className:"flex min-h-screen w-full",children:[e.jsx(t,{}),e.jsxs(n,{children:[e.jsxs("header",{className:"flex h-16 shrink-0 items-center gap-2 border-b px-4",children:[e.jsx(l,{}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h1",{className:"text-lg font-semibold",children:"Детали ребенка"})})]}),e.jsx("main",{className:"flex flex-1 flex-col gap-4 p-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(r,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Прогресс"}),p?e.jsx("div",{children:"Загрузка..."}):h?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Общий прогресс"}),e.jsxs("span",{className:"font-semibold",children:[h.overall_percentage||0,"%"]})]}),e.jsx(c,{value:h.overall_percentage||0})]}):null]}),e.jsxs(r,{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Предметы и оплата"}),j?e.jsx("div",{children:"Загрузка..."}):e.jsx("div",{className:"space-y-3",children:null==x?void 0:x.map(s=>{var a,i,t,n;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(null==(a=s.subject)?void 0:a.name)||s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Преподаватель: ",(null==(i=s.teacher)?void 0:i.name)||s.teacher_name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{status:s.payment_status,size:"sm"}),s.enrollment_id&&e.jsx(b,{childId:o,enrollmentId:s.enrollment_id,subjectName:(null==(t=s.subject)?void 0:t.name)||s.name,teacherName:(null==(n=s.teacher)?void 0:n.name)||s.teacher_name,hasSubscription:s.has_subscription||!1,paymentStatus:s.payment_status})]})]},s.enrollment_id||s.id)})})]})]})})]})]})})}function b({childId:s,enrollmentId:a,subjectName:i,teacherName:t,hasSubscription:n,paymentStatus:l}){const r=m(s,a,{description:`Оплата за предмет "${i}" (преподаватель: ${t})`,create_subscription:!0});return n&&"paid"===l?e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-green-600"}),e.jsx(o,{variant:"secondary",className:"text-xs",children:"Автосписание активно"})]}),e.jsx(x,{type:"button",size:"sm",variant:"outline",onClick:async()=>{if(window.confirm(`Отключить автосписание для предмета "${i}"?`))try{await j.cancelSubscription(s,a),window.location.reload()}catch(e){h.error("Cancel subscription error:",e)}},children:"Отключить автосписание"})]}):e.jsxs(x,{type:"button",size:"sm",onClick:()=>r.mutate(),disabled:r.isPending,variant:"overdue"===l?"destructive":"default",children:[e.jsx(f,{className:"w-4 h-4 mr-1"}),"Подключить предмет"]})}export{v as default};
