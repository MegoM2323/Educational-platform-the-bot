# THE_BOT Platform - Staging Environment Configuration
# Copy this file to .env.staging and update values for your staging environment

# ============================================================================
# Core Configuration
# ============================================================================
ENVIRONMENT=staging
DEBUG=False
SECRET_KEY=your-secret-key-min-50-characters-change-this-in-production

# ============================================================================
# Database Configuration
# ============================================================================
# Option 1: Use PostgreSQL (Recommended for staging/production)
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/thebot_staging
DB_HOST=postgres
DB_PORT=5432
DB_NAME=thebot_staging
DB_USER=postgres
DB_PASSWORD=postgres

# Option 2: Use SQLite (Development only)
# DATABASE_URL=sqlite:///db.sqlite3

# ============================================================================
# Redis Configuration (for caching, sessions, WebSocket)
# ============================================================================
REDIS_URL=redis://redis:6379/0
REDIS_PASSWORD=redis
USE_REDIS_CACHE=True
USE_REDIS_CHANNELS=True

# ============================================================================
# Frontend Configuration
# ============================================================================
FRONTEND_URL=https://staging.the-bot.ru
VITE_DJANGO_API_URL=https://staging.the-bot.ru/api
VITE_WEBSOCKET_URL=wss://staging.the-bot.ru/ws

# ============================================================================
# API Configuration
# ============================================================================
ALLOWED_HOSTS=staging.the-bot.ru,localhost,127.0.0.1
API_URL=https://staging.the-bot.ru/api
API_KEY=your-api-key-for-external-services
CORS_ALLOWED_ORIGINS=https://staging.the-bot.ru,http://localhost:3000

# ============================================================================
# Payment Integration (YooKassa)
# ============================================================================
YOOKASSA_SHOP_ID=test-shop-id
YOOKASSA_SECRET_KEY=test-secret-key
PAYMENT_TEST_MODE=False
PAYMENT_RETURN_URL=https://staging.the-bot.ru/payments/return/
PAYMENT_WEBHOOK_URL=https://staging.the-bot.ru/api/payments/webhook/

# ============================================================================
# External APIs & Services
# ============================================================================
# OpenRouter API (for LLM features)
OPENROUTER_API_KEY=your-openrouter-api-key
OPENROUTER_API_URL=https://openrouter.ai/api/v1

# Pachca API (for notifications/forum)
PACHCA_FORUM_API_TOKEN=your-pachca-token

# Supabase Configuration (if using)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-supabase-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Telegram Bot Integration
TELEGRAM_BOT_TOKEN=your-telegram-bot-token
TELEGRAM_PUBLIC_CHAT_ID=123456789
TELEGRAM_LOG_CHAT_ID=123456789

# ============================================================================
# Email Configuration
# ============================================================================
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=noreply@staging.the-bot.ru

# ============================================================================
# Celery Configuration (Background Tasks)
# ============================================================================
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/2
CELERY_ALWAYS_EAGER=False  # Set to True for testing without workers
CELERY_EAGER_PROPAGATES_EXCEPTIONS=True

# ============================================================================
# Security Configuration
# ============================================================================
SECURE_SSL_REDIRECT=True
SESSION_COOKIE_SECURE=True
SESSION_COOKIE_HTTPONLY=True
SESSION_COOKIE_SAMESITE=Strict
CSRF_COOKIE_SECURE=True
CSRF_COOKIE_HTTPONLY=True
CSRF_COOKIE_SAMESITE=Strict
CSRF_TRUSTED_ORIGINS=https://staging.the-bot.ru

# ============================================================================
# Error Tracking (Sentry)
# ============================================================================
# Main DSN for backend error tracking
SENTRY_DSN=https://your-sentry-key@sentry.io/project-id
SENTRY_ENVIRONMENT=staging
SENTRY_RELEASE=1.0.0
SENTRY_TRACES_SAMPLE_RATE=0.5
SENTRY_PROFILES_SAMPLE_RATE=0.1

# Source map upload (for frontend build)
SENTRY_ORG=your-org-slug
SENTRY_PROJECT=your-project-slug
SENTRY_AUTH_TOKEN=your-sentry-auth-token

# Frontend Sentry configuration
VITE_SENTRY_DSN=https://your-sentry-key@sentry.io/project-id
VITE_SENTRY_ENVIRONMENT=staging
VITE_SENTRY_RELEASE=1.0.0
VITE_SENTRY_TRACES_SAMPLE_RATE=0.5

# ============================================================================
# Logging Configuration
# ============================================================================
LOG_LEVEL=INFO

# ============================================================================
# Feature Flags (Optional)
# ============================================================================
FEATURE_ENABLE_CHAT=True
FEATURE_ENABLE_KNOWLEDGE_GRAPH=True
FEATURE_ENABLE_ASSIGNMENTS=True
FEATURE_ENABLE_REPORTS=True
FEATURE_ENABLE_PAYMENTS=True

# ============================================================================
# Performance Configuration
# ============================================================================
DATABASE_CONN_MAX_AGE=600
CACHE_TIMEOUT=3600
PAGINATION_DEFAULT_LIMIT=20
MAX_UPLOAD_SIZE=52428800  # 50MB

# ============================================================================
# Docker-specific Configuration
# ============================================================================
# Port mappings (for docker-compose)
BACKEND_PORT=8000
FRONTEND_PORT=3000
DB_PORT=5432
REDIS_PORT=6379

# Image tags (set by deployment pipeline)
BACKEND_IMAGE=ghcr.io/mego/the-bot/backend:latest
FRONTEND_IMAGE=ghcr.io/mego/the-bot/frontend:latest

# ============================================================================
# Admin Configuration
# ============================================================================
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@staging.the-bot.ru
DJANGO_SUPERUSER_PASSWORD=AdminPass123!

# ============================================================================
# Testing Configuration (for CI/CD)
# ============================================================================
PYTEST_TIMEOUT=300
TEST_DATABASE_URL=postgresql://postgres:postgres@postgres:5432/test_thebot
