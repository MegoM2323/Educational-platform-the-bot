{
  "data_retention_policy": {
    "version": "2.0",
    "effective_date": "2025-12-27",
    "last_reviewed": "2025-12-27",
    "next_review": "2026-12-27",
    "compliance_frameworks": [
      "GDPR (General Data Protection Regulation)",
      "SOC 2 Type II",
      "ISO 27001",
      "HIPAA (if applicable)",
      "CCPA (California Consumer Privacy Act)"
    ],
    "policy_owner": "Data Protection Officer",
    "approval_authority": "Chief Compliance Officer"
  },
  "data_classification": {
    "personal_data": {
      "description": "Any information relating to an identified or identifiable natural person",
      "examples": ["Name", "Email", "Phone", "IP address", "Device ID"],
      "classification_level": "Confidential"
    },
    "sensitive_personal_data": {
      "description": "Special categories of personal data requiring enhanced protection",
      "examples": [
        "Race or ethnicity",
        "Political opinions",
        "Religious beliefs",
        "Biometric data",
        "Health data",
        "Sexual orientation"
      ],
      "classification_level": "Highly Confidential",
      "additional_protection": "Explicit consent required, enhanced encryption"
    },
    "user_content": {
      "description": "Data created or uploaded by users",
      "examples": ["Lesson materials", "Assignments", "Messages", "Forum posts"],
      "classification_level": "Confidential"
    },
    "system_logs": {
      "description": "Logs generated by system components",
      "examples": ["API logs", "Error logs", "Application logs"],
      "classification_level": "Internal"
    },
    "audit_logs": {
      "description": "Security and compliance audit trails",
      "examples": ["CloudTrail logs", "Access logs", "Change logs"],
      "classification_level": "Confidential"
    },
    "metadata": {
      "description": "Information about data itself",
      "examples": ["Timestamps", "User IDs", "Transaction IDs"],
      "classification_level": "Internal"
    }
  },
  "retention_schedules": {
    "user_accounts": {
      "data_type": "User profile, authentication data",
      "retention_period": "Duration of relationship + 1 year",
      "archival_period": "30 days after deletion",
      "hard_delete_date": "30 days after deletion",
      "legal_basis": "Contract performance, legal obligation",
      "gdpr_compliance": "Right to be forgotten after deletion",
      "automation": "Scheduled Lambda function for anonymization",
      "notes": "Email address retained for audit trail purposes"
    },
    "active_user_data": {
      "data_type": "Profile, settings, preferences, progress data",
      "retention_period": "Duration of active account",
      "archival_period": "N/A (active data)",
      "legal_basis": "Contract performance, legitimate interest",
      "gdpr_compliance": "User can request access/deletion anytime",
      "encryption": "AES-256, KMS managed"
    },
    "deleted_user_data": {
      "data_type": "Anonymized user data after deletion",
      "retention_period": "90 days after hard delete",
      "archival_period": "30 days after deletion",
      "archival_storage": "Encrypted S3 Glacier",
      "hard_delete_date": "90 days after deletion",
      "legal_basis": "Legal hold, regulatory compliance",
      "recovery_option": "Restores from backup within 30 days",
      "process": {
        "day_0": "User requests deletion",
        "day_1": "Data marked for deletion, soft anonymization",
        "day_30": "Backup retention expires, hard anonymization",
        "day_90": "Final deletion from Glacier"
      }
    },
    "audit_logs": {
      "data_type": "CloudTrail, CloudWatch Logs, access logs",
      "retention_period": "365 days (1 year)",
      "archival_period": "30 days, then move to Glacier",
      "archival_storage": "AWS Glacier Deep Archive",
      "legal_basis": "SOC 2, regulatory compliance, fraud detection",
      "gdpr_compliance": "Can include personal data, retained for legal reasons",
      "encryption": "AES-256 KMS",
      "immutability": "S3 Object Lock enabled",
      "schedule": {
        "days_0_30": "S3 Standard (frequent access)",
        "days_31_365": "S3 Glacier (archival)",
        "day_366": "Delete (automatic)"
      }
    },
    "cloudtrail_logs": {
      "data_type": "AWS API audit trail",
      "retention_period": "365 days",
      "archival_period": "30 days in S3 Standard, then Glacier",
      "encryption": "KMS (mandatory)",
      "log_file_validation": "Enabled (SHA-256 digest chain)",
      "multi_region": "Yes",
      "cloudwatch_sync": "Yes (90 days)",
      "legal_basis": "SOC 2, regulatory compliance",
      "compliance_note": "Cannot be deleted due to log file validation"
    },
    "application_logs": {
      "data_type": "Application error logs, request logs, debug logs",
      "retention_period": "7-90 days depending on level",
      "retention_schedule": {
        "debug": "7 days",
        "info": "14 days",
        "warning": "30 days",
        "error": "90 days",
        "critical": "1 year"
      },
      "storage": "CloudWatch Logs (configurable rotation)",
      "legal_basis": "Operational needs, debugging"
    },
    "payment_data": {
      "data_type": "Transaction records, invoices, payment history",
      "retention_period": "7 years (tax/legal requirement)",
      "archival_period": "After 1 year in database, move to cold storage",
      "archival_storage": "S3 Glacier + encrypted backups",
      "encryption": "AES-256 KMS",
      "legal_basis": "Tax compliance, legal obligation",
      "pci_compliance": "PCI DSS compliant (YooKassa processor)",
      "card_data": "Never stored (payment processor only)"
    },
    "email_communications": {
      "data_type": "Email messages, notifications, receipts",
      "retention_period": "2 years",
      "archival_period": "1 year in database, then archive",
      "archival_storage": "S3 + encrypted backup",
      "legal_basis": "Contract evidence, dispute resolution",
      "user_deletion": "Included in GDPR data export/deletion"
    },
    "chat_messages": {
      "data_type": "Messages, media files, thread data",
      "retention_period": "Duration of relationship + 90 days",
      "archival_period": "30 days after user deletion",
      "legal_basis": "Contract performance, dispute resolution",
      "user_deletion": "Can be deleted (with GDPR confirmation)",
      "gdpr_compliance": "Right to erasure requires deletion confirmation"
    },
    "learning_materials": {
      "data_type": "Course materials, assignments, submissions",
      "retention_period": "Duration of enrollment + 1 academic year",
      "archival_period": "1 year after course completion",
      "legal_basis": "Educational record, proof of completion",
      "certification": "Permanent retention (diploma/certificate)"
    },
    "assignment_submissions": {
      "data_type": "Student work, grades, feedback",
      "retention_period": "2 years after submission",
      "archival_period": "1 year in database, then archive",
      "legal_basis": "Educational record, grade verification",
      "teacher_access": "Retained even after student deletion"
    },
    "session_data": {
      "data_type": "Session tokens, login history, cookies",
      "retention_period": "30 days after session end",
      "archival_period": "No archival, direct deletion",
      "legal_basis": "Security, fraud detection",
      "encryption": "Redis in-memory encryption"
    },
    "analytics_data": {
      "data_type": "User behavior, learning analytics, usage statistics",
      "retention_period": "1 year for detailed analytics, unlimited for aggregated",
      "aggregation_threshold": "5+ users (anonymized)",
      "personal_data_removal": "After 1 year, only aggregated stats retained",
      "legal_basis": "Legitimate interest (service improvement)",
      "gdpr_compliance": "Anonymized after 1 year"
    },
    "backup_data": {
      "data_type": "Database backups, snapshots",
      "retention_period": "90 days",
      "backup_schedule": {
        "daily": "7 days (hot)",
        "weekly": "30 days (warm)",
        "monthly": "90 days (cold)"
      },
      "storage_location": "AWS Backup + S3",
      "encryption": "AES-256 KMS",
      "test_restores": "Monthly (compliance requirement)",
      "disaster_recovery": "RPO 1 hour, RTO 4 hours"
    },
    "temporary_cache": {
      "data_type": "Redis cache, in-memory data",
      "retention_period": "TTL 1-24 hours (configurable)",
      "encryption": "In-flight encryption",
      "personal_data": "Cached for performance only",
      "gdpr_impact": "Minimal (transient)"
    },
    "cookie_data": {
      "data_type": "Session cookies, tracking cookies",
      "retention_period": "30 days (session) / 1 year (tracking)",
      "legal_basis": "User consent (required by GDPR)",
      "user_control": "Users can opt-out in settings",
      "third_party": "Only with explicit consent"
    },
    "ip_logs": {
      "data_type": "IP addresses from access logs",
      "retention_period": "90 days",
      "anonymization": "IP truncated after 7 days in analytics",
      "gdpr_compliance": "IP is personal data, anonymized when not needed",
      "security_exception": "Full IP retained in security logs for 365 days"
    },
    "error_tracking": {
      "data_type": "Error messages, stack traces, request data",
      "retention_period": "30 days for errors with personal data",
      "gdpr_compliance": "PII stripped from error messages",
      "tools": "Sentry (PII redaction enabled)",
      "legal_basis": "Debugging, service improvement"
    }
  },
  "data_deletion_procedures": {
    "gdpr_right_to_erasure": {
      "request_channel": "POST /api/gdpr/erasure-request",
      "verification": "Email confirmation required",
      "processing_timeline": "30 days (GDPR requirement)",
      "process": [
        "1. User submits deletion request via API",
        "2. System sends confirmation email",
        "3. User confirms via email link",
        "4. System marks account for deletion",
        "5. 30-day waiting period starts",
        "6. Soft anonymization (replace personal data with hashes)",
        "7. Hard deletion after 30 days",
        "8. Backup expiration removes all copies"
      ],
      "exceptions": [
        "Audit logs (legal obligation)",
        "Payment records (7-year tax requirement)",
        "Lesson certificates (permanent record)"
      ]
    },
    "automatic_deletion": {
      "inactive_accounts": {
        "trigger": "No login for 2 years",
        "notification": "Email reminder after 1.5 years",
        "action": "Automatic soft deletion after 2 years",
        "user_recovery": "User can reactivate within 30 days",
        "confirmation": "Explicit user opt-in required for auto-deletion"
      },
      "expired_data": {
        "logs": "Automatic deletion after retention period",
        "cache": "TTL expiration",
        "backups": "Scheduled deletion per policy"
      }
    },
    "data_anonymization": {
      "soft_anonymization": {
        "timestamp": "Day 1 of deletion request",
        "technique": "Replace personal data with salted hashes",
        "data_affected": [
          "Name → hash",
          "Email → hash",
          "Phone → hash",
          "Address → null"
        ],
        "reversibility": "Reversible (for 30-day recovery period)"
      },
      "hard_anonymization": {
        "timestamp": "Day 30 after deletion request",
        "technique": "Cryptographic deletion, irreversible",
        "data_affected": "All personally identifiable data",
        "reversibility": "Irreversible (complete deletion)"
      }
    },
    "data_export": {
      "request_channel": "POST /api/gdpr/data-export",
      "format": "ZIP with JSON and CSV files",
      "contents": [
        "Profile information",
        "Account settings",
        "Learning progress",
        "Messages and communications",
        "Uploaded files",
        "Payment history",
        "Access logs"
      ],
      "processing_timeline": "30 days (GDPR requirement)",
      "delivery": "Secure download link (14-day expiration)",
      "encryption": "End-to-end encrypted transfer"
    }
  },
  "data_retention_exceptions": {
    "legal_holds": {
      "description": "Data cannot be deleted due to legal proceeding",
      "approval_required": true,
      "authorized_by": "Legal team",
      "retention_until": "Court order or legal team approval to delete"
    },
    "regulatory_requirements": {
      "tax_records": "7 years (IRS requirement)",
      "payment_records": "7 years (financial regulations)",
      "employment_records": "3 years (labor law)",
      "security_incidents": "3 years (security incident response)"
    },
    "contractual_obligations": {
      "data_processor_agreements": "Specified in DPA",
      "vendor_requirements": "As per SLA",
      "backup_retention": "As per backup policy"
    }
  },
  "storage_tiers": {
    "tier_1_hot": {
      "duration": "0-30 days",
      "storage_class": "S3 Standard / DynamoDB",
      "access_pattern": "Frequent (daily)",
      "cost": "High",
      "use_case": "Active user data, recent logs"
    },
    "tier_2_warm": {
      "duration": "30-365 days",
      "storage_class": "S3 Intelligent-Tiering / Glacier",
      "access_pattern": "Occasional (monthly)",
      "cost": "Medium",
      "use_case": "Audit logs, historical data"
    },
    "tier_3_cold": {
      "duration": "1-7 years",
      "storage_class": "S3 Glacier Deep Archive",
      "access_pattern": "Rare (annual)",
      "cost": "Low",
      "use_case": "Long-term archival, backup retention"
    },
    "tier_4_deleted": {
      "duration": "> retention period",
      "storage_class": "None (deleted)",
      "access_pattern": "None",
      "cost": "None",
      "use_case": "Permanent deletion"
    }
  },
  "compliance_verification": {
    "automated_checks": {
      "frequency": "Daily",
      "checks": [
        "Verify S3 bucket encryption enabled",
        "Verify versioning enabled on audit buckets",
        "Verify lifecycle policies configured",
        "Verify CloudTrail logging active",
        "Verify CloudWatch retention configured",
        "Verify KMS key rotation enabled"
      ],
      "tool": "AWS Config + Python Lambda function"
    },
    "manual_audits": {
      "frequency": "Quarterly",
      "scope": [
        "Review retention policy effectiveness",
        "Verify data deletion procedures followed",
        "Test data export functionality",
        "Review access logs for policy violations",
        "Verify backups can be restored"
      ],
      "responsibility": "Data Protection Officer"
    },
    "audit_trail": {
      "location": "s3://thebot-audit-logs-{account-id}-us-east-1/",
      "retention": "365 days minimum",
      "access_logging": "All access logged",
      "immutability": "S3 Object Lock (WORM)"
    }
  },
  "change_management": {
    "policy_review": {
      "frequency": "Annual",
      "trigger_events": [
        "Regulatory changes",
        "Legal requirement changes",
        "Business model changes",
        "Audit findings"
      ]
    },
    "approval_process": {
      "drafting": "Data Protection Officer",
      "review": "Legal team, Compliance officer",
      "approval": "Chief Compliance Officer, CEO",
      "implementation": "IT + Security teams"
    },
    "documentation": {
      "version_history": "Maintained in CLAUDE.md",
      "change_log": "docs/COMPLIANCE_AUDIT.md#CHANGELOG",
      "effective_dates": "All changes dated and timestamped"
    }
  },
  "implementation_checklist": {
    "infrastructure": {
      "cloudtrail_enabled": true,
      "cloudwatch_logs_configured": true,
      "s3_encryption_enabled": true,
      "kms_key_rotation": true,
      "backup_configured": true,
      "lifecycle_policies": true
    },
    "processes": {
      "data_classification": true,
      "deletion_procedures": true,
      "export_procedures": true,
      "incident_response": true,
      "audit_procedures": true
    },
    "monitoring": {
      "automated_checks": true,
      "alerts_configured": true,
      "log_aggregation": true,
      "compliance_dashboard": "In progress"
    }
  },
  "related_documents": {
    "policy_documents": [
      "docs/COMPLIANCE_AUDIT.md",
      "docs/PRIVACY_POLICY.md",
      "docs/GDPR_COMPLIANCE.md",
      "docs/DATA_PROCESSING_AGREEMENT.md"
    ],
    "technical_documentation": [
      "infrastructure/compliance/compliance-controls.tf",
      "infrastructure/compliance/audit-config.json",
      "docs/COMPLIANCE_AUDIT.md"
    ],
    "operational_guides": [
      "docs/DATA_DELETION_PROCEDURE.md",
      "docs/DATA_EXPORT_PROCEDURE.md",
      "docs/INCIDENT_RESPONSE_PLAN.md"
    ]
  },
  "glossary": {
    "GDPR": "General Data Protection Regulation (EU regulation on data protection)",
    "SOC2": "Service Organization Control 2 (Trust Service Criteria audit)",
    "DPA": "Data Processing Agreement (between controller and processor)",
    "PII": "Personally Identifiable Information",
    "RTO": "Recovery Time Objective (time to restore service)",
    "RPO": "Recovery Point Objective (maximum acceptable data loss)",
    "WORM": "Write Once Read Many (immutable storage)",
    "TTL": "Time To Live (cache expiration)"
  }
}
