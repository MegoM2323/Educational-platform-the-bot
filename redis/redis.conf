# Redis Production Configuration
# ============================================================================

# Network & Protocol
port 6379
bind 127.0.0.1
timeout 0
tcp-backlog 511
tcp-keepalive 300

# General
daemonize no
pidfile /var/run/redis.pid
loglevel notice
logfile ""
databases 16

# Persistence - AOF (Append Only File)
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec

# Auto rewrite AOF
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Rewrite AOF more aggressively
aof-rewrite-incremental-fsync yes
aof-load-truncated yes

# Persistence - RDB (Snapshot)
# Disable RDB in favor of AOF
save ""
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb

# Memory Management
maxmemory 512mb
maxmemory-policy allkeys-lru

# LRU samples for eviction policy
maxmemory-samples 5

# Keyspace notifications
notify-keyspace-events Ex

# Replication (Master-Slave)
# replicaof <masterip> <masterport>
replica-read-only yes
replica-serve-stale-data yes
repl-diskless-sync no
repl-diskless-sync-delay 5

# Min replicas for consistency
min-replicas-to-write 0
min-replicas-max-lag 10

# Security
requirepass redis
# maxclients 10000

# Slow Log
slowlog-log-slower-than 10000
slowlog-max-len 128

# Client Output Buffering Limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Hash Table Settings
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List Settings
list-max-ziplist-size -2
list-compress-depth 0

# Set Settings
set-max-intset-entries 512

# Sorted Set Settings
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog
hll-sparse-max-bytes 3000

# Active Defragmentation
activerehashing yes

# Lazy freeing for expensive delete operations
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no

# Defragmentation
# activedefrag yes
# active-defrag-ignore-bytes 100mb
# active-defrag-threshold-lower 10

# Latency Monitor
# latency-monitor-threshold 0

# Event notification
# notify-keyspace-events ""

# Protocol
# timeout 300
# tcp-keepalive 60

# ============================================================================
# PRODUCTION RECOMMENDATIONS
# ============================================================================
#
# 1. Enable requirepass with strong password
# 2. Use maxmemory and maxmemory-policy to prevent OOM
# 3. Enable AOF for persistence
# 4. Monitor slow queries with slowlog
# 5. Set up replication for backup
# 6. Use Redis Sentinel for automatic failover
# 7. Monitor memory and CPU usage
# 8. Regular backups of RDB/AOF files
# 9. Use Redis Cluster for horizontal scaling
# 10. Enable keyspace notifications for Celery
#
